import{s as pe,n as me,o as Ze,f as hn,r as Rn,b as ye,h as _e,i as Zo}from"../chunks/scheduler.7845d5a1.js";import{S as Ce,i as we,e as de,a as O,f as d,g as T,m as w,h as R,j as P,n as L,k as E,x as h,o as ue,s as S,c as Z,y as Ie,d as q,p as Pe,t as z,b as Be,z as ze,A as ve,r as Oe,u as Me,v as Te,w as Re,B as He,l as Qe,C as zo}from"../chunks/index.ecd21da0.js";function De(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var x=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(x||{}),H=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(H||{}),fe=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(fe||{}),ie=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(ie||{}),ee=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(ee||{}),A=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(A||{}),$=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))($||{});const pn=[{name:"Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:$.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Two-handed Sword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:$.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"Halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:$.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"Flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:$.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"Double Headed Axe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:$.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],An=[{name:"Orch Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:$.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Orch Bow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:$.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"Troll Club",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:$.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],et=[{name:"Chain mail",type:$.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"Plate mail",type:$.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"Dragon Skin mail",type:$.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],Gn=[{name:"Orch Mail",defense:0,magicProtection:!1,amountInDeck:4,type:$.ARMOUR,movementReduction:0,value:0},{name:"Troll Skin",defense:1,magicProtection:!1,amountInDeck:4,type:$.ARMOUR,movementReduction:0,value:0}],en=" ",qe="?",nn="#",ke=(e,n,o,t)=>({type:e,name:n,position:{x:o,y:t},found:!1}),Se=(e,n,o,t)=>({type:e,name:t.name,position:{x:n,y:o},found:!1,item:t}),V=(e,n,o)=>({side:e,x:n,y:o,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),nt=(e,n,o,t)=>({...V(e,n,o),trapped:!0,trapAttacks:t}),Ue=(e,n,o)=>({...V(e,n,o),hidden:!0}),gn=(e,n,o)=>({...V(e,n,o),locked:!0}),fn=(e,n,o,t)=>({...V(e,n,o),locked:!0,trapped:!0,trapAttacks:t}),ot=(e,n,o,t)=>({...V(e,n,o),hidden:!0,trapped:!0,trapAttacks:t}),tt=(e,n,o,t,s)=>{const i=ne(e,n,o,t);return i.inventory=s,i},ne=(e,n,o,t)=>{const s=Object.values(x).indexOf(n),i=Object.keys(x)[s];let r=fe.LORD,a=2,l=2,u=4,c=4,f=4,p=An[0],g,_=Gn[0];switch(e){case H.ORCH:{r=fe.APPRENTICE,l=0,u=2,c=2,f=1,g=An[1];break}case H.TROLL:{r=fe.KNIGHT,l=1,u=3,c=3,f=2,p=An[2],_=Gn[1];break}}return e===H.YELLOW_DARK_LORD&&(a=3),{type:e,level:r,colour:n,actions:a,defense:l,health:u,maxHealth:c,experience:f,name:e+" ("+i+")",movement:3,maxMovement:3,position:{x:o,y:t},weapon:p,armour:_,incapacitated:!1,inventory:[],rangedWeapon:g}},st=e=>{const n=e.currentActor;if(n.blinded){m(e,`${n.name} is blinded and may not search.`);return}const o=n.inventory.filter(l=>{var u;return(u=l.properties)==null?void 0:u[Un]}).map(l=>{var u;return m(e,`${n.name} used the effect of ${l.name} when searching`),(u=l.properties)==null?void 0:u[Un]}).reduce((l,u)=>l+u,0),t=Ve(n.level,1+o);let s,i,r,a;t>=1?(s=pt(e,n,t),s||(i=ct(e,n,t)),!s&&!i&&(r=ft(e,n,t)),!s&&!i&&!r&&(a=dt(e,n,t)),!s&&!i&&!r&&!a&&m(e,`${n.name} searched but found nothing`)):m(e,`${n.name} searched but found nothing`)},vo=e=>{const n=e.currentActor;if(!n)return!1;const o=e.dungeon.layout.secrets.filter(t=>t.type===ee.TRAP_DOOR).filter(t=>!t.found).find(t=>Ee(t.position,n.position));return o?(Fe(e,it(o),n,!1),m(e,`${n.name} fell into a pit and is incapacitated for one turn.`),n.movement=0,n.actions=0,n.incapacitated=!0,o.found=!0,!0):!1},ko=(e,n)=>{const o=e.itemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.itemDeck.splice(o,1)},bo=(e,n)=>{const o=e.magicItemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.magicItemDeck.splice(o,1)},it=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:x.Red,maxHealth:0,name:"Trap Door",level:fe.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:$.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),rt=(e,n)=>e.dungeon.layout.doors.filter(o=>o.hidden).find(o=>ln({x:o.x,y:o.y},n.x,n.y)),lt=(e,n)=>e.dungeon.layout.doors.filter(o=>o.trapped).find(o=>o.x===n.x&&o.y===n.y),at=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).find(o=>ln(o.position,n.x,n.y)),ut=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).filter(o=>o.type===ee.TRAP_DOOR).find(o=>ln(o.position,n.x,n.y)),ct=(e,n,o)=>{const t=rt(e,n.position);return t?(t.hidden=!1,m(e,`${n.name} searched (${o}) and found a hidden door`),!0):!1},ft=(e,n,o)=>{const t=lt(e,n.position);return t?(m(e,`${n.name} searched (${o}) and found a trap in a door`),t.trapped=!1,!0):!1},dt=(e,n,o)=>{const t=at(e,n.position);if(t){switch(m(e,`${n.name} searched (${o}) and found ${t.name}`),t.found=!0,t.type){case ee.EQUIPMENT:{const s=t.item??mt(e);s.amountInDeck>0&&(ko(e,s),m(e,`${n.name} equipped (${s.name})`),Do(e,s,n));break}case ee.MAGIC_ITEM:{const s=t.item??ht(e);s.amountInDeck>0&&(bo(e,s),m(e,`${n.name} found (${s.name})`),n.inventory.push(s),s.pickup&&wn[s.pickup](e,s,n));break}}return!0}return!1},mt=e=>{const n=e.itemDeck.length,o=Math.floor(Math.random()*n);return e.itemDeck[o]},ht=e=>{const n=e.magicItemDeck.length,o=Math.floor(Math.random()*n);return e.magicItemDeck[o]},pt=(e,n,o)=>{const t=ut(e,n.position);return t?(m(e,`${n.name} searched (${o}) and found ${t.name}`),t.found=!0,!0):!1},dn=(e,n)=>(pn[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:fe.APPRENTICE,health:7,maxHealth:7,colour:n,experience:0,position:{x:-1,y:-1},weapon:pn[0],incapacitated:!1,inventory:[],isInventoryOpen:!1}),xe=(e,n)=>{ce(n);const o=n.currentActor;if(!o||o.actions===0)return;const t={x:o.position.x,y:o.position.y};switch(e){case"UL":t.x=o.position.x-1,t.y=o.position.y-1;break;case"U":t.y=o.position.y-1;break;case"UR":t.x=o.position.x+1,t.y=o.position.y-1;break;case"L":t.x=o.position.x-1;break;case"R":t.x=o.position.x+1;break;case"DL":t.x=o.position.x-1,t.y=o.position.y+1;break;case"D":t.y=o.position.y+1;break;case"DR":t.x=o.position.x+1,t.y=o.position.y+1;break}const s=tn(n,t.x,t.y),i=!kn(n.dungeon.layout,t.x,t.y),r=on(n,t.x,t.y);if(!s&&!i){const a=rn(n.dungeon,t.x,t.y);a?a&&(r?Eo(o,n,t):Co(o,n,t.x,t.y,1)):vt(n,o,t.x,t.y)&&je(o,n,t.x,t.y)}else m(n,`${o.name} could not make that move`);vo(n)||Cn(o)},Ao=e=>{ce(e);const n=e.currentActor;if(!n)return;if(n.blinded){m(e,`${n.name} is blinded and may not search.`);return}if(!Ye(n)){m(e,`${n.name} has no actions left to pick lock`);return}const o=e.dungeon.layout.doors.find(t=>t.x===n.position.x&&t.y===n.position.y);o&&o.locked&&(Ve(n.level,1)>=1?(o.locked=!1,m(e,`${n.name} managed to pick the lock`)):m(e,`${n.name} failed to pick the lock`),n.actions>1&&n.movement<3?n.actions-=2:n.actions--,n.movement=Ne(n),n.actions==0&&(n.movement=0))},Dn=e=>{ce(e),e.heroes.forEach((n,o)=>{n.position=e.dungeon.startingPositions[o],n.movement=Ne(n),n.actions=2,n.health=n.maxHealth})},U=e=>e.heroes.filter(n=>n.health>0).map(n=>n),gt=e=>{ce(e);const n=e.currentActor;n&&(n.actions--,n.movement=Ne(n),n.actions===0&&Tn(e))},Ye=e=>e.movement<Ne(e)?e.actions>1:e.actions>0,je=(e,n,o,t)=>{ce(n);const s=Ae(n.dungeon.layout.grid,o,t);s&&![nn,en,qe].includes(s)&&n.dungeon.discoveredRooms.push(s),Co(e,n,e.position.x,e.position.y,1),m(n,`${e.name} opened a door`)},Eo=(e,n,o)=>{if(ce(n),e.actions===1&&e.movement<e.maxMovement){m(n,`${e.name} has no actions left to attack`);return}if(!e.weapon.useHearHeroes&&Et(n,e)){m(n,`${e.name} could not use ${e.weapon.name} near a friend.`);return}const t=At(n,o);t&&(Fe(n,e,t,!1),t.health<=0&&bt(n,t,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},Io=e=>{ce(e);const n=e.currentActor;if(n){if(n.blinded){m(e,`${n.name} is blinded and may not search.`);return}if(!Ye(n)){m(e,`${n.name} has no actions left to search`);return}st(e),n.actions>1&&n.movement<Ne(n)?n.actions-=2:n.actions--,n.actions==0&&(n.movement=0)}},on=(e,n,o)=>e.dungeon.layout.monsters.some(t=>t.position.x===n&&t.position.y===o&&t.health>0),tn=(e,n,o)=>U(e).some(t=>t.position.x===n&&t.position.y===o),Cn=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=Ne(e))),e.actions==0&&(e.movement=0)},yt=e=>{ce(e),U(e).forEach(n=>{const o=n.level;n.experience>=28?n.level=fe.MASTER:n.experience>=18?n.level=fe.LORD:n.experience>=10?n.level=fe.HERO:n.experience>=4&&(n.level=fe.KNIGHT),o!==n.level&&m(e,`${n.name} leveled up to ${n.level}`)})},_t=e=>{U(e).forEach(n=>n.experience+=1)},Oo=e=>{It(e).forEach(n=>{n.experience=0,n.health=n.maxHealth,n.movement=n.maxMovement,n.actions=2})},Mo=(e,n,o)=>!o.open&&!o.hidden&&(!o.locked||o.locked&&n)&&e.movement>0,To=(e,n)=>{const o=e.dungeon.layout.notes.find(t=>Ee(t.position,n.position));o&&(e.dungeon.layout.doors.some(s=>s.hidden&&Ee(o.position,{x:s.x,y:s.y}))||m(e,`${n.name} reads: ${o.message}`))},Ro=(e,n)=>{const o=e.dungeon.layout.monsters.some(t=>ln(n.position,t.position.x,t.position.y));return o&&m(e,`${n.name} walked by a monster and lost the momentum`),o},En=(e,n,o)=>{m(e,`${o.name} dropped ${n.name}.`),e.dungeon.layout.items.push({item:n,position:o.position}),n.drop&&Po[n.drop](e,n,o)},Do=(e,n,o)=>{switch(n.type){case $.ARMOUR:o.armour&&En(e,o.armour,o),o.armour=n;break;case $.SHIELD:o.shield&&En(e,o.shield,o),o.shield=n;break;case $.WEAPON:o.weapon&&En(e,o.weapon,o),o.weapon=n;break;default:o.inventory.push(n);break}if(n.pickup){const t=wn[n.pickup];t(e,n,o)}},Co=(e,n,o,t,s)=>{e.position.x=o,e.position.y=t,To(n,e),Ro(n,e)?e.movement=0:e.movement-=s},vt=(e,n,o,t)=>{const s=e.dungeon.layout.doors.find(r=>r.x===n.position.x&&r.y===n.position.y),i=n.inventory.some(r=>{var a;return(a=r.properties)==null?void 0:a[wo]});if(s&&Mo(n,i,s)){s.locked&&i&&m(e,`${n.name} broke the locked door`);const r=kt(n.position.x,n.position.y,o,t);if(s.side===r)return s.open=!0,s.trapped&&Fe(e,Xo(s),n,!1),!0}return s&&s.locked&&m(e,"Door is locked"),!1},kt=(e,n,o,t)=>{if(e===o){if(n>t)return A.UP;if(n<t)return A.DOWN}if(n===t){if(e>o)return A.LEFT;if(e<o)return A.RIGHT}},bt=(e,n,o)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(t=>t!=n),m(e,`${o.name} killed ${n.name}`),e.dungeon.killCount++,o.experience+=n.experience},At=(e,n)=>e.dungeon.layout.monsters.find(o=>Ee(o.position,n)),Et=(e,n)=>Jo(e,n).filter(o=>o!==n).length>0,It=e=>e.heroes.filter(n=>n.health<=0).map(n=>n),Le="USED",xn="ATTACK_BONUS",Un="SEARCH_BONUS",wo="BREAK_LOCK",Kn="RE_ROLL_ATTACK",mn="DESCRIPTION",yn="ACTIVE",_n="MOVEMENT_BONUS",Fn="ACTIONS_BONUS",Lo="RESET_ON",Ho="NEXT_TURN",Ot="TRADE",No="NEXT_SCENARIO",wn={movementBonusOnPickup:(e,n,o)=>{var t,s;o.maxMovement+=(t=n.properties)==null?void 0:t[_n],o.actions>0&&(o.movement+=(s=n.properties)==null?void 0:s[_n])}},Po={movementBonusOnDrop:(e,n,o)=>{var t,s;o.maxMovement-1>0&&(o.maxMovement-=(t=n.properties)==null?void 0:t[_n]),o.movement-1>=0&&(o.movement-=(s=n.properties)==null?void 0:s[_n])}},Mt={magicHerbsOnUse:(e,n,o,t)=>{if(n.disabled){m(e,`${n.name} cannot be used at this moment.`);return}if(!t){m(e,"No target was selected.");return}if(!Ye(o)){m(e,`${o.name} has no actions left.`);return}if(n.properties){if(n.properties[Le]){m(e,`${n.name} has no uses left.`);return}n.properties[Le]=!0;const s=Math.min(Ve(o.level,3),t.maxHealth-t.health);t.health+=s,m(e,`${o.name} used ${n.name} on ${t.name}, restoring ${s} HP`),o.actions--,o.movement=o.maxMovement}},chaosSwordOnUse:(e,n,o,t)=>{if(n.disabled){m(e,`${n.name} cannot be used at this moment. ${o.name} tried it.`);return}},potionOfSpeedOnUse:(e,n,o)=>{var t,s,i;if(n.disabled){m(e,`${n.name} cannot be used at this moment.`);return}(t=n.properties)!=null&&t[Le]?m(e,`${n.name} has been consumed.`):(o.actions+=(s=n.properties)==null?void 0:s[Fn],n.properties&&(n.properties[Le]=!0),m(e,`${o.name} used ${n.name}, adding ${(i=n.properties)==null?void 0:i[Fn]} actions`))},necklaceOfLightOnUse:(e,n,o,t)=>{var s;if(n.disabled){m(e,`${n.name} cannot be used at this moment.`);return}if(!t){m(e,"No target was selected.");return}if(!Ye(o)){m(e,`${o.name} has no actions left.`);return}n.properties&&!((s=n.properties)!=null&&s[Le])&&(n.properties[Le]=!0,t.ignoredByMonsters=!0,o.actions--)}},Bo={magicHerbsOnReset:(e,n)=>{n.properties&&(n.properties[Le]=!1)},necklaceOfLightOnUse:(e,n)=>{n.properties&&(n.properties[Le]=!1),e.heroes.forEach(o=>o.ignoredByMonsters=!1)}},Tt=(e,n)=>{if(n.effect&&e.currentActor){const o=Mt[n.effect];o(e,n,e.currentActor,e.targetActor),e.targetActor=void 0}},Go=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Dt(o)).forEach(o=>{if(o.reset){const t=Bo[o.reset];t(e,o)}})})},xo=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Rt(o)).forEach(o=>{if(o.reset){const t=Bo[o.reset];t(e,o)}})})},Rt=e=>e.properties?(e.properties[Lo]??[]).some(o=>o===Ho):!1,Dt=e=>e.properties?(e.properties[Lo]??[]).some(o=>o===No):!1,be=[{name:"Healing Herbs",type:$.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"Chance to heal up to 3 wounds on one hero.",RESET_ON:[Ot,No]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"Thousand League Boots",type:$.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives one additional step for each move action.",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"Giants Glove",type:$.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional attack die. Breaks locked doors.",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"Ring of Precision",type:$.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"May re-roll one completely missed attack.",RE_ROLL_ATTACK:!0}},{name:"Crown of Wisdom",type:$.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional die roll when searching.",SEARCH_BONUS:1}},{name:"Sword of Chaos",type:$.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"A sword with a will of it's own. Use at your own peril."},effect:"chaosSwordOnUse"},{name:"Potion of Speed",type:$.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives 2 additional actions. Can only be used once.",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"Necklace of Light",type:$.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[Ho],ACTIVE:!0},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],Uo={name:"The Dread Labyrinth",beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1},{type:ie.OPEN_DOOR,targetCell:{x:18,y:4},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["       ########     ","     ###DDDEEE#     ","     #CCC##EEE#     ","######CCC##EEE######","#AAA##CCC####F#IIII#","#AAABBB#J####F#IIII#","#AAA####J##G#F#IIII#","##### ##J##GGF#IIII#","   ####KKK###F#IIII#","   #LLLKKK# #FMIIII#","   ####KKK####M#####","      #KKKMMMMM#    ","      ####MMMM##    ","         ######     "],corridors:["B","D","F","L"],pits:[{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:15,y:8},{x:16,y:8},{x:17,y:8}],doors:[V(A.RIGHT,3,5),fn(A.DOWN,6,5,1),V(A.UP,6,5),V(A.DOWN,8,4),Ue(A.UP,8,2),V(A.DOWN,8,7),V(A.LEFT,7,9),fn(A.LEFT,4,9,1),fn(A.RIGHT,9,11,1),Ue(A.RIGHT,14,9),Ue(A.UP,18,4),fn(A.LEFT,14,9,1),V(A.LEFT,13,7),gn(A.UP,11,6),V(A.UP,13,4),V(A.LEFT,11,1)],monsters:[ne(H.ORCH,x.Yellow,5,5),tt(H.TROLL,x.Yellow,7,3,[be[3]]),ne(H.ORCH,x.Red,7,11),ne(H.ORCH,x.Blue,11,2),ne(H.ORCH,x.Blue,14,11),ne(H.YELLOW_DARK_LORD,x.Yellow,18,5)],secrets:[Se(ee.MAGIC_ITEM,8,10,be[2]),ke(ee.TRAP_DOOR,"Trap door",8,6),ke(ee.TRAP_DOOR,"Trap door",11,1),ke(ee.TRAP_DOOR,"Trap door",11,7),ke(ee.TRAP_DOOR,"Trap door",13,11)],notes:[{position:{x:6,y:5},message:"An arrow on the far wall of the corridor points to the left."},{position:{x:8,y:3},message:"An arrow on the far wall of the corridor points to the right."},{position:{x:8,y:8},message:"There is a mosaic in the floor. It depicts a snake coiling around a dwarf, while battling an ice dragon. In the jaws of the snake is treasure chest."},{position:{x:14,y:10},message:"An arrow on the far wall of the corridor points to the left"}],items:[]},killCount:0},Ko={name:"The Mines of Evil",nextDungeon:Uo,beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1},{type:ie.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[V(A.UP,2,13),V(A.UP,2,10),V(A.RIGHT,3,8),gn(A.RIGHT,6,8),V(A.UP,8,7),V(A.UP,8,4),Ue(A.LEFT,7,2),V(A.LEFT,4,2),gn(A.RIGHT,12,2),V(A.RIGHT,15,2),V(A.DOWN,17,7),V(A.DOWN,17,10),Ue(A.DOWN,17,14)],monsters:[ne(H.TROLL,x.Red,3,7),ne(H.ORCH,x.Red,12,8),ne(H.ORCH,x.Green,11,1),ne(H.TROLL,x.Green,2,2),ne(H.ORCH,x.Yellow,18,7),ne(H.TROLL,x.Yellow,17,10)],secrets:[ke(ee.EQUIPMENT,"Equipment",1,3),ke(ee.EQUIPMENT,"Equipment",3,3),ke(ee.EQUIPMENT,"Equipment",15,2),Se(ee.MAGIC_ITEM,2,3,be[1]),Se(ee.MAGIC_ITEM,16,11,be[6])],notes:[{message:"Guard room",position:{x:2,y:10}},{message:"Look in the pillar room for the armory of the dwarf king",position:{x:8,y:10}},{message:"To reach the treasure of the ice dragon, look behind the mirror in the alchemy laboratory.",position:{x:2,y:3}},{message:"A large mirror decorates the far wall of this room.",position:{x:17,y:11}}],items:[]},killCount:0},Fo={name:"The Three Gates of Power",nextDungeon:Ko,beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1},{type:ie.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[V(A.RIGHT,3,5),V(A.RIGHT,6,5),V(A.RIGHT,10,6),V(A.RIGHT,13,6),V(A.RIGHT,10,9),V(A.RIGHT,13,9),V(A.RIGHT,12,3),Ue(A.UP,9,4),Ue(A.RIGHT,15,2)],monsters:[ne(H.ORCH,x.Blue,10,8),ne(H.ORCH,x.Red,13,9),ne(H.TROLL,x.Red,16,2),ne(H.TROLL,x.Yellow,14,7)],secrets:[ke(ee.EQUIPMENT,"Random Equipment",10,5),ke(ee.EQUIPMENT,"Random Equipment",13,1),ke(ee.EQUIPMENT,"Random Equipment",16,10),Se(ee.MAGIC_ITEM,16,6,be[0])],notes:[{message:"Beyond stone and fire you shall find the Dread tunnel, the road to the Ice Dragons treasure.",position:{x:2,y:4}},{message:"The Gate of Water. <There is an image of a sea dragon under the text>",position:{x:9,y:8}},{message:"The Gate of Air. <There is an image of a pegasus under the text>",position:{x:9,y:5}},{message:"The Gate of Fire. <There is an image of a hippogriph under the text>",position:{x:9,y:3}}],items:[]},killCount:0},Wo={name:"Troll cave",beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1}],nextDungeon:Fo,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[V(A.RIGHT,3,9),V(A.RIGHT,6,9),V(A.UP,7,7),V(A.UP,7,4)],monsters:[ne(H.ORCH,x.Green,6,9),ne(H.ORCH,x.Yellow,8,10),ne(H.ORCH,x.Red,7,5),ne(H.ORCH,x.Red,9,3),ne(H.TROLL,x.Green,6,1)],secrets:[ke(ee.NOTE,"Welcome to Drakriddarna",3,9)],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},Ct=[{name:"Large shield",type:$.SHIELD,amountInDeck:2,dice:2,value:2},{name:"Small shield",type:$.SHIELD,amountInDeck:2,dice:1,value:1}],wt=()=>{const e=[];return be.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},Lt=()=>{const e=[];return pn.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),et.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),Ct.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},We={name:"Treasure of the Ice Dragon",dungeons:[Wo,Fo,Ko,Uo],itemDeck:Lt(),magicItemDeck:wt(),heroes:[dn("Fearik",x.Yellow),dn("Helbran",x.Red),dn("Siedel",x.Green),dn("Wulf",x.Blue)]},Ln=(e,n)=>{const o=Math.abs(n.x-e.x),t=Math.abs(n.y-e.y),s=Math.min(o,t),i=Math.max(o,t),r=s,a=i-s;let l=Math.sqrt(2);return a===0&&(l=1),Math.floor(l*r+a)},Ht=(e,n)=>{ce(e);const o=e.currentActor,t=e.dungeon.layout.items.find(i=>Ee(i.position,o.position));if(t){const i=t.item;i.type===$.MAGIC?bo(e,i):ko(e,i);const r=e.dungeon.layout.items.indexOf(t);e.dungeon.layout.items.splice(r,1),m(e,`${o.name} picked up ${i.name}`),Do(e,i,o);return}const s=e.dungeon.layout.doors.find(i=>i.x===o.position.x&&i.y===o.position.y&&!i.open);if(s&&!s.hidden){const i=o.inventory.some(r=>{var a;return(a=r.properties)==null?void 0:a[wo]});if(Mo(o,i,s)){switch(s.locked&&i&&m(e,`${o.name} broke the locked door`),s.open=!0,s.trapped&&Fe(e,Xo(s),o,!1),s.side){case A.RIGHT:je(o,e,n.x+1,n.y);break;case A.LEFT:je(o,e,n.x-1,n.y);break;case A.DOWN:je(o,e,n.x,n.y+1);break;case A.UP:je(o,e,n.x,n.y-1);break}Cn(o)}else if(s.locked&&!s.hidden){if(!Ye(o)){m(e,`${o.name} has no actions left`);return}m(e,"Door is locked"),Ao(e)}}else{if(!Ye(o)){m(e,`${o.name} has no actions left`);return}Io(e)}},Nt=(e,n)=>{ce(e);const o=e.currentActor;if(o.actions===0){o.movement=0,m(e,`${o.name} has no actions left`);return}if(kn(e.dungeon.layout,n.x,n.y)){const s=tn(e,n.x,n.y),i=on(e,n.x,n.y),r=Ln(o.position,n),a=Hn(o.position,n,2,e,!0);if(!s&&!i&&r<=o.movement&&a){if(o.position=n,o.movement-=r,To(e,o),Ro(e,o)&&(o.movement=0),vo(e))return}else i&&(r<=o.weapon.range?Eo(o,e,n):m(e,"Monster is out of range"))}Cn(o)},Pt=(e,n,o)=>{const t=document.getElementById("gameBoard");if(!t)return;const s=t.getBoundingClientRect(),i=Math.min(Math.floor((e.clientX-s.left)/n),o.dungeon.layout.grid[0].length-1),r=Math.min(Math.floor((e.clientY-s.top)/n),o.dungeon.layout.grid.length-1),a=o.dungeon.layout.grid[r][i],l=o.currentActor;i===l.position.x&&r===l.position.y?Ht(o,{x:i,y:r}):Ke(o.dungeon,a)&&Nt(o,{x:i,y:r})},In=e=>e.dungeon.layout.monsters.filter(n=>[H.ORCH,H.TROLL].includes(n.type)),Bt=e=>{const n=Ft(e);n.length===0&&m(e,"No monsters can act"),n.forEach(o=>{const t=o.actions;for(m(e,`${o.name} acted `);o.actions>0;){ce(e);const s=Jo(e,o).filter(c=>!c.ignoredByMonsters),i=Kt(e,o),r=Vt([...i,...In(e)],o),a=qt([...i,...In(e)],o),l=Xt([...U(e),...In(e)],o,e);switch(Gt(e,o,s,i,r,a,l)){case"MELEE_ATTACK":{const c=Ut(s);Wn(e,o,c,!1);break}case"RANGED_ATTACK":{const c=xt(i,o);Wn(e,o,c,!0);break}case"MOVE":{$t(e,o);break}case"DIAGONAL_FIRE_ATTACK":On(e,o,r);break;case"ORTHOGONAL_FIRE_ATTACK":On(e,o,a);break;case"SAME_ROOM_FIRE_ATTACK":On(e,o,l)}o.movement=Ne(o)}o.actions=t,o.movement=Ne(o)})},Gt=(e,n,o,t,s,i,r)=>o.length>0?"MELEE_ATTACK":!n.rangedWeapon&&s.length===0?"MOVE":t.length>0&&n.rangedWeapon?Math.random()<.1?(m(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"RANGED_ATTACK":r.length>0?Math.random()<.1?(m(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"SAME_ROOM_FIRE_ATTACK":t.length>0&&i.length>0?Math.random()<.1?(m(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"ORTHOGONAL_FIRE_ATTACK":t.length>0&&s.length>0?Math.random()<.1?(m(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"DIAGONAL_FIRE_ATTACK":"MOVE",xt=(e,n)=>e.filter(o=>!o.shield).sort(o=>Je(n.position,o.position)).sort((o,t)=>t.health-o.health||Je(n.position,o.position)-Je(n.position,t.position))[0],Ut=e=>e.sort((n,o)=>o.health-n.health)[0],Kt=(e,n)=>U(e).filter(o=>!o.ignoredByMonsters).filter(o=>Hn(n.position,o.position,48,e,!1)),Ft=e=>e.dungeon.layout.monsters.filter(n=>{const o=Ae(e.dungeon.layout.grid,n.position.x,n.position.y);return o&&Ke(e.dungeon,o)&&n.health>0}),Wn=(e,n,o,t)=>{Fe(e,n,o,t),(n==null?void 0:n.actions)>1&&(n==null?void 0:n.movement)<3?n.actions-=2:n.actions--},Wt=(e,n)=>U(e).map(o=>({hero:o,dist:Je(o.position,n.position)})).sort((o,t)=>o.dist-t.dist)[0],$t=(e,n)=>{const o=Wt(e,n);for(;n.movement>0;){if(o&&o.dist>1){const t=Yt(e,n.position);if(t.length>0){const s=t.map(i=>({pos:i,dist:Je(i,o.hero.position)})).sort((i,r)=>i.dist-r.dist)[0].pos;n.position=s,m(e,`${n.name} moved towards ${o.hero.name} (${s.x},${s.y})`)}else m(e,`${n.name} could not move`)}n.movement--}n.actions--},Yt=(e,n)=>{const o=n.x,t=n.y,s=[];for(let i=o-1;i<=o+1;i++)for(let r=t-1;r<=t+1;r++)i===o&&r===t||kn(e.dungeon.layout,i,r)&&rn(e.dungeon,i,r)&&s.push({x:i,y:r});return s.filter(i=>!U(e).find(r=>r.position.x===i.x&&r.position.y===i.y)).filter(i=>!e.dungeon.layout.monsters.some(r=>r.position.x===i.x&&r.position.y===i.y))},Vt=(e,n)=>e.filter(o=>[H.YELLOW_DARK_LORD,H.BLUE_DARK_LORD].includes(n.type)&&Math.abs(n.position.x-o.position.x)===Math.abs(n.position.y-o.position.y)&&Ln(n.position,o.position)>1),qt=(e,n)=>e.filter(o=>[H.RED_DARK_LORD,H.BLUE_DARK_LORD].includes(n.type)&&(n.position.x===o.position.x||n.position.y===o.position.y)&&Ln(n.position,o.position)>1),Xt=(e,n,o)=>e.filter(t=>[H.GREEN_DARK_LORD,H.BLUE_DARK_LORD].includes(n.type)&&Ae(o.dungeon.layout.grid,n.position.x,n.position.y)===Ae(o.dungeon.layout.grid,t.position.x,t.position.y)),On=(e,n,o)=>{o.forEach(t=>{var s,i;(s=t.armour)!=null&&s.magicProtection?m(e,`${n.name} attempted a fire attack, but ${t.name}s ${(i=t.armour)==null?void 0:i.name} deflected it.`):Fe(e,n,t,!0)})},$n=[{name:"The Hungry Troll",number:1,description:"You suddenly hear a terrible roar echo in the halls behind you. It's the sound of a hungry troll",effect:"theHungryTroll",used:!1},{name:"The Sun Stone",number:2,description:"One of you kicks a pile of rubble, revealing a small, transparent crystal. It radiates a warm, yellow light turning all nearby trolls to stone.",effect:"sunStone",used:!1},{name:"The Time Portal",number:3,description:"You notice how everything around you seem to move slower, as if time it self had slowed down.",effect:"timePortal",used:!1},{name:"The Fountain of Youth",number:4,description:"You hear the weak sound of water running from a wall. When you taste it, you feel stronger than before",effect:"fountainOfYouth",used:!1},{name:"Sleeping Gas Cloud",number:5,description:"Noxious gas seeps through a hole in the wall, making you feel heavy and sleepy.",effect:"sleepingGasCloud",used:!1},{name:"The Lost Orch",number:6,description:"You hear a snarling filled with rage somewhere behind you. You quickly realise there were more monsters here than you thought.",effect:"theLostOrch",used:!1},{name:"The Dragons Breath",number:7,description:"The flames of your torches start to flicker and soon the dungeon is completely dark.",effect:"theDragonsBreath",used:!1},{name:"Landslide",number:8,description:"The ground starts shaking, and you hear a loud crash, as if the ceiling had fallen down.",effect:"landslide",used:!1},{name:"The Magic Node",number:9,description:"You feel a strange, powerful magic course through you. You feel invigorated by it as you press on.",effect:"fountainOfYouth",used:!1},{name:"Foresight",number:10,description:"You see before you a powerful object, hidden behind thick walls.",effect:"foresight",used:!1},{name:"Earthquake",number:11,description:"The whole room starts shaking and you are thrown to the ground. Stones fall from the ceiling and walls and with terror you realise that you ar caught in an earhtquake.",effect:"earthquake",used:!1},{name:"The Magic Storm",number:12,description:"An unsettling wind blows through the dungeon. You freeze as a green glow emanates from one of your magical items",effect:"theMagicStorm",used:!1},{name:"The Elemental Weapon",number:13,description:"A flame suddenly shoots from a silver clad stone in the ceiling, moving towards one of your weapons. The weapon becomes engulfed in flames, feeling more powerful than before.",effect:"theElementalWeapon",used:!1},{name:"The Orch Drums",number:14,description:"You hear the sound of drums from deep below you. As the sound draws nearer, you realise the orchs are on the march.",effect:"theOrchDrums",used:!1},{name:"The Symbol of Weakness",number:15,description:"You walk past a strange symbol on the wall. An evil, yellow glow emanates from it. All of you suddenly feel weaker.",effect:"theSymbolOfWeakness",used:!1}],$o=e=>e.events?Mn($n.filter(n=>{var o;return(o=e==null?void 0:e.events)==null?void 0:o.includes(n.number)})):Mn($n),Yo=e=>{const n=e.eventDeck.filter(o=>!o.used);return n.length>0?n[0]:(Mn(e.eventDeck),Yo(e))},jt={sunStone:(e,n)=>{ge(e,n);const o=U(e).length-1,t=Math.floor(Math.random()*o),s=U(e)[t],i=Ae(e.dungeon.layout.grid,s.position.x,s.position.y);e.dungeon.layout.monsters.filter(r=>r.type===H.TROLL).filter(r=>Ae(e.dungeon.layout.grid,r.position.x,r.position.y)===i).forEach(r=>{m(e,`${r.name} was killed by the Sun Stone`),r.health=0}),n.used=!0},theHungryTroll:(e,n)=>{ge(e,n),Yn(e,H.TROLL),n.used=!0},timePortal:(e,n)=>{ge(e,n),e.heroes.forEach(o=>o.actions++),n.used=!0},fountainOfYouth:(e,n)=>{ge(e,n),U(e).forEach(o=>{if(o.health<o.maxHealth){const t=Ve(o.level,3);o.health+=Math.min(t,o.maxHealth-o.health)}}),n.used=!0},sleepingGasCloud:(e,n)=>{ge(e,n),U(e).forEach(o=>{o.actions=Math.max(1,o.actions-1)}),n.used=!0},theLostOrch:(e,n)=>{ge(e,n),Yn(e,H.ORCH),n.used=!0},theDragonsBreath:(e,n)=>{ge(e,n),U(e).forEach(o=>o.blinded=!0),n.used=!0},landslide:(e,n)=>{ge(e,n);const o=e.dungeon.layout.corridors.filter(r=>!ns(e,r)).filter(r=>Ke(e.dungeon,r)),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];e.dungeon.collapsedCorridor=i,e.dungeon.layout.grid=e.dungeon.layout.grid.map(r=>r.replaceAll(i,qe)),n.used=!0},foreSight:(e,n)=>{if(ge(e,n),e.dungeon.layout.secrets.filter(t=>t.type===ee.EQUIPMENT||t.type===ee.MAGIC_ITEM).filter(t=>!t.found).filter(t=>t.item).filter(t=>{const s=Ae(e.dungeon.layout.grid,t.position.x,t.position.y)??"";return!Ke(e.dungeon,s)}).length>0){const t=e.dungeon.layout.secrets.pop();t&&t.item&&(m(e,`You sense the object is close to (${t.position.x+2},${t.position.y-1})`),e.dungeon.layout.items.push({item:t.item,position:t.position}))}n.used=!0},earthquake:(e,n)=>{ge(e,n);const o=Vo(e),t={name:"boulder",type:$.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},s={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:t,level:fe.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:x.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(i=>i.type===H.TROLL).filter(i=>Ae(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>Fe(e,s,i,!1)),U(e).filter(i=>Ae(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>Fe(e,s,i,!1)),n.used=!0},theMagicStorm:(e,n)=>{var t;ge(e,n);const o=U(e).filter(s=>s.inventory.filter(i=>!i.disabled).some(i=>i.type===$.MAGIC));if(o.length>0){const s=o.length-1,i=Math.floor(Math.random()*s),r=o[i],a=r.inventory.filter(l=>l.type===$.MAGIC);if(a.length>0){const l=a.length-1,u=Math.floor(Math.random()*l),c=a[u];c.disabled=!0,!((t=c.properties)!=null&&t[yn])&&c.pickup&&c.drop&&Po[c.drop](e,c,r)}}n.used=!0},theElementalWeapon:(e,n)=>{ge(e,n);const o=U(e),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];i.weapon.elemental=!0,n.used=!0},theOrchDrums:(e,n)=>{ge(e,n),e.dungeon.layout.monsters.filter(o=>o.type===H.ORCH).forEach(o=>o.actions=3),n.used=!0},theSymbolOfWeakness:(e,n)=>{ge(e,n),U(e).forEach(o=>o.weakened=!0),n.used=!0}},Jt=e=>{U(e).some(n=>n.weapon.elemental)&&(m(e,"The magic storm calmed down"),U(e).forEach(n=>{n.inventory.forEach(o=>{var t;!((t=o.properties)!=null&&t[yn])&&o.pickup&&wn[o.pickup](e,o,n),o.disabled=!1})}))},Qt=e=>{e.eventDeck.filter(o=>!o.used).length===0&&(zt(e),St(e),Jt(e)),es(e),Zt(e)},St=e=>{const n=e.dungeon.collapsedCorridor;n&&(m(e,"The collapsed corridor cleared up."),e.dungeon.layout.grid=e.dungeon.layout.grid.map(o=>o.replaceAll(qe,n)),e.dungeon.collapsedCorridor=void 0)},Zt=e=>{U(e).some(n=>n.blinded)&&(m(e,"You light your torches again."),U(e).forEach(n=>n.blinded=!1))},zt=e=>{U(e).some(n=>n.weapon.elemental)&&(m(e,"The elemental magic died off."),U(e).forEach(n=>n.weapon.elemental=!1))},es=e=>{U(e).some(n=>n.weakened)&&(m(e,"Your strength returns to you."),U(e).forEach(n=>n.weakened=!1))},Vo=e=>{const n=e.dungeon.discoveredRooms.length-1,o=Math.floor(Math.random()*n);return e.dungeon.discoveredRooms[o]},Yn=(e,n)=>{const o=e.dungeon.layout.monsters.filter(a=>a.type===n);if(o.length===4)return;const s=Vo(e),i=[x.Red,x.Green,x.Yellow,x.Blue];o.forEach(a=>{const l=i.indexOf(a.colour);l!==-1&&i.splice(l,1)});let r=!1;for(let a=0;a<e.dungeon.layout.grid.length;a++){const l=sn(e.dungeon.layout.grid[a]);for(let u=0;u<l.length;u++)if(l[u]===s&&!tn(e,u,a)&&!on(e,u,a)){e.dungeon.layout.monsters.push(ne(n,i[0],u,a)),r=!0;break}if(r)break}},ge=(e,n)=>{m(e,`${n.description}`),m(e,`${n.number}. ${n.name}`)},Mn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e.forEach(t=>t.used=!1),e},ns=(e,n)=>{const o=[];return e.dungeon.layout.grid.forEach((t,s)=>{sn(t).forEach((i,r)=>{i===n&&o.push(tn(e,r,s)||on(e,r,s))})}),o.some(t=>t)},os=e=>{ce(e),m(e,"Game saved."),localStorage.setItem("state",JSON.stringify(e))},ce=e=>{e.reRender=!0,localStorage.setItem("reloadGuard",JSON.stringify(e))},ts=e=>(e.currentActor=e.heroes.find(n=>{var o;return n.name===((o=e.currentActor)==null?void 0:o.name)}),m(e,"Game loaded."),ce(e),e),qo=()=>{const e={heroes:We.heroes,dungeon:We.dungeons[0],currentActor:We.heroes[0],actionLog:[`Playing '${We.name}'`,"Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."],itemDeck:Vn(We.itemDeck),magicItemDeck:Vn(We.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:$o(We.dungeons[0]),reRender:!0};return Dn(e),localStorage.setItem("autosave",JSON.stringify(e)),e},Vn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e},sn=e=>{const n=[];for(let o=0;o<e.length;o++)n.push(e[o]);return n},Ve=(e,n)=>{let o=[];for(let t=0;t<n;t++)o.push(Math.floor(Math.random()*6)+1);switch(e){case fe.APPRENTICE:o=o.filter(t=>t===5);break;case fe.KNIGHT:case fe.HERO:o=o.filter(t=>t>=4);break;case fe.LORD:case fe.MASTER:o=o.filter(t=>t>=3);break}return o.length},Ne=e=>{var n;return e.maxMovement-(((n=e.armour)==null?void 0:n.movementReduction)??0)},ss=e=>e.dungeon.winConditions.filter(n=>n.type!==ie.KILL_ALL).some(n=>!n.fulfilled),Tn=e=>{if(e.settings.debug&&console.log(e),ce(e),rs(e),e.currentActor===void 0)return e;{m(e,`${e.currentActor.name} ended their turn`);let o=U(e).indexOf(e.currentActor)+1;if(o===U(e).length&&(Bt(e),o=0,xo(e)),U(e).length===0)return is(e);if(U(e)[o].incapacitated&&(m(e,`${U(e)[o].name} is no longer incapacitated.`),U(e)[o].incapacitated=!1,o++),e.currentActor.actions=2,e.currentActor.movement=Ne(e.currentActor),e.currentActor=U(e)[o],o===0&&ss(e)){Qt(e);const t=Yo(e);jt[t.effect](e,t)}m(e,`${e.currentActor.name} started their turn`)}return e},is=e=>{const n=localStorage.getItem("autosave");if(n){const o=JSON.parse(n);return ce(o),Oo(o),Dn(o),Go(o),xo(o),jo({x:o.dungeon.startingPositions[0].x,y:o.dungeon.startingPositions[0].y},o.settings.cellSize),o.currentActor=o.heroes.find(t=>{var s;return t.name===((s=o.currentActor)==null?void 0:s.name)}),m(o,"All the heroes fell in combat. But worry not, you can try again."),o}return m(e,"Failed to reset level. Please reload."),e},rs=e=>{var n,o;e.dungeon.winConditions.forEach(t=>{var s;switch(t.type){case ie.KILL_ALL:{const i=e.dungeon.layout.monsters.map(r=>r.health).reduce((r,a)=>r+a,0);t.fulfilled=i<=0;break}case ie.REACH_CELL:{t.fulfilled=U(e).some(i=>{var r;return i.position.x===((r=t.targetCell)==null?void 0:r.x)&&i.position.y===t.targetCell.y});break}case ie.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(i=>i.type===t.targetMonsterType).some(i=>i.health>0);break}case ie.OPEN_DOOR:{t.fulfilled=((s=e.dungeon.layout.doors.find(i=>{var r,a;return i.x===((r=t.targetCell)==null?void 0:r.x)&&i.y===((a=t.targetCell)==null?void 0:a.y)}))==null?void 0:s.open)??!1;break}case ie.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,s)=>t&&s,!0),e.dungeon.beaten&&(m(e,"All win conditions have been fulfilled"),m(e,`You have cleared ${e.dungeon.name}`),(n=e.dungeon.nextDungeon)!=null&&n.name&&m(e,`Press 'Next' to move on to the next level: ${(o=e.dungeon.nextDungeon)==null?void 0:o.name}`))},Xo=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:x.Red,maxHealth:0,name:"Door",level:fe.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:$.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),kn=(e,n,o)=>{var s,i;let t=!0;if(n<0||n>=e.grid[0].length||o<0||o>=e.grid.length)t=!1;else{const r=(s=e.pits)==null?void 0:s.some(u=>Ee(u,{x:n,y:o})),a=(i=e.pillars)==null?void 0:i.some(u=>Ee(u,{x:n,y:o})),l=Ae(e.grid,n,o);(r||a||l===en||l===nn)&&(t=!1)}return t},rn=(e,n,o)=>{const t=Ae(e.layout.grid,n,o);return t?Ke(e,t):!1},Ke=(e,n)=>e.discoveredRooms.includes(n),Ae=(e,n,o)=>{let t="";return e.forEach((s,i)=>{sn(s).forEach((r,a)=>{i===o&&a===n&&(t=r)})}),t},ln=(e,n,o)=>e.x===n&&e.y===o||e.x===n-1&&e.y===o||e.x===n-1&&e.y===o-1||e.x===n&&e.y===o-1||e.x===n+1&&e.y===o-1||e.x===n+1&&e.y===o||e.x===n+1&&e.y===o+1||e.x===n&&e.y===o+1||e.x===n-1&&e.y===o+1,ls=(e,n,o,t)=>{var i;const s=((i=t.armour)==null?void 0:i.defense)??t.defense;return`${e} damage (${n}-(${s}+${o})=${e})`},Ee=(e,n)=>e.x===n.x&&e.y===n.y,m=(e,n)=>{e.actionLog=[n,...e.actionLog],ce(e)},Fe=(e,n,o,t)=>{var I,M;let s=n.weapon;t&&n.rangedWeapon&&(s=n.rangedWeapon);let i=0,r=0;s.ignoresArmour?o.armour&&m(e,`${o.name}'s armour was useless against ${s.name} `):i=((I=o.armour)==null?void 0:I.defense)??o.defense,s.ignoresShield?o.shield&&m(e,`${o.name}'s shield was useless against ${s.name} `):r=Ve(o.level,((M=o.shield)==null?void 0:M.dice)??0);const a=n.inventory.filter(y=>{var b;return(b=y==null?void 0:y.properties)==null?void 0:b[Kn]}).some(y=>{var b;return m(e,`${n.name} used the effect of ${y.name} when attacking`),(b=y.properties)==null?void 0:b[Kn]}),l=n.inventory.filter(y=>{var b;return(b=y==null?void 0:y.properties)==null?void 0:b[xn]}).map(y=>{var b;return m(e,`${n.name} used the effect of ${y.name} when attacking`),(b=y.properties)==null?void 0:b[xn]}).reduce((y,b)=>y+b,0),u=n.blinded?1:0,c=n.weakened?1:0,f=n.weapon.elemental?1:0,p=l+f,g=u+c,_=Ve(n.level,s.dice+p-g);let v=Math.max(_-(i+r),0);v===0&&a&&(m(e,`${n.name} missed but got another chance`),v=Math.max(_-(i+r),0)),o.health-=v,m(e,`${n.name} attacked ${o.name} with ${s.name} for ${ls(v,_,r,o)}`),o.health<=0&&(m(e,`${n.name} killed ${o.name}`),o.health=0,o.level=fe.APPRENTICE)},jo=(e,n)=>{const o=document.getElementById("gameBoardContainer"),t=document.getElementById("gameBoard");if(o&&t){const s=e.x*n,i=e.y*n,r=t.offsetWidth,a=t.offsetHeight;o.scrollLeft=Math.round(s/r),o.scrollTop=Math.round(i/a)}},as=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=["You have reached "+e.dungeon.name],e.eventDeck=$o(e.dungeon),ce(e),_t(e),yt(e),Oo(e),Dn(e),Go(e),jo({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize),localStorage.setItem("autosave",JSON.stringify(e)))},Je=(e,n)=>Math.sqrt(Math.pow(e.x-(n==null?void 0:n.x),2)+Math.pow(e.y-(n==null?void 0:n.y),2)),Hn=(e,n,o,t,s)=>{const i={x:e.x*o-Math.floor(o/2),y:e.y*o-Math.floor(o/2)},r={x:n.x*o-Math.floor(o/2),y:n.y*o-Math.floor(o/2)};return Nn(i,e,r,n,o,t,s,[])},Nn=(e,n,o,t,s,i,r,a)=>{var v,I;if(isNaN(e.x)||isNaN(e.y))return!1;const l=us(e,o),u={x:Math.round((l.x+Math.floor(s/2))/s),y:Math.round((l.y+Math.floor(s/2))/s)};if(isNaN(u.x)||isNaN(u.y)||isNaN(l.x)||isNaN(l.y))return!1;const c=Ae(i.dungeon.layout.grid,u.x,u.y),f=(v=i.dungeon.layout.pits)==null?void 0:v.some(M=>Ee(M,u)),p=(I=i.dungeon.layout.pillars)==null?void 0:I.some(M=>Ee(M,u)),g=i.dungeon.layout.monsters.some(M=>Ee(M.position,u)),_=U(i).filter(M=>!Ee(M.position,n)).some(M=>Ee(M.position,u));return u.x===t.x&&u.y===t.y?(a.push(u),!0):p||g||!r&&_||c===nn||c===qe||r&&(f||c===en)?!1:(u.x===n.x&&u.y===n.y||a.some(M=>M.x===u.x&&M.y===u.y)||a.push(u),Nn(l,n,o,t,s,i,r,a))},us=(e,n)=>{const o=e.x,t=e.y,s=n.x-o,i=n.y-t,r=s/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),a=i/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),l=Math.round(r+o),u=Math.round(a+t);return{x:l,y:u}},Jo=(e,n)=>U(e).filter(o=>ln(n.position,o.position.x,o.position.y)),cs=""+new URL("../assets/Dungeon_Tileset.e372bb4f.png",import.meta.url).href,fs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",ds=(e,n,o,t,s)=>{U(t).forEach(r=>{ms(e,r,n,o,s)}),ys(e,t,o),_s(e,t,o)},ms=(e,n,o,t,s)=>{const i=n.position.x,r=n.position.y;if(e.drawImage(o,4*16,0,16,16,i*t,r*t,t,t),hs(e,n,i,r,t),gs(e,n,i,r,t),ps(e,n,i,r,t),s){const a=`(${i},${r})`;e.fillStyle="black",e.font="8px Arial",e.fillText(a,i*t+3,r*t+10)}},hs=(e,n,o,t,s)=>{const i=e.fillStyle,r=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let a=0;a<n.actions;a++)e.fillRect(o*s+4+6*a,t*s+s-12,5,5),e.rect(o*s+4+6*a,t*s+s-12,5,5),e.stroke();e.fillStyle="blue";for(let a=0;a<n.movement;a++)e.fillRect(o*s+s-22+6*a,t*s+s-12,5,5),e.rect(o*s+s-22+6*a,t*s+s-12,5,5),e.stroke();e.fillStyle=i,e.strokeStyle=r},ps=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(o*s+4,t*s,s-8,4),e.fillStyle="green",e.fillRect(o*s+4,t*s,(s-8)*(n.health/n.maxHealth),4),e.rect(o*s+4,t*s,s-8,4),e.stroke()},gs=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(o*s+4,t*s+(s-6),s-8,4),e.stroke()},ys=(e,n,o)=>{const t=n.currentActor;if(t){for(let s=t.position.x-t.movement;s<=t.position.x+t.movement;s++)for(let i=t.position.y-t.movement;i<=t.position.y+t.movement;i++)if(rn(n.dungeon,s,i)&&!(s===(t==null?void 0:t.position.x)&&i===(t==null?void 0:t.position.y))){const a=on(n,s,i),l=tn(n,s,i),u=kn(n.dungeon.layout,s,i),c=Hn(t.position,{x:s,y:i},2,n,!0);!l&&!a&&u&&c&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(s*o,i*o,o,o),e.stroke())}}},_s=(e,n,o)=>{const t=n.currentActor;t&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o+o/3,t.position.y*o),e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o,t.position.y*o+o/3),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3,t.position.y*o+o),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o+o),e.stroke(),e.lineWidth=1)},vs=(e,n,o,t,s)=>{t.dungeon.layout.monsters.forEach(i=>{ks(e,n,t,i,o,s)})},ks=(e,n,o,t,s,i)=>{const r=o.dungeon.layout.grid[t.position.y][t.position.x];if(t&&t.health>0&&Ke(o.dungeon,r)){switch(t.type){case H.ORCH:bs(e,n,s,t);break;case H.TROLL:As(e,n,s,t);break;default:Es(e,n,s,t);break}Is(e,t,s),Os(e,t,s),Ms(e,t,o.heroes,o,s,i)}},bs=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},As=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},Es=(e,n,o,t)=>{e.drawImage(n,16,16,16,16,t.position.x*o,t.position.y*o,o,o)},Is=(e,n,o)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(n.position.x*o+4,n.position.y*o+(o-6),o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Os=(e,n,o)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n.position.x*o+4,n.position.y*o,o-8,4),e.fillStyle="green",e.fillRect(n.position.x*o+4,n.position.y*o,(o-8)*(n.health/n.maxHealth),4),e.rect(n.position.x*o+4,n.position.y*o,o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Ms=(e,n,o,t,s,i)=>{i&&o.forEach(r=>{const a=[],l={x:n.position.x*48-24,y:n.position.y*48-24},u={x:r.position.x*48-24,y:r.position.y*48-24};if(Nn(l,n.position,u,r.position,48,t,!1,a)){const f=n.position.x,p=n.position.y,g=r.position.x,_=r.position.y;e.beginPath(),e.strokeStyle=n.colour,e.lineWidth=2,e.moveTo(f*s+s/2,p*s+s/2),e.lineTo(g*s+s/2,_*s+s/2),e.stroke(),e.lineWidth=1}})},Ts=(e,n,o,t,s)=>{t.dungeon.layout.doors.forEach(i=>{Gs(e,n,o,t,i,s)})},Rs=(e,n,o,t,s)=>{t.dungeon.layout.grid.forEach((i,r)=>{sn(i).forEach((a,l)=>{Ls(e,n,t,a,l,r,o),Bs(e,a,t,l,r,o,s)})}),Cs(e,n,o,t,s),ws(e,n,o,t,s)},Ds=(e,n,o,t,s)=>{t.dungeon.layout.secrets.filter(i=>i.found).forEach(i=>{switch(i.type){case ee.TRAP_DOOR:Ns(e,n,o,i);break;default:Ps(e,n,o,i);break}}),t.dungeon.layout.secrets.filter(i=>!i.found).forEach(i=>{if(e.globalAlpha=.6,$e(e,n,8,0,o,i.position.x,i.position.y,t),e.globalAlpha=1,s){const r=`${i.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(i.position.x*o,i.position.y*o,o,o),e.fillStyle="black",e.font="12px Arial",e.fillText(r,i.position.x*o,i.position.y*o+10)}})},$e=(e,n,o,t,s,i,r,a)=>{a.dungeon.discoveredRooms.some(l=>qn(i,r,l,a))||qn(i,r,qe,a)?e.drawImage(n,o*48,t,48,48,i*s,r*s,s,s):Qo(e,i,r,s)},Cs=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pits)==null?void 0:i.filter(a=>rn(t.dungeon,a.x,a.y)||s))==null||r.forEach(a=>{$e(e,n,7,0,o,a.x,a.y,t)})},ws=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pillars)==null?void 0:i.filter(a=>rn(t.dungeon,a.x,a.y)||s))==null||r.forEach(a=>{$e(e,n,6,0,o,a.x,a.y,t)})},Ls=(e,n,o,t,s,i,r)=>{Hs(t,o)?t===qe?($e(e,n,0,0,r,s,i,o),$e(e,n,5,0,r,s,i,o)):$e(e,n,1,0,r,s,i,o):vn(t,o)?Qo(e,s,i,r):$e(e,n,0,0,r,s,i,o)},Hs=(e,n)=>xs(e)||!Ke(n.dungeon,e)&&e!==en,Qo=(e,n,o,t)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="black",e.fillRect(n*t,o*t,t,t),e.stroke()},Ns=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,3*48,0,48,48,s*o,i*o,o,o)},Ps=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,4*48,0,48,48,s*o,i*o,o,o)},Bs=(e,n,o,t,s,i,r)=>{!r&&(vn(n,o)||n===nn)||(e.beginPath(),e.strokeStyle="black",e.rect(t*i,s*i,i,i),r&&(e.font="7px Arial",e.fillText(`${t},${s}`,t*i+3,s*i+(i-3))),e.stroke())},Gs=(e,n,o,t,s,i)=>{const r=t.dungeon.layout.grid[s.y][s.x];if(s&&!s.hidden&&!s.open&&!vn(r,t))switch(e.fillStyle="brown",s.side){case A.RIGHT:{e.fillRect(s.x*o+(o-2),s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o-4),s.y*o+(o/2-4),8,8));break}case A.LEFT:{e.fillRect(s.x*o-2,s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o-4,s.y*o+(o/2-4),8,8));break}case A.UP:{e.fillRect(s.x*o,s.y*o-2,o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o-4,8,8));break}case A.DOWN:{e.fillRect(s.x*o,s.y*o+(o-2),o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o+(o-4),8,8));break}}i&&!vn(r,t)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${s.hidden?"H":"-"}/${s.trapped?`T${s.trapAttacks}`:"-"}/${s.locked?"L":"-"}]`,s.x*o,s.y*o+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(s.x*o,s.y*o,o,o))},xs=e=>e===nn,vn=(e,n)=>e===en||!Ke(n.dungeon,e),qn=(e,n,o,t)=>{if(!t)return;const s=Math.max(e-1,0),i=Math.max(n-1,0),r=Math.min(n+1,t.dungeon.layout.grid.length-1),a=Math.min(e+1,t.dungeon.layout.grid[0].length-1);for(let l=s;l<=a;l++)for(let u=i;u<=r;u++){const c=t.dungeon.layout.grid[u];if(sn(c)[l]===o)return!0}return!1},Us=(e,n,o,t)=>{t.dungeon.layout.items.forEach(s=>{switch(s.item.type){case $.MAGIC:Xn(e,n,o,s);break;case $.WEAPON:Xn(e,n,o,s)}})},Xn=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,0,48,48,48,s*o,i*o,o,o)};function jn(e){let n,o,t=e[2](e[0])+"",s,i;return{c(){n=T("p"),o=w(" "),s=w(t),this.h()},l(r){n=R(r,"P",{class:!0});var a=P(n);o=L(a," "),s=L(a,t),a.forEach(d),this.h()},h(){E(n,"class",i=hn(e[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")},m(r,a){O(r,n,a),h(n,o),h(n,s)},p(r,a){a&1&&t!==(t=r[2](r[0])+"")&&ue(s,t),a&1&&i!==(i=hn(r[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")&&E(n,"class",i)},d(r){r&&d(n)}}}function Ks(e){let n=e[1],o,t=jn(e);return{c(){t.c(),o=de()},l(s){t.l(s),o=de()},m(s,i){t.m(s,i),O(s,o,i)},p(s,[i]){i&2&&pe(n,n=s[1])?(t.d(1),t=jn(s),t.c(),t.m(o.parentNode,o)):t.p(s,i)},i:me,o:me,d(s){s&&d(o),t.d(s)}}}function Fs(e,n,o){let{condition:t}=n,{state:s}=n,i=!1;const r=l=>{switch(l.type){case ie.KILL_ALL:return"Kill all monsters";case ie.KILL_ALL_OF_TYPE:return`Kill all ${l.targetMonsterType}`;case ie.KILL_AT_LEAST:return`Kill at least ${l.killMinCount} monsters. (${s.dungeon.killCount}/${l.killMinCount})`;case ie.OPEN_DOOR:return"Open a certain door";case ie.REACH_CELL:return"Reach a certain cell"}};Ze(()=>{a(),setInterval(a,100)});const a=()=>{s.reRender&&o(1,i=!i)};return e.$$set=l=>{"condition"in l&&o(0,t=l.condition),"state"in l&&o(3,s=l.state)},[t,i,r,s]}class Ws extends Ce{constructor(n){super(),we(this,n,Fs,Ks,pe,{condition:0,state:3})}}function Jn(e,n,o){const t=e.slice();return t[14]=n[o],t[15]=n,t[16]=o,t}function $s(e){let n;return{c(){n=w(">")},l(o){n=L(o,">")},m(o,t){O(o,n,t)},d(o){o&&d(n)}}}function Ys(e){let n;return{c(){n=w("X")},l(o){n=L(o,"X")},m(o,t){O(o,n,t)},d(o){o&&d(n)}}}function Qn(e){let n,o,t=De(e[0].dungeon.winConditions.sort(zn)),s=[];for(let r=0;r<t.length;r+=1)s[r]=Sn(Jn(e,t,r));const i=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){n=T("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){n=R(r,"DIV",{class:!0});var a=P(n);for(let l=0;l<s.length;l+=1)s[l].l(a);a.forEach(d),this.h()},h(){E(n,"class","conditionsDiv svelte-qsh3al")},m(r,a){O(r,n,a);for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(n,null);o=!0},p(r,a){if(a&1){t=De(r[0].dungeon.winConditions.sort(zn));let l;for(l=0;l<t.length;l+=1){const u=Jn(r,t,l);s[l]?(s[l].p(u,a),q(s[l],1)):(s[l]=Sn(u),s[l].c(),q(s[l],1),s[l].m(n,null))}for(Pe(),l=t.length;l<s.length;l+=1)i(l);Be()}},i(r){if(!o){for(let a=0;a<t.length;a+=1)q(s[a]);o=!0}},o(r){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)z(s[a]);o=!1},d(r){r&&d(n),ze(s,r)}}}function Sn(e){let n,o,t,s;function i(l){e[7](l,e[14],e[15],e[16])}function r(l){e[8](l)}let a={};return e[14]!==void 0&&(a.condition=e[14]),e[0]!==void 0&&(a.state=e[0]),n=new Ws({props:a}),ye.push(()=>ve(n,"condition",i)),ye.push(()=>ve(n,"state",r)),{c(){Oe(n.$$.fragment)},l(l){Me(n.$$.fragment,l)},m(l,u){Te(n,l,u),s=!0},p(l,u){e=l;const c={};!o&&u&1&&(o=!0,c.condition=e[14],_e(()=>o=!1)),!t&&u&1&&(t=!0,c.state=e[0],_e(()=>t=!1)),n.$set(c)},i(l){s||(q(n.$$.fragment,l),s=!0)},o(l){z(n.$$.fragment,l),s=!1},d(l){Re(n,l)}}}function Vs(e){let n,o,t,s,i,r,a,l,u,c,f;function p(I,M){return I[1]?Ys:$s}let g=p(e),_=g(e),v=e[1]&&Qn(e);return{c(){n=T("div"),o=T("canvas"),t=S(),s=T("div"),i=T("div"),r=T("button"),_.c(),a=S(),v&&v.c(),this.h()},l(I){n=R(I,"DIV",{style:!0,class:!0,id:!0});var M=P(n);o=R(M,"CANVAS",{width:!0,height:!0,id:!0}),P(o).forEach(d),t=Z(M),s=R(M,"DIV",{class:!0});var y=P(s);i=R(y,"DIV",{class:!0});var b=P(i);r=R(b,"BUTTON",{class:!0});var J=P(r);_.l(J),J.forEach(d),b.forEach(d),a=Z(y),v&&v.l(y),y.forEach(d),M.forEach(d),this.h()},h(){E(o,"width",e[2]*40),E(o,"height",e[2]*30),E(o,"id","gameBoard"),E(r,"class","hideConditionsButton svelte-qsh3al"),E(i,"class","buttonDiv svelte-qsh3al"),E(s,"class",l="winConditions "+(e[1]?"":"conditionsHidden")+" svelte-qsh3al"),E(n,"style",e[4]()),E(n,"class","dungeon svelte-qsh3al"),E(n,"id","gameBoardContainer")},m(I,M){O(I,n,M),h(n,o),h(n,t),h(n,s),h(s,i),h(i,r),_.m(r,null),h(s,a),v&&v.m(s,null),u=!0,c||(f=[Ie(o,"click",e[3]),Ie(r,"click",e[6])],c=!0)},p(I,[M]){g!==(g=p(I))&&(_.d(1),_=g(I),_&&(_.c(),_.m(r,null))),I[1]?v?(v.p(I,M),M&2&&q(v,1)):(v=Qn(I),v.c(),q(v,1),v.m(s,null)):v&&(Pe(),z(v,1,1,()=>{v=null}),Be()),(!u||M&2&&l!==(l="winConditions "+(I[1]?"":"conditionsHidden")+" svelte-qsh3al"))&&E(s,"class",l)},i(I){u||(q(v),u=!0)},o(I){z(v),u=!1},d(I){I&&d(n),_.d(),v&&v.d(),c=!1,Rn(f)}}}const Zn=10,zn=(e,n)=>e.fulfilled===n.fulfilled?0:e.fulfilled?1:-1;function qs(e,n,o){var M;let{state:t}=n,{debugMode:s}=n,i=!0,r,a;const l=(t==null?void 0:t.settings.cellSize)??48;let u=0,c=0;a=window.innerHeight,r=((M=document.getElementById("footer"))==null?void 0:M.offsetHeight)??0,Ze(()=>{const y=new Image;y.src=cs;const b=new Image;b.src=fs,setInterval(()=>f(y,b),10)});const f=(y,b)=>{if(!t||!document)return;const J=document.getElementById("gameBoard"),K=J.getContext("2d");t.reRender&&(c++,u++,K.clearRect(0,0,J.width,J.height),K.fillStyle="black",K.fillRect(0,0,J.width,J.height),Rs(K,y,l,t,s),Ds(K,y,l,t,s),Us(K,y,l,t),Ts(K,y,l,t,s),vs(K,b,l,t,s),ds(K,b,l,t,s),s&&(K.fillStyle="white",K.font="8px Arial",K.fillText(`Re-renders: ${u}`,2,10),K.fillText(`FPS: ${c/(Zn/1e3)}`,2,20)),setTimeout(()=>{o(0,t.reRender=!1,t),c=0},Zn))},p=y=>{Pt(y,l,t)},g=()=>`max-height: ${a-r-20}px; max-width: ${l*40}`,_=()=>o(1,i=!i);function v(y,b,J,K){J[K]=y,o(0,t)}function I(y){t=y,o(0,t)}return e.$$set=y=>{"state"in y&&o(0,t=y.state),"debugMode"in y&&o(5,s=y.debugMode)},[t,i,l,p,g,s,_,v,I]}class Xs extends Ce{constructor(n){super(),we(this,n,qs,Vs,pe,{state:0,debugMode:5})}}function js(e){let n,o="Used";return{c(){n=T("button"),n.textContent=o,this.h()},l(t){n=R(t,"BUTTON",{class:!0,"data-svelte-h":!0}),He(n)!=="svelte-fgo135"&&(n.textContent=o),this.h()},h(){n.disabled=!0,E(n,"class","svelte-gca2x5")},m(t,s){O(t,n,s)},p:me,d(t){t&&d(n)}}}function Js(e){let n,o="Use",t,s;return{c(){n=T("button"),n.textContent=o,this.h()},l(i){n=R(i,"BUTTON",{class:!0,"data-svelte-h":!0}),He(n)!=="svelte-3f43k6"&&(n.textContent=o),this.h()},h(){E(n,"class","svelte-gca2x5")},m(i,r){O(i,n,r),t||(s=Ie(n,"click",e[2]),t=!0)},p:me,d(i){i&&d(n),t=!1,s()}}}function Qs(e){var J,K;let n,o="",t,s,i,r=e[0].name+"",a,l,u,c=((J=e[0].properties)==null?void 0:J[mn])+"",f,p,g=((K=e[0].properties)==null?void 0:K[mn])+"",_,v,I;function M(C,j){var Y,k,F;if((Y=C[0].properties)!=null&&Y[yn]&&!((k=C[0].properties)!=null&&k[Le]))return Js;if((F=C[0].properties)!=null&&F[yn])return js}let y=M(e),b=y&&y(e);return{c(){n=T("div"),n.innerHTML=o,t=S(),s=T("div"),i=T("b"),a=w(r),l=S(),u=T("span"),f=w(c),p=S(),_=w(g),v=S(),I=T("div"),b&&b.c(),this.h()},l(C){n=R(C,"DIV",{class:!0,"data-svelte-h":!0}),He(n)!=="svelte-pn8o3r"&&(n.innerHTML=o),t=Z(C),s=R(C,"DIV",{class:!0});var j=P(s);i=R(j,"B",{class:!0});var Y=P(i);a=L(Y,r),Y.forEach(d),l=Z(j),u=R(j,"SPAN",{class:!0});var k=P(u);f=L(k,c),p=Z(k),_=L(k,g),k.forEach(d),j.forEach(d),v=Z(C),I=R(C,"DIV",{class:!0});var F=P(I);b&&b.l(F),F.forEach(d),this.h()},h(){E(n,"class","item item-icon svelte-gca2x5"),E(i,"class","svelte-gca2x5"),E(u,"class","svelte-gca2x5"),E(s,"class","item item-description bottom-border svelte-gca2x5"),E(I,"class","item item-action svelte-gca2x5")},m(C,j){O(C,n,j),O(C,t,j),O(C,s,j),h(s,i),h(i,a),h(s,l),h(s,u),h(u,f),h(u,p),h(u,_),O(C,v,j),O(C,I,j),b&&b.m(I,null)},p(C,[j]){var Y,k;j&1&&r!==(r=C[0].name+"")&&ue(a,r),j&1&&c!==(c=((Y=C[0].properties)==null?void 0:Y[mn])+"")&&ue(f,c),j&1&&g!==(g=((k=C[0].properties)==null?void 0:k[mn])+"")&&ue(_,g),y===(y=M(C))&&b?b.p(C,j):(b&&b.d(1),b=y&&y(C),b&&(b.c(),b.m(I,null)))},i:me,o:me,d(C){C&&(d(n),d(t),d(s),d(v),d(I)),b&&b.d()}}}function Ss(e,n,o){let{item:t}=n,{state:s}=n;const i=()=>Tt(s,t);return e.$$set=r=>{"item"in r&&o(0,t=r.item),"state"in r&&o(1,s=r.state)},[t,s,i]}class Zs extends Ce{constructor(n){super(),we(this,n,Ss,Qs,pe,{item:0,state:1})}}function eo(e,n,o){const t=e.slice();return t[5]=n[o],t[6]=n,t[7]=o,t}function no(e){let n,o,t;function s(r){e[3](r,e[5],e[6],e[7])}let i={state:e[1]};return e[5]!==void 0&&(i.item=e[5]),n=new Zs({props:i}),ye.push(()=>ve(n,"item",s)),{c(){Oe(n.$$.fragment)},l(r){Me(n.$$.fragment,r)},m(r,a){Te(n,r,a),t=!0},p(r,a){e=r;const l={};a&2&&(l.state=e[1]),!o&&a&1&&(o=!0,l.item=e[5],_e(()=>o=!1)),n.$set(l)},i(r){t||(q(n.$$.fragment,r),t=!0)},o(r){z(n.$$.fragment,r),t=!1},d(r){Re(n,r)}}}function oo(e){let n,o,t=De(e[0]),s=[];for(let r=0;r<t.length;r+=1)s[r]=no(eo(e,t,r));const i=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let a=0;a<s.length;a+=1)s[a].l(r);n=de()},m(r,a){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(r,a);O(r,n,a),o=!0},p(r,a){if(a&3){t=De(r[0]);let l;for(l=0;l<t.length;l+=1){const u=eo(r,t,l);s[l]?(s[l].p(u,a),q(s[l],1)):(s[l]=no(u),s[l].c(),q(s[l],1),s[l].m(n.parentNode,n))}for(Pe(),l=t.length;l<s.length;l+=1)i(l);Be()}},i(r){if(!o){for(let a=0;a<t.length;a+=1)q(s[a]);o=!0}},o(r){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)z(s[a]);o=!1},d(r){r&&d(n),ze(s,r)}}}function zs(e){var c;let n,o=((c=e[1].currentActor)==null?void 0:c.name)+"",t,s,i,r,a=e[2],l,u=oo(e);return{c(){n=T("h4"),t=w(o),s=w("s  Inventory"),i=S(),r=T("div"),u.c(),this.h()},l(f){n=R(f,"H4",{class:!0});var p=P(n);t=L(p,o),s=L(p,"s  Inventory"),p.forEach(d),i=Z(f),r=R(f,"DIV",{class:!0});var g=P(r);u.l(g),g.forEach(d),this.h()},h(){E(n,"class","svelte-1sdwrze"),E(r,"class","inventory svelte-1sdwrze")},m(f,p){O(f,n,p),h(n,t),h(n,s),O(f,i,p),O(f,r,p),u.m(r,null),l=!0},p(f,[p]){var g;(!l||p&2)&&o!==(o=((g=f[1].currentActor)==null?void 0:g.name)+"")&&ue(t,o),p&4&&pe(a,a=f[2])?(Pe(),z(u,1,1,me),Be(),u=oo(f),u.c(),q(u,1),u.m(r,null)):u.p(f,p)},i(f){l||(q(u),l=!0)},o(f){z(u),l=!1},d(f){f&&(d(n),d(i),d(r)),u.d(f)}}}function ei(e,n,o){let{inventory:t}=n,{state:s}=n,i=!1;Ze(()=>{r(),setInterval(r,100)});const r=()=>{o(2,i=!i)};function a(l,u,c,f){c[f]=l,o(0,t)}return e.$$set=l=>{"inventory"in l&&o(0,t=l.inventory),"state"in l&&o(1,s=l.state)},[t,s,i,a]}class ni extends Ce{constructor(n){super(),we(this,n,ei,zs,pe,{inventory:0,state:1})}}function to(e){let n;return{c(){n=w("*")},l(o){n=L(o,"*")},m(o,t){O(o,n,t)},d(o){o&&d(n)}}}function oi(e){let n;return{c(){n=w("")},l(o){n=L(o,"")},m(o,t){O(o,n,t)},d(o){o&&d(n)}}}function ti(e){let n;return{c(){n=w("")},l(o){n=L(o,"")},m(o,t){O(o,n,t)},d(o){o&&d(n)}}}function so(e){let n,o,t,s,i;function r(l){e[7](l)}let a={state:e[1]};return e[0].inventory!==void 0&&(a.inventory=e[0].inventory),o=new ni({props:a}),ye.push(()=>ve(o,"inventory",r)),{c(){n=T("div"),Oe(o.$$.fragment),this.h()},l(l){n=R(l,"DIV",{class:!0,id:!0,style:!0});var u=P(n);Me(o.$$.fragment,u),u.forEach(d),this.h()},h(){E(n,"class","hero-inventory svelte-1jgurl5"),E(n,"id",s=e[0].name+"s-inventory"),Qe(n,"display",e[2])},m(l,u){O(l,n,u),Te(o,n,null),i=!0},p(l,u){const c={};u&2&&(c.state=l[1]),!t&&u&1&&(t=!0,c.inventory=l[0].inventory,_e(()=>t=!1)),o.$set(c),(!i||u&1&&s!==(s=l[0].name+"s-inventory"))&&E(n,"id",s),(!i||u&4)&&Qe(n,"display",l[2])},i(l){i||(q(o.$$.fragment,l),i=!0)},o(l){z(o.$$.fragment,l),i=!1},d(l){l&&d(n),Re(o)}}}function io(e){let n,o,t=e[0].actions+"",s,i,r,a,l=e[0].movement+"",u,c,f,p="Equipment:",g,_,v,I,M=e[0].weapon.name+"",y,b,J=e[0].weapon.dice+"",K,C,j,Y,k,F,D,le;function he(N,Q){return N[0].armour?ii:si}let ae=he(e),X=ae(e);function G(N,Q){return N[0].shield?li:ri}let B=G(e),oe=B(e);return{c(){n=T("span"),o=w("Actions: "),s=w(t),i=S(),r=T("span"),a=w("Moves: "),u=w(l),c=S(),f=T("span"),f.textContent=p,g=S(),_=T("div"),v=T("span"),I=w(" "),y=w(M),b=w(" ("),K=w(J),C=w(")"),j=S(),Y=T("span"),k=w(`
        `),X.c(),F=S(),D=T("span"),le=w(`
        `),oe.c(),this.h()},l(N){n=R(N,"SPAN",{class:!0});var Q=P(n);o=L(Q,"Actions: "),s=L(Q,t),Q.forEach(d),i=Z(N),r=R(N,"SPAN",{class:!0});var te=P(r);a=L(te,"Moves: "),u=L(te,l),te.forEach(d),c=Z(N),f=R(N,"SPAN",{class:!0,"data-svelte-h":!0}),He(f)!=="svelte-1ue18fw"&&(f.textContent=p),g=Z(N),_=R(N,"DIV",{class:!0});var re=P(_);v=R(re,"SPAN",{class:!0});var W=P(v);I=L(W," "),y=L(W,M),b=L(W," ("),K=L(W,J),C=L(W,")"),W.forEach(d),j=Z(re),Y=R(re,"SPAN",{class:!0});var se=P(Y);k=L(se,`
        `),X.l(se),se.forEach(d),F=Z(re),D=R(re,"SPAN",{class:!0});var Ge=P(D);le=L(Ge,`
        `),oe.l(Ge),Ge.forEach(d),re.forEach(d),this.h()},h(){E(n,"class","svelte-1jgurl5"),E(r,"class","svelte-1jgurl5"),E(f,"class","svelte-1jgurl5"),E(v,"class","svelte-1jgurl5"),E(Y,"class","svelte-1jgurl5"),E(D,"class","svelte-1jgurl5"),E(_,"class","equipment svelte-1jgurl5")},m(N,Q){O(N,n,Q),h(n,o),h(n,s),O(N,i,Q),O(N,r,Q),h(r,a),h(r,u),O(N,c,Q),O(N,f,Q),O(N,g,Q),O(N,_,Q),h(_,v),h(v,I),h(v,y),h(v,b),h(v,K),h(v,C),h(_,j),h(_,Y),h(Y,k),X.m(Y,null),h(_,F),h(_,D),h(D,le),oe.m(D,null)},p(N,Q){Q&1&&t!==(t=N[0].actions+"")&&ue(s,t),Q&1&&l!==(l=N[0].movement+"")&&ue(u,l),Q&1&&M!==(M=N[0].weapon.name+"")&&ue(y,M),Q&1&&J!==(J=N[0].weapon.dice+"")&&ue(K,J),ae===(ae=he(N))&&X?X.p(N,Q):(X.d(1),X=ae(N),X&&(X.c(),X.m(Y,null))),B===(B=G(N))&&oe?oe.p(N,Q):(oe.d(1),oe=B(N),oe&&(oe.c(),oe.m(D,null)))},d(N){N&&(d(n),d(i),d(r),d(c),d(f),d(g),d(_)),X.d(),oe.d()}}}function si(e){let n;return{c(){n=w("None (0)")},l(o){n=L(o,"None (0)")},m(o,t){O(o,n,t)},p:me,d(o){o&&d(n)}}}function ii(e){let n=e[0].armour.name+"",o,t,s=e[0].armour.defense+"",i,r;return{c(){o=w(n),t=w(" ("),i=w(s),r=w(")")},l(a){o=L(a,n),t=L(a," ("),i=L(a,s),r=L(a,")")},m(a,l){O(a,o,l),O(a,t,l),O(a,i,l),O(a,r,l)},p(a,l){l&1&&n!==(n=a[0].armour.name+"")&&ue(o,n),l&1&&s!==(s=a[0].armour.defense+"")&&ue(i,s)},d(a){a&&(d(o),d(t),d(i),d(r))}}}function ri(e){let n;return{c(){n=w("None (0)")},l(o){n=L(o,"None (0)")},m(o,t){O(o,n,t)},p:me,d(o){o&&d(n)}}}function li(e){let n=e[0].shield.name+"",o,t,s=e[0].shield.dice+"",i,r;return{c(){o=w(n),t=w(" ("),i=w(s),r=w(")")},l(a){o=L(a,n),t=L(a," ("),i=L(a,s),r=L(a,")")},m(a,l){O(a,o,l),O(a,t,l),O(a,i,l),O(a,r,l)},p(a,l){l&1&&n!==(n=a[0].shield.name+"")&&ue(o,n),l&1&&s!==(s=a[0].shield.dice+"")&&ue(i,s)},d(a){a&&(d(o),d(t),d(i),d(r))}}}function ro(e){let n,o,t,s=e[0].name+"",i,r,a,l,u=e[0].level+"",c,f,p=e[0].experience+"",g,_,v,I,M,y,b,J="",K,C,j,Y,k,F,D=e[0].health+"",le,he,ae,X,G,B=e[1].targetActor===e[0]&&to();function oe(W,se){return W[1].targetActor!==W[0]?ti:oi}let N=oe(e),Q=N(e),te=e[1].currentActor==e[0]&&so(e),re=e[1].currentActor==e[0]&&io(e);return{c(){n=T("div"),o=T("div"),t=T("b"),B&&B.c(),i=w(s),r=w(" -"),a=S(),l=T("b"),c=w(u),f=w(" ("),g=w(p),_=w(")"),v=S(),I=T("div"),M=T("button"),Q.c(),y=S(),b=T("button"),b.textContent=J,K=S(),C=T("div"),te&&te.c(),j=S(),Y=T("div"),k=T("span"),F=w("HP: "),le=w(D),he=S(),re&&re.c(),this.h()},l(W){n=R(W,"DIV",{class:!0,style:!0});var se=P(n);o=R(se,"DIV",{class:!0});var Ge=P(o);t=R(Ge,"B",{class:!0});var an=P(t);B&&B.l(an),i=L(an,s),r=L(an," -"),an.forEach(d),a=Z(Ge),l=R(Ge,"B",{class:!0});var Xe=P(l);c=L(Xe,u),f=L(Xe," ("),g=L(Xe,p),_=L(Xe,")"),Xe.forEach(d),Ge.forEach(d),v=Z(se),I=R(se,"DIV",{class:!0});var un=P(I);M=R(un,"BUTTON",{title:!0});var Pn=P(M);Q.l(Pn),Pn.forEach(d),y=Z(un),b=R(un,"BUTTON",{title:!0,"data-svelte-h":!0}),He(b)!=="svelte-qrm7uk"&&(b.textContent=J),un.forEach(d),K=Z(se),C=R(se,"DIV",{class:!0});var Bn=P(C);te&&te.l(Bn),Bn.forEach(d),j=Z(se),Y=R(se,"DIV",{class:!0});var cn=P(Y);k=R(cn,"SPAN",{class:!0});var bn=P(k);F=L(bn,"HP: "),le=L(bn,D),bn.forEach(d),he=Z(cn),re&&re.l(cn),cn.forEach(d),se.forEach(d),this.h()},h(){E(t,"class","svelte-1jgurl5"),E(l,"class","svelte-1jgurl5"),E(o,"class","hero-title svelte-1jgurl5"),E(M,"title","select target hero"),E(b,"title","Open inventory"),E(I,"class","hero-action-buttons svelte-1jgurl5"),E(C,"class","hero-information svelte-1jgurl5"),E(k,"class","svelte-1jgurl5"),E(Y,"class","hero-stats-and-equipmnet svelte-1jgurl5"),E(n,"class","hero-card svelte-1jgurl5"),Qe(n,"background-color",e[0].colour)},m(W,se){O(W,n,se),h(n,o),h(o,t),B&&B.m(t,null),h(t,i),h(t,r),h(o,a),h(o,l),h(l,c),h(l,f),h(l,g),h(l,_),h(n,v),h(n,I),h(I,M),Q.m(M,null),h(I,y),h(I,b),h(n,K),h(n,C),te&&te.m(C,null),h(n,j),h(n,Y),h(Y,k),h(k,F),h(k,le),h(Y,he),re&&re.m(Y,null),ae=!0,X||(G=[Ie(M,"click",e[5]),Ie(b,"click",e[6])],X=!0)},p(W,se){W[1].targetActor===W[0]?B||(B=to(),B.c(),B.m(t,i)):B&&(B.d(1),B=null),(!ae||se&1)&&s!==(s=W[0].name+"")&&ue(i,s),(!ae||se&1)&&u!==(u=W[0].level+"")&&ue(c,u),(!ae||se&1)&&p!==(p=W[0].experience+"")&&ue(g,p),N!==(N=oe(W))&&(Q.d(1),Q=N(W),Q&&(Q.c(),Q.m(M,null))),W[1].currentActor==W[0]?te?(te.p(W,se),se&3&&q(te,1)):(te=so(W),te.c(),q(te,1),te.m(C,null)):te&&(Pe(),z(te,1,1,()=>{te=null}),Be()),(!ae||se&1)&&D!==(D=W[0].health+"")&&ue(le,D),W[1].currentActor==W[0]?re?re.p(W,se):(re=io(W),re.c(),re.m(Y,null)):re&&(re.d(1),re=null),(!ae||se&1)&&Qe(n,"background-color",W[0].colour)},i(W){ae||(q(te),ae=!0)},o(W){z(te),ae=!1},d(W){W&&d(n),B&&B.d(),Q.d(),te&&te.d(),re&&re.d(),X=!1,Rn(G)}}}function ai(e){let n=e[1].targetActor,o,t,s=ro(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),O(i,o,r),t=!0},p(i,[r]){r&2&&pe(n,n=i[1].targetActor)?(Pe(),z(s,1,1,me),Be(),s=ro(i),s.c(),q(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(q(s),t=!0)},o(i){z(s),t=!1},d(i){i&&d(o),s.d(i)}}}function ui(e,n,o){let{hero:t}=n,{state:s}=n,i="none";const r=p=>{s.targetActor&&p===s.targetActor?o(1,s.targetActor=void 0,s):o(1,s.targetActor=p,s)},a=p=>{const g=document.getElementById(p.name+"s-inventory");console.log(p.isInventoryOpen),g!=null&&(p.isInventoryOpen=!p.isInventoryOpen,l(),g.style.display=i)},l=()=>{t.isInventoryOpen?o(2,i="inline-block"):o(2,i="none")};l();const u=()=>r(t),c=()=>a(t);function f(p){e.$$.not_equal(t.inventory,p)&&(t.inventory=p,o(0,t))}return e.$$set=p=>{"hero"in p&&o(0,t=p.hero),"state"in p&&o(1,s=p.state)},[t,s,i,r,a,u,c,f]}class So extends Ce{constructor(n){super(),we(this,n,ui,ai,pe,{hero:0,state:1})}}function lo(e,n,o){const t=e.slice();return t[3]=n[o],t[5]=o,t}function ci(e){let n,o,t,s;return o=new So({props:{hero:e[3],state:e[0]}}),{c(){n=T("div"),Oe(o.$$.fragment),t=S(),this.h()},l(i){n=R(i,"DIV",{class:!0});var r=P(n);Me(o.$$.fragment,r),t=Z(r),r.forEach(d),this.h()},h(){E(n,"class","not-current-actor svelte-gyascg")},m(i,r){O(i,n,r),Te(o,n,null),h(n,t),s=!0},p(i,r){const a={};r&1&&(a.hero=i[3]),r&1&&(a.state=i[0]),o.$set(a)},i(i){s||(q(o.$$.fragment,i),s=!0)},o(i){z(o.$$.fragment,i),s=!1},d(i){i&&d(n),Re(o)}}}function fi(e){let n,o,t,s;return o=new So({props:{hero:e[3],state:e[0]}}),{c(){n=T("div"),Oe(o.$$.fragment),t=S(),this.h()},l(i){n=R(i,"DIV",{class:!0});var r=P(n);Me(o.$$.fragment,r),t=Z(r),r.forEach(d),this.h()},h(){E(n,"class","is-current-actor svelte-gyascg")},m(i,r){O(i,n,r),Te(o,n,null),h(n,t),s=!0},p(i,r){const a={};r&1&&(a.hero=i[3]),r&1&&(a.state=i[0]),o.$set(a)},i(i){s||(q(o.$$.fragment,i),s=!0)},o(i){z(o.$$.fragment,i),s=!1},d(i){i&&d(n),Re(o)}}}function ao(e){let n,o,t,s;const i=[fi,ci],r=[];function a(l,u){return l[3]===l[0].currentActor?0:1}return n=a(e),o=r[n]=i[n](e),{c(){o.c(),t=de()},l(l){o.l(l),t=de()},m(l,u){r[n].m(l,u),O(l,t,u),s=!0},p(l,u){let c=n;n=a(l),n===c?r[n].p(l,u):(Pe(),z(r[c],1,1,()=>{r[c]=null}),Be(),o=r[n],o?o.p(l,u):(o=r[n]=i[n](l),o.c()),q(o,1),o.m(t.parentNode,t))},i(l){s||(q(o),s=!0)},o(l){z(o),s=!1},d(l){l&&d(t),r[n].d(l)}}}function uo(e){let n=e[1],o,t,s=ao(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),O(i,o,r),t=!0},p(i,r){r&2&&pe(n,n=i[1])?(Pe(),z(s,1,1,me),Be(),s=ao(i),s.c(),q(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(q(s),t=!0)},o(i){z(s),t=!1},d(i){i&&d(o),s.d(i)}}}function di(e){let n,o,t=De(U(e[0])),s=[];for(let r=0;r<t.length;r+=1)s[r]=uo(lo(e,t,r));const i=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let a=0;a<s.length;a+=1)s[a].l(r);n=de()},m(r,a){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(r,a);O(r,n,a),o=!0},p(r,[a]){if(a&3){t=De(U(r[0]));let l;for(l=0;l<t.length;l+=1){const u=lo(r,t,l);s[l]?(s[l].p(u,a),q(s[l],1)):(s[l]=uo(u),s[l].c(),q(s[l],1),s[l].m(n.parentNode,n))}for(Pe(),l=t.length;l<s.length;l+=1)i(l);Be()}},i(r){if(!o){for(let a=0;a<t.length;a+=1)q(s[a]);o=!0}},o(r){s=s.filter(Boolean);for(let a=0;a<s.length;a+=1)z(s[a]);o=!1},d(r){r&&d(n),ze(s,r)}}}function mi(e,n,o){let{state:t}=n,s=!1;Ze(()=>{i(),setInterval(i,100)});const i=()=>{t.reRender&&o(1,s=!s)};return e.$$set=r=>{"state"in r&&o(0,t=r.state)},[t,s]}class hi extends Ce{constructor(n){super(),we(this,n,mi,di,pe,{state:0})}}function co(e,n,o){const t=e.slice();return t[3]=n[o],t[5]=o,t}function pi(e){let n,o,t=e[3]+"",s;return{c(){n=T("p"),o=w(">"),s=w(t),this.h()},l(i){n=R(i,"P",{class:!0});var r=P(n);o=L(r,">"),s=L(r,t),r.forEach(d),this.h()},h(){E(n,"class","svelte-grgnnk")},m(i,r){O(i,n,r),h(n,o),h(n,s)},p(i,r){r&1&&t!==(t=i[3]+"")&&ue(s,t)},d(i){i&&d(n)}}}function fo(e){let n,o=e[5]<25&&pi(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),O(t,n,s)},p(t,s){t[5]<25&&o.p(t,s)},d(t){t&&d(n),o&&o.d(t)}}}function mo(e){let n,o=De(e[0].actionLog),t=[];for(let s=0;s<o.length;s+=1)t[s]=fo(co(e,o,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=de()},l(s){for(let i=0;i<t.length;i+=1)t[i].l(s);n=de()},m(s,i){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(s,i);O(s,n,i)},p(s,i){if(i&1){o=De(s[0].actionLog);let r;for(r=0;r<o.length;r+=1){const a=co(s,o,r);t[r]?t[r].p(a,i):(t[r]=fo(a),t[r].c(),t[r].m(n.parentNode,n))}for(;r<t.length;r+=1)t[r].d(1);t.length=o.length}},d(s){s&&d(n),ze(t,s)}}}function gi(e){let n,o=e[1],t=mo(e);return{c(){n=T("div"),t.c(),this.h()},l(s){n=R(s,"DIV",{class:!0});var i=P(n);t.l(i),i.forEach(d),this.h()},h(){E(n,"class","log svelte-grgnnk")},m(s,i){O(s,n,i),t.m(n,null)},p(s,[i]){i&2&&pe(o,o=s[1])?(t.d(1),t=mo(s),t.c(),t.m(n,null)):t.p(s,i)},i:me,o:me,d(s){s&&d(n),t.d(s)}}}function yi(e,n,o){let{state:t}=n,s=!1;Ze(()=>{i(),setInterval(i,500)});const i=()=>{t.reRender&&o(1,s=!s)};return e.$$set=r=>{"state"in r&&o(0,t=r.state)},[t,s]}class _i extends Ce{constructor(n){super(),we(this,n,yi,gi,pe,{state:0})}}const vi={name:"Testing Grounds",beaten:!0,winConditions:[{type:ie.KILL_ALL,fulfilled:!0},{type:ie.OPEN_DOOR,targetCell:{x:2,y:10},fulfilled:!1},{type:ie.KILL_ALL_OF_TYPE,targetMonsterType:H.ORCH,fulfilled:!1},{type:ie.REACH_CELL,targetCell:{x:2,y:10},fulfilled:!1},{type:ie.KILL_AT_LEAST,killMinCount:5,fulfilled:!1}],nextDungeon:Wo,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A","D"],layout:{grid:["###########","#CCCCCCCCC#","#CCCCCCCCC#","#CCCCCCCCC#","#######E###","  #####E#  ","  #FFFFE## ","###F###AA# ","#AAAAAAAA#D","#AAAAAAAA#D","#AAAAAAAA#D","##G####### "," #G#       "," #G#       "," ###       "],pillars:[{x:8,y:3},{x:7,y:9}],pits:[{x:6,y:3},{x:6,y:2}],corridors:["G","E","F"],doors:[ot(A.UP,3,8,1),gn(A.LEFT,7,6),nt(A.UP,7,7,1),V(A.UP,7,4),Ue(A.DOWN,2,10)],monsters:[ne(H.ORCH,x.Green,1,1),ne(H.ORCH,x.Red,4,9),ne(H.TROLL,x.Green,5,1)],secrets:[ke(ee.TRAP_DOOR,"Welcome to Drakriddarna",3,9),ke(ee.EQUIPMENT,"Random Equipment",1,10),Se(ee.EQUIPMENT,5,10,pn[2])],notes:[],items:[{item:be[0],position:{x:3,y:10}},{item:be[1],position:{x:4,y:10}},{item:be[6],position:{x:5,y:10}},{item:be[2],position:{x:6,y:10}},{item:be[3],position:{x:7,y:10}},{item:be[4],position:{x:8,y:10}}]},killCount:0};function ho(e,n,o){const t=e.slice();return t[5]=n[o],t}function po(e){let n,o=e[5].label+"",t,s,i;return{c(){n=T("button"),t=w(o),this.h()},l(r){n=R(r,"BUTTON",{class:!0});var a=P(n);t=L(a,o),a.forEach(d),this.h()},h(){E(n,"class","menuButton svelte-12a9xod")},m(r,a){O(r,n,a),h(n,t),s||(i=Ie(n,"click",function(){Zo(e[5].onClick)&&e[5].onClick.apply(this,arguments)}),s=!0)},p(r,a){e=r,a&4&&o!==(o=e[5].label+"")&&ue(t,o)},d(r){r&&d(n),s=!1,i()}}}function go(e){let n,o=(e[5].debugModeOnly&&e[1]||!e[5].debugModeOnly)&&po(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),O(t,n,s)},p(t,s){t[5].debugModeOnly&&t[1]||!t[5].debugModeOnly?o?o.p(t,s):(o=po(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(t){t&&d(n),o&&o.d(t)}}}function ki(e){let n,o,t,s,i,r,a,l,u=De(e[2]),c=[];for(let f=0;f<u.length;f+=1)c[f]=go(ho(e,u,f));return{c(){n=T("div"),o=T("span"),t=w(e[0]),s=S();for(let f=0;f<c.length;f+=1)c[f].c();i=S(),r=T("span"),a=w(e[3]),this.h()},l(f){n=R(f,"DIV",{class:!0});var p=P(n);o=R(p,"SPAN",{class:!0});var g=P(o);t=L(g,e[0]),g.forEach(d),s=Z(p);for(let v=0;v<c.length;v+=1)c[v].l(p);i=Z(p),r=R(p,"SPAN",{class:!0});var _=P(r);a=L(_,e[3]),_.forEach(d),p.forEach(d),this.h()},h(){E(o,"class","header svelte-12a9xod"),E(r,"class","footer svelte-12a9xod"),E(n,"class",l=hn(e[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")},m(f,p){O(f,n,p),h(n,o),h(o,t),h(n,s);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(n,null);h(n,i),h(n,r),h(r,a)},p(f,[p]){if(p&1&&ue(t,f[0]),p&6){u=De(f[2]);let g;for(g=0;g<u.length;g+=1){const _=ho(f,u,g);c[g]?c[g].p(_,p):(c[g]=go(_),c[g].c(),c[g].m(n,i))}for(;g<c.length;g+=1)c[g].d(1);c.length=u.length}p&8&&ue(a,f[3]),p&16&&l!==(l=hn(f[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")&&E(n,"class",l)},i:me,o:me,d(f){f&&d(n),ze(c,f)}}}function bi(e,n,o){let{header:t}=n,{debugMode:s}=n,{buttons:i}=n,{footer:r}=n,{showMenu:a}=n;return e.$$set=l=>{"header"in l&&o(0,t=l.header),"debugMode"in l&&o(1,s=l.debugMode),"buttons"in l&&o(2,i=l.buttons),"footer"in l&&o(3,r=l.footer),"showMenu"in l&&o(4,a=l.showMenu)},[t,s,i,r,a]}class yo extends Ce{constructor(n){super(),we(this,n,bi,ki,pe,{header:0,debugMode:1,buttons:2,footer:3,showMenu:4})}}function _o(e){let n,o="Next level",t,s;return{c(){n=T("button"),n.textContent=o,this.h()},l(i){n=R(i,"BUTTON",{class:!0,"data-svelte-h":!0}),He(n)!=="svelte-15cwa7f"&&(n.textContent=o),this.h()},h(){E(n,"class","menuButton svelte-1v33x5s")},m(i,r){O(i,n,r),t||(s=Ie(n,"click",e[16]),t=!0)},p:me,d(i){i&&d(n),t=!1,s()}}}function Ai(e){let n,o,t,s,i,r,a,l,u,c,f,p="Menu",g,_,v,I="Next",M,y,b="Action",J,K,C,j;function Y(G){e[9](G)}function k(G){e[10](G)}let F={header:"Main Menu",footer:`${e[2].date} - ${e[2].hash}`,buttons:e[8]};e[1]!==void 0&&(F.debugMode=e[1]),e[3]!==void 0&&(F.showMenu=e[3]),o=new yo({props:F}),ye.push(()=>ve(o,"debugMode",Y)),ye.push(()=>ve(o,"showMenu",k));function D(G){e[11](G)}function le(G){e[12](G)}function he(G){e[13](G)}let ae={header:"Load Game",footer:""};e[1]!==void 0&&(ae.debugMode=e[1]),e[4]!==void 0&&(ae.showMenu=e[4]),e[5]!==void 0&&(ae.buttons=e[5]),r=new yo({props:ae}),ye.push(()=>ve(r,"debugMode",D)),ye.push(()=>ve(r,"showMenu",le)),ye.push(()=>ve(r,"buttons",he));let X=e[0].dungeon.beaten&&_o(e);return{c(){n=T("div"),Oe(o.$$.fragment),i=S(),Oe(r.$$.fragment),c=S(),f=T("button"),f.textContent=p,g=S(),_=T("div"),v=T("button"),v.textContent=I,M=S(),y=T("button"),y.textContent=b,J=S(),X&&X.c(),this.h()},l(G){n=R(G,"DIV",{class:!0});var B=P(n);Me(o.$$.fragment,B),i=Z(B),Me(r.$$.fragment,B),c=Z(B),f=R(B,"BUTTON",{class:!0,"data-svelte-h":!0}),He(f)!=="svelte-1cm9wyz"&&(f.textContent=p),g=Z(B),_=R(B,"DIV",{});var oe=P(_);v=R(oe,"BUTTON",{class:!0,"data-svelte-h":!0}),He(v)!=="svelte-1w61r62"&&(v.textContent=I),M=Z(oe),y=R(oe,"BUTTON",{class:!0,style:!0,"data-svelte-h":!0}),He(y)!=="svelte-1vhh8te"&&(y.textContent=b),oe.forEach(d),J=Z(B),X&&X.l(B),B.forEach(d),this.h()},h(){E(f,"class","menuButton svelte-1v33x5s"),E(v,"class","menuButton twoColButton svelte-1v33x5s"),E(y,"class","menuButton twoColButton svelte-1v33x5s"),Qe(y,"float","right"),E(n,"class","commands svelte-1v33x5s")},m(G,B){O(G,n,B),Te(o,n,null),h(n,i),Te(r,n,null),h(n,c),h(n,f),h(n,g),h(n,_),h(_,v),h(_,M),h(_,y),h(n,J),X&&X.m(n,null),K=!0,C||(j=[Ie(window,"keydown",zo(e[6])),Ie(f,"click",e[7]),Ie(v,"click",e[14]),Ie(y,"click",e[15])],C=!0)},p(G,[B]){const oe={};B&4&&(oe.footer=`${G[2].date} - ${G[2].hash}`),!t&&B&2&&(t=!0,oe.debugMode=G[1],_e(()=>t=!1)),!s&&B&8&&(s=!0,oe.showMenu=G[3],_e(()=>s=!1)),o.$set(oe);const N={};!a&&B&2&&(a=!0,N.debugMode=G[1],_e(()=>a=!1)),!l&&B&16&&(l=!0,N.showMenu=G[4],_e(()=>l=!1)),!u&&B&32&&(u=!0,N.buttons=G[5],_e(()=>u=!1)),r.$set(N),G[0].dungeon.beaten?X?X.p(G,B):(X=_o(G),X.c(),X.m(n,null)):X&&(X.d(1),X=null)},i(G){K||(q(o.$$.fragment,G),q(r.$$.fragment,G),K=!0)},o(G){z(o.$$.fragment,G),z(r.$$.fragment,G),K=!1},d(G){G&&d(n),Re(o),Re(r),X&&X.d(),C=!1,Rn(j)}}}function Ei(e,n,o){let{state:t}=n,{debugMode:s}=n,{buildInfo:i}=n,r=!1,a=!1,l=[];const u=()=>{o(1,s=!s),o(0,t.settings.debug=s,t),ce(t)},c=D=>{switch(D.key){case"6":case"d":xe("R",t);break;case"9":case"e":xe("UR",t);break;case"8":case"w":xe("U",t);break;case"7":case"q":xe("UL",t);break;case"4":case"a":xe("L",t);break;case"1":case"z":xe("DL",t);break;case"2":case"x":xe("D",t);break;case"3":case"c":xe("DR",t);break;case"0":case" ":o(0,t=Tn(t));break;case"-":case"r":Ao(t);break;case"+":case"f":Io(t);break}},f=()=>{o(0,t=qo()),ce(t),o(3,r=!1)},p=()=>{os(t),o(3,r=!1)},g=()=>{o(0,t.dungeon=vi,t),ce(t),o(3,r=!1)},_=()=>{o(3,r=!1),o(4,a=!0),o(5,l=v())},v=()=>{const D=[],le=localStorage.getItem("autosave");le&&D.push({debugModeOnly:!1,label:"Autosave",onClick:()=>I(le)});const he=localStorage.getItem("state");return he&&D.push({debugModeOnly:!1,label:"Manual Save",onClick:()=>I(he)}),D.push({debugModeOnly:!1,label:"Back",onClick:()=>{o(3,r=!0),o(4,a=!1)}}),D},I=D=>{o(0,t=ts(JSON.parse(D))),o(3,r=!1),o(4,a=!1)},M=()=>{a?o(3,r=!1):o(3,r=!r),o(4,a=!1)},y=[{debugModeOnly:!1,label:"New Game",onClick:f},{debugModeOnly:!1,label:"Save",onClick:p},{debugModeOnly:!1,label:"Load",onClick:_},{debugModeOnly:!1,label:"Debug",onClick:u},{debugModeOnly:!0,label:"To Testing Grounds",onClick:g}];function b(D){s=D,o(1,s)}function J(D){r=D,o(3,r)}function K(D){s=D,o(1,s)}function C(D){a=D,o(4,a)}function j(D){l=D,o(5,l)}const Y=()=>o(0,t=Tn(t)),k=()=>gt(t),F=()=>as(t);return e.$$set=D=>{"state"in D&&o(0,t=D.state),"debugMode"in D&&o(1,s=D.debugMode),"buildInfo"in D&&o(2,i=D.buildInfo)},[t,s,i,r,a,l,c,M,y,b,J,K,C,j,Y,k,F]}class Ii extends Ce{constructor(n){super(),we(this,n,Ei,Ai,pe,{state:0,debugMode:1,buildInfo:2})}}const Oi="2023-10-02",Mi="50ebfc0",Ti={date:Oi,hash:Mi};function Ri(e){let n,o,t,s,i,r,a,l,u,c,f,p,g,_,v,I;t=new hi({props:{state:e[0]}});function M(k){e[2](k)}function y(k){e[3](k)}let b={};e[0]!==void 0&&(b.state=e[0]),e[1]!==void 0&&(b.debugMode=e[1]),i=new Xs({props:b}),ye.push(()=>ve(i,"state",M)),ye.push(()=>ve(i,"debugMode",y));function J(k){e[4](k)}function K(k){e[5](k)}let C={buildInfo:Ti};e[0]!==void 0&&(C.state=e[0]),e[1]!==void 0&&(C.debugMode=e[1]),c=new Ii({props:C}),ye.push(()=>ve(c,"state",J)),ye.push(()=>ve(c,"debugMode",K));function j(k){e[6](k)}let Y={};return e[0]!==void 0&&(Y.state=e[0]),_=new _i({props:Y}),ye.push(()=>ve(_,"state",j)),{c(){n=T("div"),o=T("div"),Oe(t.$$.fragment),s=S(),Oe(i.$$.fragment),l=S(),u=T("div"),Oe(c.$$.fragment),g=S(),Oe(_.$$.fragment),this.h()},l(k){n=R(k,"DIV",{class:!0});var F=P(n);o=R(F,"DIV",{class:!0});var D=P(o);Me(t.$$.fragment,D),D.forEach(d),s=Z(F),Me(i.$$.fragment,F),F.forEach(d),l=Z(k),u=R(k,"DIV",{class:!0,id:!0});var le=P(u);Me(c.$$.fragment,le),g=Z(le),Me(_.$$.fragment,le),le.forEach(d),this.h()},h(){E(o,"class","characterSide svelte-3spdd7"),E(n,"class","container svelte-3spdd7"),E(u,"class","container svelte-3spdd7"),E(u,"id","footer")},m(k,F){O(k,n,F),h(n,o),Te(t,o,null),h(n,s),Te(i,n,null),O(k,l,F),O(k,u,F),Te(c,u,null),h(u,g),Te(_,u,null),I=!0},p(k,[F]){const D={};F&1&&(D.state=k[0]),t.$set(D);const le={};!r&&F&1&&(r=!0,le.state=k[0],_e(()=>r=!1)),!a&&F&2&&(a=!0,le.debugMode=k[1],_e(()=>a=!1)),i.$set(le);const he={};!f&&F&1&&(f=!0,he.state=k[0],_e(()=>f=!1)),!p&&F&2&&(p=!0,he.debugMode=k[1],_e(()=>p=!1)),c.$set(he);const ae={};!v&&F&1&&(v=!0,ae.state=k[0],_e(()=>v=!1)),_.$set(ae)},i(k){I||(q(t.$$.fragment,k),q(i.$$.fragment,k),q(c.$$.fragment,k),q(_.$$.fragment,k),I=!0)},o(k){z(t.$$.fragment,k),z(i.$$.fragment,k),z(c.$$.fragment,k),z(_.$$.fragment,k),I=!1},d(k){k&&(d(n),d(l),d(u)),Re(t),Re(i),Re(c),Re(_)}}}function Di(e,n,o){let t,s=null;s=localStorage.getItem("reloadGuard"),s?t=JSON.parse(s):t=qo();let i=t.settings.debug;function r(f){t=f,o(0,t)}function a(f){i=f,o(1,i)}function l(f){t=f,o(0,t)}function u(f){i=f,o(1,i)}function c(f){t=f,o(0,t)}return[t,i,r,a,l,u,c]}class Li extends Ce{constructor(n){super(),we(this,n,Di,Ri,pe,{})}}export{Li as component};
