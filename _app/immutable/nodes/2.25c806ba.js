import{s as me,n as ye,e as Qe,o as sn,f as hn,r as Ln,b as ge,h as he,i as lt}from"../chunks/scheduler.8ae2156d.js";import{S as we,i as He,e as de,a as I,f,g as w,m as D,h as H,j as N,n as O,k as R,x as p,o as Y,s as x,c as j,y as Ie,d as q,p as Ne,t as $,b as Pe,z as rn,A as _e,r as De,u as Oe,v as Me,w as Re,B as Do,l as on,C as at}from"../chunks/index.9c43906b.js";import{t as We,a as ct,s as Rn}from"../chunks/index.5b7ba905.js";function Be(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var X=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(X||{}),F=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(F||{}),fe=(e=>(e.APPRENTICE="apprentice",e.KNIGHT="knight",e.HERO="hero",e.LORD="lord",e.MASTER="master",e))(fe||{}),le=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(le||{}),ie=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(ie||{}),L=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(L||{}),Q=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))(Q||{});const _n=[{name:"items.weapons.sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:Q.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.twoHandedSword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:Q.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:Q.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:Q.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.doubleHeadedAxe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:Q.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],In=[{name:"items.weapons.orchSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:Q.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.orchBow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:Q.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"items.weapons.trollClub",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:Q.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],ut=[{name:"items.armour.chainMail",type:Q.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"items.armour.plateMail",type:Q.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"items.armour.dragonSkinMail",type:Q.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],Un=[{name:"items.armour.orchMail",defense:0,magicProtection:!1,amountInDeck:4,type:Q.ARMOUR,movementReduction:0,value:0},{name:"items.armour.trollSkin",defense:1,magicProtection:!1,amountInDeck:4,type:Q.ARMOUR,movementReduction:0,value:0}],ln=" ",ze="?",an="#",Ce=(e,n,o,t)=>({type:e,name:n,position:{x:o,y:t},found:!1}),tn=(e,n,o,t)=>({type:e,name:t.name,position:{x:n,y:o},found:!1,item:t}),Z=(e,n,o)=>({side:e,x:n,y:o,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),ft=(e,n,o,t)=>({...Z(e,n,o),trapped:!0,trapAttacks:t}),Xe=(e,n,o)=>({...Z(e,n,o),hidden:!0}),vn=(e,n,o)=>({...Z(e,n,o),locked:!0}),pn=(e,n,o,t)=>({...Z(e,n,o),locked:!0,trapped:!0,trapAttacks:t}),dt=(e,n,o,t)=>({...Z(e,n,o),hidden:!0,trapped:!0,trapAttacks:t}),mt=(e,n,o,t,s)=>{const i=se(e,n,o,t);return i.inventory=s,i},se=(e,n,o,t)=>{const s=Object.values(X).indexOf(n),i=Object.keys(X)[s];let r=fe.LORD,l=2,a=2,c=4,u=4,g=4,E=In[0],_,C=Un[0];switch(e){case F.ORCH:{r=fe.APPRENTICE,a=0,c=2,u=2,g=1,_=In[1];break}case F.TROLL:{r=fe.KNIGHT,a=1,c=3,u=3,g=2,E=In[2],C=Un[1];break}}return e===F.YELLOW_DARK_LORD&&(l=3),{type:e,level:r,colour:n,actions:l,defense:a,health:c,maxHealth:u,experience:g,name:e+" ("+i+")",movement:3,maxMovement:3,position:{x:o,y:t},weapon:E,armour:C,incapacitated:!1,inventory:[],rangedWeapon:_}},pt=e=>{const n=e.currentActor;if(n.blinded){v(e,"logs.heroAction.blinded",{hero:h(n.name)});return}const o=n.inventory.filter(a=>{var c;return(c=a.properties)==null?void 0:c[Fn]}).map(a=>{var c;return v(e,"logs.heroAction.searchBonus",{hero:h(n.name),item:h(a.name)}),(c=a.properties)==null?void 0:c[Fn]}).reduce((a,c)=>a+c,0),t=$e(n.level,1+o);let s,i,r,l;t>=1?(s=Dt(e,n,t),s||(i=At(e,n,t)),!s&&!i&&(r=bt(e,n,t)),!s&&!i&&!r&&(l=kt(e,n,t)),!s&&!i&&!r&&!l&&v(e,"logs.heroAction.searchFoundNothing",{hero:h(n.name)})):v(e,"logs.heroAction.searchFoundNothing",{hero:h(n.name)})},Oo=e=>{const n=e.currentActor;if(!n)return!1;const o=e.dungeon.layout.secrets.filter(t=>t.type===ie.TRAP_DOOR).filter(t=>!t.found).find(t=>Ee(t.position,n.position));return o?(Se(e,gt(o),n,!1),v(e,"logs.heroAction.pitfall",{hero:h(n.name)}),n.movement=0,n.actions=0,n.incapacitated=!0,o.found=!0,!0):!1},Mo=(e,n)=>{const o=e.itemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.itemDeck.splice(o,1)},Ro=(e,n)=>{const o=e.magicItemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.magicItemDeck.splice(o,1)},gt=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:X.Red,maxHealth:0,name:"Trap Door",level:fe.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:Q.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),ht=(e,n)=>e.dungeon.layout.doors.filter(o=>o.hidden).find(o=>mn({x:o.x,y:o.y},n.x,n.y)),_t=(e,n)=>e.dungeon.layout.doors.filter(o=>o.trapped).find(o=>o.x===n.x&&o.y===n.y),vt=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).find(o=>mn(o.position,n.x,n.y)),yt=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).filter(o=>o.type===ie.TRAP_DOOR).find(o=>mn(o.position,n.x,n.y)),At=(e,n,o)=>{const t=ht(e,n.position);return t?(t.hidden=!1,v(e,"logs.heroAction.foundDoor",{hero:h(n.name),result:`${o}`}),!0):!1},bt=(e,n,o)=>{const t=_t(e,n.position);return t?(v(e,"logs.heroAction.foundTrapInDoor",{hero:h(n.name),result:`${o}`}),t.trapped=!1,!0):!1},kt=(e,n,o)=>{const t=vt(e,n.position);if(t){switch(v(e,"logs.heroAction.foundSecret",{hero:h(n.name),result:`${o}`,secret:t.name}),t.found=!0,t.type){case ie.EQUIPMENT:{const s=t.item??Et(e);s.amountInDeck>0&&(Mo(e,s),v(e,"logs.heroAction.equipped",{hero:h(n.name),item:h(s.name)}),Bo(e,s,n));break}case ie.MAGIC_ITEM:{const s=t.item??It(e);s.amountInDeck>0&&(Ro(e,s),v(e,"logs.heroAction.found",{hero:h(n.name),item:h(s.name)}),n.inventory.push(s),s.pickup&&Nn[s.pickup](e,s,n));break}}return!0}return!1},Et=e=>{const n=e.itemDeck.length,o=Math.floor(Math.random()*n);return e.itemDeck[o]},It=e=>{const n=e.magicItemDeck.length,o=Math.floor(Math.random()*n);return e.magicItemDeck[o]},Dt=(e,n,o)=>{const t=yt(e,n.position);return t?(v(e,"logs.heroAction.foundSecret",{hero:h(n.name),result:`${o}`,secret:h(t.name)}),t.found=!0,!0):!1},gn=(e,n)=>(_n[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:fe.APPRENTICE,health:7,maxHealth:7,colour:n,experience:0,position:{x:-1,y:-1},weapon:_n[0],incapacitated:!1,inventory:[],isInventoryOpen:!1}),qe=(e,n)=>{ae(n);const o=n.currentActor;if(!o||o.actions===0)return;const t={x:o.position.x,y:o.position.y};switch(e){case"UL":t.x=o.position.x-1,t.y=o.position.y-1;break;case"U":t.y=o.position.y-1;break;case"UR":t.x=o.position.x+1,t.y=o.position.y-1;break;case"L":t.x=o.position.x-1;break;case"R":t.x=o.position.x+1;break;case"DL":t.x=o.position.x-1,t.y=o.position.y+1;break;case"D":t.y=o.position.y+1;break;case"DR":t.x=o.position.x+1,t.y=o.position.y+1;break}const s=un(n,t.x,t.y),i=!kn(n.dungeon.layout,t.x,t.y),r=cn(n,t.x,t.y);if(!s&&!i){const l=dn(n.dungeon,t.x,t.y);l?l&&(r?To(o,n,t):Go(o,n,t.x,t.y,1)):Ct(n,o,t.x,t.y)&&en(o,n,t.x,t.y)}else v(n,"logs.heroAction.illegalMove",{hero:h(o.name)});Oo(n)||Hn(o)},Co=e=>{ae(e);const n=e.currentActor;if(!n)return;if(n.blinded){v(e,"logs.heroAction.blinded",{hero:h(n.name)});return}if(!je(n)){v(e,"logs.heroAction.noActions",{hero:h(n.name)});return}const o=e.dungeon.layout.doors.find(t=>t.x===n.position.x&&t.y===n.position.y);o&&o.locked&&($e(n.level,1)>=1?(o.locked=!1,v(e,"logs.heroAction.pickedLock",{hero:h(n.name)})):v(e,"logs.heroAction.failedToPickLock",{hero:h(n.name)}),n.actions>1&&n.movement<3?n.actions-=2:n.actions--,n.movement=Fe(n),n.actions==0&&(n.movement=0))},wn=e=>{ae(e),e.heroes.forEach((n,o)=>{n.position=e.dungeon.startingPositions[o],n.movement=Fe(n),n.actions=2,n.health=n.maxHealth})},J=e=>e.heroes.filter(n=>n.health>0).map(n=>n),Ot=e=>{ae(e);const n=e.currentActor;n&&(n.actions--,n.movement=Fe(n),n.actions===0&&Tn(e))},je=e=>e.movement<Fe(e)?e.actions>1:e.actions>0,en=(e,n,o,t)=>{ae(n);const s=ke(n.dungeon.layout.grid,o,t);s&&![an,ln,ze].includes(s)&&n.dungeon.discoveredRooms.push(s),Go(e,n,e.position.x,e.position.y,1),v(n,"logs.heroAction.openedDoor",{hero:h(e.name)})},To=(e,n,o)=>{if(ae(n),e.actions===1&&e.movement<e.maxMovement){v(n,"logs.heroAction.noActions",{hero:h(e.name)});return}if(!e.weapon.useHearHeroes&&Ht(n,e)){v(n,"logs.heroAction.notNearFriend",{hero:h(e.name),weapon:h(e.weapon.name)});return}const t=wt(n,o);t&&(Se(n,e,t,!1),t.health<=0&&Lt(n,t,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},Lo=e=>{ae(e);const n=e.currentActor;if(n){if(n.blinded){v(e,"logs.heroAction.blinded",{hero:h(n.name)});return}if(!je(n)){v(e,"logs.heroAction.noActions",{hero:h(n.name)});return}pt(e),n.actions>1&&n.movement<Fe(n)?n.actions-=2:n.actions--,n.actions==0&&(n.movement=0)}},cn=(e,n,o)=>e.dungeon.layout.monsters.some(t=>t.position.x===n&&t.position.y===o&&t.health>0),un=(e,n,o)=>J(e).some(t=>t.position.x===n&&t.position.y===o),Hn=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=Fe(e))),e.actions==0&&(e.movement=0)},Mt=e=>{ae(e),J(e).forEach(n=>{const o=n.level;n.experience>=28?n.level=fe.MASTER:n.experience>=18?n.level=fe.LORD:n.experience>=10?n.level=fe.HERO:n.experience>=4&&(n.level=fe.KNIGHT),o!==n.level&&v(e,"logs.heroAction.leveledUp",{hero:h(n.name),level:h(`content.level.${n.level}`)})})},Rt=e=>{J(e).forEach(n=>n.experience+=1)},wo=e=>{Nt(e).forEach(n=>{n.experience=0,n.health=n.maxHealth,n.movement=n.maxMovement,n.actions=2})},Ho=(e,n,o)=>!o.open&&!o.hidden&&(!o.locked||o.locked&&n)&&e.movement>0,No=(e,n)=>{const o=e.dungeon.layout.notes.find(t=>Ee(t.position,n.position));o&&(e.dungeon.layout.doors.some(s=>s.hidden&&Ee(o.position,{x:s.x,y:s.y}))||v(e,"logs.heroAction.reads",{hero:h(n.name),note:h(o.message)}))},Po=(e,n)=>{const o=e.dungeon.layout.monsters.some(t=>mn(n.position,t.position.x,t.position.y));return o&&v(e,"logs.heroAction.walkedByMonster",{hero:h(n.name)}),o},Dn=(e,n,o)=>{v(e,"logs.heroAction.drop",{hero:h(o.name),item:h(n.name)}),e.dungeon.layout.items.push({item:n,position:o.position}),n.drop&&Vo[n.drop](e,n,o)},Bo=(e,n,o)=>{switch(n.type){case Q.ARMOUR:o.armour&&Dn(e,o.armour,o),o.armour=n;break;case Q.SHIELD:o.shield&&Dn(e,o.shield,o),o.shield=n;break;case Q.WEAPON:o.weapon&&Dn(e,o.weapon,o),o.weapon=n;break;default:o.inventory.push(n);break}if(n.pickup){const t=Nn[n.pickup];t(e,n,o)}},Go=(e,n,o,t,s)=>{e.position.x=o,e.position.y=t,No(n,e),Po(n,e)?e.movement=0:e.movement-=s},Ct=(e,n,o,t)=>{const s=e.dungeon.layout.doors.find(r=>r.x===n.position.x&&r.y===n.position.y),i=n.inventory.some(r=>{var l;return(l=r.properties)==null?void 0:l[Uo]});if(s&&Ho(n,i,s)){s.locked&&i&&v(e,"logs.heroAction.brokeLock",{hero:h(n.name)});const r=Tt(n.position.x,n.position.y,o,t);if(s.side===r)return s.open=!0,s.trapped&&Se(e,ot(s),n,!1),!0}return s&&s.locked&&v(e,"logs.heroAction.locked"),!1},Tt=(e,n,o,t)=>{if(e===o){if(n>t)return L.UP;if(n<t)return L.DOWN}if(n===t){if(e>o)return L.LEFT;if(e<o)return L.RIGHT}},Lt=(e,n,o)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(t=>t!=n),e.dungeon.killCount++,o.experience+=n.experience},wt=(e,n)=>e.dungeon.layout.monsters.find(o=>Ee(o.position,n)),Ht=(e,n)=>st(e,n).filter(o=>o!==n).length>0,Nt=e=>e.heroes.filter(n=>n.health<=0).map(n=>n),Ke="USED",Kn="ATTACK_BONUS",Fn="SEARCH_BONUS",Uo="BREAK_LOCK",Wn="RE_ROLL_ATTACK",Vn="DESCRIPTION",yn="ACTIVE",An="MOVEMENT_BONUS",Yn="ACTIONS_BONUS",Ko="RESET_ON",Fo="NEXT_TURN",Pt="TRADE",Wo="NEXT_SCENARIO",Nn={movementBonusOnPickup:(e,n,o)=>{var t,s;o.maxMovement+=(t=n.properties)==null?void 0:t[An],o.actions>0&&(o.movement+=(s=n.properties)==null?void 0:s[An])}},Vo={movementBonusOnDrop:(e,n,o)=>{var t,s;o.maxMovement-1>0&&(o.maxMovement-=(t=n.properties)==null?void 0:t[An]),o.movement-1>=0&&(o.movement-=(s=n.properties)==null?void 0:s[An])}},Bt={magicHerbsOnUse:(e,n,o,t)=>{if(n.disabled){v(e,"logs.item.cannotUse",{item:h(n.name)});return}if(!t){v(e,"logs.item.noTarget");return}if(!je(o)){v(e,"logs.heroAction.noActions",{hero:h(o.name)});return}if(n.properties){if(n.properties[Ke]){v(e,"logs.item.noUsesLeft",{item:h(n.name)});return}n.properties[Ke]=!0;const s=Math.min($e(o.level,3),t.maxHealth-t.health);t.health+=s,v(e,"logs.item.magicHerbs",{user:h(o.name),item:h(n.name),target:h(t.name),addedHealth:`${s}`}),o.actions--,o.movement=o.maxMovement}},chaosSwordOnUse:(e,n,o,t)=>{if(n.disabled){v(e,"logs.item.cannotUse",{item:h(n.name)});return}},potionOfSpeedOnUse:(e,n,o)=>{var t,s,i;if(n.disabled){v(e,"logs.item.cannotUse",{item:h(n.name)});return}(t=n.properties)!=null&&t[Ke]?v(e,"logs.item.consumed",{item:h(n.name)}):(o.actions+=(s=n.properties)==null?void 0:s[Yn],n.properties&&(n.properties[Ke]=!0),v(e,"logs.item.potionOfSpeed",{user:h(o.name),item:h(n.name),actions:(i=n.properties)==null?void 0:i[Yn]}))},necklaceOfLightOnUse:(e,n,o,t)=>{var s;if(n.disabled){v(e,"logs.item.cannotUse",{item:h(n.name)});return}if(!t){v(e,"logs.item.noTarget");return}if(!je(o)){v(e,"logs.heroAction.noActions",{hero:h(o.name)});return}n.properties&&!((s=n.properties)!=null&&s[Ke])&&(n.properties[Ke]=!0,t.ignoredByMonsters=!0,o.actions--)}},Yo={magicHerbsOnReset:(e,n)=>{n.properties&&(n.properties[Ke]=!1)},necklaceOfLightOnUse:(e,n)=>{n.properties&&(n.properties[Ke]=!1),e.heroes.forEach(o=>o.ignoredByMonsters=!1)}},Gt=(e,n)=>{if(n.effect&&e.currentActor){const o=Bt[n.effect];o(e,n,e.currentActor,e.targetActor),e.targetActor=void 0}},qo=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Kt(o)).forEach(o=>{if(o.reset){const t=Yo[o.reset];t(e,o)}})})},Xo=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Ut(o)).forEach(o=>{if(o.reset){const t=Yo[o.reset];t(e,o)}})})},Ut=e=>e.properties?(e.properties[Ko]??[]).some(o=>o===Fo):!1,Kt=e=>e.properties?(e.properties[Ko]??[]).some(o=>o===Wo):!1,be=[{name:"items.magicItems.healingHerbs.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"items.magicItems.healingHerbs.description",RESET_ON:[Pt,Wo]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"items.magicItems.boots.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.boots.description",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"items.magicItems.giantsGlove.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.giantsGlove.description",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"items.magicItems.ringOfPrecision.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.ringOfPrecision.description",RE_ROLL_ATTACK:!0}},{name:"items.magicItems.crownOfWisdom.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.crownOfWisdom.description",SEARCH_BONUS:1}},{name:"items.magicItems.swordOfChaos.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.swordOfChaos.description"},effect:"chaosSwordOnUse"},{name:"items.magicItems.potionOfSpeed.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.potionOfSpeed.description",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"items.magicItems.necklaceOfLight.name",type:Q.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[Fo],ACTIVE:!0,DESCRIPTION:"items.magicItems.necklaceOfLight.description"},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],Jo={name:"campaign.iceDragon.e1m3.name",beaten:!1,winConditions:[{type:le.KILL_ALL,fulfilled:!1},{type:le.OPEN_DOOR,targetCell:{x:18,y:4},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["       ########     ","     ###DDDEEE#     ","     #CCC##EEE#     ","######CCC##EEE######","#AAA##CCC####F#IIII#","#AAABBB#J####F#IIII#","#AAA####J##G#F#IIII#","##### ##J##GGF#IIII#","   ####KKK###F#IIII#","   #LLLKKK# #FMIIII#","   ####KKK####M#####","      #KKKMMMMM#    ","      ####MMMM##    ","         ######     "],corridors:["B","D","F","L"],pits:[{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:15,y:8},{x:16,y:8},{x:17,y:8}],doors:[Z(L.RIGHT,3,5),pn(L.DOWN,6,5,1),Z(L.UP,6,5),Z(L.DOWN,8,4),Xe(L.UP,8,2),Z(L.DOWN,8,7),Z(L.LEFT,7,9),pn(L.LEFT,4,9,1),pn(L.RIGHT,9,11,1),Xe(L.RIGHT,14,9),Xe(L.UP,18,4),pn(L.LEFT,14,9,1),Z(L.LEFT,13,7),vn(L.UP,11,6),Z(L.UP,13,4),Z(L.LEFT,11,1)],monsters:[se(F.ORCH,X.Yellow,5,5),mt(F.TROLL,X.Yellow,7,3,[be[3]]),se(F.ORCH,X.Red,7,11),se(F.ORCH,X.Blue,11,2),se(F.ORCH,X.Blue,14,11),se(F.YELLOW_DARK_LORD,X.Yellow,18,5)],secrets:[tn(ie.MAGIC_ITEM,8,10,be[2]),Ce(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",8,6),Ce(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,1),Ce(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,7),Ce(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",13,11)],notes:[{position:{x:6,y:5},message:"campaign.iceDragon.e1m3.notes.hint1"},{position:{x:8,y:3},message:"campaign.iceDragon.e1m3.notes.hint2"},{position:{x:8,y:8},message:"campaign.iceDragon.e1m3.notes.hint3"},{position:{x:14,y:10},message:"campaign.iceDragon.e1m3.notes.hint4"}],items:[]},killCount:0},So={name:"campaign.iceDragon.e1m2.name",nextDungeon:Jo,beaten:!1,winConditions:[{type:le.KILL_ALL,fulfilled:!1},{type:le.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[Z(L.UP,2,13),Z(L.UP,2,10),Z(L.RIGHT,3,8),vn(L.RIGHT,6,8),Z(L.UP,8,7),Z(L.UP,8,4),Xe(L.LEFT,7,2),Z(L.LEFT,4,2),vn(L.RIGHT,12,2),Z(L.RIGHT,15,2),Z(L.DOWN,17,7),Z(L.DOWN,17,10),Xe(L.DOWN,17,14)],monsters:[se(F.TROLL,X.Red,3,7),se(F.ORCH,X.Red,12,8),se(F.ORCH,X.Green,11,1),se(F.TROLL,X.Green,2,2),se(F.ORCH,X.Yellow,18,7),se(F.TROLL,X.Yellow,17,10)],secrets:[Ce(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,3),Ce(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",3,3),Ce(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",15,2),tn(ie.MAGIC_ITEM,2,3,be[1]),tn(ie.MAGIC_ITEM,16,11,be[6])],notes:[{message:"campaign.iceDragon.e1m2.notes.hint1",position:{x:2,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint2",position:{x:8,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint3",position:{x:2,y:3}},{message:"campaign.iceDragon.e1m2.notes.hint4",position:{x:17,y:11}}],items:[]},killCount:0},Qo={name:"campaign.iceDragon.e1m1.name",nextDungeon:So,beaten:!1,winConditions:[{type:le.KILL_ALL,fulfilled:!1},{type:le.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[Z(L.RIGHT,3,5),Z(L.RIGHT,6,5),Z(L.RIGHT,10,6),Z(L.RIGHT,13,6),Z(L.RIGHT,10,9),Z(L.RIGHT,13,9),Z(L.RIGHT,12,3),Xe(L.UP,9,4),Xe(L.RIGHT,15,2)],monsters:[se(F.ORCH,X.Blue,10,8),se(F.ORCH,X.Red,13,9),se(F.TROLL,X.Red,16,2),se(F.TROLL,X.Yellow,14,7)],secrets:[Ce(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",10,5),Ce(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",13,1),Ce(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",16,10),tn(ie.MAGIC_ITEM,16,6,be[0])],notes:[{message:"campaign.iceDragon.e1m1.notes.hint1",position:{x:2,y:4}},{message:"campaign.iceDragon.e1m1.notes.hint2",position:{x:9,y:8}},{message:"campaign.iceDragon.e1m1.notes.hint3",position:{x:9,y:5}},{message:"campaign.iceDragon.e1m1.notes.hint4",position:{x:9,y:3}}],items:[]},killCount:0},Zo={name:"campaign.iceDragon.e1mo.name",beaten:!1,winConditions:[{type:le.KILL_ALL,fulfilled:!1}],nextDungeon:Qo,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[Z(L.RIGHT,3,9),Z(L.RIGHT,6,9),Z(L.UP,7,7),Z(L.UP,7,4)],monsters:[se(F.ORCH,X.Green,6,9),se(F.ORCH,X.Yellow,8,10),se(F.ORCH,X.Red,7,5),se(F.ORCH,X.Red,9,3),se(F.TROLL,X.Green,6,1)],secrets:[],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},Ft=[{name:"items.shields.largeShield",type:Q.SHIELD,amountInDeck:2,dice:2,value:2},{name:"items.shields.smallShield",type:Q.SHIELD,amountInDeck:2,dice:1,value:1}],Wt=()=>{const e=[];return be.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},Vt=()=>{const e=[];return _n.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),ut.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),Ft.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},Yt={name:"campaign.iceDragon.name",dungeons:[Zo,Qo,So,Jo],itemDeck:Vt(),magicItemDeck:Wt(),heroes:[gn("Fearik",X.Yellow),gn("Helbran",X.Red),gn("Siedel",X.Green),gn("Wulf",X.Blue)]},Pn=(e,n)=>{const o=Math.abs(n.x-e.x),t=Math.abs(n.y-e.y),s=Math.min(o,t),i=Math.max(o,t),r=s,l=i-s;let a=Math.sqrt(2);return l===0&&(a=1),Math.floor(a*r+l)},qt=(e,n)=>{ae(e);const o=e.currentActor,t=e.dungeon.layout.items.find(i=>Ee(i.position,o.position));if(t){const i=t.item;i.type===Q.MAGIC?Ro(e,i):Mo(e,i);const r=e.dungeon.layout.items.indexOf(t);e.dungeon.layout.items.splice(r,1),v(e,"logs.heroAction.pickUp",{hero:h(o.name),item:h(i.name)}),Bo(e,i,o);return}const s=e.dungeon.layout.doors.find(i=>i.x===o.position.x&&i.y===o.position.y&&!i.open);if(s&&!s.hidden){const i=o.inventory.some(r=>{var l;return(l=r.properties)==null?void 0:l[Uo]});if(Ho(o,i,s)){switch(s.locked&&i&&v(e,"logs.heroAction.brokeLock",{hero:h(o.name)}),s.open=!0,s.trapped&&Se(e,ot(s),o,!1),s.side){case L.RIGHT:en(o,e,n.x+1,n.y);break;case L.LEFT:en(o,e,n.x-1,n.y);break;case L.DOWN:en(o,e,n.x,n.y+1);break;case L.UP:en(o,e,n.x,n.y-1);break}Hn(o)}else if(s.locked&&!s.hidden){if(!je(o)){v(e,"logs.heroAction.noActions",{hero:h(o.name)});return}v(e,"logs.heroAction.locked"),Co(e)}}else{if(!je(o)){v(e,"logs.heroAction.noActions",{hero:h(o.name)});return}Lo(e)}},Xt=(e,n)=>{ae(e);const o=e.currentActor;if(o.actions===0){o.movement=0,v(e,"logs.heroAction.noActions",{hero:h(o.name)});return}if(kn(e.dungeon.layout,n.x,n.y)){const s=un(e,n.x,n.y),i=cn(e,n.x,n.y),r=Pn(o.position,n),l=Bn(o.position,n,2,e,!0);if(!s&&!i&&r<=o.movement&&l){if(o.position=n,o.movement-=r,No(e,o),Po(e,o)&&(o.movement=0),Oo(e))return}else i&&(r<=o.weapon.range?To(o,e,n):v(e,"logs.heroAction.monsterOutOfRange"))}Hn(o)},Jt=(e,n,o)=>{const t=document.getElementById("gameBoard");if(!t)return;const s=t.getBoundingClientRect(),i=Math.min(Math.floor((e.clientX-s.left)/n),o.dungeon.layout.grid[0].length-1),r=Math.min(Math.floor((e.clientY-s.top)/n),o.dungeon.layout.grid.length-1),l=o.dungeon.layout.grid[r][i],a=o.currentActor;i===a.position.x&&r===a.position.y?qt(o,{x:i,y:r}):Je(o.dungeon,l)&&Xt(o,{x:i,y:r})},On=e=>e.dungeon.layout.monsters.filter(n=>[F.ORCH,F.TROLL].includes(n.type)),St=e=>{const n=xo(e);n.length===0&&v(e,"logs.monsterAction.noMonsterAct"),n.forEach(o=>{const t=o.actions;for(v(e,"logs.monsterAction.acted",{monster:h(o.name)});o.actions>0;){ae(e);const s=st(e,o).filter(u=>!u.ignoredByMonsters),i=jt(e,o),r=ns([...i,...On(e)],o),l=os([...i,...On(e)],o),a=ts([...J(e),...On(e)],o,e);switch(Qt(e,o,s,i,r,l,a)){case"MELEE_ATTACK":{const u=xt(s);qn(e,o,u,!1);break}case"RANGED_ATTACK":{const u=Zt(i,o);qn(e,o,u,!0);break}case"MOVE":{zt(e,o);break}case"DIAGONAL_FIRE_ATTACK":Mn(e,o,r);break;case"ORTHOGONAL_FIRE_ATTACK":Mn(e,o,l);break;case"SAME_ROOM_FIRE_ATTACK":Mn(e,o,a)}o.movement=Fe(o)}o.actions=t,o.movement=Fe(o)})},Qt=(e,n,o,t,s,i,r)=>o.length>0?"MELEE_ATTACK":!n.rangedWeapon&&s.length===0?"MOVE":t.length>0&&n.rangedWeapon?Math.random()<.1?(v(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"RANGED_ATTACK":r.length>0?Math.random()<.1?(v(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"SAME_ROOM_FIRE_ATTACK":t.length>0&&i.length>0?Math.random()<.1?(v(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"ORTHOGONAL_FIRE_ATTACK":t.length>0&&s.length>0?Math.random()<.1?(v(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"DIAGONAL_FIRE_ATTACK":"MOVE",Zt=(e,n)=>e.filter(o=>!o.shield).sort(o=>nn(n.position,o.position)).sort((o,t)=>t.health-o.health||nn(n.position,o.position)-nn(n.position,t.position))[0],xt=e=>e.sort((n,o)=>o.health-n.health)[0],jt=(e,n)=>J(e).filter(o=>!o.ignoredByMonsters).filter(o=>Bn(n.position,o.position,48,e,!1)),xo=e=>e.dungeon.layout.monsters.filter(n=>{const o=ke(e.dungeon.layout.grid,n.position.x,n.position.y);return o&&Je(e.dungeon,o)&&n.health>0}),qn=(e,n,o,t)=>{Se(e,n,o,t),(n==null?void 0:n.actions)>1&&(n==null?void 0:n.movement)<3?n.actions-=2:n.actions--},$t=(e,n)=>J(e).map(o=>({hero:o,dist:nn(o.position,n.position)})).sort((o,t)=>o.dist-t.dist)[0],zt=(e,n)=>{const o=$t(e,n);for(;n.movement>0;){if(o&&o.dist>1){const t=es(e,n.position);if(t.length>0){const s=t.map(i=>({pos:i,dist:nn(i,o.hero.position)})).sort((i,r)=>i.dist-r.dist)[0].pos;n.position=s,v(e,"logs.monsterAction.movedTowards",{monster:h(n.name),hero:h(o.hero.name),x:`${s.x}`,y:`${s.y}`})}else v(e,"logs.monsterAction.couldNotMove",{monster:h(n.name)})}n.movement--}n.actions--},es=(e,n)=>{const o=n.x,t=n.y,s=[];for(let i=o-1;i<=o+1;i++)for(let r=t-1;r<=t+1;r++)i===o&&r===t||kn(e.dungeon.layout,i,r)&&dn(e.dungeon,i,r)&&s.push({x:i,y:r});return s.filter(i=>!J(e).find(r=>r.position.x===i.x&&r.position.y===i.y)).filter(i=>!e.dungeon.layout.monsters.some(r=>r.position.x===i.x&&r.position.y===i.y))},ns=(e,n)=>e.filter(o=>[F.YELLOW_DARK_LORD,F.BLUE_DARK_LORD].includes(n.type)&&Math.abs(n.position.x-o.position.x)===Math.abs(n.position.y-o.position.y)&&Pn(n.position,o.position)>1),os=(e,n)=>e.filter(o=>[F.RED_DARK_LORD,F.BLUE_DARK_LORD].includes(n.type)&&(n.position.x===o.position.x||n.position.y===o.position.y)&&Pn(n.position,o.position)>1),ts=(e,n,o)=>e.filter(t=>[F.GREEN_DARK_LORD,F.BLUE_DARK_LORD].includes(n.type)&&ke(o.dungeon.layout.grid,n.position.x,n.position.y)===ke(o.dungeon.layout.grid,t.position.x,t.position.y)),Mn=(e,n,o)=>{o.forEach(t=>{var s,i;(s=t.armour)!=null&&s.magicProtection?v(e,"logs.monsterAction.fireAttackDeflected",{monster:h(n.name),target:h(t.name),armour:h((i=t.armour)==null?void 0:i.name)}):Se(e,n,t,!0)})},Xn=[{name:"events.hungryTroll.name",number:1,description:"events.hungryTroll.description",effect:"theHungryTroll",used:!1},{name:"events.sunStone.name",number:2,description:"events.sunStone.description",effect:"sunStone",used:!1},{name:"events.timePortal.name",number:3,description:"events.timePortal.description",effect:"timePortal",used:!1},{name:"events.fountainOfYouth.name",number:4,description:"events.fountainOfYouth.description",effect:"fountainOfYouth",used:!1},{name:"events.sleepingGas.name",number:5,description:"events.sleepingGas.description",effect:"sleepingGasCloud",used:!1},{name:"events.lostOrch.name",number:6,description:"events.lostOrch.description",effect:"theLostOrch",used:!1},{name:"events.dragonsBreath.name",number:7,description:"events.dragonsBreath.description",effect:"theDragonsBreath",used:!1},{name:"events.landslide.name",number:8,description:"events.landslide.description",effect:"landslide",used:!1},{name:"events.magicNode.name",number:9,description:"events.magicNode.description",effect:"fountainOfYouth",used:!1},{name:"events.foresight.name",number:10,description:"events.foresight.description",effect:"foresight",used:!1},{name:"events.earthquake.name",number:11,description:"events.earthquake.description",effect:"earthquake",used:!1},{name:"events.magicStorm.name",number:12,description:"events.magicStorm.description",effect:"theMagicStorm",used:!1},{name:"events.elementalWeapon.name",number:13,description:"events.elementalWeapon.description",effect:"theElementalWeapon",used:!1},{name:"events.orchDrums.name",number:14,description:"events.orchDrums.description",effect:"theOrchDrums",used:!1},{name:"events.weakness.name",number:15,description:"events.weakness.description",effect:"theSymbolOfWeakness",used:!1}],jo=e=>e.events?Cn(Xn.filter(n=>{var o;return(o=e==null?void 0:e.events)==null?void 0:o.includes(n.number)})):Cn(Xn),$o=e=>{const n=e.eventDeck.filter(o=>!o.used);return n.length>0?n[0]:(Cn(e.eventDeck),$o(e))},ss={sunStone:(e,n)=>{ve(e,n);const o=J(e).length-1,t=Math.floor(Math.random()*o),s=J(e)[t],i=ke(e.dungeon.layout.grid,s.position.x,s.position.y);e.dungeon.layout.monsters.filter(r=>r.type===F.TROLL).filter(r=>ke(e.dungeon.layout.grid,r.position.x,r.position.y)===i).forEach(r=>{v(e,"logs.events.sunStone",{monster:h(r.name)}),r.health=0}),n.used=!0},theHungryTroll:(e,n)=>{ve(e,n),Jn(e,F.TROLL),n.used=!0},timePortal:(e,n)=>{ve(e,n),e.heroes.forEach(o=>o.actions++),n.used=!0},fountainOfYouth:(e,n)=>{ve(e,n),J(e).forEach(o=>{if(o.health<o.maxHealth){const t=$e(o.level,3);o.health+=Math.min(t,o.maxHealth-o.health)}}),n.used=!0},sleepingGasCloud:(e,n)=>{ve(e,n),J(e).forEach(o=>{o.actions=Math.max(1,o.actions-1)}),n.used=!0},theLostOrch:(e,n)=>{ve(e,n),Jn(e,F.ORCH),n.used=!0},theDragonsBreath:(e,n)=>{ve(e,n),J(e).forEach(o=>o.blinded=!0),n.used=!0},landslide:(e,n)=>{ve(e,n);const o=e.dungeon.layout.corridors.filter(r=>!fs(e,r)).filter(r=>Je(e.dungeon,r)),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];e.dungeon.collapsedCorridor=i,e.dungeon.layout.grid=e.dungeon.layout.grid.map(r=>r.replaceAll(i,ze)),n.used=!0},foreSight:(e,n)=>{if(ve(e,n),e.dungeon.layout.secrets.filter(t=>t.type===ie.EQUIPMENT||t.type===ie.MAGIC_ITEM).filter(t=>!t.found).filter(t=>t.item).filter(t=>{const s=ke(e.dungeon.layout.grid,t.position.x,t.position.y)??"";return!Je(e.dungeon,s)}).length>0){const t=e.dungeon.layout.secrets.pop();t&&t.item&&(v(e,"logs.events.foreSight",{x:`${t.position.x+2}`,y:`${t.position.y-1}`}),e.dungeon.layout.items.push({item:t.item,position:t.position}))}n.used=!0},earthquake:(e,n)=>{ve(e,n);const o=zo(e),t={name:"boulder",type:Q.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},s={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:t,level:fe.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:X.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(i=>i.type===F.TROLL).filter(i=>ke(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>Se(e,s,i,!1)),J(e).filter(i=>ke(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>Se(e,s,i,!1)),n.used=!0},theMagicStorm:(e,n)=>{var t;ve(e,n);const o=J(e).filter(s=>s.inventory.filter(i=>!i.disabled).some(i=>i.type===Q.MAGIC));if(o.length>0){const s=o.length-1,i=Math.floor(Math.random()*s),r=o[i],l=r.inventory.filter(a=>a.type===Q.MAGIC);if(l.length>0){const a=l.length-1,c=Math.floor(Math.random()*a),u=l[c];u.disabled=!0,!((t=u.properties)!=null&&t[yn])&&u.pickup&&u.drop&&Vo[u.drop](e,u,r)}}n.used=!0},theElementalWeapon:(e,n)=>{ve(e,n);const o=J(e),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];i.weapon.elemental=!0,n.used=!0},theOrchDrums:(e,n)=>{ve(e,n),e.dungeon.layout.monsters.filter(o=>o.type===F.ORCH).forEach(o=>o.actions=3),n.used=!0},theSymbolOfWeakness:(e,n)=>{ve(e,n),J(e).forEach(o=>o.weakened=!0),n.used=!0}},is=e=>{J(e).some(n=>n.weapon.elemental)&&(v(e,"logs.events.magicStormRestored"),J(e).forEach(n=>{n.inventory.forEach(o=>{var t;!((t=o.properties)!=null&&t[yn])&&o.pickup&&Nn[o.pickup](e,o,n),o.disabled=!1})}))},rs=e=>{e.eventDeck.filter(o=>!o.used).length===0&&(cs(e),ls(e),is(e)),us(e),as(e)},ls=e=>{const n=e.dungeon.collapsedCorridor;n&&(v(e,"logs.events.landslideRestored"),e.dungeon.layout.grid=e.dungeon.layout.grid.map(o=>o.replaceAll(ze,n)),e.dungeon.collapsedCorridor=void 0)},as=e=>{J(e).some(n=>n.blinded)&&(v(e,"logs.events.blindedRestored"),J(e).forEach(n=>n.blinded=!1))},cs=e=>{J(e).some(n=>n.weapon.elemental)&&(v(e,"logs.events.elementalWeaponRestored"),J(e).forEach(n=>n.weapon.elemental=!1))},us=e=>{J(e).some(n=>n.weakened)&&(v(e,"logs.events.weakenedRestored"),J(e).forEach(n=>n.weakened=!1))},zo=e=>{const n=e.dungeon.discoveredRooms.length-1,o=Math.floor(Math.random()*n);return e.dungeon.discoveredRooms[o]},Jn=(e,n)=>{const o=xo(e).filter(l=>l.type===n);if(o.length===4)return;const s=zo(e),i=[X.Red,X.Green,X.Yellow,X.Blue];o.forEach(l=>{const a=i.indexOf(l.colour);a!==-1&&i.splice(a,1)});let r=!1;for(let l=0;l<e.dungeon.layout.grid.length;l++){const a=fn(e.dungeon.layout.grid[l]);for(let c=0;c<a.length;c++)if(a[c]===s&&!un(e,c,l)&&!cn(e,c,l)){e.dungeon.layout.monsters.push(se(n,i[0],c,l)),r=!0;break}if(r)break}},ve=(e,n)=>{v(e,n.description),v(e,n.name)},Cn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e.forEach(t=>t.used=!1),e},fs=(e,n)=>{const o=[];return e.dungeon.layout.grid.forEach((t,s)=>{fn(t).forEach((i,r)=>{i===n&&o.push(un(e,r,s)||cn(e,r,s))})}),o.some(t=>t)},h=(e,n)=>We.get(e,n)??e,ds=e=>{ae(e),localStorage.setItem("state",JSON.stringify(e)),v(e,"logs.gameSaved")},ae=e=>{e.reRender=!0,localStorage.setItem("reloadGuard",JSON.stringify(e))},et=e=>(e.currentActor=e.heroes.find(n=>{var o;return n.name===((o=e.currentActor)==null?void 0:o.name)}),v(e,"logs.gameLoaded"),ae(e),e),nt=()=>{const e=structuredClone(Yt),n={heroes:e.heroes,dungeon:e.dungeons[0],currentActor:e.heroes[0],actionLog:[{key:"logs.playingCampaign",properties:{name:h(e.name)}},{key:"logs.gameInitialized"},{key:"logs.initLogActions"},{key:"logs.initLogMoves"},{key:"logs.initLogMoveFinished"},{key:"logs.initLogUnfair"}],itemDeck:Sn(e.itemDeck),magicItemDeck:Sn(e.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:jo(e.dungeons[0]),reRender:!0};return wn(n),localStorage.setItem("autosave",JSON.stringify(n)),n},Sn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e},fn=e=>{const n=[];for(let o=0;o<e.length;o++)n.push(e[o]);return n},$e=(e,n)=>{let o=[];for(let t=0;t<n;t++)o.push(Math.floor(Math.random()*6)+1);switch(e){case fe.APPRENTICE:o=o.filter(t=>t===5);break;case fe.KNIGHT:case fe.HERO:o=o.filter(t=>t>=4);break;case fe.LORD:case fe.MASTER:o=o.filter(t=>t>=3);break}return o.length},Fe=e=>{var n;return e.maxMovement-(((n=e.armour)==null?void 0:n.movementReduction)??0)},ms=e=>e.dungeon.winConditions.filter(n=>n.type!==le.KILL_ALL).some(n=>!n.fulfilled),Tn=e=>{if(e.settings.debug&&console.log(e),ae(e),gs(e),e.currentActor===void 0)return e;{v(e,"logs.endedTurn",{name:h(e.currentActor.name)});let o=J(e).indexOf(e.currentActor)+1;if(o===J(e).length&&(St(e),o=0,Xo(e)),J(e).length===0)return ps(e);J(e)[o].incapacitated&&(v(e,"logs.noLongerIncapacitated",{name:h(J(e)[o].name)}),J(e)[o].incapacitated=!1,o++),e.currentActor.actions=2,e.currentActor.movement=Fe(e.currentActor),e.currentActor=J(e)[o];const t=ms(e);if(o===0&&!t){rs(e);const s=$o(e);e.currentEvent=s,ss[s.effect](e,s)}v(e,"logs.startedTurn",{name:h(e.currentActor.name)})}return e},ps=e=>{const n=localStorage.getItem("autosave");if(n){const o=JSON.parse(n);return ae(o),wo(o),wn(o),qo(o),Xo(o),tt({x:o.dungeon.startingPositions[0].x,y:o.dungeon.startingPositions[0].y},o.settings.cellSize),o.currentActor=o.heroes.find(t=>{var s;return t.name===((s=o.currentActor)==null?void 0:s.name)}),v(o,"logs.allHeroesDead"),o}return v(e,"logs.failedToReset"),e},gs=e=>{var n,o;e.dungeon.winConditions.forEach(t=>{var s;switch(t.type){case le.KILL_ALL:{const i=e.dungeon.layout.monsters.map(r=>r.health).reduce((r,l)=>r+l,0);t.fulfilled=i<=0;break}case le.REACH_CELL:{t.fulfilled=J(e).some(i=>{var r;return i.position.x===((r=t.targetCell)==null?void 0:r.x)&&i.position.y===t.targetCell.y});break}case le.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(i=>i.type===t.targetMonsterType).some(i=>i.health>0);break}case le.OPEN_DOOR:{t.fulfilled=((s=e.dungeon.layout.doors.find(i=>{var r,l;return i.x===((r=t.targetCell)==null?void 0:r.x)&&i.y===((l=t.targetCell)==null?void 0:l.y)}))==null?void 0:s.open)??!1;break}case le.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,s)=>t&&s,!0),e.dungeon.beaten&&(v(e,"logs.allConditionsFulfilled"),v(e,"logs.clearedDungeon",{name:h(e.dungeon.name)}),(n=e.dungeon.nextDungeon)!=null&&n.name&&v(e,"logs.moveToNext",{name:h((o=e.dungeon.nextDungeon)==null?void 0:o.name)}))},ot=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:X.Red,maxHealth:0,name:"Door",level:fe.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:Q.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),kn=(e,n,o)=>{var s,i;let t=!0;if(n<0||n>=e.grid[0].length||o<0||o>=e.grid.length)t=!1;else{const r=(s=e.pits)==null?void 0:s.some(c=>Ee(c,{x:n,y:o})),l=(i=e.pillars)==null?void 0:i.some(c=>Ee(c,{x:n,y:o})),a=ke(e.grid,n,o);(r||l||a===ln||a===an)&&(t=!1)}return t},dn=(e,n,o)=>{const t=ke(e.layout.grid,n,o);return t?Je(e,t):!1},Je=(e,n)=>e.discoveredRooms.includes(n),ke=(e,n,o)=>{let t="";return e.forEach((s,i)=>{fn(s).forEach((r,l)=>{i===o&&l===n&&(t=r)})}),t},mn=(e,n,o)=>e.x===n&&e.y===o||e.x===n-1&&e.y===o||e.x===n-1&&e.y===o-1||e.x===n&&e.y===o-1||e.x===n+1&&e.y===o-1||e.x===n+1&&e.y===o||e.x===n+1&&e.y===o+1||e.x===n&&e.y===o+1||e.x===n-1&&e.y===o+1,hs=(e,n,o,t)=>{var i;const s=((i=t.armour)==null?void 0:i.defense)??t.defense;return`${e} damage (${n}-(${s}+${o})=${e})`},Ee=(e,n)=>e.x===n.x&&e.y===n.y,v=(e,n,o)=>{e.actionLog=[{key:n,properties:o},...e.actionLog],ae(e)},Se=(e,n,o,t)=>{var A,y;let s=n.weapon;t&&n.rangedWeapon&&(s=n.rangedWeapon);let i=0,r=0;s.ignoresArmour?o.armour&&v(e,"logs.takeDamage.armourUseless",{actor:h(o.name),weapon:h(s.name)}):i=((A=o.armour)==null?void 0:A.defense)??o.defense,s.ignoresShield?o.shield&&v(e,"logs.takeDamage.shieldUseless",{actor:h(o.name),weapon:h(s.name)}):r=$e(o.level,((y=o.shield)==null?void 0:y.dice)??0);const l=n.inventory.filter(m=>{var d;return(d=m==null?void 0:m.properties)==null?void 0:d[Wn]}).some(m=>{var d;return v(e,"logs.takeDamage.usedEffect",{actor:h(n.name),item:h(m.name)}),(d=m.properties)==null?void 0:d[Wn]}),a=n.inventory.filter(m=>{var d;return(d=m==null?void 0:m.properties)==null?void 0:d[Kn]}).map(m=>{var d;return v(e,"logs.takeDamage.usedEffect",{actor:h(n.name),item:h(m.name)}),(d=m.properties)==null?void 0:d[Kn]}).reduce((m,d)=>m+d,0),c=n.blinded?1:0,u=n.weakened?1:0,g=n.weapon.elemental?1:0,E=a+g,_=c+u,C=$e(n.level,s.dice+E-_);let M=Math.max(C-(i+r),0);M===0&&l&&(v(e,"logs.takeDamage.reRoll",{actor:h(n.name)}),M=Math.max(C-(i+r),0)),o.health-=M,v(e,"logs.takeDamage.attackedWith",{actor:h(n.name),target:h(o.name),weapon:h(s.name),damage:hs(M,C,r,o)}),o.health<=0&&(v(e,"logs.takeDamage.killed",{actor:h(n.name),target:h(o.name)}),o.health=0,o.level=fe.APPRENTICE)},tt=(e,n)=>{const o=document.getElementById("gameBoardContainer"),t=document.getElementById("gameBoard");if(o&&t){const s=e.x*n,i=e.y*n,r=t.offsetWidth,l=t.offsetHeight;o.scrollLeft=Math.round(s/r),o.scrollTop=Math.round(i/l)}},_s=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=[{key:"logs.youHaveReached",properties:{name:h(e.dungeon.name)}}],e.eventDeck=jo(e.dungeon),ae(e),Rt(e),Mt(e),wo(e),wn(e),qo(e),tt({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize),localStorage.setItem("autosave",JSON.stringify(e)))},nn=(e,n)=>Math.sqrt(Math.pow(e.x-(n==null?void 0:n.x),2)+Math.pow(e.y-(n==null?void 0:n.y),2)),Bn=(e,n,o,t,s)=>{const i={x:e.x*o-Math.floor(o/2),y:e.y*o-Math.floor(o/2)},r={x:n.x*o-Math.floor(o/2),y:n.y*o-Math.floor(o/2)};return Gn(i,e,r,n,o,t,s,[])},Gn=(e,n,o,t,s,i,r,l)=>{var M,A;if(isNaN(e.x)||isNaN(e.y))return!1;const a=vs(e,o),c={x:Math.round((a.x+Math.floor(s/2))/s),y:Math.round((a.y+Math.floor(s/2))/s)};if(isNaN(c.x)||isNaN(c.y)||isNaN(a.x)||isNaN(a.y))return!1;const u=ke(i.dungeon.layout.grid,c.x,c.y),g=(M=i.dungeon.layout.pits)==null?void 0:M.some(y=>Ee(y,c)),E=(A=i.dungeon.layout.pillars)==null?void 0:A.some(y=>Ee(y,c)),_=i.dungeon.layout.monsters.some(y=>Ee(y.position,c)),C=J(i).filter(y=>!Ee(y.position,n)).some(y=>Ee(y.position,c));return c.x===t.x&&c.y===t.y?(l.push(c),!0):E||_||!r&&C||u===an||u===ze||r&&(g||u===ln)?!1:(c.x===n.x&&c.y===n.y||l.some(y=>y.x===c.x&&y.y===c.y)||l.push(c),Gn(a,n,o,t,s,i,r,l))},vs=(e,n)=>{const o=e.x,t=e.y,s=n.x-o,i=n.y-t,r=s/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),l=i/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),a=Math.round(r+o),c=Math.round(l+t);return{x:a,y:c}},st=(e,n)=>J(e).filter(o=>mn(n.position,o.position.x,o.position.y)),ys=""+new URL("../assets/Dungeon_Tileset.e372bb4f.png",import.meta.url).href,As="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",bs=(e,n,o,t,s)=>{J(t).forEach(r=>{ks(e,r,n,o,s)}),Os(e,t,o),Ms(e,t,o)},ks=(e,n,o,t,s)=>{const i=n.position.x,r=n.position.y;if(e.drawImage(o,4*16,0,16,16,i*t,r*t,t,t),Es(e,n,i,r,t),Ds(e,n,i,r,t),Is(e,n,i,r,t),s){const l=`(${i},${r})`;e.fillStyle="black",e.font="8px Arial",e.fillText(l,i*t+3,r*t+10)}},Es=(e,n,o,t,s)=>{const i=e.fillStyle,r=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let l=0;l<n.actions;l++)e.fillRect(o*s+4+6*l,t*s+s-12,5,5),e.rect(o*s+4+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle="blue";for(let l=0;l<n.movement;l++)e.fillRect(o*s+s-22+6*l,t*s+s-12,5,5),e.rect(o*s+s-22+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle=i,e.strokeStyle=r},Is=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(o*s+4,t*s,s-8,4),e.fillStyle="green",e.fillRect(o*s+4,t*s,(s-8)*(n.health/n.maxHealth),4),e.rect(o*s+4,t*s,s-8,4),e.stroke()},Ds=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(o*s+4,t*s+(s-6),s-8,4),e.stroke()},Os=(e,n,o)=>{const t=n.currentActor;if(t){for(let s=t.position.x-t.movement;s<=t.position.x+t.movement;s++)for(let i=t.position.y-t.movement;i<=t.position.y+t.movement;i++)if(dn(n.dungeon,s,i)&&!(s===(t==null?void 0:t.position.x)&&i===(t==null?void 0:t.position.y))){const l=cn(n,s,i),a=un(n,s,i),c=kn(n.dungeon.layout,s,i),u=Bn(t.position,{x:s,y:i},2,n,!0);!a&&!l&&c&&u&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(s*o,i*o,o,o),e.stroke())}}},Ms=(e,n,o)=>{const t=n.currentActor;t&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o+o/3,t.position.y*o),e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o,t.position.y*o+o/3),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3,t.position.y*o+o),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o+o),e.stroke(),e.lineWidth=1)},Rs=(e,n,o,t,s)=>{t.dungeon.layout.monsters.forEach(i=>{Cs(e,n,t,i,o,s)})},Cs=(e,n,o,t,s,i)=>{const r=o.dungeon.layout.grid[t.position.y][t.position.x];if(t&&t.health>0&&Je(o.dungeon,r)){switch(t.type){case F.ORCH:Ts(e,n,s,t);break;case F.TROLL:Ls(e,n,s,t);break;default:ws(e,n,s,t);break}Hs(e,t,s),Ns(e,t,s),Ps(e,t,o.heroes,o,s,i)}},Ts=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},Ls=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},ws=(e,n,o,t)=>{e.drawImage(n,16,16,16,16,t.position.x*o,t.position.y*o,o,o)},Hs=(e,n,o)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(n.position.x*o+4,n.position.y*o+(o-6),o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Ns=(e,n,o)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n.position.x*o+4,n.position.y*o,o-8,4),e.fillStyle="green",e.fillRect(n.position.x*o+4,n.position.y*o,(o-8)*(n.health/n.maxHealth),4),e.rect(n.position.x*o+4,n.position.y*o,o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Ps=(e,n,o,t,s,i)=>{i&&o.forEach(r=>{const l=[],a={x:n.position.x*48-24,y:n.position.y*48-24},c={x:r.position.x*48-24,y:r.position.y*48-24};if(Gn(a,n.position,c,r.position,48,t,!1,l)){const g=n.position.x,E=n.position.y,_=r.position.x,C=r.position.y;e.beginPath(),e.strokeStyle=n.colour,e.lineWidth=2,e.moveTo(g*s+s/2,E*s+s/2),e.lineTo(_*s+s/2,C*s+s/2),e.stroke(),e.lineWidth=1}})},Bs=(e,n,o,t,s)=>{t.dungeon.layout.doors.forEach(i=>{Js(e,n,o,t,i,s)})},Gs=(e,n,o,t,s)=>{t.dungeon.layout.grid.forEach((i,r)=>{fn(i).forEach((l,a)=>{Ws(e,n,t,l,a,r,o),Xs(e,l,t,a,r,o,s)})}),Ks(e,n,o,t,s),Fs(e,n,o,t,s)},Us=(e,n,o,t,s)=>{t.dungeon.layout.secrets.filter(i=>i.found).forEach(i=>{switch(i.type){case ie.TRAP_DOOR:Ys(e,n,o,i);break;default:qs(e,n,o,i);break}}),t.dungeon.layout.secrets.filter(i=>!i.found).forEach(i=>{if(e.globalAlpha=.6,Ze(e,n,8,0,o,i.position.x,i.position.y,t),e.globalAlpha=1,s){const r=`${i.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(i.position.x*o,i.position.y*o,o,o),e.fillStyle="black",e.font="12px Arial",e.fillText(r,i.position.x*o,i.position.y*o+10)}})},Ze=(e,n,o,t,s,i,r,l)=>{l.dungeon.discoveredRooms.some(a=>Qn(i,r,a,l))||Qn(i,r,ze,l)?e.drawImage(n,o*48,t,48,48,i*s,r*s,s,s):it(e,i,r,s)},Ks=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pits)==null?void 0:i.filter(l=>dn(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{Ze(e,n,7,0,o,l.x,l.y,t)})},Fs=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pillars)==null?void 0:i.filter(l=>dn(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{Ze(e,n,6,0,o,l.x,l.y,t)})},Ws=(e,n,o,t,s,i,r)=>{Vs(t,o)?t===ze?(Ze(e,n,0,0,r,s,i,o),Ze(e,n,5,0,r,s,i,o)):Ze(e,n,1,0,r,s,i,o):bn(t,o)?it(e,s,i,r):Ze(e,n,0,0,r,s,i,o)},Vs=(e,n)=>Ss(e)||!Je(n.dungeon,e)&&e!==ln,it=(e,n,o,t)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="black",e.fillRect(n*t,o*t,t,t),e.stroke()},Ys=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,3*48,0,48,48,s*o,i*o,o,o)},qs=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,4*48,0,48,48,s*o,i*o,o,o)},Xs=(e,n,o,t,s,i,r)=>{!r&&(bn(n,o)||n===an)||(e.beginPath(),e.strokeStyle="black",e.rect(t*i,s*i,i,i),r&&(e.font="7px Arial",e.fillText(`${t},${s}`,t*i+3,s*i+(i-3))),e.stroke())},Js=(e,n,o,t,s,i)=>{const r=t.dungeon.layout.grid[s.y][s.x];if(s&&!s.hidden&&!s.open&&!bn(r,t))switch(e.fillStyle="brown",s.side){case L.RIGHT:{e.fillRect(s.x*o+(o-2),s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o-4),s.y*o+(o/2-4),8,8));break}case L.LEFT:{e.fillRect(s.x*o-2,s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o-4,s.y*o+(o/2-4),8,8));break}case L.UP:{e.fillRect(s.x*o,s.y*o-2,o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o-4,8,8));break}case L.DOWN:{e.fillRect(s.x*o,s.y*o+(o-2),o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o+(o-4),8,8));break}}i&&!bn(r,t)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${s.hidden?"H":"-"}/${s.trapped?`T${s.trapAttacks}`:"-"}/${s.locked?"L":"-"}]`,s.x*o,s.y*o+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(s.x*o,s.y*o,o,o))},Ss=e=>e===an,bn=(e,n)=>e===ln||!Je(n.dungeon,e),Qn=(e,n,o,t)=>{if(!t)return;const s=Math.max(e-1,0),i=Math.max(n-1,0),r=Math.min(n+1,t.dungeon.layout.grid.length-1),l=Math.min(e+1,t.dungeon.layout.grid[0].length-1);for(let a=s;a<=l;a++)for(let c=i;c<=r;c++){const u=t.dungeon.layout.grid[c];if(fn(u)[a]===o)return!0}return!1},Qs=(e,n,o,t)=>{t.dungeon.layout.items.forEach(s=>{switch(s.item.type){case Q.MAGIC:Zn(e,n,o,s);break;case Q.WEAPON:Zn(e,n,o,s)}})},Zn=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,0,48,48,48,s*o,i*o,o,o)};function xn(e){let n,o,t=e[2](e[0])+"",s,i;return{c(){n=w("p"),o=D("❇️ "),s=D(t),this.h()},l(r){n=H(r,"P",{class:!0});var l=N(n);o=O(l,"❇️ "),s=O(l,t),l.forEach(f),this.h()},h(){R(n,"class",i=hn(e[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")},m(r,l){I(r,n,l),p(n,o),p(n,s)},p(r,l){l&1&&t!==(t=r[2](r[0])+"")&&Y(s,t),l&1&&i!==(i=hn(r[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")&&R(n,"class",i)},d(r){r&&f(n)}}}function Zs(e){let n=e[1],o,t=xn(e);return{c(){t.c(),o=de()},l(s){t.l(s),o=de()},m(s,i){t.m(s,i),I(s,o,i)},p(s,[i]){i&2&&me(n,n=s[1])?(t.d(1),t=xn(s),t.c(),t.m(o.parentNode,o)):t.p(s,i)},i:ye,o:ye,d(s){s&&f(o),t.d(s)}}}function xs(e,n,o){let t;Qe(e,We,c=>o(4,t=c));let{condition:s}=n,{state:i}=n,r=!1;const l=c=>{switch(c.type){case le.KILL_ALL:return t("content.winConditions.killAll");case le.KILL_ALL_OF_TYPE:return t("content.winConditions.killAll",{type:c.targetMonsterType});case le.KILL_AT_LEAST:return t("content.winConditions.killAtLeast",{minKills:c.killMinCount})+` (${i.dungeon.killCount}/${c.killMinCount})`;case le.OPEN_DOOR:return t("content.winConditions.openDoor");case le.REACH_CELL:return t("content.winConditions.reachCell")}};sn(()=>{a(),setInterval(a,100)});const a=()=>{i.reRender&&o(1,r=!r)};return e.$$set=c=>{"condition"in c&&o(0,s=c.condition),"state"in c&&o(3,i=c.state)},[s,r,l,i]}class js extends we{constructor(n){super(),He(this,n,xs,Zs,me,{condition:0,state:3})}}function jn(e){let n,o,t,s,i,r,l=e[0].number+"",a,c,u=e[2](e[0].name)+"",g,E,_,C;function M(b,T){return b[1]?zs:$s}let A=M(e),y=A(e),m=e[1]&&$n(e),d=e[1]&&zn(e);return{c(){n=w("div"),o=w("button"),y.c(),t=x(),m&&m.c(),s=x(),i=w("div"),r=w("span"),a=D(l),c=D(". "),g=D(u),E=x(),d&&d.c(),this.h()},l(b){n=H(b,"DIV",{});var T=N(n);o=H(T,"BUTTON",{class:!0});var B=N(o);y.l(B),B.forEach(f),t=j(T),m&&m.l(T),T.forEach(f),s=j(b),i=H(b,"DIV",{});var oe=N(i);r=H(oe,"SPAN",{class:!0});var re=N(r);a=O(re,l),c=O(re,". "),g=O(re,u),re.forEach(f),E=j(oe),d&&d.l(oe),oe.forEach(f),this.h()},h(){R(o,"class","hideEventButton svelte-4rf9ww"),R(r,"class","svelte-4rf9ww")},m(b,T){I(b,n,T),p(n,o),y.m(o,null),p(n,t),m&&m.m(n,null),I(b,s,T),I(b,i,T),p(i,r),p(r,a),p(r,c),p(r,g),p(i,E),d&&d.m(i,null),_||(C=Ie(o,"click",e[3]),_=!0)},p(b,T){A===(A=M(b))&&y?y.p(b,T):(y.d(1),y=A(b),y&&(y.c(),y.m(o,null))),b[1]?m?m.p(b,T):(m=$n(b),m.c(),m.m(n,null)):m&&(m.d(1),m=null),T&1&&l!==(l=b[0].number+"")&&Y(a,l),T&5&&u!==(u=b[2](b[0].name)+"")&&Y(g,u),b[1]?d?d.p(b,T):(d=zn(b),d.c(),d.m(i,null)):d&&(d.d(1),d=null)},d(b){b&&(f(n),f(s),f(i)),y.d(),m&&m.d(),d&&d.d(),_=!1,C()}}}function $s(e){let n=e[2]("content.winConditions.buttonOpen")+"",o;return{c(){o=D(n)},l(t){o=O(t,n)},m(t,s){I(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonOpen")+"")&&Y(o,n)},d(t){t&&f(o)}}}function zs(e){let n=e[2]("content.winConditions.buttonClose")+"",o;return{c(){o=D(n)},l(t){o=O(t,n)},m(t,s){I(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonClose")+"")&&Y(o,n)},d(t){t&&f(o)}}}function $n(e){let n,o=e[2]("content.event.current")+"",t;return{c(){n=w("p"),t=D(o),this.h()},l(s){n=H(s,"P",{class:!0});var i=N(n);t=O(i,o),i.forEach(f),this.h()},h(){R(n,"class","svelte-4rf9ww")},m(s,i){I(s,n,i),p(n,t)},p(s,i){i&4&&o!==(o=s[2]("content.event.current")+"")&&Y(t,o)},d(s){s&&f(n)}}}function zn(e){let n,o=e[2](e[0].description)+"",t;return{c(){n=w("p"),t=D(o),this.h()},l(s){n=H(s,"P",{class:!0});var i=N(n);t=O(i,o),i.forEach(f),this.h()},h(){R(n,"class","svelte-4rf9ww")},m(s,i){I(s,n,i),p(n,t)},p(s,i){i&5&&o!==(o=s[2](s[0].description)+"")&&Y(t,o)},d(s){s&&f(n)}}}function ei(e){let n,o,t=e[0]&&jn(e);return{c(){n=w("div"),t&&t.c(),this.h()},l(s){n=H(s,"DIV",{class:!0});var i=N(n);t&&t.l(i),i.forEach(f),this.h()},h(){R(n,"class",o="event "+(e[1]?"eventOpen":"")+" svelte-4rf9ww")},m(s,i){I(s,n,i),t&&t.m(n,null)},p(s,[i]){s[0]?t?t.p(s,i):(t=jn(s),t.c(),t.m(n,null)):t&&(t.d(1),t=null),i&2&&o!==(o="event "+(s[1]?"eventOpen":"")+" svelte-4rf9ww")&&R(n,"class",o)},i:ye,o:ye,d(s){s&&f(n),t&&t.d()}}}function ni(e,n,o){let t;Qe(e,We,l=>o(2,t=l));let{event:s}=n,i=!0;const r=()=>o(1,i=!i);return e.$$set=l=>{"event"in l&&o(0,s=l.event)},[s,i,t,r]}class oi extends we{constructor(n){super(),He(this,n,ni,ei,me,{event:0})}}function eo(e,n,o){const t=e.slice();return t[15]=n[o],t[16]=n,t[17]=o,t}function ti(e){let n=e[2]("content.winConditions.buttonOpen")+"",o;return{c(){o=D(n)},l(t){o=O(t,n)},m(t,s){I(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonOpen")+"")&&Y(o,n)},d(t){t&&f(o)}}}function si(e){let n=e[2]("content.winConditions.buttonClose")+"",o;return{c(){o=D(n)},l(t){o=O(t,n)},m(t,s){I(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonClose")+"")&&Y(o,n)},d(t){t&&f(o)}}}function no(e){let n,o,t=Be(e[0].dungeon.winConditions.sort(io)),s=[];for(let r=0;r<t.length;r+=1)s[r]=oo(eo(e,t,r));const i=r=>$(s[r],1,1,()=>{s[r]=null});return{c(){n=w("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){n=H(r,"DIV",{class:!0});var l=N(n);for(let a=0;a<s.length;a+=1)s[a].l(l);l.forEach(f),this.h()},h(){R(n,"class","conditionsDiv svelte-qsh3al")},m(r,l){I(r,n,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,null);o=!0},p(r,l){if(l&1){t=Be(r[0].dungeon.winConditions.sort(io));let a;for(a=0;a<t.length;a+=1){const c=eo(r,t,a);s[a]?(s[a].p(c,l),q(s[a],1)):(s[a]=oo(c),s[a].c(),q(s[a],1),s[a].m(n,null))}for(Ne(),a=t.length;a<s.length;a+=1)i(a);Pe()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)q(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)$(s[l]);o=!1},d(r){r&&f(n),rn(s,r)}}}function oo(e){let n,o,t,s;function i(a){e[8](a,e[15],e[16],e[17])}function r(a){e[9](a)}let l={};return e[15]!==void 0&&(l.condition=e[15]),e[0]!==void 0&&(l.state=e[0]),n=new js({props:l}),ge.push(()=>_e(n,"condition",i)),ge.push(()=>_e(n,"state",r)),{c(){De(n.$$.fragment)},l(a){Oe(n.$$.fragment,a)},m(a,c){Me(n,a,c),s=!0},p(a,c){e=a;const u={};!o&&c&1&&(o=!0,u.condition=e[15],he(()=>o=!1)),!t&&c&1&&(t=!0,u.state=e[0],he(()=>t=!1)),n.$set(u)},i(a){s||(q(n.$$.fragment,a),s=!0)},o(a){$(n.$$.fragment,a),s=!1},d(a){Re(n,a)}}}function to(e){let n,o,t;return o=new oi({props:{event:e[0].currentEvent}}),{c(){n=w("div"),De(o.$$.fragment)},l(s){n=H(s,"DIV",{});var i=N(n);Oe(o.$$.fragment,i),i.forEach(f)},m(s,i){I(s,n,i),Me(o,n,null),t=!0},p(s,i){const r={};i&1&&(r.event=s[0].currentEvent),o.$set(r)},i(s){t||(q(o.$$.fragment,s),t=!0)},o(s){$(o.$$.fragment,s),t=!1},d(s){s&&f(n),Re(o)}}}function ii(e){let n,o,t,s,i,r,l,a,c,u,g,E;function _(m,d){return m[1]?si:ti}let C=_(e),M=C(e),A=e[1]&&no(e),y=e[0].currentEvent&&to(e);return{c(){n=w("div"),o=w("canvas"),t=x(),s=w("div"),i=w("div"),r=w("button"),M.c(),l=x(),A&&A.c(),c=x(),y&&y.c(),this.h()},l(m){n=H(m,"DIV",{style:!0,class:!0,id:!0});var d=N(n);o=H(d,"CANVAS",{width:!0,height:!0,id:!0}),N(o).forEach(f),t=j(d),s=H(d,"DIV",{class:!0});var b=N(s);i=H(b,"DIV",{class:!0});var T=N(i);r=H(T,"BUTTON",{class:!0});var B=N(r);M.l(B),B.forEach(f),T.forEach(f),l=j(b),A&&A.l(b),b.forEach(f),c=j(d),y&&y.l(d),d.forEach(f),this.h()},h(){R(o,"width",e[3]*40),R(o,"height",e[3]*30),R(o,"id","gameBoard"),R(r,"class","hideConditionsButton svelte-qsh3al"),R(i,"class","buttonDiv svelte-qsh3al"),R(s,"class",a="winConditions "+(e[1]?"":"conditionsHidden")+" svelte-qsh3al"),R(n,"style",e[5]()),R(n,"class","dungeon svelte-qsh3al"),R(n,"id","gameBoardContainer")},m(m,d){I(m,n,d),p(n,o),p(n,t),p(n,s),p(s,i),p(i,r),M.m(r,null),p(s,l),A&&A.m(s,null),p(n,c),y&&y.m(n,null),u=!0,g||(E=[Ie(o,"click",e[4]),Ie(r,"click",e[7])],g=!0)},p(m,[d]){C===(C=_(m))&&M?M.p(m,d):(M.d(1),M=C(m),M&&(M.c(),M.m(r,null))),m[1]?A?(A.p(m,d),d&2&&q(A,1)):(A=no(m),A.c(),q(A,1),A.m(s,null)):A&&(Ne(),$(A,1,1,()=>{A=null}),Pe()),(!u||d&2&&a!==(a="winConditions "+(m[1]?"":"conditionsHidden")+" svelte-qsh3al"))&&R(s,"class",a),m[0].currentEvent?y?(y.p(m,d),d&1&&q(y,1)):(y=to(m),y.c(),q(y,1),y.m(n,null)):y&&(Ne(),$(y,1,1,()=>{y=null}),Pe())},i(m){u||(q(A),q(y),u=!0)},o(m){$(A),$(y),u=!1},d(m){m&&f(n),M.d(),A&&A.d(),y&&y.d(),g=!1,Ln(E)}}}const so=10,io=(e,n)=>e.fulfilled===n.fulfilled?0:e.fulfilled?1:-1;function ri(e,n,o){var m;let t;Qe(e,We,d=>o(2,t=d));let{state:s}=n,{debugMode:i}=n,r=!0,l,a;const c=(s==null?void 0:s.settings.cellSize)??48;let u=0,g=0;a=window.innerHeight,l=((m=document.getElementById("footer"))==null?void 0:m.offsetHeight)??0,sn(()=>{const d=new Image;d.src=ys;const b=new Image;b.src=As,setInterval(()=>E(d,b),10)});const E=(d,b)=>{if(!s||!document)return;const T=document.getElementById("gameBoard"),B=T.getContext("2d");s.reRender&&(g++,u++,B.clearRect(0,0,T.width,T.height),B.fillStyle="black",B.fillRect(0,0,T.width,T.height),Gs(B,d,c,s,i),Us(B,d,c,s,i),Qs(B,d,c,s),Bs(B,d,c,s,i),Rs(B,b,c,s,i),bs(B,b,c,s,i),i&&(B.fillStyle="white",B.font="8px Arial",B.fillText(`Re-renders: ${u}`,2,10),B.fillText(`FPS: ${g/(so/1e3)}`,2,20)),setTimeout(()=>{o(0,s.reRender=!1,s),g=0},so))},_=d=>{Jt(d,c,s)},C=()=>`max-height: ${a-l-20}px; max-width: ${c*40}`,M=()=>o(1,r=!r);function A(d,b,T,B){T[B]=d,o(0,s)}function y(d){s=d,o(0,s)}return e.$$set=d=>{"state"in d&&o(0,s=d.state),"debugMode"in d&&o(6,i=d.debugMode)},[s,r,t,c,_,C,i,M,A,y]}class li extends we{constructor(n){super(),He(this,n,ri,ii,me,{state:0,debugMode:6})}}function ai(e){let n,o=e[2]("content.inventory.uses")+"",t;return{c(){n=w("button"),t=D(o),this.h()},l(s){n=H(s,"BUTTON",{class:!0});var i=N(n);t=O(i,o),i.forEach(f),this.h()},h(){n.disabled=!0,R(n,"class","svelte-gca2x5")},m(s,i){I(s,n,i),p(n,t)},p(s,i){i&4&&o!==(o=s[2]("content.inventory.uses")+"")&&Y(t,o)},d(s){s&&f(n)}}}function ci(e){let n,o=e[2]("content.inventory.use")+"",t,s,i;return{c(){n=w("button"),t=D(o),this.h()},l(r){n=H(r,"BUTTON",{class:!0});var l=N(n);t=O(l,o),l.forEach(f),this.h()},h(){R(n,"class","svelte-gca2x5")},m(r,l){I(r,n,l),p(n,t),s||(i=Ie(n,"click",e[3]),s=!0)},p(r,l){l&4&&o!==(o=r[2]("content.inventory.use")+"")&&Y(t,o)},d(r){r&&f(n),s=!1,i()}}}function ui(e){var y;let n,o="",t,s,i,r=e[2](e[0].name)+"",l,a,c,u=e[2]((y=e[0].properties)==null?void 0:y[Vn])+"",g,E,_;function C(m,d){var b,T,B;if((b=m[0].properties)!=null&&b[yn]&&!((T=m[0].properties)!=null&&T[Ke]))return ci;if((B=m[0].properties)!=null&&B[yn])return ai}let M=C(e),A=M&&M(e);return{c(){n=w("div"),n.innerHTML=o,t=x(),s=w("div"),i=w("b"),l=D(r),a=x(),c=w("span"),g=D(u),E=x(),_=w("div"),A&&A.c(),this.h()},l(m){n=H(m,"DIV",{class:!0,"data-svelte-h":!0}),Do(n)!=="svelte-pn8o3r"&&(n.innerHTML=o),t=j(m),s=H(m,"DIV",{class:!0});var d=N(s);i=H(d,"B",{class:!0});var b=N(i);l=O(b,r),b.forEach(f),a=j(d),c=H(d,"SPAN",{class:!0});var T=N(c);g=O(T,u),T.forEach(f),d.forEach(f),E=j(m),_=H(m,"DIV",{class:!0});var B=N(_);A&&A.l(B),B.forEach(f),this.h()},h(){R(n,"class","item item-icon svelte-gca2x5"),R(i,"class","svelte-gca2x5"),R(c,"class","svelte-gca2x5"),R(s,"class","item item-description bottom-border svelte-gca2x5"),R(_,"class","item item-action svelte-gca2x5")},m(m,d){I(m,n,d),I(m,t,d),I(m,s,d),p(s,i),p(i,l),p(s,a),p(s,c),p(c,g),I(m,E,d),I(m,_,d),A&&A.m(_,null)},p(m,[d]){var b;d&5&&r!==(r=m[2](m[0].name)+"")&&Y(l,r),d&5&&u!==(u=m[2]((b=m[0].properties)==null?void 0:b[Vn])+"")&&Y(g,u),M===(M=C(m))&&A?A.p(m,d):(A&&A.d(1),A=M&&M(m),A&&(A.c(),A.m(_,null)))},i:ye,o:ye,d(m){m&&(f(n),f(t),f(s),f(E),f(_)),A&&A.d()}}}function fi(e,n,o){let t;Qe(e,We,l=>o(2,t=l));let{item:s}=n,{state:i}=n;const r=()=>Gt(i,s);return e.$$set=l=>{"item"in l&&o(0,s=l.item),"state"in l&&o(1,i=l.state)},[s,i,t,r]}class di extends we{constructor(n){super(),He(this,n,fi,ui,me,{item:0,state:1})}}function ro(e,n,o){const t=e.slice();return t[6]=n[o],t[7]=n,t[8]=o,t}function lo(e){let n,o,t;function s(r){e[4](r,e[6],e[7],e[8])}let i={state:e[1]};return e[6]!==void 0&&(i.item=e[6]),n=new di({props:i}),ge.push(()=>_e(n,"item",s)),{c(){De(n.$$.fragment)},l(r){Oe(n.$$.fragment,r)},m(r,l){Me(n,r,l),t=!0},p(r,l){e=r;const a={};l&2&&(a.state=e[1]),!o&&l&1&&(o=!0,a.item=e[6],he(()=>o=!1)),n.$set(a)},i(r){t||(q(n.$$.fragment,r),t=!0)},o(r){$(n.$$.fragment,r),t=!1},d(r){Re(n,r)}}}function ao(e){let n,o,t=Be(e[0]),s=[];for(let r=0;r<t.length;r+=1)s[r]=lo(ro(e,t,r));const i=r=>$(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);n=de()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);I(r,n,l),o=!0},p(r,l){if(l&3){t=Be(r[0]);let a;for(a=0;a<t.length;a+=1){const c=ro(r,t,a);s[a]?(s[a].p(c,l),q(s[a],1)):(s[a]=lo(c),s[a].c(),q(s[a],1),s[a].m(n.parentNode,n))}for(Ne(),a=t.length;a<s.length;a+=1)i(a);Pe()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)q(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)$(s[l]);o=!1},d(r){r&&f(n),rn(s,r)}}}function mi(e){var c;let n,o=e[3]("content.inventory.label",{hero:e[3]((c=e[1].currentActor)==null?void 0:c.name)})+"",t,s,i,r=e[2],l,a=ao(e);return{c(){n=w("h4"),t=D(o),s=x(),i=w("div"),a.c(),this.h()},l(u){n=H(u,"H4",{class:!0});var g=N(n);t=O(g,o),g.forEach(f),s=j(u),i=H(u,"DIV",{class:!0});var E=N(i);a.l(E),E.forEach(f),this.h()},h(){R(n,"class","svelte-1sdwrze"),R(i,"class","inventory svelte-1sdwrze")},m(u,g){I(u,n,g),p(n,t),I(u,s,g),I(u,i,g),a.m(i,null),l=!0},p(u,[g]){var E;(!l||g&10)&&o!==(o=u[3]("content.inventory.label",{hero:u[3]((E=u[1].currentActor)==null?void 0:E.name)})+"")&&Y(t,o),g&4&&me(r,r=u[2])?(Ne(),$(a,1,1,ye),Pe(),a=ao(u),a.c(),q(a,1),a.m(i,null)):a.p(u,g)},i(u){l||(q(a),l=!0)},o(u){$(a),l=!1},d(u){u&&(f(n),f(s),f(i)),a.d(u)}}}function pi(e,n,o){let t;Qe(e,We,c=>o(3,t=c));let{inventory:s}=n,{state:i}=n,r=!1;sn(()=>{l(),setInterval(l,100)});const l=()=>{o(2,r=!r)};function a(c,u,g,E){g[E]=c,o(0,s)}return e.$$set=c=>{"inventory"in c&&o(0,s=c.inventory),"state"in c&&o(1,i=c.state)},[s,i,r,t,a]}class gi extends we{constructor(n){super(),He(this,n,pi,mi,me,{inventory:0,state:1})}}function co(e){let n;return{c(){n=D("*")},l(o){n=O(o,"*")},m(o,t){I(o,n,t)},d(o){o&&f(n)}}}function hi(e){let n;return{c(){n=D("☑")},l(o){n=O(o,"☑")},m(o,t){I(o,n,t)},d(o){o&&f(n)}}}function _i(e){let n;return{c(){n=D("⛶")},l(o){n=O(o,"⛶")},m(o,t){I(o,n,t)},d(o){o&&f(n)}}}function uo(e){let n,o,t,s,i;function r(a){e[8](a)}let l={state:e[1]};return e[0].inventory!==void 0&&(l.inventory=e[0].inventory),o=new gi({props:l}),ge.push(()=>_e(o,"inventory",r)),{c(){n=w("div"),De(o.$$.fragment),this.h()},l(a){n=H(a,"DIV",{class:!0,id:!0,style:!0});var c=N(n);Oe(o.$$.fragment,c),c.forEach(f),this.h()},h(){R(n,"class","hero-inventory svelte-11gs3s7"),R(n,"id",s=e[0].name+"s-inventory"),on(n,"display",e[2])},m(a,c){I(a,n,c),Me(o,n,null),i=!0},p(a,c){const u={};c&2&&(u.state=a[1]),!t&&c&1&&(t=!0,u.inventory=a[0].inventory,he(()=>t=!1)),o.$set(u),(!i||c&1&&s!==(s=a[0].name+"s-inventory"))&&R(n,"id",s),(!i||c&4)&&on(n,"display",a[2])},i(a){i||(q(o.$$.fragment,a),i=!0)},o(a){$(o.$$.fragment,a),i=!1},d(a){a&&f(n),Re(o)}}}function fo(e){let n,o=e[3]("content.hero.actions")+"",t,s,i=e[0].actions+"",r,l,a,c=e[3]("content.hero.moves")+"",u,g,E=e[0].movement+"",_,C,M,A=e[3]("content.hero.equipment")+"",y,m,d,b,T,B,oe=e[3](e[0].weapon.name)+"",re,P,z=e[0].weapon.dice+"",ce,ue,pe,te,W,Te,ne,Ve;function Ae(V,S){return V[0].armour?yi:vi}let ee=Ae(e),k=ee(e);function G(V,S){return V[0].shield?bi:Ai}let U=G(e),K=U(e);return{c(){n=w("span"),t=D(o),s=D(": "),r=D(i),l=x(),a=w("span"),u=D(c),g=D(": "),_=D(E),C=x(),M=w("span"),y=D(A),m=D(":"),d=x(),b=w("div"),T=w("span"),B=D("🗡️ "),re=D(oe),P=D(" ("),ce=D(z),ue=D(")"),pe=x(),te=w("span"),W=D(`🧱
        `),k.c(),Te=x(),ne=w("span"),Ve=D(`🛡️
        `),K.c(),this.h()},l(V){n=H(V,"SPAN",{class:!0});var S=N(n);t=O(S,o),s=O(S,": "),r=O(S,i),S.forEach(f),l=j(V),a=H(V,"SPAN",{class:!0});var Ge=N(a);u=O(Ge,c),g=O(Ge,": "),_=O(Ge,E),Ge.forEach(f),C=j(V),M=H(V,"SPAN",{class:!0});var xe=N(M);y=O(xe,A),m=O(xe,":"),xe.forEach(f),d=j(V),b=H(V,"DIV",{class:!0});var Ue=N(b);T=H(Ue,"SPAN",{class:!0});var Le=N(T);B=O(Le,"🗡️ "),re=O(Le,oe),P=O(Le," ("),ce=O(Le,z),ue=O(Le,")"),Le.forEach(f),pe=j(Ue),te=H(Ue,"SPAN",{class:!0});var Ye=N(te);W=O(Ye,`🧱
        `),k.l(Ye),Ye.forEach(f),Te=j(Ue),ne=H(Ue,"SPAN",{class:!0});var En=N(ne);Ve=O(En,`🛡️
        `),K.l(En),En.forEach(f),Ue.forEach(f),this.h()},h(){R(n,"class","svelte-11gs3s7"),R(a,"class","svelte-11gs3s7"),R(M,"class","svelte-11gs3s7"),R(T,"class","svelte-11gs3s7"),R(te,"class","svelte-11gs3s7"),R(ne,"class","svelte-11gs3s7"),R(b,"class","equipment svelte-11gs3s7")},m(V,S){I(V,n,S),p(n,t),p(n,s),p(n,r),I(V,l,S),I(V,a,S),p(a,u),p(a,g),p(a,_),I(V,C,S),I(V,M,S),p(M,y),p(M,m),I(V,d,S),I(V,b,S),p(b,T),p(T,B),p(T,re),p(T,P),p(T,ce),p(T,ue),p(b,pe),p(b,te),p(te,W),k.m(te,null),p(b,Te),p(b,ne),p(ne,Ve),K.m(ne,null)},p(V,S){S&8&&o!==(o=V[3]("content.hero.actions")+"")&&Y(t,o),S&1&&i!==(i=V[0].actions+"")&&Y(r,i),S&8&&c!==(c=V[3]("content.hero.moves")+"")&&Y(u,c),S&1&&E!==(E=V[0].movement+"")&&Y(_,E),S&8&&A!==(A=V[3]("content.hero.equipment")+"")&&Y(y,A),S&9&&oe!==(oe=V[3](V[0].weapon.name)+"")&&Y(re,oe),S&1&&z!==(z=V[0].weapon.dice+"")&&Y(ce,z),ee===(ee=Ae(V))&&k?k.p(V,S):(k.d(1),k=ee(V),k&&(k.c(),k.m(te,null))),U===(U=G(V))&&K?K.p(V,S):(K.d(1),K=U(V),K&&(K.c(),K.m(ne,null)))},d(V){V&&(f(n),f(l),f(a),f(C),f(M),f(d),f(b)),k.d(),K.d()}}}function vi(e){let n=e[3]("content.hero.none")+"",o,t;return{c(){o=D(n),t=D(" (0)")},l(s){o=O(s,n),t=O(s," (0)")},m(s,i){I(s,o,i),I(s,t,i)},p(s,i){i&8&&n!==(n=s[3]("content.hero.none")+"")&&Y(o,n)},d(s){s&&(f(o),f(t))}}}function yi(e){let n=e[3](e[0].armour.name)+"",o,t,s=e[0].armour.defense+"",i,r;return{c(){o=D(n),t=D(" ("),i=D(s),r=D(")")},l(l){o=O(l,n),t=O(l," ("),i=O(l,s),r=O(l,")")},m(l,a){I(l,o,a),I(l,t,a),I(l,i,a),I(l,r,a)},p(l,a){a&9&&n!==(n=l[3](l[0].armour.name)+"")&&Y(o,n),a&1&&s!==(s=l[0].armour.defense+"")&&Y(i,s)},d(l){l&&(f(o),f(t),f(i),f(r))}}}function Ai(e){let n=e[3]("content.hero.none")+"",o,t;return{c(){o=D(n),t=D(" (0)")},l(s){o=O(s,n),t=O(s," (0)")},m(s,i){I(s,o,i),I(s,t,i)},p(s,i){i&8&&n!==(n=s[3]("content.hero.none")+"")&&Y(o,n)},d(s){s&&(f(o),f(t))}}}function bi(e){let n=e[3](e[0].shield.name)+"",o,t,s=e[0].shield.dice+"",i,r;return{c(){o=D(n),t=D(" ("),i=D(s),r=D(")")},l(l){o=O(l,n),t=O(l," ("),i=O(l,s),r=O(l,")")},m(l,a){I(l,o,a),I(l,t,a),I(l,i,a),I(l,r,a)},p(l,a){a&9&&n!==(n=l[3](l[0].shield.name)+"")&&Y(o,n),a&1&&s!==(s=l[0].shield.dice+"")&&Y(i,s)},d(l){l&&(f(o),f(t),f(i),f(r))}}}function mo(e){let n,o,t,s=e[3](e[0].name)+"",i,r,l=e[3]("content.level."+e[0].level)+"",a,c,u=e[0].experience+"",g,E,_,C,M,A,y,m="🎒",d,b,T,B,oe,re=e[3]("content.hero.hp")+"",P,z,ce=e[0].health+"",ue,pe,te,W,Te,ne=e[1].targetActor===e[0]&&co();function Ve(U,K){return U[1].targetActor!==U[0]?_i:hi}let Ae=Ve(e),ee=Ae(e),k=e[1].currentActor===e[0]&&uo(e),G=e[1].currentActor===e[0]&&fo(e);return{c(){n=w("div"),o=w("div"),t=w("b"),ne&&ne.c(),i=D(s),r=D(` -
    `),a=D(l),c=D(" ("),g=D(u),E=D(")"),_=x(),C=w("div"),M=w("button"),ee.c(),A=x(),y=w("button"),y.textContent=m,d=x(),b=w("div"),k&&k.c(),T=x(),B=w("div"),oe=w("span"),P=D(re),z=D(": "),ue=D(ce),pe=x(),G&&G.c(),this.h()},l(U){n=H(U,"DIV",{class:!0,style:!0});var K=N(n);o=H(K,"DIV",{class:!0});var V=N(o);t=H(V,"B",{class:!0});var S=N(t);ne&&ne.l(S),i=O(S,s),r=O(S,` -
    `),a=O(S,l),c=O(S," ("),g=O(S,u),E=O(S,")"),S.forEach(f),V.forEach(f),_=j(K),C=H(K,"DIV",{});var Ge=N(C);M=H(Ge,"BUTTON",{title:!0});var xe=N(M);ee.l(xe),xe.forEach(f),A=j(Ge),y=H(Ge,"BUTTON",{title:!0,"data-svelte-h":!0}),Do(y)!=="svelte-qrm7uk"&&(y.textContent=m),Ge.forEach(f),d=j(K),b=H(K,"DIV",{class:!0});var Ue=N(b);k&&k.l(Ue),Ue.forEach(f),T=j(K),B=H(K,"DIV",{});var Le=N(B);oe=H(Le,"SPAN",{class:!0});var Ye=N(oe);P=O(Ye,re),z=O(Ye,": "),ue=O(Ye,ce),Ye.forEach(f),pe=j(Le),G&&G.l(Le),Le.forEach(f),K.forEach(f),this.h()},h(){R(t,"class","svelte-11gs3s7"),R(o,"class","hero-title svelte-11gs3s7"),R(M,"title","select target hero"),R(y,"title","Open inventory"),R(b,"class","hero-information svelte-11gs3s7"),R(oe,"class","svelte-11gs3s7"),R(n,"class","hero-card svelte-11gs3s7"),on(n,"background-color",e[0].colour)},m(U,K){I(U,n,K),p(n,o),p(o,t),ne&&ne.m(t,null),p(t,i),p(t,r),p(t,a),p(t,c),p(t,g),p(t,E),p(n,_),p(n,C),p(C,M),ee.m(M,null),p(C,A),p(C,y),p(n,d),p(n,b),k&&k.m(b,null),p(n,T),p(n,B),p(B,oe),p(oe,P),p(oe,z),p(oe,ue),p(B,pe),G&&G.m(B,null),te=!0,W||(Te=[Ie(M,"click",e[6]),Ie(y,"click",e[7])],W=!0)},p(U,K){U[1].targetActor===U[0]?ne||(ne=co(),ne.c(),ne.m(t,i)):ne&&(ne.d(1),ne=null),(!te||K&9)&&s!==(s=U[3](U[0].name)+"")&&Y(i,s),(!te||K&9)&&l!==(l=U[3]("content.level."+U[0].level)+"")&&Y(a,l),(!te||K&1)&&u!==(u=U[0].experience+"")&&Y(g,u),Ae!==(Ae=Ve(U))&&(ee.d(1),ee=Ae(U),ee&&(ee.c(),ee.m(M,null))),U[1].currentActor===U[0]?k?(k.p(U,K),K&3&&q(k,1)):(k=uo(U),k.c(),q(k,1),k.m(b,null)):k&&(Ne(),$(k,1,1,()=>{k=null}),Pe()),(!te||K&8)&&re!==(re=U[3]("content.hero.hp")+"")&&Y(P,re),(!te||K&1)&&ce!==(ce=U[0].health+"")&&Y(ue,ce),U[1].currentActor===U[0]?G?G.p(U,K):(G=fo(U),G.c(),G.m(B,null)):G&&(G.d(1),G=null),(!te||K&1)&&on(n,"background-color",U[0].colour)},i(U){te||(q(k),te=!0)},o(U){$(k),te=!1},d(U){U&&f(n),ne&&ne.d(),ee.d(),k&&k.d(),G&&G.d(),W=!1,Ln(Te)}}}function ki(e){let n=e[1].targetActor,o,t,s=mo(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),I(i,o,r),t=!0},p(i,[r]){r&2&&me(n,n=i[1].targetActor)?(Ne(),$(s,1,1,ye),Pe(),s=mo(i),s.c(),q(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(q(s),t=!0)},o(i){$(s),t=!1},d(i){i&&f(o),s.d(i)}}}function Ei(e,n,o){let t;Qe(e,We,_=>o(3,t=_));let{hero:s}=n,{state:i}=n,r="none";const l=_=>{i.targetActor&&_===i.targetActor?o(1,i.targetActor=void 0,i):o(1,i.targetActor=_,i)},a=_=>{const C=document.getElementById(_.name+"s-inventory");C&&(_.isInventoryOpen=!_.isInventoryOpen,c(),C.style.display=r)},c=()=>{s.isInventoryOpen?o(2,r="inline-block"):o(2,r="none")};c();const u=()=>l(s),g=()=>a(s);function E(_){e.$$.not_equal(s.inventory,_)&&(s.inventory=_,o(0,s))}return e.$$set=_=>{"hero"in _&&o(0,s=_.hero),"state"in _&&o(1,i=_.state)},[s,i,r,t,l,a,u,g,E]}class rt extends we{constructor(n){super(),He(this,n,Ei,ki,me,{hero:0,state:1})}}function po(e,n,o){const t=e.slice();return t[3]=n[o],t[5]=o,t}function Ii(e){let n,o,t,s;return o=new rt({props:{hero:e[3],state:e[0]}}),{c(){n=w("div"),De(o.$$.fragment),t=x(),this.h()},l(i){n=H(i,"DIV",{class:!0});var r=N(n);Oe(o.$$.fragment,r),t=j(r),r.forEach(f),this.h()},h(){R(n,"class","not-current-actor svelte-gyascg")},m(i,r){I(i,n,r),Me(o,n,null),p(n,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),o.$set(l)},i(i){s||(q(o.$$.fragment,i),s=!0)},o(i){$(o.$$.fragment,i),s=!1},d(i){i&&f(n),Re(o)}}}function Di(e){let n,o,t,s;return o=new rt({props:{hero:e[3],state:e[0]}}),{c(){n=w("div"),De(o.$$.fragment),t=x(),this.h()},l(i){n=H(i,"DIV",{class:!0});var r=N(n);Oe(o.$$.fragment,r),t=j(r),r.forEach(f),this.h()},h(){R(n,"class","is-current-actor svelte-gyascg")},m(i,r){I(i,n,r),Me(o,n,null),p(n,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),o.$set(l)},i(i){s||(q(o.$$.fragment,i),s=!0)},o(i){$(o.$$.fragment,i),s=!1},d(i){i&&f(n),Re(o)}}}function go(e){let n,o,t,s;const i=[Di,Ii],r=[];function l(a,c){return a[3]===a[0].currentActor?0:1}return n=l(e),o=r[n]=i[n](e),{c(){o.c(),t=de()},l(a){o.l(a),t=de()},m(a,c){r[n].m(a,c),I(a,t,c),s=!0},p(a,c){let u=n;n=l(a),n===u?r[n].p(a,c):(Ne(),$(r[u],1,1,()=>{r[u]=null}),Pe(),o=r[n],o?o.p(a,c):(o=r[n]=i[n](a),o.c()),q(o,1),o.m(t.parentNode,t))},i(a){s||(q(o),s=!0)},o(a){$(o),s=!1},d(a){a&&f(t),r[n].d(a)}}}function ho(e){let n=e[1],o,t,s=go(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),I(i,o,r),t=!0},p(i,r){r&2&&me(n,n=i[1])?(Ne(),$(s,1,1,ye),Pe(),s=go(i),s.c(),q(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(q(s),t=!0)},o(i){$(s),t=!1},d(i){i&&f(o),s.d(i)}}}function Oi(e){let n,o,t=Be(J(e[0])),s=[];for(let r=0;r<t.length;r+=1)s[r]=ho(po(e,t,r));const i=r=>$(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);n=de()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);I(r,n,l),o=!0},p(r,[l]){if(l&3){t=Be(J(r[0]));let a;for(a=0;a<t.length;a+=1){const c=po(r,t,a);s[a]?(s[a].p(c,l),q(s[a],1)):(s[a]=ho(c),s[a].c(),q(s[a],1),s[a].m(n.parentNode,n))}for(Ne(),a=t.length;a<s.length;a+=1)i(a);Pe()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)q(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)$(s[l]);o=!1},d(r){r&&f(n),rn(s,r)}}}function Mi(e,n,o){let{state:t}=n,s=!1;sn(()=>{i(),setInterval(i,100)});const i=()=>{t.reRender&&o(1,s=!s)};return e.$$set=r=>{"state"in r&&o(0,t=r.state)},[t,s]}class Ri extends we{constructor(n){super(),He(this,n,Mi,Oi,me,{state:0})}}function _o(e,n,o){const t=e.slice();return t[5]=n[o],t[7]=o,t}function Ci(e){let n,o,t=e[2](e[5])+"",s;return{c(){n=w("p"),o=D(">"),s=D(t),this.h()},l(i){n=H(i,"P",{class:!0});var r=N(n);o=O(r,">"),s=O(r,t),r.forEach(f),this.h()},h(){R(n,"class","svelte-grgnnk")},m(i,r){I(i,n,r),p(n,o),p(n,s)},p(i,r){r&1&&t!==(t=i[2](i[5])+"")&&Y(s,t)},d(i){i&&f(n)}}}function vo(e){let n,o=e[7]<25&&Ci(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),I(t,n,s)},p(t,s){t[7]<25&&o.p(t,s)},d(t){t&&f(n),o&&o.d(t)}}}function yo(e){let n,o=Be(e[0].actionLog),t=[];for(let s=0;s<o.length;s+=1)t[s]=vo(_o(e,o,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=de()},l(s){for(let i=0;i<t.length;i+=1)t[i].l(s);n=de()},m(s,i){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(s,i);I(s,n,i)},p(s,i){if(i&5){o=Be(s[0].actionLog);let r;for(r=0;r<o.length;r+=1){const l=_o(s,o,r);t[r]?t[r].p(l,i):(t[r]=vo(l),t[r].c(),t[r].m(n.parentNode,n))}for(;r<t.length;r+=1)t[r].d(1);t.length=o.length}},d(s){s&&f(n),rn(t,s)}}}function Ti(e){let n,o=e[1],t=yo(e);return{c(){n=w("div"),t.c(),this.h()},l(s){n=H(s,"DIV",{class:!0});var i=N(n);t.l(i),i.forEach(f),this.h()},h(){R(n,"class","log svelte-grgnnk")},m(s,i){I(s,n,i),t.m(n,null)},p(s,[i]){i&2&&me(o,o=s[1])?(t.d(1),t=yo(s),t.c(),t.m(n,null)):t.p(s,i)},i:ye,o:ye,d(s){s&&f(n),t.d(s)}}}function Li(e,n,o){let t;Qe(e,We,a=>o(3,t=a));let{state:s}=n,i=!1;sn(()=>{r(),setInterval(r,500)});const r=()=>{s.reRender&&o(1,i=!i)},l=a=>t(a.key,a.properties);return e.$$set=a=>{"state"in a&&o(0,s=a.state)},[s,i,l]}class wi extends we{constructor(n){super(),He(this,n,Li,Ti,me,{state:0})}}const Hi={name:"campaign.iceDragon.testingGrounds.name",beaten:!0,winConditions:[{type:le.KILL_ALL,fulfilled:!0},{type:le.OPEN_DOOR,targetCell:{x:2,y:10},fulfilled:!1},{type:le.KILL_ALL_OF_TYPE,targetMonsterType:F.ORCH,fulfilled:!1},{type:le.REACH_CELL,targetCell:{x:2,y:10},fulfilled:!1},{type:le.KILL_AT_LEAST,killMinCount:5,fulfilled:!1}],nextDungeon:Zo,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A","D"],layout:{grid:["###########","#CCCCCCCCC#","#CCCCCCCCC#","#CCCCCCCCC#","#######E###","  #####E#  ","  #FFFFE## ","###F###AA# ","#AAAAAAAA#D","#AAAAAAAA#D","#AAAAAAAA#D","##G####### "," #G#       "," #G#       "," ###       "],pillars:[{x:8,y:3},{x:7,y:9}],pits:[{x:6,y:3},{x:6,y:2}],corridors:["G","E","F"],doors:[dt(L.UP,3,8,1),vn(L.LEFT,7,6),ft(L.UP,7,7,1),Z(L.UP,7,4),Xe(L.DOWN,2,10)],monsters:[se(F.ORCH,X.Green,1,1),se(F.ORCH,X.Red,4,9),se(F.TROLL,X.Green,5,1)],secrets:[Ce(ie.TRAP_DOOR,"campaign.iceDragon.testingGrounds.secrets.trapDoor",3,9),Ce(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,10),tn(ie.EQUIPMENT,5,10,_n[2])],notes:[],items:[{item:be[0],position:{x:3,y:10}},{item:be[1],position:{x:4,y:10}},{item:be[6],position:{x:5,y:10}},{item:be[2],position:{x:6,y:10}},{item:be[3],position:{x:7,y:10}},{item:be[4],position:{x:8,y:10}}]},killCount:0};function Ao(e,n,o){const t=e.slice();return t[5]=n[o],t}function bo(e){let n,o=e[5].label+"",t,s,i;return{c(){n=w("button"),t=D(o),this.h()},l(r){n=H(r,"BUTTON",{class:!0});var l=N(n);t=O(l,o),l.forEach(f),this.h()},h(){R(n,"class","menuButton svelte-12a9xod")},m(r,l){I(r,n,l),p(n,t),s||(i=Ie(n,"click",function(){lt(e[5].onClick)&&e[5].onClick.apply(this,arguments)}),s=!0)},p(r,l){e=r,l&4&&o!==(o=e[5].label+"")&&Y(t,o)},d(r){r&&f(n),s=!1,i()}}}function ko(e){let n,o=(e[5].debugModeOnly&&e[1]||!e[5].debugModeOnly)&&bo(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),I(t,n,s)},p(t,s){t[5].debugModeOnly&&t[1]||!t[5].debugModeOnly?o?o.p(t,s):(o=bo(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(t){t&&f(n),o&&o.d(t)}}}function Ni(e){let n,o,t,s,i,r,l,a,c=Be(e[2]),u=[];for(let g=0;g<c.length;g+=1)u[g]=ko(Ao(e,c,g));return{c(){n=w("div"),o=w("span"),t=D(e[0]),s=x();for(let g=0;g<u.length;g+=1)u[g].c();i=x(),r=w("span"),l=D(e[3]),this.h()},l(g){n=H(g,"DIV",{class:!0});var E=N(n);o=H(E,"SPAN",{class:!0});var _=N(o);t=O(_,e[0]),_.forEach(f),s=j(E);for(let M=0;M<u.length;M+=1)u[M].l(E);i=j(E),r=H(E,"SPAN",{class:!0});var C=N(r);l=O(C,e[3]),C.forEach(f),E.forEach(f),this.h()},h(){R(o,"class","header svelte-12a9xod"),R(r,"class","footer svelte-12a9xod"),R(n,"class",a=hn(e[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")},m(g,E){I(g,n,E),p(n,o),p(o,t),p(n,s);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(n,null);p(n,i),p(n,r),p(r,l)},p(g,[E]){if(E&1&&Y(t,g[0]),E&6){c=Be(g[2]);let _;for(_=0;_<c.length;_+=1){const C=Ao(g,c,_);u[_]?u[_].p(C,E):(u[_]=ko(C),u[_].c(),u[_].m(n,i))}for(;_<u.length;_+=1)u[_].d(1);u.length=c.length}E&8&&Y(l,g[3]),E&16&&a!==(a=hn(g[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")&&R(n,"class",a)},i:ye,o:ye,d(g){g&&f(n),rn(u,g)}}}function Pi(e,n,o){let{header:t}=n,{debugMode:s}=n,{buttons:i}=n,{footer:r}=n,{showMenu:l}=n;return e.$$set=a=>{"header"in a&&o(0,t=a.header),"debugMode"in a&&o(1,s=a.debugMode),"buttons"in a&&o(2,i=a.buttons),"footer"in a&&o(3,r=a.footer),"showMenu"in a&&o(4,l=a.showMenu)},[t,s,i,r,l]}class Eo extends we{constructor(n){super(),He(this,n,Pi,Ni,me,{header:0,debugMode:1,buttons:2,footer:3,showMenu:4})}}function Io(e){let n,o=e[7]("content.actions.nextLevel")+"",t,s,i;return{c(){n=w("button"),t=D(o),this.h()},l(r){n=H(r,"BUTTON",{class:!0});var l=N(n);t=O(l,o),l.forEach(f),this.h()},h(){R(n,"class","menuButton svelte-1v33x5s")},m(r,l){I(r,n,l),p(n,t),s||(i=Ie(n,"click",e[18]),s=!0)},p(r,l){l&128&&o!==(o=r[7]("content.actions.nextLevel")+"")&&Y(t,o)},d(r){r&&f(n),s=!1,i()}}}function Bi(e){let n,o,t,s,i,r,l,a,c,u,g,E,_=e[7]("content.menu.menuButton")+"",C,M,A,y,m=e[7]("content.actions.next")+"",d,b,T,B=e[7]("content.actions.action")+"",oe,re,P,z,ce;function ue(k){e[10](k)}function pe(k){e[11](k)}function te(k){e[12](k)}let W={header:e[7]("content.menu.mainMenu.header"),footer:`${e[2].date} - ${e[2].hash}`};e[1]!==void 0&&(W.debugMode=e[1]),e[3]!==void 0&&(W.showMenu=e[3]),e[6]!==void 0&&(W.buttons=e[6]),o=new Eo({props:W}),ge.push(()=>_e(o,"debugMode",ue)),ge.push(()=>_e(o,"showMenu",pe)),ge.push(()=>_e(o,"buttons",te));function Te(k){e[13](k)}function ne(k){e[14](k)}function Ve(k){e[15](k)}let Ae={header:e[7]("content.menu.loadGame.header"),footer:""};e[1]!==void 0&&(Ae.debugMode=e[1]),e[4]!==void 0&&(Ae.showMenu=e[4]),e[5]!==void 0&&(Ae.buttons=e[5]),l=new Eo({props:Ae}),ge.push(()=>_e(l,"debugMode",Te)),ge.push(()=>_e(l,"showMenu",ne)),ge.push(()=>_e(l,"buttons",Ve));let ee=e[0].dungeon.beaten&&Io(e);return{c(){n=w("div"),De(o.$$.fragment),r=x(),De(l.$$.fragment),g=x(),E=w("button"),C=D(_),M=x(),A=w("div"),y=w("button"),d=D(m),b=x(),T=w("button"),oe=D(B),re=x(),ee&&ee.c(),this.h()},l(k){n=H(k,"DIV",{class:!0});var G=N(n);Oe(o.$$.fragment,G),r=j(G),Oe(l.$$.fragment,G),g=j(G),E=H(G,"BUTTON",{class:!0});var U=N(E);C=O(U,_),U.forEach(f),M=j(G),A=H(G,"DIV",{});var K=N(A);y=H(K,"BUTTON",{class:!0});var V=N(y);d=O(V,m),V.forEach(f),b=j(K),T=H(K,"BUTTON",{class:!0,style:!0});var S=N(T);oe=O(S,B),S.forEach(f),K.forEach(f),re=j(G),ee&&ee.l(G),G.forEach(f),this.h()},h(){R(E,"class","menuButton svelte-1v33x5s"),R(y,"class","menuButton twoColButton svelte-1v33x5s"),R(T,"class","menuButton twoColButton svelte-1v33x5s"),on(T,"float","right"),R(n,"class","commands svelte-1v33x5s")},m(k,G){I(k,n,G),Me(o,n,null),p(n,r),Me(l,n,null),p(n,g),p(n,E),p(E,C),p(n,M),p(n,A),p(A,y),p(y,d),p(A,b),p(A,T),p(T,oe),p(n,re),ee&&ee.m(n,null),P=!0,z||(ce=[Ie(window,"keydown",at(e[8])),Ie(E,"click",e[9]),Ie(y,"click",e[16]),Ie(T,"click",e[17])],z=!0)},p(k,[G]){const U={};G&128&&(U.header=k[7]("content.menu.mainMenu.header")),G&4&&(U.footer=`${k[2].date} - ${k[2].hash}`),!t&&G&2&&(t=!0,U.debugMode=k[1],he(()=>t=!1)),!s&&G&8&&(s=!0,U.showMenu=k[3],he(()=>s=!1)),!i&&G&64&&(i=!0,U.buttons=k[6],he(()=>i=!1)),o.$set(U);const K={};G&128&&(K.header=k[7]("content.menu.loadGame.header")),!a&&G&2&&(a=!0,K.debugMode=k[1],he(()=>a=!1)),!c&&G&16&&(c=!0,K.showMenu=k[4],he(()=>c=!1)),!u&&G&32&&(u=!0,K.buttons=k[5],he(()=>u=!1)),l.$set(K),(!P||G&128)&&_!==(_=k[7]("content.menu.menuButton")+"")&&Y(C,_),(!P||G&128)&&m!==(m=k[7]("content.actions.next")+"")&&Y(d,m),(!P||G&128)&&B!==(B=k[7]("content.actions.action")+"")&&Y(oe,B),k[0].dungeon.beaten?ee?ee.p(k,G):(ee=Io(k),ee.c(),ee.m(n,null)):ee&&(ee.d(1),ee=null)},i(k){P||(q(o.$$.fragment,k),q(l.$$.fragment,k),P=!0)},o(k){$(o.$$.fragment,k),$(l.$$.fragment,k),P=!1},d(k){k&&f(n),Re(o),Re(l),ee&&ee.d(),z=!1,Ln(ce)}}}function Gi(e,n,o){let t;Qe(e,We,W=>o(7,t=W));let{state:s}=n,{debugMode:i}=n,{buildInfo:r}=n,l=!1,a=!1,c=[],u=[];const g=()=>{o(1,i=!i),o(0,s.settings.debug=i,s),ae(s)},E=W=>{switch(W.key){case"6":case"d":qe("R",s);break;case"9":case"e":qe("UR",s);break;case"8":case"w":qe("U",s);break;case"7":case"q":qe("UL",s);break;case"4":case"a":qe("L",s);break;case"1":case"z":qe("DL",s);break;case"2":case"x":qe("D",s);break;case"3":case"c":qe("DR",s);break;case"0":case" ":o(0,s=Tn(s));break;case"-":case"r":Co(s);break;case"+":case"f":Lo(s);break}},_=()=>{o(0,s=nt()),ae(s),o(3,l=!1)},C=()=>{ds(s),o(3,l=!1)},M=()=>{o(0,s.dungeon=Hi,s),ae(s),o(3,l=!1)},A=()=>{o(3,l=!1),o(4,a=!0),o(5,c=y())},y=()=>{const W=[],Te=localStorage.getItem("autosave");Te&&W.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.autoSave"),onClick:()=>d(Te)});const ne=localStorage.getItem("state");return ne&&W.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.manualSave"),onClick:()=>d(ne)}),W.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.back"),onClick:()=>{o(3,l=!0),o(4,a=!1)}}),W},m=()=>[{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.newGame"),onClick:_},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.saveGame"),onClick:C},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.loadGame"),onClick:A},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.debug"),onClick:g},{debugModeOnly:!0,label:t("content.menu.mainMenu.buttons.testingGrounds"),onClick:M},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.language"),onClick:T}],d=W=>{o(0,s=et(JSON.parse(W))),o(3,l=!1),o(4,a=!1)},b=()=>{o(6,u=m()),a?o(3,l=!1):o(3,l=!l),o(4,a=!1)},T=()=>{ct.get()==="en"?(Rn("sv"),o(0,s.settings.locale="sv",s)):(Rn("en"),o(0,s.settings.locale="en",s)),o(6,u=m()),ae(s)};u=m();function B(W){i=W,o(1,i)}function oe(W){l=W,o(3,l)}function re(W){u=W,o(6,u)}function P(W){i=W,o(1,i)}function z(W){a=W,o(4,a)}function ce(W){c=W,o(5,c)}const ue=()=>o(0,s=Tn(s)),pe=()=>Ot(s),te=()=>_s(s);return e.$$set=W=>{"state"in W&&o(0,s=W.state),"debugMode"in W&&o(1,i=W.debugMode),"buildInfo"in W&&o(2,r=W.buildInfo)},[s,i,r,l,a,c,u,t,E,b,B,oe,re,P,z,ce,ue,pe,te]}class Ui extends we{constructor(n){super(),He(this,n,Gi,Bi,me,{state:0,debugMode:1,buildInfo:2})}}const Ki="2023-10-05",Fi="95ac019",Wi={date:Ki,hash:Fi};function Vi(e){let n,o,t,s,i,r,l,a,c,u,g,E,_,C,M,A;t=new Ri({props:{state:e[0]}});function y(P){e[2](P)}function m(P){e[3](P)}let d={};e[0]!==void 0&&(d.state=e[0]),e[1]!==void 0&&(d.debugMode=e[1]),i=new li({props:d}),ge.push(()=>_e(i,"state",y)),ge.push(()=>_e(i,"debugMode",m));function b(P){e[4](P)}function T(P){e[5](P)}let B={buildInfo:Wi};e[0]!==void 0&&(B.state=e[0]),e[1]!==void 0&&(B.debugMode=e[1]),u=new Ui({props:B}),ge.push(()=>_e(u,"state",b)),ge.push(()=>_e(u,"debugMode",T));function oe(P){e[6](P)}let re={};return e[0]!==void 0&&(re.state=e[0]),C=new wi({props:re}),ge.push(()=>_e(C,"state",oe)),{c(){n=w("div"),o=w("div"),De(t.$$.fragment),s=x(),De(i.$$.fragment),a=x(),c=w("div"),De(u.$$.fragment),_=x(),De(C.$$.fragment),this.h()},l(P){n=H(P,"DIV",{class:!0});var z=N(n);o=H(z,"DIV",{class:!0});var ce=N(o);Oe(t.$$.fragment,ce),ce.forEach(f),s=j(z),Oe(i.$$.fragment,z),z.forEach(f),a=j(P),c=H(P,"DIV",{class:!0,id:!0});var ue=N(c);Oe(u.$$.fragment,ue),_=j(ue),Oe(C.$$.fragment,ue),ue.forEach(f),this.h()},h(){R(o,"class","characterSide svelte-3spdd7"),R(n,"class","container svelte-3spdd7"),R(c,"class","container svelte-3spdd7"),R(c,"id","footer")},m(P,z){I(P,n,z),p(n,o),Me(t,o,null),p(n,s),Me(i,n,null),I(P,a,z),I(P,c,z),Me(u,c,null),p(c,_),Me(C,c,null),A=!0},p(P,[z]){const ce={};z&1&&(ce.state=P[0]),t.$set(ce);const ue={};!r&&z&1&&(r=!0,ue.state=P[0],he(()=>r=!1)),!l&&z&2&&(l=!0,ue.debugMode=P[1],he(()=>l=!1)),i.$set(ue);const pe={};!g&&z&1&&(g=!0,pe.state=P[0],he(()=>g=!1)),!E&&z&2&&(E=!0,pe.debugMode=P[1],he(()=>E=!1)),u.$set(pe);const te={};!M&&z&1&&(M=!0,te.state=P[0],he(()=>M=!1)),C.$set(te)},i(P){A||(q(t.$$.fragment,P),q(i.$$.fragment,P),q(u.$$.fragment,P),q(C.$$.fragment,P),A=!0)},o(P){$(t.$$.fragment,P),$(i.$$.fragment,P),$(u.$$.fragment,P),$(C.$$.fragment,P),A=!1},d(P){P&&(f(n),f(a),f(c)),Re(t),Re(i),Re(u),Re(C)}}}function Yi(e,n,o){let t,s=null;s=localStorage.getItem("reloadGuard"),s?(t=et(JSON.parse(s)),ae(t)):(t=nt(),ae(t)),Rn(t.settings.locale);let i=t.settings.debug;function r(g){t=g,o(0,t)}function l(g){i=g,o(1,i)}function a(g){t=g,o(0,t)}function c(g){i=g,o(1,i)}function u(g){t=g,o(0,t)}return[t,i,r,l,a,c,u]}class Si extends we{constructor(n){super(),He(this,n,Yi,Vi,me,{})}}export{Si as component};
