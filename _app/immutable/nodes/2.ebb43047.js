import{s as He,n as ie,o as qe,b as zt,f as qt,r as Vt,i as N}from"../chunks/scheduler.ba2ce6c0.js";import{S as Ve,i as Xe,g,h as m,j as k,f as p,k as P,a as le,y as Xt,r as yt,s as T,u as Rt,c as C,z as H,x as d,v as Dt,A as I,d as Tt,t as Ct,w as Ot}from"../chunks/index.8040907f.js";var U=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(U||{}),x=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(x||{}),Y=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(Y||{}),ce=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ONE=1]="KILL_ONE",e[e.REACH_CELL=2]="REACH_CELL",e))(ce||{}),Pt=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.DOOR="Door",e.NOTE="Note",e))(Pt||{}),S=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(S||{});const Zt="0",jt="#",Jt=" ",Qt=(e,t,n,o)=>({type:e,name:t,position:{x:n,y:o},found:!1}),Oe=(e,t,n)=>({side:e,x:t,y:n,locked:!1,trapped:!1,open:!1}),be=(e,t,n,o)=>{const s=Object.values(U).indexOf(t),r=Object.keys(U)[s];let l=Y.LORD,f=2,h=2,v=4,E=4,y=4;switch(e){case x.ORCH:{l=Y.APPRENTICE,h=0,v=2,E=2,y=1;break}case x.TROLL:{l=Y.KNIGHT,h=1,v=3,E=3,y=2;break}}return e===x.YELLOW_DARK_LORD&&(f=3),{type:e,level:l,colour:t,actions:f,defense:h,health:v,maxHealth:E,experience:y,name:e+" ("+r+")",movement:3,position:{x:n,y:o}}},$t={name:"Second cave",beaten:!1,winConditions:[{type:ce.REACH_CELL,targetCell:{x:0,y:0},fulfilled:!1}],startingPositions:[{x:0,y:2},{x:0,y:3},{x:0,y:4},{x:1,y:3}],discoveredRooms:["A"],layout:{grid:["AAA","A A","AAA","AAA","AAA"],doors:[],monsters:[],secrets:[]}},_t={name:"Troll cave",beaten:!1,winConditions:[{type:ce.KILL_ALL,fulfilled:!1}],nextDungeon:$t,startingPositions:[{x:0,y:7},{x:0,y:8},{x:0,y:9},{x:1,y:8}],discoveredRooms:["A"],layout:{grid:["     CCCC","     CCCC","     CCCC","      E  ","      E  ","      E  ","      BB ","AAA   BB ","AAADDDBB ","AAA   BB "],doors:[Oe(S.RIGHT,2,8),Oe(S.RIGHT,5,8),Oe(S.UP,6,6),Oe(S.UP,6,3)],monsters:[be(x.ORCH,U.Green,5,8),be(x.ORCH,U.Yellow,7,9),be(x.ORCH,U.Red,6,4),be(x.ORCH,U.Red,8,2),be(x.TROLL,U.Green,5,0)],secrets:[Qt(Pt.NOTE,"Welcome to Drakriddarna",1,8)]}},Ht=e=>{e.actionLog.push("Game saved."),localStorage.setItem("state",JSON.stringify(e))},en=()=>{const e=localStorage.getItem("state");if(e){const t=JSON.parse(e);return t.currentActor=t.heroes.find(n=>{var o;return n.name===((o=t.currentActor)==null?void 0:o.name)}),t.actionLog.push("Game loaded."),t}},tn=()=>{const e=Ut;return Mt(e,_t),{heroes:e,dungeon:_t,currentActor:e[0],actionLog:["Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."]}},_e=(e,t)=>({name:e,actions:2,movement:3,defense:0,level:Y.APPRENTICE,health:7,maxHealth:7,colour:t,experience:0}),Ut=[_e("Fearik",U.Yellow),_e("Helbran",U.Red),_e("Siedel",U.Green),_e("Wulf",U.Blue)],Mt=(e,t)=>{e.forEach((n,o)=>n.position=t.startingPositions[o])},ye=e=>{let t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t},nn=(e,t,n)=>e.dungeon.layout.monsters.some(o=>{var s;return o.position.x===t&&((s=o.position)==null?void 0:s.y)===n&&o.health>0}),O=(e,t)=>{const n=t.currentActor;if(n.actions===0)return;let o=n.position.x,s=n.position.y;switch(e){case"UL":o=n.position.x-1,s=n.position.y-1;break;case"U":s=n.position.y-1;break;case"UR":o=n.position.x+1,s=n.position.y-1;break;case"L":o=n.position.x-1;break;case"R":o=n.position.x+1;break;case"DL":o=n.position.x-1,s=n.position.y+1;break;case"D":s=n.position.y+1;break;case"DR":o=n.position.x+1,s=n.position.y+1;break}const r=t.heroes.some(h=>h.position.x===o&&h.position.y===s),l=!xt(t.dungeon.layout,o,s),f=nn(t,o,s);if(!r&&!l){const h=Yt(t.dungeon,o,s);h?h&&(f?sn(n,t,o,s):Kt(n,o,s,1)):rn(t,n,o,s)&&on(n,t,o,s)}else t.actionLog.push(n.name+" could not make that move");n.movement===0&&(n.actions--,n.movement=3)},Kt=(e,t,n,o)=>{e.position.x=t,e.position.y=n,e.movement-=o},on=(e,t,n,o)=>{const s=Be(t.dungeon.layout.grid,n,o);s&&t.dungeon.discoveredRooms.push(s),Kt(e,e.position.x,e.position.y,1),t.actionLog.push(e.name+" opened a door")},sn=(e,t,n,o)=>{if(e.actions===1&&e.movement!==3){t.actionLog.push(e.name+" has no actions left to attack");return}const s=t.dungeon.layout.monsters.find(r=>{var l;return r.position.x===n&&((l=r.position)==null?void 0:l.y)===o});if(s){const r=we(e.level,3),l=Math.max(r-s.defense,0);t.actionLog.push(e.name+" attacked "+s.name+" for "+l+" damage ("+r+"-"+s.defense+"="+l+")"),s.health-=l,s.health<=0&&(t.dungeon.layout.monsters=t.dungeon.layout.monsters.filter(f=>f!=s),t.actionLog.push(e.name+" killed "+s.name),e.experience+=s.experience),(e==null?void 0:e.actions)>1&&(e==null?void 0:e.movement)<3?e.actions-=2:e.actions--}},we=(e,t)=>{let n=[];for(let o=0;o<t;o++)n.push(Math.floor(Math.random()*6)+1);switch(e){case Y.APPRENTICE:n=n.filter(o=>o===6);break;case Y.KNIGHT:case Y.HERO:n=n.filter(o=>o>=5);break;case Y.LORD:case Y.MASTER:n=n.filter(o=>o>=4);break}return n.length},wt=e=>{const t=e.currentActor;if(!Gt(t)){e.actionLog.push(t.name+" has no actions left to pick lock");return}const n=e.dungeon.layout.doors.find(o=>o.x===t.position.x&&o.y===t.position.y);n&&n.locked&&(we(t.level,1)>=1?(n.locked=!1,e.actionLog.push(t.name+" managed to pick the lock")):e.actionLog.push(t.name+" failed to pick the lock"),(t==null?void 0:t.actions)>1&&(t==null?void 0:t.movement)<3?t.actions-=2:t.actions--,t.movement=3)},Bt=e=>{const t=e.currentActor;if(!Gt(t)){e.actionLog.push(t.name+" has no actions left to search");return}const n=we(t.level,1);if(n>=1){const o=e.dungeon.layout.secrets.find(s=>Ft(s.position,t.position.x,t.position.y));o?e.actionLog.push(t.name+" searched ("+n+") and found "+o.name):(e.actionLog.push(t.name+" searched ("+n+") but found nothing"),console.log("found no secret"))}else e.actionLog.push(t.name+" searched ("+n+") but found nothing");(t==null?void 0:t.actions)>1&&(t==null?void 0:t.movement)<3?t.actions-=2:t.actions--,t.movement=3},It=e=>{if(an(e),e.currentActor!==void 0){e.actionLog.push(e.currentActor.name+" ended their turn");let n=e.heroes.indexOf(e.currentActor)+1;n===e.heroes.length&&(cn(e),n=0),e.currentActor.actions=2,e.currentActor.movement=3,e.currentActor=e.heroes[n],e.actionLog.push(e.currentActor.name+" started their turn")}},an=e=>{e.dungeon.winConditions.forEach(t=>{switch(t.type){case ce.KILL_ALL:const n=e.dungeon.layout.monsters.map(s=>s.health).reduce((s,r)=>s+r,0);t.fulfilled=n<=0;break;case ce.REACH_CELL:t.fulfilled=e.heroes.some(s=>{var r;s.position.x===((r=t.targetCell)==null?void 0:r.x)&&(s.position.y,t.targetCell.y)});break;case ce.KILL_ONE:const o=e.dungeon.layout.monsters.find(s=>s.name===t.targetMonster);t.fulfilled=o.health===0;break}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,n)=>t&&n,!0),e.dungeon.beaten&&(e.actionLog.push("All win conditions have been fulfilled"),e.actionLog.push("You have cleared "+e.dungeon.name))},rn=(e,t,n,o)=>{var r;const s=e.dungeon.layout.doors.find(l=>{var f;return l.x===((f=t.position)==null?void 0:f.x)&&l.y===t.position.y});if(s&&!s.locked){const l=ln(t.position.x,(r=t.position)==null?void 0:r.y,n,o);if(s.side===l)return s.open=!0,!0}return s.locked&&e.actionLog.push("Door is locked"),!1},ln=(e,t,n,o)=>{if(e===n){if(t>o)return S.UP;if(t<o)return S.DOWN}if(t===o){if(e>n)return S.LEFT;if(e<n)return S.RIGHT}},xt=(e,t,n)=>{let o=!0;if(t<0||t>=e.grid[0].length||n<0||n>=e.grid.length)o=!1;else{const s=Be(e.grid,t,n);(s===Zt||s===jt||s===Jt)&&(o=!1)}return o},Yt=(e,t,n)=>{const o=Be(e.layout.grid,t,n);return o?e.discoveredRooms.includes(o):!1},Be=(e,t,n)=>{let o;return e.forEach((s,r)=>{ye(s).forEach((l,f)=>{r===n&&f===t&&(o=l)})}),o},Ft=(e,t,n)=>e.x===t&&e.y===n||e.x===t-1&&e.y===n||e.x===t-1&&e.y===n-1||e.x===t&&e.y===n-1||e.x===t+1&&e.y===n-1||e.x===t+1&&e.y===n||e.x===t+1&&e.y===n+1||e.x===t&&e.y===n+1||e.x===t-1&&e.y===n+1,cn=e=>{const t=e.dungeon.layout.monsters.filter(n=>{var s;const o=Be(e.dungeon.layout.grid,(s=n.position)==null?void 0:s.x,n.position.y);return e.dungeon.discoveredRooms.includes(o)&&n.health>0});t.length===0&&e.actionLog.push("No monsters can act"),t.forEach(n=>{const o=n.actions;for(;n.actions>0;){e.actionLog.push(n.name+" acted ");const s=e.heroes.filter(r=>{var l;return Ft(n.position,(l=r.position)==null?void 0:l.x,r.position.y)});if(s.length>0){const r=Math.floor(Math.random()*s.length);fn(e,n,s[r])}else dn(e,n)}n.actions=o})};function St(e,t){return Math.sqrt(Math.pow(e.x-(t==null?void 0:t.x),2)+Math.pow(e.y-(t==null?void 0:t.y),2))}const dn=(e,t)=>{const n=e.heroes.map(s=>({hero:s,dist:St(s.position,t.position)})).sort((s,r)=>s.dist-r.dist)[0],o=un(e,t.position);if(o.length>0){const s=o.map(r=>({pos:r,dist:St(r,n.hero.position)})).sort((r,l)=>r.dist-l.dist)[0].pos;t.position=s,e.actionLog.push(t.name+" moved towards "+n.hero.name+" ("+s.x+","+s.y+")")}else e.actionLog.push(t.name+" could not move");t.actions--};let un=(e,t)=>{const n=t.x,o=t.y,s=[];for(let r=n-1;r<=n+1;r++)for(let l=o-1;l<=o+1;l++)r===n&&l===o||xt(e.dungeon.layout,r,l)&&Yt(e.dungeon,r,l)&&s.push({x:r,y:l});return s.filter(r=>!e.heroes.find(l=>l.position.x===r.x&&l.position.y===r.y)).filter(r=>!e.dungeon.layout.monsters.find(f=>f.position.x===r.x&&f.position.y===r.y))};const fn=(e,t,n)=>{if(t.actions===1&&t.movement!==3){e.actionLog.push(n.name+" has no actions left to attack");return}if(n){const o=we(t.level,3),s=Math.max(o-n.defense,0);e.actionLog.push(t.name+" attacked "+n.name+" for "+s+" damage ("+o+"-"+n.defense+"="+s+")"),n.health-=s,n.health<=0&&(e.actionLog.push(t.name+" killed "+n.name),e.heroes=e.heroes.filter(r=>r!==n)),(t==null?void 0:t.actions)>1&&(t==null?void 0:t.movement)<3?t.actions-=2:t.actions--}},Gt=e=>e.movement<3?e.actions>1:e.actions>0,hn=""+new URL("../assets/Dungeon_Tileset.b0da342a.png",import.meta.url).href,gn="data:image/png;base64,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";function mn(e){let t;return{c(){t=g("canvas"),this.h()},l(n){t=m(n,"CANVAS",{width:!0,height:!0,id:!0}),k(t).forEach(p),this.h()},h(){P(t,"width","860"),P(t,"height","750"),P(t,"id","gameBoard")},m(n,o){le(n,t,o)},p:ie,i:ie,o:ie,d(n){n&&p(t)}}}const a=48;function vn(e,t,n){let{state:o}=t,{debugMode:s=!1}=t;qe(()=>{const i=new Image;i.src=hn;const A=new Image;A.src=gn,r(i,A),setInterval(()=>r(i,A),10)});const r=(i,A)=>{if(!o||!document)return;const u=document.getElementById("gameBoard"),c=u.getContext("2d");c.clearRect(0,0,u.width,u.height),o.dungeon.layout.grid.forEach((L,_)=>{ye(L).forEach((b,D)=>l(c,b,D,_,i))}),o.dungeon.layout.grid.forEach((L,_)=>{ye(L).forEach((b,D)=>f(c,b,D,_))}),o.dungeon.layout.grid.forEach((L,_)=>{ye(L).forEach((b,D)=>h(c,b,D,_))}),o.dungeon.layout.grid.forEach((L,_)=>{ye(L).forEach((b,D)=>w(c,b,D,_,A))})},l=(i,A,u,c,L)=>{F(A)?(i.beginPath(),i.strokeStyle="black",i.fillStyle="black",i.fillRect(u*a,c*a,a,a),i.stroke()):i.drawImage(L,0,7*16,16,16,u*a,c*a,a,a)},f=(i,A,u,c)=>{i.beginPath(),i.strokeStyle="black",i.rect(u*a,c*a,a,a),s&&(i.font="7px Arial",i.fillText(u+","+c,u*a+3,c*a+(a-3))),i.stroke()},h=(i,A,u,c)=>{const L=G(u,c);if(L&&!L.open&&!F(A))switch(i.fillStyle="brown",L.side){case S.RIGHT:{i.fillRect(u*a+(a-2),c*a,4,a),L.locked&&(i.fillStyle="grey",i.fillRect(u*a+(a-4),c*a+(a/2-4),8,8));break}case S.LEFT:{i.fillRect(u*a-2,c*a,4,a),L.locked&&(i.fillStyle="grey",i.fillRect(u*a-4,c*a+(a/2-4),8,8));break}case S.UP:{i.fillRect(u*a,c*a-2,a,4),L.locked&&(i.fillStyle="grey",i.fillRect(u*a+(a/2-4),c*a-4,8,8));break}case S.DOWN:{i.fillRect(u*a,c*a+(a-2),a,4),L.locked&&(i.fillStyle="grey",i.fillRect(u*a+(a/2-4),c*a+(a-4),8,8));break}}},v=(i,A,u,c)=>{i.beginPath(),i.strokeStyle=A.colour,i.fillStyle=A.colour,i.fillRect(u*a+4,c*a+(a-6),a-8,4),i.stroke()},E=(i,A,u)=>{s&&u.forEach(c=>{i.strokeStyle=A.colour,i.beginPath(),i.moveTo(A.position.x*a+a/2,A.position.y*a+a/2),i.lineTo(c.position.x*a+a/2,c.position.y*a+a/2),i.stroke()})},y=(i,A,u,c)=>{i.beginPath(),i.strokeStyle="black",i.fillStyle="red",i.fillRect(u*a+4,c*a,a-8,4),i.fillStyle="green",i.fillRect(u*a+4,c*a,(a-8)*(A.health/A.maxHealth),4),i.rect(u*a+4,c*a,a-8,4),i.stroke()},w=(i,A,u,c,L)=>{i.beginPath();const _=o.heroes.find(b=>b.position.x===u&&b.position.y===c);if(_)i.drawImage(L,4*16,0,16,16,u*a,c*a,a,a),v(i,_,u,c),y(i,_,u,c),i.stroke();else{const b=o.dungeon.layout.monsters.find(D=>D.position.x===u&&D.position.y===c);if(b&&b.health>0&&!F(A)){switch(b.type){case x.ORCH:i.drawImage(L,a,16,16,16,u*a,c*a,a,a);break;case x.TROLL:i.drawImage(L,a,16,16,16,u*a,c*a,a,a);break;default:i.drawImage(L,16,16,16,16,u*a,c*a,a,a);break}v(i,b,u,c),y(i,b,u,c),E(i,b,o.heroes)}}i.stroke()},F=i=>i===" "||!o.dungeon.discoveredRooms.includes(i),G=(i,A)=>o.dungeon.layout.doors.find(u=>u.x===i&&u.y===A);return e.$$set=i=>{"state"in i&&n(0,o=i.state),"debugMode"in i&&n(1,s=i.debugMode)},[o,s]}class pn extends Ve{constructor(t){super(),Xe(this,t,vn,mn,He,{state:0,debugMode:1})}}function An(e){let t;return{c(){t=g("canvas"),this.h()},l(n){t=m(n,"CANVAS",{id:!0,height:!0,width:!0}),k(t).forEach(p),this.h()},h(){P(t,"id","characterBoard"),P(t,"height","750"),P(t,"width","260")},m(n,o){le(n,t,o)},p:ie,i:ie,o:ie,d(n){n&&p(t)}}}const re=180;function kn(e,t,n){let{state:o}=t;qe(()=>{s(),setInterval(s,100)});const s=()=>{if(!o||!document)return;const f=document.getElementById("characterBoard"),h=f.getContext("2d");h.clearRect(0,0,f.width,f.height),h.stroke(),o.heroes.forEach((v,E)=>r(h,f,v,E)),o.heroes.forEach((v,E)=>l(h,v,E))},r=(f,h,v,E)=>{f.fillStyle=v.colour,f.fillRect(12,E*re+12,h.width,re-12),f.stroke(),f.fillStyle="black"},l=(f,h,v)=>{const y=(h===o.currentActor?"> "+h.name:h.name)+" - "+h.level+" ("+h.experience+")";f.strokeStyle="black",f.font="18px Arial",f.fillText(y,16,v*re+30),f.fillText("HP: "+h.health,16,v*re+50),f.fillText("Actions: "+h.actions,16,v*re+70),f.fillText("Moves: "+h.movement,16,v*re+90),f.stroke()};return e.$$set=f=>{"state"in f&&n(0,o=f.state)},[o]}class Ln extends Ve{constructor(t){super(),Xe(this,t,kn,An,He,{state:0})}}function Nt(e){let t,n='<canvas width="860" height="100" id="logs"></canvas>';return{c(){t=g("div"),t.innerHTML=n,this.h()},l(o){t=m(o,"DIV",{class:!0,"data-svelte-h":!0}),H(t)!=="svelte-xcon9n"&&(t.innerHTML=n),this.h()},h(){P(t,"class","log svelte-60nygp")},m(o,s){le(o,t,s)},p:ie,d(o){o&&p(t)}}}function En(e){let t,n,o,s,r,l,f,h,v,E,y,w,F,G,i="UL",A,u,c,L="U",_,b,D,Ze="UR",Ie,de,Z,je="Next",Se,M,ue,j,Je="L",Ne,Re,Pe,fe,J,Qe="R",Ue,he,Q,$e="Search",Me,K,ge,$,et="DL",Ke,me,ee,tt="D",xe,ve,te,nt="DR",Ye,pe,ne,ot="Pick lock",Fe,oe,Ae,se,st="Save",Ge,ke,ae,at="Load",We,it=e[0].actionLog,De,ze,rt;o=new Ln({props:{state:e[0]}});function Wt(R){e[1](R)}let lt={};e[0]!==void 0&&(lt.state=e[0]),l=new pn({props:lt}),zt.push(()=>Xt(l,"state",Wt));let W=Nt();return{c(){t=g("div"),n=g("div"),yt(o.$$.fragment),s=T(),r=g("div"),yt(l.$$.fragment),h=T(),v=g("div"),E=g("div"),y=g("table"),w=g("tr"),F=g("td"),G=g("button"),G.textContent=i,A=T(),u=g("td"),c=g("button"),c.textContent=L,_=T(),b=g("td"),D=g("button"),D.textContent=Ze,Ie=T(),de=g("td"),Z=g("button"),Z.textContent=je,Se=T(),M=g("tr"),ue=g("td"),j=g("button"),j.textContent=Je,Ne=T(),Re=g("td"),Pe=T(),fe=g("td"),J=g("button"),J.textContent=Qe,Ue=T(),he=g("td"),Q=g("button"),Q.textContent=$e,Me=T(),K=g("tr"),ge=g("td"),$=g("button"),$.textContent=et,Ke=T(),me=g("td"),ee=g("button"),ee.textContent=tt,xe=T(),ve=g("td"),te=g("button"),te.textContent=nt,Ye=T(),pe=g("td"),ne=g("button"),ne.textContent=ot,Fe=T(),oe=g("tr"),Ae=g("td"),se=g("button"),se.textContent=st,Ge=T(),ke=g("td"),ae=g("button"),ae.textContent=at,We=T(),W.c(),this.h()},l(R){t=m(R,"DIV",{class:!0});var B=k(t);n=m(B,"DIV",{class:!0});var Le=k(n);Rt(o.$$.fragment,Le),Le.forEach(p),s=C(B),r=m(B,"DIV",{class:!0});var Ee=k(r);Rt(l.$$.fragment,Ee),Ee.forEach(p),B.forEach(p),h=C(R),v=m(R,"DIV",{class:!0});var Te=k(v);E=m(Te,"DIV",{class:!0});var ct=k(E);y=m(ct,"TABLE",{});var z=k(y);w=m(z,"TR",{});var q=k(w);F=m(q,"TD",{});var dt=k(F);G=m(dt,"BUTTON",{"data-svelte-h":!0}),H(G)!=="svelte-fw3uxo"&&(G.textContent=i),dt.forEach(p),A=C(q),u=m(q,"TD",{});var ut=k(u);c=m(ut,"BUTTON",{"data-svelte-h":!0}),H(c)!=="svelte-1jeoia6"&&(c.textContent=L),ut.forEach(p),_=C(q),b=m(q,"TD",{});var ft=k(b);D=m(ft,"BUTTON",{"data-svelte-h":!0}),H(D)!=="svelte-1p8c8vc"&&(D.textContent=Ze),ft.forEach(p),Ie=C(q),de=m(q,"TD",{});var ht=k(de);Z=m(ht,"BUTTON",{"data-svelte-h":!0}),H(Z)!=="svelte-1rtxc14"&&(Z.textContent=je),ht.forEach(p),q.forEach(p),Se=C(z),M=m(z,"TR",{});var V=k(M);ue=m(V,"TD",{});var gt=k(ue);j=m(gt,"BUTTON",{"data-svelte-h":!0}),H(j)!=="svelte-10dnpu6"&&(j.textContent=Je),gt.forEach(p),Ne=C(V),Re=m(V,"TD",{}),k(Re).forEach(p),Pe=C(V),fe=m(V,"TD",{});var mt=k(fe);J=m(mt,"BUTTON",{"data-svelte-h":!0}),H(J)!=="svelte-12287ni"&&(J.textContent=Qe),mt.forEach(p),Ue=C(V),he=m(V,"TD",{});var vt=k(he);Q=m(vt,"BUTTON",{"data-svelte-h":!0}),H(Q)!=="svelte-cps1bu"&&(Q.textContent=$e),vt.forEach(p),V.forEach(p),Me=C(z),K=m(z,"TR",{});var X=k(K);ge=m(X,"TD",{});var pt=k(ge);$=m(pt,"BUTTON",{"data-svelte-h":!0}),H($)!=="svelte-1ji074i"&&($.textContent=et),pt.forEach(p),Ke=C(X),me=m(X,"TD",{});var At=k(me);ee=m(At,"BUTTON",{"data-svelte-h":!0}),H(ee)!=="svelte-li5tq6"&&(ee.textContent=tt),At.forEach(p),xe=C(X),ve=m(X,"TD",{});var kt=k(ve);te=m(kt,"BUTTON",{"data-svelte-h":!0}),H(te)!=="svelte-3esmwe"&&(te.textContent=nt),kt.forEach(p),Ye=C(X),pe=m(X,"TD",{});var Lt=k(pe);ne=m(Lt,"BUTTON",{"data-svelte-h":!0}),H(ne)!=="svelte-sacog4"&&(ne.textContent=ot),Lt.forEach(p),X.forEach(p),Fe=C(z),oe=m(z,"TR",{});var Ce=k(oe);Ae=m(Ce,"TD",{});var Et=k(Ae);se=m(Et,"BUTTON",{"data-svelte-h":!0}),H(se)!=="svelte-1vr5zyk"&&(se.textContent=st),Et.forEach(p),Ge=C(Ce),ke=m(Ce,"TD",{});var bt=k(ke);ae=m(bt,"BUTTON",{"data-svelte-h":!0}),H(ae)!=="svelte-1m2jkw7"&&(ae.textContent=at),bt.forEach(p),Ce.forEach(p),z.forEach(p),ct.forEach(p),We=C(Te),W.l(Te),Te.forEach(p),this.h()},h(){P(n,"class","characterSide svelte-60nygp"),P(r,"class","boardSide svelte-60nygp"),P(t,"class","container svelte-60nygp"),P(E,"class","commands svelte-60nygp"),P(v,"class","container svelte-60nygp")},m(R,B){le(R,t,B),d(t,n),Dt(o,n,null),d(t,s),d(t,r),Dt(l,r,null),le(R,h,B),le(R,v,B),d(v,E),d(E,y),d(y,w),d(w,F),d(F,G),d(w,A),d(w,u),d(u,c),d(w,_),d(w,b),d(b,D),d(w,Ie),d(w,de),d(de,Z),d(y,Se),d(y,M),d(M,ue),d(ue,j),d(M,Ne),d(M,Re),d(M,Pe),d(M,fe),d(fe,J),d(M,Ue),d(M,he),d(he,Q),d(y,Me),d(y,K),d(K,ge),d(ge,$),d(K,Ke),d(K,me),d(me,ee),d(K,xe),d(K,ve),d(ve,te),d(K,Ye),d(K,pe),d(pe,ne),d(y,Fe),d(y,oe),d(oe,Ae),d(Ae,se),d(oe,Ge),d(oe,ke),d(ke,ae),d(v,We),W.m(v,null),De=!0,ze||(rt=[I(G,"click",function(){N(O("UL",e[0]))&&O("UL",e[0]).apply(this,arguments)}),I(c,"click",function(){N(O("U",e[0]))&&O("U",e[0]).apply(this,arguments)}),I(D,"click",function(){N(O("UR",e[0]))&&O("UR",e[0]).apply(this,arguments)}),I(Z,"click",function(){N(It(e[0]))&&It(e[0]).apply(this,arguments)}),I(j,"click",function(){N(O("L",e[0]))&&O("L",e[0]).apply(this,arguments)}),I(J,"click",function(){N(O("R",e[0]))&&O("R",e[0]).apply(this,arguments)}),I(Q,"click",function(){N(Bt(e[0]))&&Bt(e[0]).apply(this,arguments)}),I($,"click",function(){N(O("DL",e[0]))&&O("DL",e[0]).apply(this,arguments)}),I(ee,"click",function(){N(O("D",e[0]))&&O("D",e[0]).apply(this,arguments)}),I(te,"click",function(){N(O("DR",e[0]))&&O("DR",e[0]).apply(this,arguments)}),I(ne,"click",function(){N(wt(e[0]))&&wt(e[0]).apply(this,arguments)}),I(se,"click",function(){N(Ht(e[0]))&&Ht(e[0]).apply(this,arguments)}),I(ae,"click",e[2])],ze=!0)},p(R,[B]){e=R;const Le={};B&1&&(Le.state=e[0]),o.$set(Le);const Ee={};!f&&B&1&&(f=!0,Ee.state=e[0],qt(()=>f=!1)),l.$set(Ee),B&1&&He(it,it=e[0].actionLog)?(W.d(1),W=Nt(),W.c(),W.m(v,null)):W.p(e,B)},i(R){De||(Tt(o.$$.fragment,R),Tt(l.$$.fragment,R),De=!0)},o(R){Ct(o.$$.fragment,R),Ct(l.$$.fragment,R),De=!1},d(R){R&&(p(t),p(h),p(v)),Ot(o),Ot(l),W.d(R),ze=!1,Vt(rt)}}}function bn(e,t,n){let o=tn();qe(()=>{r(),setInterval(r,500),setInterval(s,1e3)});const s=()=>{if(o.dungeon.beaten&&o.dungeon.nextDungeon){n(0,o.dungeon=o.dungeon.nextDungeon,o);const h=Ut.filter(v=>!o.heroes.find(E=>v.name===E.name));o.heroes.push(...h),Mt(o.heroes,o.dungeon),n(0,o.actionLog=[],o),o.actionLog.push("You have reached "+o.dungeon.name)}},r=()=>{if(!o||!document)return;const h=document.getElementById("logs"),v=h.getContext("2d");v.clearRect(0,0,h.width,h.height),o.actionLog.slice(-10).reverse().forEach((E,y)=>{v.font="12px Arial",v.fillStyle="black",v.fillText("> "+E,2,(y+1)*12+2),v.stroke()})};function l(h){o=h,n(0,o)}return[o,l,()=>n(0,o=en())]}class Dn extends Ve{constructor(t){super(),Xe(this,t,bn,En,He,{})}}export{Dn as component};
