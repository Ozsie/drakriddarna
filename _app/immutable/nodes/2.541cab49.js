import{s as Le,n as fe,o as Ln,b as On,f as Mn,r as Yt}from"../chunks/scheduler.bc760b9c.js";import{S as un,i as dn,g as f,h as m,j as v,f as d,k as N,a as P,x as c,y as X,s as w,m as O,c as x,n as M,o as de,z as Z,p as fn,t as re,b as mn,d as j,e as _e,A as tt,B as wn,r as rn,u as sn,v as an,w as ln,l as pt,C as po}from"../chunks/index.54d4ae92.js";const go=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function bn(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var $=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))($||{}),F=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(F||{}),ae=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(ae||{}),Oe=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(Oe||{}),oe=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(oe||{}),A=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(A||{}),U=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))(U||{});const Kn=[{name:"Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:U.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Two-handed Sword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:U.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"Halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:U.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"Flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:U.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"Double Headed Axe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:U.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],Jn=[{name:"Orch Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:U.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Orch Bow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:U.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"Troll Club",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:U.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],vo=[{name:"Chain mail",type:U.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"Plate mail",type:U.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"Dragon Skin mail",type:U.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],gt=[{name:"Orch Mail",defense:0,magicProtection:!1,amountInDeck:4,type:U.ARMOUR,movementReduction:0,value:0},{name:"Troll Skin",defense:1,magicProtection:!1,amountInDeck:4,type:U.ARMOUR,movementReduction:0,value:0}],jn=" ",Nn="?",Qn="#",Xe=(e,n,t,o)=>({type:e,name:n,position:{x:t,y:o},found:!1}),Yn=(e,n,t,o)=>({type:e,name:o.name,position:{x:n,y:t},found:!1,item:o}),q=(e,n,t)=>({side:e,x:n,y:t,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),yo=(e,n,t,o)=>({...q(e,n,t),trapped:!0,trapAttacks:o}),Hn=(e,n,t)=>({...q(e,n,t),hidden:!0}),Sn=(e,n,t)=>({...q(e,n,t),locked:!0}),ko=(e,n,t,o)=>({...q(e,n,t),hidden:!0,trapped:!0,trapAttacks:o}),ie=(e,n,t,o)=>{const r=Object.values($).indexOf(n),s=Object.keys($)[r];let i=ae.LORD,a=2,l=2,u=4,p=4,b=4,g=Jn[0],k,D=gt[0];switch(e){case F.ORCH:{i=ae.APPRENTICE,l=0,u=2,p=2,b=1,k=Jn[1];break}case F.TROLL:{i=ae.KNIGHT,l=1,u=3,p=3,b=2,g=Jn[2],D=gt[1];break}}return e===F.YELLOW_DARK_LORD&&(a=3),{type:e,level:i,colour:n,actions:a,defense:l,health:u,maxHealth:p,experience:b,name:e+" ("+s+")",movement:3,maxMovement:3,position:{x:t,y:o},weapon:g,armour:D,incapacitated:!1,inventory:[],rangedWeapon:k}},_o=e=>{const n=e.currentActor;if(n.blinded){h(e,`${n.name} is blinded and may not search.`);return}const t=n.inventory.filter(l=>{var u;return(u=l.properties)==null?void 0:u[kt]}).map(l=>{var u;return h(e,`${n.name} used the effect of ${l.name} when searching`),(u=l.properties)==null?void 0:u[kt]}).reduce((l,u)=>l+u,0),o=Cn(n.level,1+t);let r,s,i,a;o>=1?(r=wo(e,n,o),r||(s=Do(e,n,o)),!r&&!s&&(i=Ro(e,n,o)),!r&&!s&&!i&&(a=Io(e,n,o)),!r&&!s&&!i&&!a&&h(e,`${n.name} searched but found nothing`)):h(e,`${n.name} searched but found nothing`)},Vt=e=>{const n=e.currentActor;if(!n)return!1;const t=e.dungeon.layout.secrets.filter(o=>o.type===oe.TRAP_DOOR).filter(o=>!o.found).find(o=>Qe(o.position,n.position));return t?(cn(e,Eo(t),n,!1),h(e,`${n.name} fell into a pit and is incapacitated for one turn.`),n.movement=0,n.actions=0,n.incapacitated=!0,t.found=!0,!0):!1},qt=(e,n)=>{const t=e.itemDeck.findIndex(o=>o.type===n.type&&o.name===n.name);e.itemDeck.splice(t,1)},Xt=(e,n)=>{const t=e.magicItemDeck.findIndex(o=>o.type===n.type&&o.name===n.name);e.magicItemDeck.splice(t,1)},Eo=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:$.Red,maxHealth:0,name:"Trap Door",level:ae.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:U.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),Ao=(e,n)=>e.dungeon.layout.doors.filter(t=>t.hidden).find(t=>Gn({x:t.x,y:t.y},n.x,n.y)),bo=(e,n)=>e.dungeon.layout.doors.filter(t=>t.trapped).find(t=>t.x===n.x&&t.y===n.y),To=(e,n)=>e.dungeon.layout.secrets.filter(t=>!t.found).find(t=>Gn(t.position,n.x,n.y)),Co=(e,n)=>e.dungeon.layout.secrets.filter(t=>!t.found).filter(t=>t.type===oe.TRAP_DOOR).find(t=>Gn(t.position,n.x,n.y)),Do=(e,n,t)=>{const o=Ao(e,n.position);return o?(o.hidden=!1,h(e,`${n.name} searched (${t}) and found a hidden door`),!0):!1},Ro=(e,n,t)=>{const o=bo(e,n.position);return o?(h(e,`${n.name} searched (${t}) and found a trap in a door`),o.trapped=!1,!0):!1},Io=(e,n,t)=>{const o=To(e,n.position);if(o){switch(h(e,`${n.name} searched (${t}) and found ${o.name}`),o.found=!0,o.type){case oe.EQUIPMENT:{let r=o.item??Oo(e);if(r.amountInDeck>0)switch(qt(e,r),h(e,`${n.name} equipped (${r.name})`),r.type){case U.ARMOUR:n.armour&&n.inventory.push(n.armour),n.armour=r;break;case U.SHIELD:n.shield&&n.inventory.push(n.shield),n.shield=r;break;case U.WEAPON:n.weapon&&n.inventory.push(n.weapon),n.weapon=r;break}break}case oe.MAGIC_ITEM:{let r=o.item??Mo(e);r.amountInDeck>0&&(Xt(e,r),h(e,`${n.name} found (${r.name})`),n.inventory.push(r),r.pickup&&rt[r.pickup](e,r,n));break}}return!0}return!1},Oo=e=>{const n=e.itemDeck.length,t=Math.floor(Math.random()*n);return e.itemDeck[t]},Mo=e=>{const n=e.magicItemDeck.length,t=Math.floor(Math.random()*n);return e.magicItemDeck[t]},wo=(e,n,t)=>{const o=Co(e,n.position);return o?(h(e,`${n.name} searched (${t}) and found ${o.name}`),o.found=!0,!0):!1},Wn=(e,n)=>(Kn[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:ae.APPRENTICE,health:7,maxHealth:7,colour:n,experience:0,position:{x:-1,y:-1},weapon:Kn[0],incapacitated:!1,inventory:[]}),le=(e,n)=>{n.reRender=!0;const t=n.currentActor;if(!t||t.actions===0)return;const o={x:t.position.x,y:t.position.y};switch(e){case"UL":o.x=t.position.x-1,o.y=t.position.y-1;break;case"U":o.y=t.position.y-1;break;case"UR":o.x=t.position.x+1,o.y=t.position.y-1;break;case"L":o.x=t.position.x-1;break;case"R":o.x=t.position.x+1;break;case"DL":o.x=t.position.x-1,o.y=t.position.y+1;break;case"D":o.y=t.position.y+1;break;case"DR":o.x=t.position.x+1,o.y=t.position.y+1;break}const r=Bn(n,o.x,o.y),s=!Zn(n.dungeon.layout,o.x,o.y),i=Pn(n,o.x,o.y);if(!r&&!s){const a=$n(n.dungeon,o.x,o.y);a?a&&(i?Qt(t,n,o):St(t,n,o.x,o.y,1)):No(n,t,o.x,o.y)&&In(t,n,o.x,o.y)}else h(n,`${t.name} could not make that move`);Vt(n)||ot(t)},zn=e=>{e.reRender=!0;const n=e.currentActor;if(!n)return;if(n.blinded){h(e,`${n.name} is blinded and may not search.`);return}if(!Tn(n)){h(e,`${n.name} has no actions left to pick lock`);return}const t=e.dungeon.layout.doors.find(o=>o.x===n.position.x&&o.y===n.position.y);t&&t.locked&&(Cn(n.level,1)>=1?(t.locked=!1,h(e,`${n.name} managed to pick the lock`)):h(e,`${n.name} failed to pick the lock`),n.actions>1&&n.movement<3?n.actions-=2:n.actions--,n.movement=je(n),n.actions==0&&(n.movement=0))},jt=e=>{e.reRender=!0,e.heroes.forEach((n,t)=>{n.position=e.dungeon.startingPositions[t],n.movement=je(n),n.actions=2,n.health=n.maxHealth})},B=e=>e.heroes.filter(n=>n.health>0),vt=e=>{e.reRender=!0;const n=e.currentActor;n&&(n.actions--,n.movement=je(n),n.actions===0&&Fn(e))},Tn=e=>e.movement<je(e)?e.actions>1:e.actions>0,In=(e,n,t,o)=>{n.reRender=!0;const r=Fe(n.dungeon.layout.grid,t,o);r&&n.dungeon.discoveredRooms.push(r),St(e,n,e.position.x,e.position.y,1),h(n,`${e.name} opened a door`)},Qt=(e,n,t)=>{if(n.reRender=!0,e.actions===1&&e.movement<e.maxMovement){h(n,`${e.name} has no actions left to attack`);return}if(!e.weapon.useHearHeroes&&$o(n,e)){h(n,`${e.name} could not use ${e.weapon.name} near a friend.`);return}const o=Uo(n,t);o&&(cn(n,e,o,!1),o.health<=0&&Bo(n,o,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},et=e=>{e.reRender=!0;const n=e.currentActor;if(n){if(n.blinded){h(e,`${n.name} is blinded and may not search.`);return}if(!Tn(n)){h(e,`${n.name} has no actions left to search`);return}_o(e),n.actions>1&&n.movement<je(n)?n.actions-=2:n.actions--,n.actions==0&&(n.movement=0)}},Pn=(e,n,t)=>e.dungeon.layout.monsters.some(o=>o.position.x===n&&o.position.y===t&&o.health>0),Bn=(e,n,t)=>B(e).some(o=>o.position.x===n&&o.position.y===t),ot=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=je(e))),e.actions==0&&(e.movement=0)},xo=e=>{e.reRender=!0,B(e).forEach(n=>{const t=n.level;n.experience>=28?n.level=ae.MASTER:n.experience>=18?n.level=ae.LORD:n.experience>=10?n.level=ae.HERO:n.experience>=4&&(n.level=ae.KNIGHT),t!==n.level&&h(e,`${n.name} leveled up to ${n.level}`)})},Ho=e=>{B(e).forEach(n=>n.experience+=4)},Lo=e=>{Go(e).forEach(n=>{n.experience=0,n.health=n.maxHealth,n.movement=n.maxMovement,n.actions=2})},Zt=(e,n,t)=>!t.open&&!t.hidden&&(!t.locked||t.locked&&n)&&e.movement>0,Jt=(e,n)=>{const t=e.dungeon.layout.notes.find(o=>Qe(o.position,n.position));t&&(e.dungeon.layout.doors.some(r=>r.hidden&&Qe(t.position,{x:r.x,y:r.y}))||h(e,`${n.name} reads: ${t.message}`))},St=(e,n,t,o,r)=>{e.position.x=t,e.position.y=o,Jt(n,e),n.dungeon.layout.monsters.some(i=>Gn(e.position,i.position.x,i.position.y))?(h(n,`${e.name} walked by a monster and lost the momentum`),e.movement=0):e.movement-=r},No=(e,n,t,o)=>{const r=e.dungeon.layout.doors.find(i=>i.x===n.position.x&&i.y===n.position.y),s=n.inventory.some(i=>{var a;return(a=i.properties)==null?void 0:a[zt]});if(r&&Zt(n,s,r)){r.locked&&s&&h(e,`${n.name} broke the locked door`);const i=Po(n.position.x,n.position.y,t,o);if(r.side===i)return r.open=!0,r.trapped&&cn(e,uo(r),n,!1),!0}return r&&r.locked&&h(e,"Door is locked"),!1},Po=(e,n,t,o)=>{if(e===t){if(n>o)return A.UP;if(n<o)return A.DOWN}if(n===o){if(e>t)return A.LEFT;if(e<t)return A.RIGHT}},Bo=(e,n,t)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(o=>o!=n),h(e,`${t.name} killed ${n.name}`),e.dungeon.killCount++,t.experience+=n.experience},Uo=(e,n)=>e.dungeon.layout.monsters.find(t=>Qe(t.position,n)),$o=(e,n)=>fo(e,n).filter(t=>t!==n).length>0,Go=e=>e.heroes.filter(n=>n.health<=0),Ge="USED",yt="ATTACK_BONUS",kt="SEARCH_BONUS",zt="BREAK_LOCK",_t="RE_ROLL_ATTACK",Et="DESCRIPTION",Vn="ACTIVE",qn="MOVEMENT_BONUS",At="ACTIONS_BONUS",eo="RESET_ON",no="NEXT_TURN",Wo="TRADE",to="NEXT_SCENARIO",We=[{name:"Healing Herbs",type:U.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"Chance to heal up to 3 wounds on one hero.",RESET_ON:[Wo,to]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"Thousand League Boots",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives one additional step for each move action.",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"Giants Glove",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional attack die. Breaks locked doors.",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"Ring of Precision",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"May re-roll one completely missed attack.",RE_ROLL_ATTACK:!0}},{name:"Crown of Wisdom",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional die roll when searching.",SEARCH_BONUS:1}},{name:"Sword of Chaos",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"A sword with a will of it's own. Use at your own peril."},effect:"chaosSwordOnUse"},{name:"Potion of Speed",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives 2 additional actions. Can only be used once.",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"Necklace of Light",type:U.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[no],ACTIVE:!0},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],rt={movementBonusOnPickup:(e,n,t)=>{var o,r;t.maxMovement+=(o=n.properties)==null?void 0:o[qn],t.movement+=(r=n.properties)==null?void 0:r[qn]}},Fo={movementBonusOnDrop:(e,n,t)=>{var o,r;t.maxMovement-1>0&&(t.maxMovement-=(o=n.properties)==null?void 0:o[qn]),t.movement-1>=0&&(t.movement-=(r=n.properties)==null?void 0:r[qn])}},Ko={magicHerbsOnUse:(e,n,t,o)=>{if(n.disabled){h(e,`${n.name} cannot be used at this moment.`);return}if(!o){h(e,"No target was selected.");return}if(!Tn(t)){h(e,`${t.name} has no actions left.`);return}if(n.properties){if(n.properties[Ge]){h(e,`${n.name} has no uses left.`);return}n.properties[Ge]=!0;let r=Math.min(Cn(t.level,3),o.maxHealth-o.health);o.health+=r,h(e,`${t.name} used ${n.name} on ${o.name}, restoring ${r} HP`),t.actions--,t.movement=t.maxMovement}},chaosSwordOnUse:(e,n,t,o)=>{if(n.disabled){h(e,`${n.name} cannot be used at this moment.`);return}},potionOfSpeedOnUse:(e,n,t)=>{var o,r,s;if(n.disabled){h(e,`${n.name} cannot be used at this moment.`);return}(o=n.properties)!=null&&o[Ge]?h(e,`${n.name} has been consumed.`):(t.actions+=(r=n.properties)==null?void 0:r[At],n.properties&&(n.properties[Ge]=!0),h(e,`${t.name} used ${n.name}, adding ${(s=n.properties)==null?void 0:s[At]} actions`))},necklaceOfLightOnUse:(e,n,t,o)=>{var r;if(n.disabled){h(e,`${n.name} cannot be used at this moment.`);return}if(!o){h(e,"No target was selected.");return}if(!Tn(t)){h(e,`${t.name} has no actions left.`);return}n.properties&&!((r=n.properties)!=null&&r[Ge])&&(n.properties[Ge]=!0,o.ignoredByMonsters=!0,t.actions--)}},oo={magicHerbsOnReset:(e,n)=>{n.properties&&(n.properties[Ge]=!1)},necklaceOfLightOnUse:(e,n)=>{n.properties&&(n.properties[Ge]=!1),e.heroes.forEach(t=>t.ignoredByMonsters=!1)}},ro={name:"The Mines of Evil",beaten:!1,winConditions:[{type:Oe.KILL_ALL,fulfilled:!1},{type:Oe.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[q(A.UP,2,13),q(A.UP,2,10),q(A.RIGHT,3,8),Sn(A.RIGHT,6,8),q(A.UP,8,7),q(A.UP,8,4),Hn(A.LEFT,7,2),q(A.LEFT,4,2),Sn(A.RIGHT,12,2),q(A.RIGHT,15,2),q(A.DOWN,17,7),q(A.DOWN,17,10),Hn(A.DOWN,17,14)],monsters:[ie(F.TROLL,$.Red,3,7),ie(F.ORCH,$.Red,12,8),ie(F.ORCH,$.Green,11,1),ie(F.TROLL,$.Green,2,2),ie(F.ORCH,$.Yellow,18,7),ie(F.TROLL,$.Yellow,17,10)],secrets:[Xe(oe.EQUIPMENT,"Equipment",1,3),Xe(oe.EQUIPMENT,"Equipment",3,3),Xe(oe.EQUIPMENT,"Equipment",15,2),Yn(oe.MAGIC_ITEM,2,3,We[1]),Yn(oe.MAGIC_ITEM,16,11,We[6])],notes:[{message:"Guard room",position:{x:2,y:10}},{message:"Look in the pillar room for the armory of the dwarf king",position:{x:8,y:10}},{message:"To reach the treasure of the ice dragon, look behind the mirror in the alchemy laboratory.",position:{x:2,y:3}},{message:"A large mirror decorates the far wall of this room.",position:{x:17,y:11}}],items:[]},killCount:0},so={name:"The Three Gates of Power",nextDungeon:ro,beaten:!1,winConditions:[{type:Oe.KILL_ALL,fulfilled:!1},{type:Oe.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[q(A.RIGHT,3,5),q(A.RIGHT,6,5),q(A.RIGHT,10,6),q(A.RIGHT,13,6),q(A.RIGHT,10,9),q(A.RIGHT,13,9),q(A.RIGHT,12,3),Hn(A.UP,9,4),Hn(A.RIGHT,15,2)],monsters:[ie(F.ORCH,$.Blue,10,8),ie(F.ORCH,$.Red,13,9),ie(F.TROLL,$.Red,16,2),ie(F.TROLL,$.Yellow,14,7)],secrets:[Xe(oe.EQUIPMENT,"Random Equipment",10,5),Xe(oe.EQUIPMENT,"Random Equipment",13,1),Xe(oe.EQUIPMENT,"Random Equipment",16,10),Yn(oe.MAGIC_ITEM,16,6,We[0])],notes:[{message:"Beyond stone and fire you shall find the Dread tunnel, the road to the Ice Dragons treasure.",position:{x:2,y:4}},{message:"The Gate of Water. <There is an image of a sea dragon under the text>",position:{x:9,y:8}},{message:"The Gate of Air. <There is an image of a pegasus under the text>",position:{x:9,y:5}},{message:"The Gate of Fire. <There is an image of a hippogriph under the text>",position:{x:9,y:3}}],items:[]},killCount:0},io={name:"Troll cave",beaten:!1,winConditions:[{type:Oe.KILL_ALL,fulfilled:!1}],nextDungeon:so,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[q(A.RIGHT,3,9),q(A.RIGHT,6,9),q(A.UP,7,7),q(A.UP,7,4)],monsters:[ie(F.ORCH,$.Green,6,9),ie(F.ORCH,$.Yellow,8,10),ie(F.ORCH,$.Red,7,5),ie(F.ORCH,$.Red,9,3),ie(F.TROLL,$.Green,6,1)],secrets:[Xe(oe.NOTE,"Welcome to Drakriddarna",3,9)],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},Yo=[{name:"Large shield",type:U.SHIELD,amountInDeck:2,dice:2,value:2},{name:"Small shield",type:U.SHIELD,amountInDeck:2,dice:1,value:1}],Vo=()=>{const e=[];return We.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),e},qo=()=>{const e=[];return Kn.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),vo.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),Yo.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),e},on={name:"Treasure of the Ice Dragon",dungeons:[io,so,ro],itemDeck:qo(),magicItemDeck:Vo(),heroes:[Wn("Fearik",$.Yellow),Wn("Helbran",$.Red),Wn("Siedel",$.Green),Wn("Wulf",$.Blue)]},Xo=e=>{const n=So(e);n.length===0&&h(e,"No monsters can act"),n.forEach(t=>{const o=t.actions;for(h(e,`${t.name} acted `);t.actions>0;){e.reRender=!0;const r=fo(e,t).filter(a=>!a.ignoredByMonsters),s=Jo(e,t);switch(jo(e,t,r,s)){case"MELEE_ATTACK":{const a=Zo(r);bt(e,t,a,!1);break}case"RANGED_ATTACK":{const a=Qo(s,t);bt(e,t,a,!0);break}case"MOVE":{er(e,t);break}}t.movement=je(t)}t.actions=o,t.movement=je(t)})},jo=(e,n,t,o)=>t.length>0?"MELEE_ATTACK":n.rangedWeapon&&o.length>0&&n.rangedWeapon?Math.random()<.1?(h(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"RANGED_ATTACK":"MOVE",Qo=(e,n)=>e.filter(t=>!t.shield).sort(t=>xn(n.position,t.position)).sort((t,o)=>o.health-t.health||xn(n.position,t.position)-xn(n.position,o.position))[0],Zo=e=>e.sort((n,t)=>t.health-n.health)[0],Jo=(e,n)=>B(e).filter(t=>!t.ignoredByMonsters).filter(t=>st(n.position,t.position,48,e,!1)),So=e=>e.dungeon.layout.monsters.filter(n=>{const t=Fe(e.dungeon.layout.grid,n.position.x,n.position.y);return t&&Se(e.dungeon,t)&&n.health>0}),bt=(e,n,t,o)=>{cn(e,n,t,o),(n==null?void 0:n.actions)>1&&(n==null?void 0:n.movement)<3?n.actions-=2:n.actions--},zo=(e,n)=>B(e).map(t=>({hero:t,dist:xn(t.position,n.position)})).sort((t,o)=>t.dist-o.dist)[0],er=(e,n)=>{const t=zo(e,n);for(;n.movement>0;){if(t.dist>1){const o=nr(e,n.position);if(o.length>0){const r=o.map(s=>({pos:s,dist:xn(s,t.hero.position)})).sort((s,i)=>s.dist-i.dist)[0].pos;n.position=r,h(e,`${n.name} moved towards ${t.hero.name} (${r.x},${r.y})`)}else h(e,`${n.name} could not move`)}n.movement--}n.actions--},nr=(e,n)=>{const t=n.x,o=n.y,r=[];for(let s=t-1;s<=t+1;s++)for(let i=o-1;i<=o+1;i++)s===t&&i===o||Zn(e.dungeon.layout,s,i)&&$n(e.dungeon,s,i)&&r.push({x:s,y:i});return r.filter(s=>!B(e).find(i=>i.position.x===s.x&&i.position.y===s.y)).filter(s=>!e.dungeon.layout.monsters.some(i=>i.position.x===s.x&&i.position.y===s.y))},tr=(e,n)=>{if(n.effect&&e.currentActor){const t=Ko[n.effect];t(e,n,e.currentActor,e.targetActor),e.targetActor=void 0}},or=e=>{e.heroes.forEach(n=>{n.inventory.filter(t=>ir(t)).forEach(t=>{if(t.reset){const o=oo[t.reset];o(e,t)}})})},rr=e=>{e.heroes.forEach(n=>{n.inventory.filter(t=>sr(t)).forEach(t=>{if(t.reset){const o=oo[t.reset];o(e,t)}})})},sr=e=>e.properties?(e.properties[eo]??[]).some(t=>t===no):!1,ir=e=>e.properties?(e.properties[eo]??[]).some(t=>t===to):!1,Tt=[{name:"The Hungry Troll",number:1,description:"You suddenly hear a terrible roar echo in the halls behind you. It's the sound of a hungry troll",effect:"theHungryTroll",used:!1},{name:"The Sun Stone",number:2,description:"One of you kicks a pile of rubble, revealing a small, transparent crystal. It radiates a warm, yellow light turning all nearby trolls to stone.",effect:"sunStone",used:!1},{name:"The Time Portal",number:3,description:"You notice how everything around you seem to move slower, as if time it self had slowed down.",effect:"timePortal",used:!1},{name:"The Fountain of Youth",number:4,description:"You hear the weak sound of water running from a wall. When you taste it, you feel stronger than before",effect:"fountainOfYouth",used:!1},{name:"Sleeping Gas Cloud",number:5,description:"Noxious gas seeps through a hole in the wall, making you feel heavy and sleepy.",effect:"sleepingGasCloud",used:!1},{name:"The Lost Orch",number:6,description:"You hear a snarling filled with rage somewhere behind you. You quickly realise there were more monsters here than you thought.",effect:"theLostOrch",used:!1},{name:"The Dragons Breath",number:7,description:"The flames of your torches start to flicker and soon the dungeon is completely dark.",effect:"theDragonsBreath",used:!1},{name:"Landslide",number:8,description:"The ground starts shaking, and you hear a loud crash, as if the ceiling had fallen down.",effect:"landslide",used:!1},{name:"The Magic Node",number:9,description:"You feel a strange, powerful magic course through you. You feel invigorated by it as you press on.",effect:"fountainOfYouth",used:!1},{name:"Foresight",number:10,description:"You see before you a powerful object, hidden behind thick walls.",effect:"foresight",used:!1},{name:"Earthquake",number:11,description:"The whole room starts shaking and you are thrown to the ground. Stones fall from the ceiling and walls and with terror you realise that you ar caught in an earhtquake.",effect:"earthquake",used:!1},{name:"The Magic Storm",number:12,description:"An unsettling wind blows through the dungeon. You freeze as a green glow emanates from one of your magical items",effect:"theMagicStorm",used:!1},{name:"The Elemental Weapon",number:13,description:"A flame suddenly shoots from a silver clad stone in the ceiling, moving towards one of your weapons. The weapon becomes engulfed in flames, feeling more powerful than before.",effect:"theElementalWeapon",used:!1},{name:"The Orch Drums",number:14,description:"You hear the sound of drums from deep below you. As the sound draws nearer, you realise the orchs are on the march.",effect:"theOrchDrums",used:!1},{name:"The Symbol of Weakness",number:15,description:"You walk past a strange symbol on the wall. An evil, yellow glow emanates from it. All of you suddenly feel weaker.",effect:"theSymbolOfWeakness",used:!1}],ao=e=>e.events?nt(Tt.filter(n=>{var t;return(t=e==null?void 0:e.events)==null?void 0:t.includes(n.number)})):nt(Tt),lo=e=>{const n=e.eventDeck.filter(t=>!t.used);return n.length>0?n[0]:(nt(e.eventDeck),lo(e))},ar={sunStone:(e,n)=>{ke(e,n);const t=B(e).length-1,o=Math.floor(Math.random()*t),r=B(e)[o],s=Fe(e.dungeon.layout.grid,r.position.x,r.position.y);e.dungeon.layout.monsters.filter(i=>i.type===F.TROLL).filter(i=>Fe(e.dungeon.layout.grid,i.position.x,i.position.y)===s).forEach(i=>{h(e,`${i.name} was killed by the Sun Stone`),i.health=0}),n.used=!0},theHungryTroll:(e,n)=>{ke(e,n),Ct(e,F.TROLL),n.used=!0},timePortal:(e,n)=>{ke(e,n),e.heroes.forEach(t=>t.actions++),n.used=!0},fountainOfYouth:(e,n)=>{ke(e,n),B(e).forEach(t=>{if(t.health<t.maxHealth){const o=Cn(t.level,3);t.health+=Math.min(o,t.maxHealth-t.health)}}),n.used=!0},sleepingGasCloud:(e,n)=>{ke(e,n),B(e).forEach(t=>{t.actions=Math.max(1,t.actions-1)}),n.used=!0},theLostOrch:(e,n)=>{ke(e,n),Ct(e,F.ORCH),n.used=!0},theDragonsBreath:(e,n)=>{ke(e,n),B(e).forEach(t=>t.blinded=!0),n.used=!0},landslide:(e,n)=>{ke(e,n);const t=e.dungeon.layout.corridors.filter(i=>!hr(e,i)).filter(i=>Se(e.dungeon,i)),o=t.length-1,r=Math.floor(Math.random()*o),s=t[r];e.dungeon.collapsedCorridor=s,e.dungeon.layout.grid=e.dungeon.layout.grid.map(i=>i.replaceAll(s,Nn)),n.used=!0},foreSight:(e,n)=>{if(ke(e,n),e.dungeon.layout.secrets.filter(o=>o.type===oe.EQUIPMENT||o.type===oe.MAGIC_ITEM).filter(o=>!o.found).filter(o=>o.item).filter(o=>{const r=Fe(e.dungeon.layout.grid,o.position.x,o.position.y)??"";return!Se(e.dungeon,r)}).length>0){const o=e.dungeon.layout.secrets.pop();o&&o.item&&(h(e,`You sense the object is close to (${o.position.x+2},${o.position.y-1})`),e.dungeon.layout.items.push({item:o.item,position:o.position}))}n.used=!0},earthquake:(e,n)=>{ke(e,n);const t=co(e),o={name:"boulder",type:U.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},r={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:o,level:ae.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:$.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(s=>s.type===F.TROLL).filter(s=>Fe(e.dungeon.layout.grid,s.position.x,s.position.y)===t).forEach(s=>cn(e,r,s,!1)),B(e).filter(s=>Fe(e.dungeon.layout.grid,s.position.x,s.position.y)===t).forEach(s=>cn(e,r,s,!1)),n.used=!0},theMagicStorm:(e,n)=>{var o;ke(e,n);const t=B(e).filter(r=>r.inventory.filter(s=>!s.disabled).some(s=>s.type===U.MAGIC));if(t.length>0){const r=t.length-1,s=Math.floor(Math.random()*r),i=t[s],a=i.inventory.filter(l=>l.type===U.MAGIC);if(a.length>0){const l=a.length-1,u=Math.floor(Math.random()*l),p=a[u];p.disabled=!0,!((o=p.properties)!=null&&o[Vn])&&p.pickup&&p.drop&&Fo[p.drop](e,p,i)}}n.used=!0},theElementalWeapon:(e,n)=>{ke(e,n);const t=B(e),o=t.length-1,r=Math.floor(Math.random()*o),s=t[r];s.weapon.elemental=!0,n.used=!0},theOrchDrums:(e,n)=>{ke(e,n),e.dungeon.layout.monsters.filter(t=>t.type===F.ORCH).forEach(t=>t.actions=3),n.used=!0},theSymbolOfWeakness:(e,n)=>{ke(e,n),B(e).forEach(t=>t.weakened=!0),n.used=!0}},lr=e=>{B(e).some(n=>n.weapon.elemental)&&(h(e,"The magic storm calmed down"),B(e).forEach(n=>{n.inventory.forEach(t=>{var o;!((o=t.properties)!=null&&o[Vn])&&t.pickup&&rt[t.pickup](e,t,n),t.disabled=!1})}))},cr=e=>{e.eventDeck.filter(t=>!t.used).length===0&&(fr(e),ur(e),lr(e)),mr(e),dr(e)},ur=e=>{const n=e.dungeon.collapsedCorridor;n&&(h(e,"The collapsed corridor cleared up."),e.dungeon.layout.grid=e.dungeon.layout.grid.map(t=>t.replaceAll(Nn,n)),e.dungeon.collapsedCorridor=void 0)},dr=e=>{B(e).some(n=>n.blinded)&&(h(e,"You light your torches again."),B(e).forEach(n=>n.blinded=!1))},fr=e=>{B(e).some(n=>n.weapon.elemental)&&(h(e,"The elemental magic died off."),B(e).forEach(n=>n.weapon.elemental=!1))},mr=e=>{B(e).some(n=>n.weakened)&&(h(e,"Your strength returns to you."),B(e).forEach(n=>n.weakened=!1))},co=e=>{const n=e.dungeon.discoveredRooms.length-1,t=Math.floor(Math.random()*n);return e.dungeon.discoveredRooms[t]},Ct=(e,n)=>{const t=e.dungeon.layout.monsters.filter(a=>a.type===n);if(t.length===4)return;const r=co(e),s=[$.Red,$.Green,$.Yellow,$.Blue];t.forEach(a=>{const l=s.indexOf(a.colour);l!==-1&&s.splice(l,1)});let i=!1;for(let a=0;a<e.dungeon.layout.grid.length;a++){const l=Un(e.dungeon.layout.grid[a]);for(let u=0;u<l.length;u++)if(l[u]===r&&!Bn(e,u,a)&&!Pn(e,u,a)){e.dungeon.layout.monsters.push(ie(n,s[0],u,a)),i=!0;break}if(i)break}},ke=(e,n)=>{h(e,`${n.description}`),h(e,`${n.number}. ${n.name}`)},nt=e=>{let n=e.length,t;for(;n>0;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e.forEach(o=>o.used=!1),e},hr=(e,n)=>{const t=[];return e.dungeon.layout.grid.forEach((o,r)=>{Un(o).forEach((s,i)=>{s===n&&t.push(Bn(e,i,r)||Pn(e,i,r))})}),t.some(o=>o)};Oe.KILL_ALL,ko(A.UP,3,8,1),Sn(A.LEFT,7,6),yo(A.UP,7,7,1),q(A.UP,7,4),Hn(A.DOWN,2,10),ie(F.ORCH,$.Green,1,1),ie(F.TROLL,$.Green,5,1),Xe(oe.TRAP_DOOR,"Welcome to Drakriddarna",3,9),Xe(oe.EQUIPMENT,"Random Equipment",1,10),Yn(oe.EQUIPMENT,5,10,Kn[2]),We[0],We[1],We[6],We[2],We[3],We[4];const Dt=e=>{e.reRender=!0,h(e,"Game saved."),localStorage.setItem("state",JSON.stringify(e))},Rt=()=>{const e=localStorage.getItem("state");if(e){const n=JSON.parse(e);return n.currentActor=n.heroes.find(t=>{var o;return t.name===((o=n.currentActor)==null?void 0:o.name)}),h(n,"Game loaded."),n.reRender=!0,n}},pr=()=>{const e={heroes:on.heroes,dungeon:on.dungeons[0],currentActor:on.heroes[0],actionLog:[`Playing '${on.name}'`,"Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."],itemDeck:It(on.itemDeck),magicItemDeck:It(on.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:ao(on.dungeons[0]),reRender:!0};return jt(e),e},It=e=>{let n=e.length,t;for(;n>0;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e},Un=e=>{let n=[];for(let t=0;t<e.length;t++)n.push(e[t]);return n},Cn=(e,n)=>{let t=[];for(let o=0;o<n;o++)t.push(Math.floor(Math.random()*6)+1);switch(e){case ae.APPRENTICE:t=t.filter(o=>o===5);break;case ae.KNIGHT:case ae.HERO:t=t.filter(o=>o>=4);break;case ae.LORD:case ae.MASTER:t=t.filter(o=>o>=3);break}return t.length},je=e=>{var n;return e.maxMovement-(((n=e.armour)==null?void 0:n.movementReduction)??0)},Fn=e=>{if(e.reRender=!0,gr(e),e.currentActor!==void 0){h(e,`${e.currentActor.name} ended their turn`);let t=B(e).indexOf(e.currentActor)+1;if(t===B(e).length&&(Xo(e),t=0,rr(e)),B(e)[t].incapacitated&&(h(e,`${B(e)[t].name} is no longer incapacitated.`),B(e)[t].incapacitated=!1,t++),e.currentActor.actions=2,e.currentActor.movement=je(e.currentActor),e.currentActor=B(e)[t],t===0){cr(e);const o=lo(e);ar[o.effect](e,o)}h(e,`${e.currentActor.name} started their turn`)}},gr=e=>{var n;e.dungeon.winConditions.forEach(t=>{var o;switch(t.type){case Oe.KILL_ALL:{const r=e.dungeon.layout.monsters.map(s=>s.health).reduce((s,i)=>s+i,0);t.fulfilled=r<=0;break}case Oe.REACH_CELL:{t.fulfilled=B(e).some(r=>{var s;return r.position.x===((s=t.targetCell)==null?void 0:s.x)&&r.position.y===t.targetCell.y});break}case Oe.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(r=>r.type===t.targetMonsterType).some(r=>r.health>0);break}case Oe.OPEN_DOOR:{t.fulfilled=((o=e.dungeon.layout.doors.find(r=>{var s,i;return r.x===((s=t.targetCell)==null?void 0:s.x)&&r.y===((i=t.targetCell)==null?void 0:i.y)}))==null?void 0:o.open)??!1;break}case Oe.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,o)=>t&&o,!0),e.dungeon.beaten&&(h(e,"All win conditions have been fulfilled"),h(e,`You have cleared ${e.dungeon.name}`),h(e,`Press 'Next' to move on to the next level: ${(n=e.dungeon.nextDungeon)==null?void 0:n.name}`))},uo=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:$.Red,maxHealth:0,name:"Door",level:ae.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:U.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),Zn=(e,n,t)=>{var r,s;let o=!0;if(n<0||n>=e.grid[0].length||t<0||t>=e.grid.length)o=!1;else{const i=(r=e.pits)==null?void 0:r.some(u=>Qe(u,{x:n,y:t})),a=(s=e.pillars)==null?void 0:s.some(u=>Qe(u,{x:n,y:t})),l=Fe(e.grid,n,t);(i||a||l===jn||l===Qn)&&(o=!1)}return o},$n=(e,n,t)=>{const o=Fe(e.layout.grid,n,t);return o?Se(e,o):!1},Se=(e,n)=>e.discoveredRooms.includes(n),Fe=(e,n,t)=>{let o="";return e.forEach((r,s)=>{Un(r).forEach((i,a)=>{s===t&&a===n&&(o=i)})}),o},Gn=(e,n,t)=>e.x===n&&e.y===t||e.x===n-1&&e.y===t||e.x===n-1&&e.y===t-1||e.x===n&&e.y===t-1||e.x===n+1&&e.y===t-1||e.x===n+1&&e.y===t||e.x===n+1&&e.y===t+1||e.x===n&&e.y===t+1||e.x===n-1&&e.y===t+1,vr=(e,n,t,o)=>{var s;const r=((s=o.armour)==null?void 0:s.defense)??o.defense;return`${e} damage (${n}-(${r}+${t})=${e})`},Qe=(e,n)=>e.x===n.x&&e.y===n.y,h=(e,n)=>{e.actionLog=[n,...e.actionLog],e.reRender=!0},cn=(e,n,t,o)=>{var y,H;let r=n.weapon;o&&n.rangedWeapon&&(r=n.rangedWeapon);let s=0,i=0;r.ignoresArmour?t.armour&&h(e,`${t.name}'s armour was useless against ${r.name} `):s=((y=t.armour)==null?void 0:y.defense)??t.defense,r.ignoresShield?t.shield&&h(e,`${t.name}'s shield was useless against ${r.name} `):i=Cn(t.level,((H=t.shield)==null?void 0:H.dice)??0);const a=n.inventory.filter(R=>{var _;return(_=R==null?void 0:R.properties)==null?void 0:_[_t]}).some(R=>{var _;return h(e,`${n.name} used the effect of ${R.name} when attacking`),(_=R.properties)==null?void 0:_[_t]}),l=n.inventory.filter(R=>{var _;return(_=R==null?void 0:R.properties)==null?void 0:_[yt]}).map(R=>{var _;return h(e,`${n.name} used the effect of ${R.name} when attacking`),(_=R.properties)==null?void 0:_[yt]}).reduce((R,_)=>R+_,0);let u=n.blinded?1:0,p=n.weakened?1:0,b=n.weapon.elemental?1:0;const g=l+b,k=u+p,D=Cn(n.level,r.dice+g-k);let C=Math.max(D-(s+i),0);C===0&&a&&(h(e,`${n.name} missed but got another chance`),C=Math.max(D-(s+i),0)),t.health-=C,h(e,`${n.name} attacked ${t.name} with ${r.name} for ${vr(C,D,i,t)}`),t.health<=0&&(h(e,`${n.name} killed ${t.name}`),t.health=0,t.level=ae.APPRENTICE)},yr=(e,n)=>{const t=document.getElementById("gameBoardContainer"),o=document.getElementById("gameBoard");if(t&&o){const r=e.x*n,s=e.y*n,i=o.offsetWidth,a=o.offsetHeight;t.scrollLeft=Math.round(r/i),t.scrollTop=Math.round(s/a),console.log(`scrolling to ${t.scrollLeft} x ${t.scrollTop}`)}},kr=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=["You have reached "+e.dungeon.name],e.eventDeck=ao(e.dungeon),e.reRender=!0,Ho(e),xo(e),Lo(e),jt(e),or(e),yr({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize))},xn=(e,n)=>Math.sqrt(Math.pow(e.x-(n==null?void 0:n.x),2)+Math.pow(e.y-(n==null?void 0:n.y),2)),st=(e,n,t,o,r)=>{const s={x:e.x*t-Math.floor(t/2),y:e.y*t-Math.floor(t/2)},i={x:n.x*t-Math.floor(t/2),y:n.y*t-Math.floor(t/2)};return it(s,e,i,n,t,o,r,[])},it=(e,n,t,o,r,s,i,a)=>{var k,D;const l=_r(e,t),u={x:Math.round((l.x+Math.floor(r/2))/r),y:Math.round((l.y+Math.floor(r/2))/r)},p=Fe(s.dungeon.layout.grid,u.x,u.y),b=(k=s.dungeon.layout.pits)==null?void 0:k.some(C=>Qe(C,u)),g=(D=s.dungeon.layout.pillars)==null?void 0:D.some(C=>Qe(C,u));return u.x===o.x&&u.y===o.y?(a.push(u),!0):p===Qn||g||p===Nn||i&&(b||p===jn)?!1:(u.x===n.x&&u.y===n.y||a.some(C=>C.x===u.x&&C.y===u.y)||a.push(u),it(l,n,t,o,r,s,i,a))},_r=(e,n)=>{const t=e.x,o=e.y,r=n.x-t,s=n.y-o,i=r/Math.pow(Math.pow(r,2)+Math.pow(s,2),1/2),a=s/Math.pow(Math.pow(r,2)+Math.pow(s,2),1/2);let l=Math.round(i+t),u=Math.round(a+o);return{x:l,y:u}},fo=(e,n)=>B(e).filter(t=>Gn(n.position,t.position.x,t.position.y)),Er=""+new URL("../assets/Dungeon_Tileset.be5b0045.png",import.meta.url).href,Ar="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",br=(e,n)=>{const t=Math.abs(n.x-e.x),o=Math.abs(n.y-e.y),r=Math.min(t,o),s=Math.max(t,o),i=r,a=s-r;let l=Math.sqrt(2);return a===0&&(l=1),Math.floor(l*i+a)},Tr=(e,n)=>{e.reRender=!0;const t=e.currentActor,o=e.dungeon.layout.items.find(s=>Qe(s.position,t.position));if(o){const s=o.item;s.type===U.MAGIC?Xt(e,s):qt(e,s);const i=e.dungeon.layout.items.indexOf(o);if(e.dungeon.layout.items.splice(i,1),h(e,`${t.name} picked up ${s.name}`),t.inventory.push(s),s.pickup){const a=rt[s.pickup];a(e,s,t)}return}const r=e.dungeon.layout.doors.find(s=>s.x===t.position.x&&s.y===t.position.y);if(r&&!r.hidden){const s=t.inventory.some(i=>{var a;return(a=i.properties)==null?void 0:a[zt]});if(Zt(t,s,r)){switch(r.locked&&s&&h(e,`${t.name} broke the locked door`),r.open=!0,r.trapped&&cn(e,uo(r),t,!1),r.side){case A.RIGHT:In(t,e,n.x+1,n.y);break;case A.LEFT:In(t,e,n.x-1,n.y);break;case A.DOWN:In(t,e,n.x,n.y+1);break;case A.UP:In(t,e,n.x,n.y-1);break}ot(t)}else if(r.locked&&!r.hidden){if(!Tn(t)){h(e,`${t.name} has no actions left`);return}h(e,"Door is locked"),zn(e)}}else{if(!Tn(t)){h(e,`${t.name} has no actions left`);return}et(e)}},Cr=(e,n)=>{e.reRender=!0;const t=e.currentActor;if(t.actions===0){h(e,`${t.name} has no actions left`);return}if(Zn(e.dungeon.layout,n.x,n.y)){const r=Bn(e,n.x,n.y),s=Pn(e,n.x,n.y),i=br(t.position,n),a=st(t.position,n,2,e,!0);if(!r&&!s&&i<=t.movement&&a){if(t.position=n,t.movement-=i,Jt(e,t),Vt(e))return}else s&&(i<=t.weapon.range?Qt(t,e,n):h(e,"Monster is out of range"))}ot(t)},Dr=(e,n,t)=>{const o=document.getElementById("gameBoard");if(!o)return;const r=o.getBoundingClientRect(),s=Math.min(Math.floor((e.clientX-r.left)/n),t.dungeon.layout.grid[0].length-1),i=Math.min(Math.floor((e.clientY-r.top)/n),t.dungeon.layout.grid.length-1),a=t.dungeon.layout.grid[i][s],l=t.currentActor;s===l.position.x&&i===l.position.y?Tr(t,{x:s,y:i}):Se(t.dungeon,a)&&Cr(t,{x:s,y:i})},Rr=(e,n,t,o,r)=>{B(o).forEach(i=>{Ir(e,i,n,t,r)}),xr(e,o,t),Hr(e,o,t)},Ir=(e,n,t,o,r)=>{const s=n.position.x,i=n.position.y;if(e.drawImage(t,4*16,0,16,16,s*o,i*o,o,o),Or(e,n,s,i,o),wr(e,n,s,i,o),Mr(e,n,s,i,o),r){const a=`(${s},${i})`;e.fillStyle="black",e.font="8px Arial",e.fillText(a,s*o+3,i*o+10)}},Or=(e,n,t,o,r)=>{const s=e.fillStyle,i=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let a=0;a<n.actions;a++)e.fillRect(t*r+4+6*a,o*r+r-12,5,5),e.rect(t*r+4+6*a,o*r+r-12,5,5),e.stroke();e.fillStyle="blue";for(let a=0;a<n.movement;a++)e.fillRect(t*r+r-22+6*a,o*r+r-12,5,5),e.rect(t*r+r-22+6*a,o*r+r-12,5,5),e.stroke();e.fillStyle=s,e.strokeStyle=i},Mr=(e,n,t,o,r)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(t*r+4,o*r,r-8,4),e.fillStyle="green",e.fillRect(t*r+4,o*r,(r-8)*(n.health/n.maxHealth),4),e.rect(t*r+4,o*r,r-8,4),e.stroke()},wr=(e,n,t,o,r)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(t*r+4,o*r+(r-6),r-8,4),e.stroke()},xr=(e,n,t)=>{const o=n.currentActor;if(o){for(let r=o.position.x-o.movement;r<=o.position.x+o.movement;r++)for(let s=o.position.y-o.movement;s<=o.position.y+o.movement;s++)if($n(n.dungeon,r,s)&&!(r===(o==null?void 0:o.position.x)&&s===(o==null?void 0:o.position.y))){const a=Pn(n,r,s),l=Bn(n,r,s),u=Zn(n.dungeon.layout,r,s),p=st(o.position,{x:r,y:s},2,n,!0);!l&&!a&&u&&p&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(r*t,s*t,t,t),e.stroke())}}},Hr=(e,n,t)=>{const o=n.currentActor;o&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(o.position.x*t,o.position.y*t),e.lineTo(o.position.x*t+t/3,o.position.y*t),e.moveTo(o.position.x*t,o.position.y*t),e.lineTo(o.position.x*t,o.position.y*t+t/3),e.moveTo(o.position.x*t+t,o.position.y*t),e.lineTo(o.position.x*t+t/3*2,o.position.y*t),e.moveTo(o.position.x*t+t,o.position.y*t),e.lineTo(o.position.x*t+t,o.position.y*t+t/3),e.moveTo(o.position.x*t,o.position.y*t+t),e.lineTo(o.position.x*t,o.position.y*t+t/3*2),e.moveTo(o.position.x*t,o.position.y*t+t),e.lineTo(o.position.x*t+t/3,o.position.y*t+t),e.moveTo(o.position.x*t+t,o.position.y*t+t),e.lineTo(o.position.x*t+t,o.position.y*t+t/3*2),e.moveTo(o.position.x*t+t,o.position.y*t+t),e.lineTo(o.position.x*t+t/3*2,o.position.y*t+t),e.stroke(),e.lineWidth=1)},Lr=(e,n,t,o,r)=>{o.dungeon.layout.monsters.forEach(s=>{Nr(e,n,o,s,t,r)})},Nr=(e,n,t,o,r,s)=>{const i=t.dungeon.layout.grid[o.position.y][o.position.x];if(o&&o.health>0&&Se(t.dungeon,i)){switch(o.type){case F.ORCH:Pr(e,n,r,o);break;case F.TROLL:Br(e,n,r,o);break;default:Ur(e,n,r,o);break}$r(e,o,r),Gr(e,o,r),Wr(e,o,t.heroes,t,r,s)}},Pr=(e,n,t,o)=>{e.drawImage(n,t,16,16,16,o.position.x*t,o.position.y*t,t,t)},Br=(e,n,t,o)=>{e.drawImage(n,t,16,16,16,o.position.x*t,o.position.y*t,t,t)},Ur=(e,n,t,o)=>{e.drawImage(n,16,16,16,16,o.position.x*t,o.position.y*t,t,t)},$r=(e,n,t)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(n.position.x*t+4,n.position.y*t+(t-6),t-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Gr=(e,n,t)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n.position.x*t+4,n.position.y*t,t-8,4),e.fillStyle="green",e.fillRect(n.position.x*t+4,n.position.y*t,(t-8)*(n.health/n.maxHealth),4),e.rect(n.position.x*t+4,n.position.y*t,t-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Wr=(e,n,t,o,r,s)=>{s&&t.forEach(i=>{const a=[],l={x:n.position.x*48-24,y:n.position.y*48-24},u={x:i.position.x*48-24,y:i.position.y*48-24};if(it(l,n.position,u,i.position,48,o,!1,a)){const b=n.position.x,g=n.position.y,k=i.position.x,D=i.position.y;e.beginPath(),e.strokeStyle=n.colour,e.lineWidth=2,e.moveTo(b*r+r/2,g*r+r/2),e.lineTo(k*r+r/2,D*r+r/2),e.stroke(),e.lineWidth=1}})},Fr=(e,n,t,o,r)=>{o.dungeon.layout.doors.forEach(s=>{Sr(e,n,t,o,s,r)})},Kr=(e,n,t,o,r)=>{o.dungeon.layout.grid.forEach((s,i)=>{Un(s).forEach((a,l)=>{Xr(e,n,o,a,l,i,t),Jr(e,a,o,l,i,t,r)})}),Vr(e,n,t,o,r),qr(e,n,t,o,r)},Yr=(e,n,t,o,r)=>{o.dungeon.layout.secrets.filter(s=>s.found).forEach(s=>{switch(s.type){case oe.TRAP_DOOR:Qr(e,n,t,s);break;default:Zr(e,n,t,s);break}}),r&&o.dungeon.layout.secrets.filter(s=>!s.found).forEach(s=>{const i=`${s.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(s.position.x*t,s.position.y*t,t,t),e.fillStyle="black",e.font="12px Arial",e.fillText(i,s.position.x*t,s.position.y*t+10)})},An=(e,n,t,o,r,s,i,a)=>{a.dungeon.discoveredRooms.some(l=>Ot(s,i,l,a))||Ot(s,i,Nn,a)?e.drawImage(n,t*48,o,48,48,s*r,i*r,r,r):mo(e,s,i,r)},Vr=(e,n,t,o,r)=>{var s,i;(i=(s=o.dungeon.layout.pits)==null?void 0:s.filter(a=>$n(o.dungeon,a.x,a.y)||r))==null||i.forEach(a=>{An(e,n,7,0,t,a.x,a.y,o)})},qr=(e,n,t,o,r)=>{var s,i;(i=(s=o.dungeon.layout.pillars)==null?void 0:s.filter(a=>$n(o.dungeon,a.x,a.y)||r))==null||i.forEach(a=>{An(e,n,6,0,t,a.x,a.y,o)})},Xr=(e,n,t,o,r,s,i)=>{jr(o,t)?o===Nn?(An(e,n,0,0,i,r,s,t),An(e,n,5,0,i,r,s,t)):An(e,n,1,0,i,r,s,t):Xn(o,t)?mo(e,r,s,i):An(e,n,0,0,i,r,s,t)},jr=(e,n)=>zr(e)||!Se(n.dungeon,e)&&e!==jn,mo=(e,n,t,o)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="black",e.fillRect(n*o,t*o,o,o),e.stroke()},Qr=(e,n,t,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(n,3*48,0,48,48,r*t,s*t,t,t)},Zr=(e,n,t,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(n,4*48,0,48,48,r*t,s*t,t,t)},Jr=(e,n,t,o,r,s,i)=>{!i&&(Xn(n,t)||n===Qn)||(e.beginPath(),e.strokeStyle="black",e.rect(o*s,r*s,s,s),i&&(e.font="7px Arial",e.fillText(o+","+r,o*s+3,r*s+(s-3))),e.stroke())},Sr=(e,n,t,o,r,s)=>{const i=o.dungeon.layout.grid[r.y][r.x];if(r&&!r.hidden&&!r.open&&!Xn(i,o))switch(e.fillStyle="brown",r.side){case A.RIGHT:{e.fillRect(r.x*t+(t-2),r.y*t,4,t),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t+(t-4),r.y*t+(t/2-4),8,8));break}case A.LEFT:{e.fillRect(r.x*t-2,r.y*t,4,t),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t-4,r.y*t+(t/2-4),8,8));break}case A.UP:{e.fillRect(r.x*t,r.y*t-2,t,4),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t+(t/2-4),r.y*t-4,8,8));break}case A.DOWN:{e.fillRect(r.x*t,r.y*t+(t-2),t,4),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t+(t/2-4),r.y*t+(t-4),8,8));break}}s&&!Xn(i,o)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${r.hidden?"H":"-"}/${r.trapped?"T"+r.trapAttacks:"-"}/${r.locked?"L":"-"}]`,r.x*t,r.y*t+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(r.x*t,r.y*t,t,t))},zr=e=>e===Qn,Xn=(e,n)=>e===jn||!Se(n.dungeon,e),Ot=(e,n,t,o)=>{if(!o)return;const r=Math.max(e-1,0),s=Math.max(n-1,0),i=Math.min(n+1,o.dungeon.layout.grid.length-1),a=Math.min(e+1,o.dungeon.layout.grid[0].length-1);for(let l=r;l<=a;l++)for(let u=s;u<=i;u++){const p=o.dungeon.layout.grid[u];if(Un(p)[l]===t)return!0}return!1},es=(e,n,t,o)=>{o.dungeon.layout.items.forEach(r=>{switch(r.item.type){case U.MAGIC:ns(e,n,t,r);break}})},ns=(e,n,t,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(n,0,48,48,48,r*t,s*t,t,t)};function ts(e){let n,t,o,r;return{c(){n=f("div"),t=f("canvas"),this.h()},l(s){n=m(s,"DIV",{style:!0,class:!0,id:!0});var i=v(n);t=m(i,"CANVAS",{width:!0,height:!0,id:!0}),v(t).forEach(d),i.forEach(d),this.h()},h(){N(t,"width",e[0]*40),N(t,"height",e[0]*30),N(t,"id","gameBoard"),N(n,"style",e[2]()),N(n,"class","dungeon svelte-a4uhtl"),N(n,"id","gameBoardContainer")},m(s,i){P(s,n,i),c(n,t),o||(r=X(t,"click",e[1]),o=!0)},p:fe,i:fe,o:fe,d(s){s&&d(n),o=!1,r()}}}const Mt=10;function os(e,n,t){let{state:o}=n,{debugMode:r}=n,s,i;const a=(o==null?void 0:o.settings.cellSize)??48;let l=0,u=0;i=window.innerHeight,s=document.getElementById("footer").offsetHeight,Ln(()=>{const k=new Image;k.src=Er;const D=new Image;D.src=Ar,setInterval(()=>p(k,D),10)});const p=(k,D)=>{if(!o||!document)return;const C=document.getElementById("gameBoard"),y=C.getContext("2d");o.reRender&&(u++,l++,y.clearRect(0,0,C.width,C.height),y.fillStyle="black",y.fillRect(0,0,C.width,C.height),Kr(y,k,a,o,r),Yr(y,k,a,o,r),es(y,k,a,o),Fr(y,k,a,o,r),Lr(y,D,a,o,r),Rr(y,D,a,o,r),r&&(y.fillStyle="white",y.font="8px Arial",y.fillText(`Re-renders: ${l}`,2,10),y.fillText(`FPS: ${u/(Mt/1e3)}`,2,20)),setTimeout(()=>{t(3,o.reRender=!1,o),u=0},Mt))},b=k=>{Dr(k,a,o)},g=()=>`max-height: ${i-s-20}px; max-width: ${a*40}`;return e.$$set=k=>{"state"in k&&t(3,o=k.state),"debugMode"in k&&t(4,r=k.debugMode)},[a,b,g,o,r]}class rs extends un{constructor(n){super(),dn(this,n,os,ts,Le,{state:3,debugMode:4})}}function wt(e){let n,t="Use",o,r;return{c(){n=f("button"),n.textContent=t},l(s){n=m(s,"BUTTON",{"data-svelte-h":!0}),Z(n)!=="svelte-3f43k6"&&(n.textContent=t)},m(s,i){P(s,n,i),o||(r=X(n,"click",e[2]),o=!0)},p:fe,d(s){s&&d(n),o=!1,r()}}}function ss(e){var k,D,C;let n,t,o,r=e[0].name+"",s,i,a,l,u,p=((k=e[0].properties)==null?void 0:k[Et])+"",b,g=((D=e[0].properties)==null?void 0:D[Vn])&&!((C=e[0].properties)!=null&&C[Ge])&&wt(e);return{c(){n=f("div"),t=f("span"),g&&g.c(),o=w(),s=O(r),i=w(),a=f("div"),l=f("span"),u=O("Â "),b=O(p),this.h()},l(y){n=m(y,"DIV",{class:!0});var H=v(n);t=m(H,"SPAN",{class:!0});var R=v(t);g&&g.l(R),o=x(R),s=M(R,r),R.forEach(d),i=x(H),a=m(H,"DIV",{class:!0});var _=v(a);l=m(_,"SPAN",{class:!0});var K=v(l);u=M(K,"Â "),b=M(K,p),K.forEach(d),_.forEach(d),H.forEach(d),this.h()},h(){N(t,"class","svelte-16r3uh2"),N(l,"class","svelte-16r3uh2"),N(a,"class","description svelte-16r3uh2"),N(n,"class","item-card svelte-16r3uh2")},m(y,H){P(y,n,H),c(n,t),g&&g.m(t,null),c(t,o),c(t,s),c(n,i),c(n,a),c(a,l),c(l,u),c(l,b)},p(y,[H]){var R,_,K;(R=y[0].properties)!=null&&R[Vn]&&!((_=y[0].properties)!=null&&_[Ge])?g?g.p(y,H):(g=wt(y),g.c(),g.m(t,o)):g&&(g.d(1),g=null),H&1&&r!==(r=y[0].name+"")&&de(s,r),H&1&&p!==(p=((K=y[0].properties)==null?void 0:K[Et])+"")&&de(b,p)},i:fe,o:fe,d(y){y&&d(n),g&&g.d()}}}function is(e,n,t){let{item:o}=n,{state:r}=n;const s=()=>tr(r,o);return e.$$set=i=>{"item"in i&&t(0,o=i.item),"state"in i&&t(1,r=i.state)},[o,r,s]}class as extends un{constructor(n){super(),dn(this,n,is,ss,Le,{item:0,state:1})}}function xt(e,n,t){const o=e.slice();return o[5]=n[t],o[6]=n,o[7]=t,o}function Ht(e){let n,t,o;function r(i){e[3](i,e[5],e[6],e[7])}let s={state:e[1]};return e[5]!==void 0&&(s.item=e[5]),n=new as({props:s}),On.push(()=>wn(n,"item",r)),{c(){rn(n.$$.fragment)},l(i){sn(n.$$.fragment,i)},m(i,a){an(n,i,a),o=!0},p(i,a){e=i;const l={};a&2&&(l.state=e[1]),!t&&a&1&&(t=!0,l.item=e[5],Mn(()=>t=!1)),n.$set(l)},i(i){o||(j(n.$$.fragment,i),o=!0)},o(i){re(n.$$.fragment,i),o=!1},d(i){ln(n,i)}}}function Lt(e){let n,t,o=bn(e[0]),r=[];for(let i=0;i<o.length;i+=1)r[i]=Ht(xt(e,o,i));const s=i=>re(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();n=_e()},l(i){for(let a=0;a<r.length;a+=1)r[a].l(i);n=_e()},m(i,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(i,a);P(i,n,a),t=!0},p(i,a){if(a&3){o=bn(i[0]);let l;for(l=0;l<o.length;l+=1){const u=xt(i,o,l);r[l]?(r[l].p(u,a),j(r[l],1)):(r[l]=Ht(u),r[l].c(),j(r[l],1),r[l].m(n.parentNode,n))}for(fn(),l=o.length;l<r.length;l+=1)s(l);mn()}},i(i){if(!t){for(let a=0;a<o.length;a+=1)j(r[a]);t=!0}},o(i){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)re(r[a]);t=!1},d(i){i&&d(n),tt(r,i)}}}function ls(e){let n,t,o="Inventory",r,s=e[2],i,a=Lt(e);return{c(){n=f("div"),t=f("span"),t.textContent=o,r=w(),a.c(),this.h()},l(l){n=m(l,"DIV",{class:!0});var u=v(n);t=m(u,"SPAN",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-5cqt1m"&&(t.textContent=o),r=x(u),a.l(u),u.forEach(d),this.h()},h(){N(t,"class","svelte-17j3oea"),N(n,"class","inventory svelte-17j3oea")},m(l,u){P(l,n,u),c(n,t),c(n,r),a.m(n,null),i=!0},p(l,[u]){u&4&&Le(s,s=l[2])?(fn(),re(a,1,1,fe),mn(),a=Lt(l),a.c(),j(a,1),a.m(n,null)):a.p(l,u)},i(l){i||(j(a),i=!0)},o(l){re(a),i=!1},d(l){l&&d(n),a.d(l)}}}function cs(e,n,t){let{inventory:o}=n,{state:r}=n,s=!1;Ln(()=>{i(),setInterval(i,100)});const i=()=>{t(2,s=!s)};function a(l,u,p,b){p[b]=l,t(0,o)}return e.$$set=l=>{"inventory"in l&&t(0,o=l.inventory),"state"in l&&t(1,r=l.state)},[o,r,s,a]}class us extends un{constructor(n){super(),dn(this,n,cs,ls,Le,{inventory:0,state:1})}}function Nt(e){let n;return{c(){n=O("*")},l(t){n=M(t,"*")},m(t,o){P(t,n,o)},d(t){t&&d(n)}}}function ds(e){let n;return{c(){n=O("Unselect")},l(t){n=M(t,"Unselect")},m(t,o){P(t,n,o)},d(t){t&&d(n)}}}function fs(e){let n;return{c(){n=O("Target")},l(t){n=M(t,"Target")},m(t,o){P(t,n,o)},d(t){t&&d(n)}}}function ms(e){let n;return{c(){n=O("None (0)")},l(t){n=M(t,"None (0)")},m(t,o){P(t,n,o)},p:fe,d(t){t&&d(n)}}}function hs(e){let n=e[0].armour.name+"",t,o,r=e[0].armour.defense+"",s,i;return{c(){t=O(n),o=O(" ("),s=O(r),i=O(")")},l(a){t=M(a,n),o=M(a," ("),s=M(a,r),i=M(a,")")},m(a,l){P(a,t,l),P(a,o,l),P(a,s,l),P(a,i,l)},p(a,l){l&1&&n!==(n=a[0].armour.name+"")&&de(t,n),l&1&&r!==(r=a[0].armour.defense+"")&&de(s,r)},d(a){a&&(d(t),d(o),d(s),d(i))}}}function ps(e){let n;return{c(){n=O("None (0)")},l(t){n=M(t,"None (0)")},m(t,o){P(t,n,o)},p:fe,d(t){t&&d(n)}}}function gs(e){let n=e[0].shield.name+"",t,o,r=e[0].shield.dice+"",s,i;return{c(){t=O(n),o=O(" ("),s=O(r),i=O(")")},l(a){t=M(a,n),o=M(a," ("),s=M(a,r),i=M(a,")")},m(a,l){P(a,t,l),P(a,o,l),P(a,s,l),P(a,i,l)},p(a,l){l&1&&n!==(n=a[0].shield.name+"")&&de(t,n),l&1&&r!==(r=a[0].shield.dice+"")&&de(s,r)},d(a){a&&(d(t),d(o),d(s),d(i))}}}function Pt(e){let n,t,o,r;function s(a){e[4](a)}let i={state:e[1]};return e[0].inventory!==void 0&&(i.inventory=e[0].inventory),t=new us({props:i}),On.push(()=>wn(t,"inventory",s)),{c(){n=f("div"),rn(t.$$.fragment),this.h()},l(a){n=m(a,"DIV",{class:!0});var l=v(n);sn(t.$$.fragment,l),l.forEach(d),this.h()},h(){N(n,"class","equipment")},m(a,l){P(a,n,l),an(t,n,null),r=!0},p(a,l){const u={};l&2&&(u.state=a[1]),!o&&l&1&&(o=!0,u.inventory=a[0].inventory,Mn(()=>o=!1)),t.$set(u)},i(a){r||(j(t.$$.fragment,a),r=!0)},o(a){re(t.$$.fragment,a),r=!1},d(a){a&&d(n),ln(t)}}}function Bt(e){let n,t,o,r=e[0].name+"",s,i,a,l,u=e[0].level+"",p,b,g=e[0].experience+"",k,D,C,y,H,R,_,K,Y=e[0].health+"",G,me,ee,E,L=e[0].actions+"",W,J,S,he,V=e[0].movement+"",Ne,Pe,z,Me="Equipment:",we,Ee,pe,Ke,Ae=e[0].weapon.name+"",ze,en,xe=e[0].weapon.dice+"",Te,hn,nn,ge,He,pn,Ce,ce,Ye,ne,gn,vn,te=e[1].targetActor===e[0]&&Nt();function Be(T,I){return T[1].targetActor!==T[0]?fs:ds}let tn=Be(e),be=tn(e);function Ze(T,I){return T[0].armour?hs:ms}let De=Ze(e),ve=De(e);function yn(T,I){return T[0].shield?gs:ps}let Ue=yn(e),se=Ue(e),Q=e[0]===e[1].currentActor&&Pt(e);return{c(){n=f("div"),t=f("div"),o=f("b"),te&&te.c(),s=O(r),i=O(" -"),a=w(),l=f("b"),p=O(u),b=O(" ("),k=O(g),D=O(")"),C=w(),y=f("span"),H=f("button"),be.c(),R=w(),_=f("span"),K=O("HP: "),G=O(Y),me=w(),ee=f("span"),E=O("Actions: "),W=O(L),J=w(),S=f("span"),he=O("Moves: "),Ne=O(V),Pe=w(),z=f("span"),z.textContent=Me,we=w(),Ee=f("div"),pe=f("span"),Ke=O("ð¡ï¸ "),ze=O(Ae),en=O(" ("),Te=O(xe),hn=O(")"),nn=w(),ge=f("span"),He=O(`ð§±
      `),ve.c(),pn=w(),Ce=f("span"),ce=O(`ð¡ï¸
      `),se.c(),Ye=w(),Q&&Q.c(),this.h()},l(T){n=m(T,"DIV",{class:!0,style:!0});var I=v(n);t=m(I,"DIV",{class:!0});var $e=v(t);o=m($e,"B",{class:!0});var ue=v(o);te&&te.l(ue),s=M(ue,r),i=M(ue," -"),ue.forEach(d),a=x($e),l=m($e,"B",{class:!0});var ye=v(l);p=M(ye,u),b=M(ye," ("),k=M(ye,g),D=M(ye,")"),ye.forEach(d),$e.forEach(d),C=x(I),y=m(I,"SPAN",{class:!0});var Dn=v(y);H=m(Dn,"BUTTON",{});var Rn=v(H);be.l(Rn),Rn.forEach(d),Dn.forEach(d),R=x(I),_=m(I,"SPAN",{class:!0});var kn=v(_);K=M(kn,"HP: "),G=M(kn,Y),kn.forEach(d),me=x(I),ee=m(I,"SPAN",{class:!0});var _n=v(ee);E=M(_n,"Actions: "),W=M(_n,L),_n.forEach(d),J=x(I),S=m(I,"SPAN",{class:!0});var Re=v(S);he=M(Re,"Moves: "),Ne=M(Re,V),Re.forEach(d),Pe=x(I),z=m(I,"SPAN",{class:!0,"data-svelte-h":!0}),Z(z)!=="svelte-1ue18fw"&&(z.textContent=Me),we=x(I),Ee=m(I,"DIV",{class:!0});var Ve=v(Ee);pe=m(Ve,"SPAN",{class:!0});var qe=v(pe);Ke=M(qe,"ð¡ï¸ "),ze=M(qe,Ae),en=M(qe," ("),Te=M(qe,xe),hn=M(qe,")"),qe.forEach(d),nn=x(Ve),ge=m(Ve,"SPAN",{class:!0});var En=v(ge);He=M(En,`ð§±
      `),ve.l(En),En.forEach(d),pn=x(Ve),Ce=m(Ve,"SPAN",{class:!0});var Ie=v(Ce);ce=M(Ie,`ð¡ï¸
      `),se.l(Ie),Ie.forEach(d),Ve.forEach(d),Ye=x(I),Q&&Q.l(I),I.forEach(d),this.h()},h(){N(o,"class","svelte-pgtred"),N(l,"class","svelte-pgtred"),N(t,"class","hero-title svelte-pgtred"),N(y,"class","svelte-pgtred"),N(_,"class","svelte-pgtred"),N(ee,"class","svelte-pgtred"),N(S,"class","svelte-pgtred"),N(z,"class","svelte-pgtred"),N(pe,"class","svelte-pgtred"),N(ge,"class","svelte-pgtred"),N(Ce,"class","svelte-pgtred"),N(Ee,"class","equipment"),N(n,"class","hero-card svelte-pgtred"),pt(n,"background-color",e[0].colour)},m(T,I){P(T,n,I),c(n,t),c(t,o),te&&te.m(o,null),c(o,s),c(o,i),c(t,a),c(t,l),c(l,p),c(l,b),c(l,k),c(l,D),c(n,C),c(n,y),c(y,H),be.m(H,null),c(n,R),c(n,_),c(_,K),c(_,G),c(n,me),c(n,ee),c(ee,E),c(ee,W),c(n,J),c(n,S),c(S,he),c(S,Ne),c(n,Pe),c(n,z),c(n,we),c(n,Ee),c(Ee,pe),c(pe,Ke),c(pe,ze),c(pe,en),c(pe,Te),c(pe,hn),c(Ee,nn),c(Ee,ge),c(ge,He),ve.m(ge,null),c(Ee,pn),c(Ee,Ce),c(Ce,ce),se.m(Ce,null),c(n,Ye),Q&&Q.m(n,null),ne=!0,gn||(vn=X(H,"click",e[3]),gn=!0)},p(T,I){T[1].targetActor===T[0]?te||(te=Nt(),te.c(),te.m(o,s)):te&&(te.d(1),te=null),(!ne||I&1)&&r!==(r=T[0].name+"")&&de(s,r),(!ne||I&1)&&u!==(u=T[0].level+"")&&de(p,u),(!ne||I&1)&&g!==(g=T[0].experience+"")&&de(k,g),tn!==(tn=Be(T))&&(be.d(1),be=tn(T),be&&(be.c(),be.m(H,null))),(!ne||I&1)&&Y!==(Y=T[0].health+"")&&de(G,Y),(!ne||I&1)&&L!==(L=T[0].actions+"")&&de(W,L),(!ne||I&1)&&V!==(V=T[0].movement+"")&&de(Ne,V),(!ne||I&1)&&Ae!==(Ae=T[0].weapon.name+"")&&de(ze,Ae),(!ne||I&1)&&xe!==(xe=T[0].weapon.dice+"")&&de(Te,xe),De===(De=Ze(T))&&ve?ve.p(T,I):(ve.d(1),ve=De(T),ve&&(ve.c(),ve.m(ge,null))),Ue===(Ue=yn(T))&&se?se.p(T,I):(se.d(1),se=Ue(T),se&&(se.c(),se.m(Ce,null))),T[0]===T[1].currentActor?Q?(Q.p(T,I),I&3&&j(Q,1)):(Q=Pt(T),Q.c(),j(Q,1),Q.m(n,null)):Q&&(fn(),re(Q,1,1,()=>{Q=null}),mn()),(!ne||I&1)&&pt(n,"background-color",T[0].colour)},i(T){ne||(j(Q),ne=!0)},o(T){re(Q),ne=!1},d(T){T&&d(n),te&&te.d(),be.d(),ve.d(),se.d(),Q&&Q.d(),gn=!1,vn()}}}function vs(e){let n=e[1].targetActor,t,o,r=Bt(e);return{c(){r.c(),t=_e()},l(s){r.l(s),t=_e()},m(s,i){r.m(s,i),P(s,t,i),o=!0},p(s,[i]){i&2&&Le(n,n=s[1].targetActor)?(fn(),re(r,1,1,fe),mn(),r=Bt(s),r.c(),j(r,1),r.m(t.parentNode,t)):r.p(s,i)},i(s){o||(j(r),o=!0)},o(s){re(r),o=!1},d(s){s&&d(t),r.d(s)}}}function ys(e,n,t){let{hero:o}=n,{state:r}=n;const s=l=>{r.targetActor&&l===r.targetActor?t(1,r.targetActor=void 0,r):t(1,r.targetActor=l,r)},i=()=>s(o);function a(l){e.$$.not_equal(o.inventory,l)&&(o.inventory=l,t(0,o))}return e.$$set=l=>{"hero"in l&&t(0,o=l.hero),"state"in l&&t(1,r=l.state)},[o,r,s,i,a]}class ho extends un{constructor(n){super(),dn(this,n,ys,vs,Le,{hero:0,state:1})}}function Ut(e,n,t){const o=e.slice();return o[3]=n[t],o[5]=t,o}function ks(e){let n,t,o,r;return t=new ho({props:{hero:e[3],state:e[0]}}),{c(){n=f("div"),rn(t.$$.fragment),o=w(),this.h()},l(s){n=m(s,"DIV",{class:!0});var i=v(n);sn(t.$$.fragment,i),o=x(i),i.forEach(d),this.h()},h(){N(n,"class","not-current-actor svelte-gyascg")},m(s,i){P(s,n,i),an(t,n,null),c(n,o),r=!0},p(s,i){const a={};i&1&&(a.hero=s[3]),i&1&&(a.state=s[0]),t.$set(a)},i(s){r||(j(t.$$.fragment,s),r=!0)},o(s){re(t.$$.fragment,s),r=!1},d(s){s&&d(n),ln(t)}}}function _s(e){let n,t,o,r;return t=new ho({props:{hero:e[3],state:e[0]}}),{c(){n=f("div"),rn(t.$$.fragment),o=w(),this.h()},l(s){n=m(s,"DIV",{class:!0});var i=v(n);sn(t.$$.fragment,i),o=x(i),i.forEach(d),this.h()},h(){N(n,"class","is-current-actor svelte-gyascg")},m(s,i){P(s,n,i),an(t,n,null),c(n,o),r=!0},p(s,i){const a={};i&1&&(a.hero=s[3]),i&1&&(a.state=s[0]),t.$set(a)},i(s){r||(j(t.$$.fragment,s),r=!0)},o(s){re(t.$$.fragment,s),r=!1},d(s){s&&d(n),ln(t)}}}function $t(e){let n,t,o,r;const s=[_s,ks],i=[];function a(l,u){return l[3]===l[0].currentActor?0:1}return n=a(e),t=i[n]=s[n](e),{c(){t.c(),o=_e()},l(l){t.l(l),o=_e()},m(l,u){i[n].m(l,u),P(l,o,u),r=!0},p(l,u){let p=n;n=a(l),n===p?i[n].p(l,u):(fn(),re(i[p],1,1,()=>{i[p]=null}),mn(),t=i[n],t?t.p(l,u):(t=i[n]=s[n](l),t.c()),j(t,1),t.m(o.parentNode,o))},i(l){r||(j(t),r=!0)},o(l){re(t),r=!1},d(l){l&&d(o),i[n].d(l)}}}function Gt(e){let n=e[1],t,o,r=$t(e);return{c(){r.c(),t=_e()},l(s){r.l(s),t=_e()},m(s,i){r.m(s,i),P(s,t,i),o=!0},p(s,i){i&2&&Le(n,n=s[1])?(fn(),re(r,1,1,fe),mn(),r=$t(s),r.c(),j(r,1),r.m(t.parentNode,t)):r.p(s,i)},i(s){o||(j(r),o=!0)},o(s){re(r),o=!1},d(s){s&&d(t),r.d(s)}}}function Es(e){let n,t,o=bn(B(e[0])),r=[];for(let i=0;i<o.length;i+=1)r[i]=Gt(Ut(e,o,i));const s=i=>re(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();n=_e()},l(i){for(let a=0;a<r.length;a+=1)r[a].l(i);n=_e()},m(i,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(i,a);P(i,n,a),t=!0},p(i,[a]){if(a&3){o=bn(B(i[0]));let l;for(l=0;l<o.length;l+=1){const u=Ut(i,o,l);r[l]?(r[l].p(u,a),j(r[l],1)):(r[l]=Gt(u),r[l].c(),j(r[l],1),r[l].m(n.parentNode,n))}for(fn(),l=o.length;l<r.length;l+=1)s(l);mn()}},i(i){if(!t){for(let a=0;a<o.length;a+=1)j(r[a]);t=!0}},o(i){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)re(r[a]);t=!1},d(i){i&&d(n),tt(r,i)}}}function As(e,n,t){let{state:o}=n,r=!1;Ln(()=>{s(),setInterval(s,100)});const s=()=>{o.reRender&&t(1,r=!r)};return e.$$set=i=>{"state"in i&&t(0,o=i.state)},[o,r]}class bs extends un{constructor(n){super(),dn(this,n,As,Es,Le,{state:0})}}function Wt(e,n,t){const o=e.slice();return o[2]=n[t],o[4]=t,o}function Ts(e){let n,t,o=e[2]+"",r;return{c(){n=f("p"),t=O(">"),r=O(o),this.h()},l(s){n=m(s,"P",{class:!0});var i=v(n);t=M(i,">"),r=M(i,o),i.forEach(d),this.h()},h(){N(n,"class","svelte-axhg6g")},m(s,i){P(s,n,i),c(n,t),c(n,r)},p(s,i){i&1&&o!==(o=s[2]+"")&&de(r,o)},d(s){s&&d(n)}}}function Ft(e){let n,t=e[4]<25&&Ts(e);return{c(){t&&t.c(),n=_e()},l(o){t&&t.l(o),n=_e()},m(o,r){t&&t.m(o,r),P(o,n,r)},p(o,r){o[4]<25&&t.p(o,r)},d(o){o&&d(n),t&&t.d(o)}}}function Kt(e){let n,t=bn(e[0]),o=[];for(let r=0;r<t.length;r+=1)o[r]=Ft(Wt(e,t,r));return{c(){for(let r=0;r<o.length;r+=1)o[r].c();n=_e()},l(r){for(let s=0;s<o.length;s+=1)o[s].l(r);n=_e()},m(r,s){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,s);P(r,n,s)},p(r,s){if(s&1){t=bn(r[0]);let i;for(i=0;i<t.length;i+=1){const a=Wt(r,t,i);o[i]?o[i].p(a,s):(o[i]=Ft(a),o[i].c(),o[i].m(n.parentNode,n))}for(;i<o.length;i+=1)o[i].d(1);o.length=t.length}},d(r){r&&d(n),tt(o,r)}}}function Cs(e){let n,t=e[0],o=Kt(e);return{c(){n=f("div"),o.c(),this.h()},l(r){n=m(r,"DIV",{class:!0});var s=v(n);o.l(s),s.forEach(d),this.h()},h(){N(n,"class","log svelte-axhg6g")},m(r,s){P(r,n,s),o.m(n,null)},p(r,[s]){s&1&&Le(t,t=r[0])?(o.d(1),o=Kt(r),o.c(),o.m(n,null)):o.p(r,s)},i:fe,o:fe,d(r){r&&d(n),o.d(r)}}}function Ds(e,n,t){let o=[],{state:r}=n;return Ln(()=>{setInterval(()=>{r.reRender&&t(0,o=r.actionLog)},500)}),e.$$set=s=>{"state"in s&&t(1,r=s.state)},[o,r]}class Rs extends un{constructor(n){super(),dn(this,n,Ds,Cs,Le,{state:1})}}const{window:Is}=go;function Os(e){let n,t,o,r,s="UL",i,a,l,u="U",p,b,g,k="UR",D,C,y,H="Next",R,_,K,Y,G="L",me,ee,E,L,W,J="R",S,he,V,Ne="Search",Pe,z,Me,we,Ee="DL",pe,Ke,Ae,ze="D",en,xe,Te,hn="DR",nn,ge,He,pn="Pick lock",Ce,ce,Ye,ne,gn="Save",vn,te,Be,tn="Load",be,Ze,De,ve="Debug",yn,Ue,se,Q="End action",T,I;return{c(){n=f("table"),t=f("tr"),o=f("td"),r=f("button"),r.textContent=s,i=w(),a=f("td"),l=f("button"),l.textContent=u,p=w(),b=f("td"),g=f("button"),g.textContent=k,D=w(),C=f("td"),y=f("button"),y.textContent=H,R=w(),_=f("tr"),K=f("td"),Y=f("button"),Y.textContent=G,me=w(),ee=f("td"),E=w(),L=f("td"),W=f("button"),W.textContent=J,S=w(),he=f("td"),V=f("button"),V.textContent=Ne,Pe=w(),z=f("tr"),Me=f("td"),we=f("button"),we.textContent=Ee,pe=w(),Ke=f("td"),Ae=f("button"),Ae.textContent=ze,en=w(),xe=f("td"),Te=f("button"),Te.textContent=hn,nn=w(),ge=f("td"),He=f("button"),He.textContent=pn,Ce=w(),ce=f("tr"),Ye=f("td"),ne=f("button"),ne.textContent=gn,vn=w(),te=f("td"),Be=f("button"),Be.textContent=tn,be=w(),Ze=f("td"),De=f("button"),De.textContent=ve,yn=w(),Ue=f("td"),se=f("button"),se.textContent=Q},l($e){n=m($e,"TABLE",{});var ue=v(n);t=m(ue,"TR",{});var ye=v(t);o=m(ye,"TD",{});var Dn=v(o);r=m(Dn,"BUTTON",{"data-svelte-h":!0}),Z(r)!=="svelte-1vu0fc2"&&(r.textContent=s),Dn.forEach(d),i=x(ye),a=m(ye,"TD",{});var Rn=v(a);l=m(Rn,"BUTTON",{"data-svelte-h":!0}),Z(l)!=="svelte-m1j18o"&&(l.textContent=u),Rn.forEach(d),p=x(ye),b=m(ye,"TD",{});var kn=v(b);g=m(kn,"BUTTON",{"data-svelte-h":!0}),Z(g)!=="svelte-8eygoe"&&(g.textContent=k),kn.forEach(d),D=x(ye),C=m(ye,"TD",{});var _n=v(C);y=m(_n,"BUTTON",{"data-svelte-h":!0}),Z(y)!=="svelte-1axp1ke"&&(y.textContent=H),_n.forEach(d),ye.forEach(d),R=x(ue),_=m(ue,"TR",{});var Re=v(_);K=m(Re,"TD",{});var Ve=v(K);Y=m(Ve,"BUTTON",{"data-svelte-h":!0}),Z(Y)!=="svelte-amyars"&&(Y.textContent=G),Ve.forEach(d),me=x(Re),ee=m(Re,"TD",{}),v(ee).forEach(d),E=x(Re),L=m(Re,"TD",{});var qe=v(L);W=m(qe,"BUTTON",{"data-svelte-h":!0}),Z(W)!=="svelte-2zfta0"&&(W.textContent=J),qe.forEach(d),S=x(Re),he=m(Re,"TD",{});var En=v(he);V=m(En,"BUTTON",{"data-svelte-h":!0}),Z(V)!=="svelte-1kis6k4"&&(V.textContent=Ne),En.forEach(d),Re.forEach(d),Pe=x(ue),z=m(ue,"TR",{});var Ie=v(z);Me=m(Ie,"TD",{});var at=v(Me);we=m(at,"BUTTON",{"data-svelte-h":!0}),Z(we)!=="svelte-57p0uk"&&(we.textContent=Ee),at.forEach(d),pe=x(Ie),Ke=m(Ie,"TD",{});var lt=v(Ke);Ae=m(lt,"BUTTON",{"data-svelte-h":!0}),Z(Ae)!=="svelte-1nly394"&&(Ae.textContent=ze),lt.forEach(d),en=x(Ie),xe=m(Ie,"TD",{});var ct=v(xe);Te=m(ct,"BUTTON",{"data-svelte-h":!0}),Z(Te)!=="svelte-7ds02w"&&(Te.textContent=hn),ct.forEach(d),nn=x(Ie),ge=m(Ie,"TD",{});var ut=v(ge);He=m(ut,"BUTTON",{"data-svelte-h":!0}),Z(He)!=="svelte-90j6ve"&&(He.textContent=pn),ut.forEach(d),Ie.forEach(d),Ce=x(ue),ce=m(ue,"TR",{});var Je=v(ce);Ye=m(Je,"TD",{});var dt=v(Ye);ne=m(dt,"BUTTON",{"data-svelte-h":!0}),Z(ne)!=="svelte-fxtyz6"&&(ne.textContent=gn),dt.forEach(d),vn=x(Je),te=m(Je,"TD",{});var ft=v(te);Be=m(ft,"BUTTON",{"data-svelte-h":!0}),Z(Be)!=="svelte-1m2jkw7"&&(Be.textContent=tn),ft.forEach(d),be=x(Je),Ze=m(Je,"TD",{});var mt=v(Ze);De=m(mt,"BUTTON",{"data-svelte-h":!0}),Z(De)!=="svelte-5alhx0"&&(De.textContent=ve),mt.forEach(d),yn=x(Je),Ue=m(Je,"TD",{});var ht=v(Ue);se=m(ht,"BUTTON",{"data-svelte-h":!0}),Z(se)!=="svelte-1de77je"&&(se.textContent=Q),ht.forEach(d),Je.forEach(d),ue.forEach(d)},m($e,ue){P($e,n,ue),c(n,t),c(t,o),c(o,r),c(t,i),c(t,a),c(a,l),c(t,p),c(t,b),c(b,g),c(t,D),c(t,C),c(C,y),c(n,R),c(n,_),c(_,K),c(K,Y),c(_,me),c(_,ee),c(_,E),c(_,L),c(L,W),c(_,S),c(_,he),c(he,V),c(n,Pe),c(n,z),c(z,Me),c(Me,we),c(z,pe),c(z,Ke),c(Ke,Ae),c(z,en),c(z,xe),c(xe,Te),c(z,nn),c(z,ge),c(ge,He),c(n,Ce),c(n,ce),c(ce,Ye),c(Ye,ne),c(ce,vn),c(ce,te),c(te,Be),c(ce,be),c(ce,Ze),c(Ze,De),c(ce,yn),c(ce,Ue),c(Ue,se),T||(I=[X(r,"click",e[12]),X(l,"click",e[13]),X(g,"click",e[14]),X(y,"click",e[15]),X(Y,"click",e[16]),X(W,"click",e[17]),X(V,"click",e[18]),X(we,"click",e[19]),X(Ae,"click",e[20]),X(Te,"click",e[21]),X(He,"click",e[22]),X(ne,"click",e[23]),X(Be,"click",e[24]),X(De,"click",e[25]),X(se,"click",e[26])],T=!0)},p:fe,d($e){$e&&d(n),T=!1,Yt(I)}}}function Ms(e){let n,t,o,r,s="Next",i,a,l,u="End action",p,b,g,k,D="Save",C,y,H,R="Load",_,K,Y,G,me="Debug",ee,E;return{c(){n=f("table"),t=f("tr"),o=f("td"),r=f("button"),r.textContent=s,i=w(),a=f("td"),l=f("button"),l.textContent=u,p=w(),b=f("tr"),g=f("td"),k=f("button"),k.textContent=D,C=w(),y=f("td"),H=f("button"),H.textContent=R,_=w(),K=f("tr"),Y=f("td"),G=f("button"),G.textContent=me},l(L){n=m(L,"TABLE",{});var W=v(n);t=m(W,"TR",{});var J=v(t);o=m(J,"TD",{});var S=v(o);r=m(S,"BUTTON",{"data-svelte-h":!0}),Z(r)!=="svelte-1axp1ke"&&(r.textContent=s),S.forEach(d),i=x(J),a=m(J,"TD",{});var he=v(a);l=m(he,"BUTTON",{"data-svelte-h":!0}),Z(l)!=="svelte-1de77je"&&(l.textContent=u),he.forEach(d),J.forEach(d),p=x(W),b=m(W,"TR",{});var V=v(b);g=m(V,"TD",{});var Ne=v(g);k=m(Ne,"BUTTON",{"data-svelte-h":!0}),Z(k)!=="svelte-fxtyz6"&&(k.textContent=D),Ne.forEach(d),C=x(V),y=m(V,"TD",{});var Pe=v(y);H=m(Pe,"BUTTON",{"data-svelte-h":!0}),Z(H)!=="svelte-1m2jkw7"&&(H.textContent=R),Pe.forEach(d),V.forEach(d),_=x(W),K=m(W,"TR",{});var z=v(K);Y=m(z,"TD",{});var Me=v(Y);G=m(Me,"BUTTON",{"data-svelte-h":!0}),Z(G)!=="svelte-5alhx0"&&(G.textContent=me),Me.forEach(d),z.forEach(d),W.forEach(d)},m(L,W){P(L,n,W),c(n,t),c(t,o),c(o,r),c(t,i),c(t,a),c(a,l),c(n,p),c(n,b),c(b,g),c(g,k),c(b,C),c(b,y),c(y,H),c(n,_),c(n,K),c(K,Y),c(Y,G),ee||(E=[X(r,"click",e[7]),X(l,"click",e[8]),X(k,"click",e[9]),X(H,"click",e[10]),X(G,"click",e[11])],ee=!0)},p:fe,d(L){L&&d(n),ee=!1,Yt(E)}}}function ws(e){let n,t,o,r,s,i,a,l,u,p,b,g,k,D,C,y;o=new bs({props:{state:e[0]}});function H(E){e[5](E)}function R(E){e[6](E)}let _={};e[0]!==void 0&&(_.state=e[0]),e[1]!==void 0&&(_.debugMode=e[1]),s=new rs({props:_}),On.push(()=>wn(s,"state",H)),On.push(()=>wn(s,"debugMode",R));function K(E,L){return E[2]<600?Ms:Os}let Y=K(e),G=Y(e);function me(E){e[27](E)}let ee={};return e[0]!==void 0&&(ee.state=e[0]),g=new Rs({props:ee}),On.push(()=>wn(g,"state",me)),{c(){n=f("div"),t=f("div"),rn(o.$$.fragment),r=w(),rn(s.$$.fragment),l=w(),u=f("div"),p=f("div"),G.c(),b=w(),rn(g.$$.fragment),this.h()},l(E){n=m(E,"DIV",{class:!0});var L=v(n);t=m(L,"DIV",{class:!0});var W=v(t);sn(o.$$.fragment,W),W.forEach(d),r=x(L),sn(s.$$.fragment,L),L.forEach(d),l=x(E),u=m(E,"DIV",{class:!0,id:!0});var J=v(u);p=m(J,"DIV",{class:!0});var S=v(p);G.l(S),S.forEach(d),b=x(J),sn(g.$$.fragment,J),J.forEach(d),this.h()},h(){N(t,"class","characterSide svelte-8a7at9"),N(n,"class","container svelte-8a7at9"),N(p,"class","commands svelte-8a7at9"),N(u,"class","container svelte-8a7at9"),N(u,"id","footer")},m(E,L){P(E,n,L),c(n,t),an(o,t,null),c(n,r),an(s,n,null),P(E,l,L),P(E,u,L),c(u,p),G.m(p,null),c(u,b),an(g,u,null),D=!0,C||(y=X(Is,"keydown",po(e[4])),C=!0)},p(E,[L]){const W={};L&1&&(W.state=E[0]),o.$set(W);const J={};!i&&L&1&&(i=!0,J.state=E[0],Mn(()=>i=!1)),!a&&L&2&&(a=!0,J.debugMode=E[1],Mn(()=>a=!1)),s.$set(J),Y===(Y=K(E))&&G?G.p(E,L):(G.d(1),G=Y(E),G&&(G.c(),G.m(p,null)));const S={};!k&&L&1&&(k=!0,S.state=E[0],Mn(()=>k=!1)),g.$set(S)},i(E){D||(j(o.$$.fragment,E),j(s.$$.fragment,E),j(g.$$.fragment,E),D=!0)},o(E){re(o.$$.fragment,E),re(s.$$.fragment,E),re(g.$$.fragment,E),D=!1},d(E){E&&(d(n),d(l),d(u)),ln(o),ln(s),G.d(),ln(g),C=!1,y()}}}function xs(e,n,t){let o=pr(),r=o.settings.debug,s;Ln(()=>{setInterval(()=>kr(o),1e3)}),s=window.innerWidth;const i=()=>{t(1,r=!r),t(0,o.settings.debug=r,o),t(0,o.reRender=!0,o)};function a(V){switch(V.key){case"6":case"d":le("R",o);break;case"9":case"e":le("UR",o);break;case"8":case"w":le("U",o);break;case"7":case"q":le("UL",o);break;case"4":case"a":le("L",o);break;case"1":case"z":le("DL",o);break;case"2":case"x":le("D",o);break;case"3":case"c":le("DR",o);break;case"0":case" ":Fn(o);break;case"-":case"r":zn(o);break;case"+":case"f":et(o);break}}function l(V){o=V,t(0,o)}function u(V){r=V,t(1,r)}const p=()=>Fn(o),b=()=>vt(o),g=()=>Dt(o),k=()=>t(0,o=Rt()),D=()=>i(),C=()=>le("UL",o),y=()=>le("U",o),H=()=>le("UR",o),R=()=>Fn(o),_=()=>le("L",o),K=()=>le("R",o),Y=()=>et(o),G=()=>le("DL",o),me=()=>le("D",o),ee=()=>le("DR",o),E=()=>zn(o),L=()=>Dt(o),W=()=>t(0,o=Rt()),J=()=>i(),S=()=>vt(o);function he(V){o=V,t(0,o)}return[o,r,s,i,a,l,u,p,b,g,k,D,C,y,H,R,_,K,Y,G,me,ee,E,L,W,J,S,he]}class Ns extends un{constructor(n){super(),dn(this,n,xs,ws,Le,{})}}export{Ns as component};
