import{s as Pe,n as ce,o as $e,b as Zt,f as jt,r as en,i as N}from"../chunks/scheduler.ba2ce6c0.js";import{S as Ze,i as je,g as B,h,j as I,f as m,k as U,a as fe,y as tn,r as bt,s as T,u as Ot,c as D,z as _,x as g,v as Ht,A as P,d as _t,t as wt,w as St}from"../chunks/index.8040907f.js";var O=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(O||{}),H=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(H||{}),F=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(F||{}),q=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(q||{}),ue=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.DOOR="Door",e.NOTE="Note",e))(ue||{}),k=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(k||{});const nn="0",on="@",Me=" ",Ve="#",sn=(e,t,o,n)=>({type:e,name:t,position:{x:o,y:n},found:!1}),x=(e,t,o)=>({side:e,x:t,y:o,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),Mt=(e,t,o)=>({...x(e,t,o),hidden:!0}),J=(e,t,o,n)=>{const i=Object.values(O).indexOf(t),A=Object.keys(O)[i];let c=F.LORD,d=2,f=2,C=4,y=4,L=4;switch(e){case H.ORCH:{c=F.APPRENTICE,f=0,C=2,y=2,L=1;break}case H.TROLL:{c=F.KNIGHT,f=1,C=3,y=3,L=2;break}}return e===H.YELLOW_DARK_LORD&&(d=3),{type:e,level:c,colour:t,actions:d,defense:f,health:C,maxHealth:y,experience:L,name:e+" ("+A+")",movement:3,position:{x:o,y:n}}},an={name:"The Three Gates of Power",beaten:!1,winConditions:[{type:q.KILL_ALL,fulfilled:!1},{type:q.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:1,y:4},{x:0,y:3},{x:0,y:4},{x:0,y:5}],discoveredRooms:["A"],layout:{grid:["            EEEE","            EEEE","         DDDEEEE","AAA   CCCC","AAABBBCCCC   GGG","AAA   CCCCFFFGGG","      CCCC   GGG","      CCCC","      CCCCHHHIII","             III","             III"],doors:[x(k.RIGHT,2,4),x(k.RIGHT,5,4),x(k.RIGHT,9,5),x(k.RIGHT,12,5),x(k.RIGHT,9,8),x(k.RIGHT,12,8),x(k.RIGHT,11,2),Mt(k.UP,9,3),Mt(k.RIGHT,15,1)],monsters:[J(H.ORCH,O.Blue,9,7),J(H.ORCH,O.Red,12,8),J(H.TROLL,O.Red,15,1),J(H.TROLL,O.Yellow,13,6)],secrets:[{type:ue.EQUIPMENT,position:{x:9,y:4},found:!1,name:"Random Equipment"},{type:ue.EQUIPMENT,position:{x:12,y:0},found:!1,name:"Random Equipment"},{type:ue.MAGIC_ITEM,position:{x:15,y:5},found:!1,name:"Random Magic Item",item:{name:"Healing Herbs"}},{type:ue.EQUIPMENT,position:{x:15,y:9},found:!1,name:"Random Equipment"}],notes:[{message:"Beyond stone and fire you shall find the Dread tunnel, the road to the Ice Dragons treasure.",position:{x:2,y:4}},{message:"The Gate of Water. <There is an image of a sea dragon under the text>",position:{x:9,y:8}},{message:"The Gate of Air. <There is an image of a pegasus under the text>",position:{x:9,y:5}},{message:"The Gate of Fire. <There is an image of a hippogriph under the text>",position:{x:9,y:3}}]},killCount:0},Pt={name:"Troll cave",beaten:!1,winConditions:[{type:q.KILL_ALL,fulfilled:!1}],nextDungeon:an,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[x(k.RIGHT,3,9),x(k.RIGHT,6,9),x(k.UP,7,7),x(k.UP,7,4)],monsters:[J(H.ORCH,O.Green,6,9),J(H.ORCH,O.Yellow,8,10),J(H.ORCH,O.Red,7,5),J(H.ORCH,O.Red,9,3),J(H.TROLL,O.Green,6,1)],secrets:[sn(ue.NOTE,"Welcome to Drakriddarna",2,9)],notes:[]},killCount:0},Nt=e=>{e.actionLog.push("Game saved."),localStorage.setItem("state",JSON.stringify(e))},An=()=>{const e=localStorage.getItem("state");if(e){const t=JSON.parse(e);return t.currentActor=t.heroes.find(o=>{var n;return o.name===((n=t.currentActor)==null?void 0:n.name)}),t.actionLog.push("Game loaded."),t}},rn=()=>{const e=Wt;return qt(e,Pt),{heroes:e,dungeon:Pt,currentActor:e[0],actionLog:["Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."]}},Se=(e,t)=>({name:e,actions:2,movement:3,defense:0,level:F.APPRENTICE,health:7,maxHealth:7,colour:t,experience:0,position:{x:-1,y:-1}}),Wt=[Se("Fearik",O.Yellow),Se("Helbran",O.Red),Se("Siedel",O.Green),Se("Wulf",O.Blue)],qt=(e,t)=>{e.forEach((o,n)=>o.position=t.startingPositions[n])},de=e=>{let t=[];for(let o=0;o<e.length;o++)t.push(e[o]);return t},Jt=(e,t,o)=>e.dungeon.layout.monsters.some(n=>n.position.x===t&&n.position.y===o&&n.health>0),Xt=(e,t,o)=>e.heroes.some(n=>n.position.x===t&&n.position.y===o),b=(e,t)=>{const o=t.currentActor;if(!o||o.actions===0)return;let n=o.position.x,i=o.position.y;switch(e){case"UL":n=o.position.x-1,i=o.position.y-1;break;case"U":i=o.position.y-1;break;case"UR":n=o.position.x+1,i=o.position.y-1;break;case"L":n=o.position.x-1;break;case"R":n=o.position.x+1;break;case"DL":n=o.position.x-1,i=o.position.y+1;break;case"D":i=o.position.y+1;break;case"DR":n=o.position.x+1,i=o.position.y+1;break}const A=Xt(t,n,i),c=!et(t.dungeon.layout,n,i),d=Jt(t,n,i);if(!A&&!c){const f=tt(t.dungeon,n,i);f?f&&(d?cn(o,t,n,i):zt(o,t,n,i,1)):dn(t,o,n,i)&&ln(o,t,n,i)}else t.actionLog.push(`${o.name} could not make that move`);o.movement===0&&(o.actions--,o.movement=3)},zt=(e,t,o,n,i)=>{e.position.x=o,e.position.y=n;const A=t.dungeon.layout.notes.find(d=>Kt(d.position,e.position));A&&(t.dungeon.layout.doors.some(f=>f.hidden&&Kt(A.position,{x:f.x,y:f.y}))||t.actionLog.push(`${e.name} reads: ${A.message}`)),t.dungeon.layout.monsters.some(d=>nt(e.position,d.position.x,d.position.y))?(t.actionLog.push(`${e.name} walked by a monster and lost the momentum`),e.movement=0):e.movement-=i},ln=(e,t,o,n)=>{const i=Ne(t.dungeon.layout.grid,o,n);i&&t.dungeon.discoveredRooms.push(i),zt(e,t,e.position.x,e.position.y,1),t.actionLog.push(`${e.name} opened a door`)},cn=(e,t,o,n)=>{if(e.actions===1&&e.movement!==3){t.actionLog.push(`${e.name} has no actions left to attack`);return}const i=t.dungeon.layout.monsters.find(A=>A.position.x===o&&A.position.y===n);if(i){const A=Re(e.level,3),c=Math.max(A-i.defense,0);t.actionLog.push(`${e.name} attacked ${i.name} for ${ot(c,A,i)}`),i.health-=c,i.health<=0&&(t.dungeon.layout.monsters=t.dungeon.layout.monsters.filter(d=>d!=i),t.actionLog.push(`${e.name} killed ${i.name}`),t.dungeon.killCount++,e.experience+=i.experience),e.actions>1&&e.movement<3?e.actions-=2:e.actions--}},Re=(e,t)=>{let o=[];for(let n=0;n<t;n++)o.push(Math.floor(Math.random()*6)+1);switch(e){case F.APPRENTICE:o=o.filter(n=>n===5);break;case F.KNIGHT:case F.HERO:o=o.filter(n=>n>=4);break;case F.LORD:case F.MASTER:o=o.filter(n=>n>=3);break}return o.length},xt=e=>{const t=e.currentActor;if(!t)return;if(!Vt(t)){e.actionLog.push(`${t.name} has no actions left to pick lock`);return}const o=e.dungeon.layout.doors.find(n=>n.x===t.position.x&&n.y===t.position.y);o&&o.locked&&(Re(t.level,1)>=1?(o.locked=!1,e.actionLog.push(`${t.name} managed to pick the lock`)):e.actionLog.push(`${t.name} failed to pick the lock`),t.actions>1&&t.movement<3?t.actions-=2:t.actions--,t.movement=3)},Ut=e=>{const t=e.currentActor;if(!t)return;if(!Vt(t)){e.actionLog.push(`${t.name} has no actions left to search`);return}const o=Re(t.level,1);if(o>=1){const n=e.dungeon.layout.doors.find(c=>c.hidden&&c.x===t.position.x&&c.y===t.position.y);n&&(e.actionLog.push(`${t.name} searched (${o}) and found a hidden door`),n.hidden=!1);const i=e.dungeon.layout.doors.find(c=>c.trapped&&c.x===t.position.x&&t.position.y);i&&!n&&(e.actionLog.push(`${t.name} searched (${o}) and found a trap in a door`),i.trapped=!1);const A=e.dungeon.layout.secrets.find(c=>nt(c.position,t.position.x,t.position.y));A&&!i&&!n&&e.actionLog.push(`${t.name} searched (${o}) and found ${A.name}`),!n&&!i&&!A&&e.actionLog.push(`${t.name} searched (${o}) but found nothing`)}else e.actionLog.push(`${t.name} searched (${o}) but found nothing`);t.actions>1&&t.movement<3?t.actions-=2:t.actions--,t.movement=3},Yt=e=>{if(gn(e),e.currentActor!==void 0){e.actionLog.push(`${e.currentActor.name} ended their turn`);let o=e.heroes.indexOf(e.currentActor)+1;o===e.heroes.length&&(fn(e),o=0),e.currentActor.actions=2,e.currentActor.movement=3,e.currentActor=e.heroes[o],e.actionLog.push(`${e.currentActor.name} started their turn`)}},gn=e=>{e.dungeon.winConditions.forEach(t=>{var o;switch(t.type){case q.KILL_ALL:{const n=e.dungeon.layout.monsters.map(i=>i.health).reduce((i,A)=>i+A,0);t.fulfilled=n<=0;break}case q.REACH_CELL:{t.fulfilled=e.heroes.some(n=>{var i;return n.position.x===((i=t.targetCell)==null?void 0:i.x)&&n.position.y===t.targetCell.y});break}case q.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(n=>n.type===t.targetMonsterType).some(n=>n.health>0);break}case q.OPEN_DOOR:{t.fulfilled=((o=e.dungeon.layout.doors.find(n=>{var i,A;return n.x===((i=t.targetCell)==null?void 0:i.x)&&n.y===((A=t.targetCell)==null?void 0:A.y)}))==null?void 0:o.open)??!1;break}case q.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,o)=>t&&o,!0),e.dungeon.beaten&&(e.actionLog.push("All win conditions have been fulfilled"),e.actionLog.push(`You have cleared ${e.dungeon.name}`))},dn=(e,t,o,n)=>{const i=e.dungeon.layout.doors.find(A=>A.x===t.position.x&&A.y===t.position.y);if(i&&!i.locked){const A=un(t.position.x,t.position.y,o,n);if(i.side===A){if(i.open=!0,i.trapped){const c=Re(F.APPRENTICE,i.trapAttacks),d=Math.max(c-t.defense,0);e.actionLog.push(`Door was trapped. ${t.name} took ${ot(d,c,t)}`),t.health-=d}return!0}}return i&&i.locked&&e.actionLog.push("Door is locked"),!1},un=(e,t,o,n)=>{if(e===o){if(t>n)return k.UP;if(t<n)return k.DOWN}if(t===n){if(e>o)return k.LEFT;if(e<o)return k.RIGHT}},et=(e,t,o)=>{let n=!0;if(t<0||t>=e.grid[0].length||o<0||o>=e.grid.length)n=!1;else{const i=Ne(e.grid,t,o);(i===nn||i===on||i===Me||i===Ve)&&(n=!1)}return n},tt=(e,t,o)=>{const n=Ne(e.layout.grid,t,o);return n?e.discoveredRooms.includes(n):!1},Ne=(e,t,o)=>{let n;return e.forEach((i,A)=>{de(i).forEach((c,d)=>{A===o&&d===t&&(n=c)})}),n},nt=(e,t,o)=>e.x===t&&e.y===o||e.x===t-1&&e.y===o||e.x===t-1&&e.y===o-1||e.x===t&&e.y===o-1||e.x===t+1&&e.y===o-1||e.x===t+1&&e.y===o||e.x===t+1&&e.y===o+1||e.x===t&&e.y===o+1||e.x===t-1&&e.y===o+1,fn=e=>{const t=e.dungeon.layout.monsters.filter(o=>{const n=Ne(e.dungeon.layout.grid,o.position.x,o.position.y);return n&&e.dungeon.discoveredRooms.includes(n)&&o.health>0});t.length===0&&e.actionLog.push("No monsters can act"),t.forEach(o=>{const n=o.actions;for(;o.actions>0;){e.actionLog.push(`${o.name} acted `);const i=e.heroes.filter(A=>nt(o.position,A.position.x,A.position.y));if(i.length>0){const A=Math.floor(Math.random()*i.length);En(e,o,i[A])}else Bn(e,o)}o.actions=n})};function Gt(e,t){return Math.sqrt(Math.pow(e.x-(t==null?void 0:t.x),2)+Math.pow(e.y-(t==null?void 0:t.y),2))}const Bn=(e,t)=>{const o=e.heroes.map(i=>({hero:i,dist:Gt(i.position,t.position)})).sort((i,A)=>i.dist-A.dist)[0],n=hn(e,t.position);if(n.length>0){const i=n.map(A=>({pos:A,dist:Gt(A,o.hero.position)})).sort((A,c)=>A.dist-c.dist)[0].pos;t.position=i,e.actionLog.push(`${t.name} moved towards ${o.hero.name} (${i.x},${i.y})`)}else e.actionLog.push(`${t.name} could not move`);t.actions--};let hn=(e,t)=>{const o=t.x,n=t.y,i=[];for(let A=o-1;A<=o+1;A++)for(let c=n-1;c<=n+1;c++)A===o&&c===n||et(e.dungeon.layout,A,c)&&tt(e.dungeon,A,c)&&i.push({x:A,y:c});return i.filter(A=>!e.heroes.find(c=>c.position.x===A.x&&c.position.y===A.y)).filter(A=>!e.dungeon.layout.monsters.find(d=>d.position.x===A.x&&d.position.y===A.y))};const ot=(e,t,o)=>`${e} damage (${t}-${o.defense}=${e})`,En=(e,t,o)=>{if(t.actions===1&&t.movement!==3){e.actionLog.push(`${o.name} has no actions left to attack`);return}if(o){const n=Re(t.level,3),i=Math.max(n-o.defense,0);e.actionLog.push(`${t.name} attacked ${o.name} for ${ot(i,n,o)}`),o.health-=i,o.health<=0&&(e.actionLog.push(`${t.name} killed ${o.name}`),e.heroes=e.heroes.filter(A=>A!==o)),(t==null?void 0:t.actions)>1&&(t==null?void 0:t.movement)<3?t.actions-=2:t.actions--}},Vt=e=>e.movement<3?e.actions>1:e.actions>0,Kt=(e,t)=>e.x===t.x&&e.y===t.y,Cn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAABAKADAAQAAAABAAABAAAAAABn6hpJAAAGiklEQVR4Ae3dS47iMBAA0DDiDogT9g6JY7ELJ2IJnKKnMxpLSQRRHJzxRPWyCQZ/n1ulFiqT3eVy+W5mXs/nszkcDjNrN01u/dkd/63Y9Z973e/35ng85jb7qP7UmKfTafdR5xoT+EBg37V9PB6zurher83X19dq9WdNolepm0/udbvdmvP53LRtm9t0cf0aYy6erIahBH6FWq3FEiAwEBAABhwKBGIJCACx9ttqCQwEBIABhwKBWAICQKz9tloCAwEBYMChQCCWgAAQa7+tlsBAQAAYcCgQiCUgAMTab6slMBD4kwk4eKdwoUvXXZKxN3caXZZd7tWl5i5plztOv36NMfvje03glcDqAaA7O9ClD69xvTsLMJV7n+bRpQOXvJaO+XMWoOQ09EUgS2D1ANDNZu5Zg6yZ/1R+959Fjdz7GmPmeqlPYCzgO4CxiDKBQAICQKDNtlQCYwEBYCyiTCCQgAAQaLMtlcBYQAAYiygTCCQgAATabEslMBYQAMYiygQCCQgAgTbbUgmMBQSAsYgygUAC+9xc/bXr59q/y+mvkXtfY8xcL/UJ9AV2Oc8F6Dec87oLFms+R+DdWYCpuc3J2Z9qv+SzqTE9F2CJqDalBLKeC5A76NrPEXh3FmBqnjVy9muMOWXgMwJJwHcAScKdQEABASDgplsygSQgACQJdwIBBQSAgJtuyQSSgACQJNwJBBQQAAJuuiUTSAICQJJwJxBQQAAIuOmWTCAJCABJwp1AQIHsswD/m9G7swBT86yRs19jzCkDnxHoBPY1fre/JP3S3/df2q4/96kc/3699PrVmJ4LkHTcawj8k7MAay+sbdu1h3jZvxz/lyze3JCA7wA2tFmmSqC0gABQWlR/BDYkIABsaLNMlUBpAQGgtKj+CGxIQADY0GaZKoHSAgJAaVH9EdiQgACwoc0yVQKlBQSA0qL6I7AhAQFgQ5tlqgRKC6x+FmDt5wjUzrGvPX7pPwj9ESBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAoJTAbwUM8lhPvL+bAAAAAElFTkSuQmCC",mn="data:image/png;base64,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";function pn(e){let t;return{c(){t=B("canvas"),this.h()},l(o){t=h(o,"CANVAS",{width:!0,height:!0,id:!0}),I(t).forEach(m),this.h()},h(){U(t,"width","860"),U(t,"height","750"),U(t,"id","gameBoard")},m(o,n){fe(o,t,n)},p:ce,i:ce,o:ce,d(o){o&&m(t)}}}const a=48;function In(e,t,o){let{state:n}=t,{debugMode:i=!0}=t;$e(()=>{const s=new Image;s.src=Cn;const E=new Image;E.src=mn,A(s,E),setInterval(()=>A(s,E),10)});const A=(s,E)=>{if(!n||!document)return;const r=document.getElementById("gameBoard"),l=r.getContext("2d");l.clearRect(0,0,r.width,r.height),n.dungeon.layout.grid.forEach((u,Q)=>{de(u).forEach((p,v)=>c(l,p,v,Q,s))}),n.dungeon.layout.grid.forEach((u,Q)=>{de(u).forEach((p,v)=>d(l,p,v,Q))}),n.dungeon.layout.grid.forEach((u,Q)=>{de(u).forEach((p,v)=>f(l,p,v,Q))}),n.dungeon.layout.grid.forEach((u,Q)=>{de(u).forEach((p,v)=>Z(l,p,v,Q,E))})},c=(s,E,r,l,u)=>{Te(E)||!n.dungeon.discoveredRooms.includes(E)&&E!==Me?n.dungeon.discoveredRooms.some(Q=>j(r,l,Q))&&s.drawImage(u,48,0,48,48,r*a,l*a,a,a):Y(E)?(s.beginPath(),s.strokeStyle="black",s.fillStyle="black",s.fillRect(r*a,l*a,a,a),s.stroke()):s.drawImage(u,0,0,48,48,r*a,l*a,a,a)},d=(s,E,r,l)=>{E===Me||E===Ve||(s.beginPath(),s.strokeStyle="black",s.rect(r*a,l*a,a,a),i&&(s.font="7px Arial",s.fillText(r+","+l,r*a+3,l*a+(a-3))),s.stroke())},f=(s,E,r,l)=>{const u=Be(r,l);if(u&&!u.hidden&&!u.open&&!Y(E))switch(s.fillStyle="brown",u.side){case k.RIGHT:{s.fillRect(r*a+(a-2),l*a,4,a),u.locked&&i&&(s.fillStyle="grey",s.fillRect(r*a+(a-4),l*a+(a/2-4),8,8)),u.trapped&&i&&(s.fillStyle="red",s.fillRect(r*a+(a-4),l*a+(a/2-4),4,4));break}case k.LEFT:{s.fillRect(r*a-2,l*a,4,a),u.locked&&i&&(s.fillStyle="grey",s.fillRect(r*a-4,l*a+(a/2-4),8,8)),u.trapped&&i&&(s.fillStyle="red",s.fillRect(r*a-4,l*a+(a/2-4),4,4));break}case k.UP:{s.fillRect(r*a,l*a-2,a,4),u.locked&&i&&(s.fillStyle="grey",s.fillRect(r*a+(a/2-4),l*a-4,8,8)),u.trapped&&i&&(s.fillStyle="red",s.fillRect(r*a+(a/2-4),l*a-4,4,4));break}case k.DOWN:{s.fillRect(r*a,l*a+(a-2),a,4),u.locked&&i&&(s.fillStyle="grey",s.fillRect(r*a+(a/2-4),l*a+(a-4),8,8)),u.trapped&&i&&(s.fillStyle="red",s.fillRect(r*a+(a/2-4),l*a+(a-4),4,4));break}}},C=(s,E,r,l)=>{s.beginPath(),s.strokeStyle=E.colour,s.fillStyle=E.colour,s.fillRect(r*a+4,l*a+(a-6),a-8,4),s.stroke()},y=(s,E,r,l)=>{i&&r.forEach(u=>{const Q=E.position.x,p=E.position.y,v=u.position.x,S=u.position.y;s.strokeStyle=E.colour,s.beginPath(),s.moveTo(Q*a+a/2,p*a+a/2),s.lineTo(v*a+a/2,S*a+a/2),s.stroke()})},L=(s,E,r,l)=>{s.beginPath(),s.strokeStyle="black",s.fillStyle="red",s.fillRect(r*a+4,l*a,a-8,4),s.fillStyle="green",s.fillRect(r*a+4,l*a,(a-8)*(E.health/E.maxHealth),4),s.rect(r*a+4,l*a,a-8,4),s.stroke()},w=(s,E)=>{if(s===n.currentActor&&i){for(let r=s.position.x-s.movement;r<=s.position.x+s.movement;r++)for(let l=s.position.y-s.movement;l<=s.position.y+s.movement;l++)if(tt(n.dungeon,r,l)){const Q=Jt(n,r,l),p=Xt(n,r,l),v=et(n.dungeon.layout,r,l);!p&&!Q&&v&&(E.fillStyle="rgba(50, 50, 255, 0.08)",E.fillRect(r*a,l*a,a,a),E.stroke())}}},Z=(s,E,r,l,u)=>{s.beginPath();const Q=n.heroes.find(p=>p.position.x===r&&p.position.y===l);if(Q)w(Q,s),s.drawImage(u,4*16,0,16,16,r*a,l*a,a,a),C(s,Q,r,l),L(s,Q,r,l);else{const p=n.dungeon.layout.monsters.find(v=>v.position.x===r&&v.position.y===l);if(p&&p.health>0&&!Y(E)){switch(p.type){case H.ORCH:s.drawImage(u,a,16,16,16,r*a,l*a,a,a);break;case H.TROLL:s.drawImage(u,a,16,16,16,r*a,l*a,a,a);break;default:s.drawImage(u,16,16,16,16,r*a,l*a,a,a);break}C(s,p,r,l),L(s,p,r,l),y(s,p,n.heroes)}}},Y=s=>s===Me||!n.dungeon.discoveredRooms.includes(s),Te=s=>s===Ve,Be=(s,E)=>n.dungeon.layout.doors.find(r=>r.x===s&&r.y===E),j=(s,E,r)=>{if(!n)return;const l=Math.max(s-1,0),u=Math.max(E-1,0),Q=Math.min(s+1,n.dungeon.layout.grid.length),p=Math.min(E+1,n.dungeon.layout.grid[0].length);for(let v=l;v<=Q;v++)for(let S=u;S<=p;S++){const De=n.dungeon.layout.grid[S];if(de(De)[v]===r)return!0}return!1};return e.$$set=s=>{"state"in s&&o(0,n=s.state),"debugMode"in s&&o(1,i=s.debugMode)},[n,i]}class vn extends Ze{constructor(t){super(),je(this,t,In,pn,Pe,{state:0,debugMode:1})}}function yn(e){let t;return{c(){t=B("canvas"),this.h()},l(o){t=h(o,"CANVAS",{id:!0,height:!0,width:!0}),I(t).forEach(m),this.h()},h(){U(t,"id","characterBoard"),U(t,"height","750"),U(t,"width","260")},m(o,n){fe(o,t,n)},p:ce,i:ce,o:ce,d(o){o&&m(t)}}}const ge=180;function Qn(e,t,o){let{state:n}=t;$e(()=>{i(),setInterval(i,100)});const i=()=>{if(!n||!document)return;const d=document.getElementById("characterBoard"),f=d.getContext("2d");f.clearRect(0,0,d.width,d.height),f.stroke(),n.heroes.forEach((C,y)=>A(f,d,C,y)),n.heroes.forEach((C,y)=>c(f,C,y))},A=(d,f,C,y)=>{d.fillStyle=C.colour,d.fillRect(12,y*ge+12,f.width,ge-12),d.stroke(),d.fillStyle="black"},c=(d,f,C)=>{const L=(f===n.currentActor?"> "+f.name:f.name)+" - "+f.level+" ("+f.experience+")";d.strokeStyle="black",d.font="18px Arial",d.fillText(L,16,C*ge+30),d.fillText("HP: "+f.health,16,C*ge+50),d.fillText("Actions: "+f.actions,16,C*ge+70),d.fillText("Moves: "+f.movement,16,C*ge+90),d.stroke()};return e.$$set=d=>{"state"in d&&o(0,n=d.state)},[n]}class Ln extends Ze{constructor(t){super(),je(this,t,Qn,yn,Pe,{state:0})}}function Ft(e){let t,o='<canvas width="860" height="100" id="logs"></canvas>';return{c(){t=B("div"),t.innerHTML=o,this.h()},l(n){t=h(n,"DIV",{class:!0,"data-svelte-h":!0}),_(t)!=="svelte-xcon9n"&&(t.innerHTML=o),this.h()},h(){U(t,"class","log svelte-60nygp")},m(n,i){fe(n,t,i)},p:ce,d(n){n&&m(t)}}}function kn(e){let t,o,n,i,A,c,d,f,C,y,L,w,Z,Y,Te="UL",Be,j,s,E="U",r,l,u,Q="UR",p,v,S,De="Next",be,G,he,ee,st="L",xe,Oe,Ue,Ee,te,it="R",Ye,Ce,ne,at="Search",Ge,K,me,oe,At="DL",Ke,pe,se,rt="D",Fe,Ie,ie,lt="DR",We,ve,ae,ct="Pick lock",qe,Ae,ye,re,gt="Save",Je,Qe,le,dt="Load",Xe,ut=e[0].actionLog,He,ze,ft;n=new Ln({props:{state:e[0]}});function $t(R){e[1](R)}let Bt={};e[0]!==void 0&&(Bt.state=e[0]),c=new vn({props:Bt}),Zt.push(()=>tn(c,"state",$t));let W=Ft();return{c(){t=B("div"),o=B("div"),bt(n.$$.fragment),i=T(),A=B("div"),bt(c.$$.fragment),f=T(),C=B("div"),y=B("div"),L=B("table"),w=B("tr"),Z=B("td"),Y=B("button"),Y.textContent=Te,Be=T(),j=B("td"),s=B("button"),s.textContent=E,r=T(),l=B("td"),u=B("button"),u.textContent=Q,p=T(),v=B("td"),S=B("button"),S.textContent=De,be=T(),G=B("tr"),he=B("td"),ee=B("button"),ee.textContent=st,xe=T(),Oe=B("td"),Ue=T(),Ee=B("td"),te=B("button"),te.textContent=it,Ye=T(),Ce=B("td"),ne=B("button"),ne.textContent=at,Ge=T(),K=B("tr"),me=B("td"),oe=B("button"),oe.textContent=At,Ke=T(),pe=B("td"),se=B("button"),se.textContent=rt,Fe=T(),Ie=B("td"),ie=B("button"),ie.textContent=lt,We=T(),ve=B("td"),ae=B("button"),ae.textContent=ct,qe=T(),Ae=B("tr"),ye=B("td"),re=B("button"),re.textContent=gt,Je=T(),Qe=B("td"),le=B("button"),le.textContent=dt,Xe=T(),W.c(),this.h()},l(R){t=h(R,"DIV",{class:!0});var M=I(t);o=h(M,"DIV",{class:!0});var Le=I(o);Ot(n.$$.fragment,Le),Le.forEach(m),i=D(M),A=h(M,"DIV",{class:!0});var ke=I(A);Ot(c.$$.fragment,ke),ke.forEach(m),M.forEach(m),f=D(R),C=h(R,"DIV",{class:!0});var _e=I(C);y=h(_e,"DIV",{class:!0});var ht=I(y);L=h(ht,"TABLE",{});var X=I(L);w=h(X,"TR",{});var z=I(w);Z=h(z,"TD",{});var Et=I(Z);Y=h(Et,"BUTTON",{"data-svelte-h":!0}),_(Y)!=="svelte-fw3uxo"&&(Y.textContent=Te),Et.forEach(m),Be=D(z),j=h(z,"TD",{});var Ct=I(j);s=h(Ct,"BUTTON",{"data-svelte-h":!0}),_(s)!=="svelte-1jeoia6"&&(s.textContent=E),Ct.forEach(m),r=D(z),l=h(z,"TD",{});var mt=I(l);u=h(mt,"BUTTON",{"data-svelte-h":!0}),_(u)!=="svelte-1p8c8vc"&&(u.textContent=Q),mt.forEach(m),p=D(z),v=h(z,"TD",{});var pt=I(v);S=h(pt,"BUTTON",{"data-svelte-h":!0}),_(S)!=="svelte-1rtxc14"&&(S.textContent=De),pt.forEach(m),z.forEach(m),be=D(X),G=h(X,"TR",{});var V=I(G);he=h(V,"TD",{});var It=I(he);ee=h(It,"BUTTON",{"data-svelte-h":!0}),_(ee)!=="svelte-10dnpu6"&&(ee.textContent=st),It.forEach(m),xe=D(V),Oe=h(V,"TD",{}),I(Oe).forEach(m),Ue=D(V),Ee=h(V,"TD",{});var vt=I(Ee);te=h(vt,"BUTTON",{"data-svelte-h":!0}),_(te)!=="svelte-12287ni"&&(te.textContent=it),vt.forEach(m),Ye=D(V),Ce=h(V,"TD",{});var yt=I(Ce);ne=h(yt,"BUTTON",{"data-svelte-h":!0}),_(ne)!=="svelte-cps1bu"&&(ne.textContent=at),yt.forEach(m),V.forEach(m),Ge=D(X),K=h(X,"TR",{});var $=I(K);me=h($,"TD",{});var Qt=I(me);oe=h(Qt,"BUTTON",{"data-svelte-h":!0}),_(oe)!=="svelte-1ji074i"&&(oe.textContent=At),Qt.forEach(m),Ke=D($),pe=h($,"TD",{});var Lt=I(pe);se=h(Lt,"BUTTON",{"data-svelte-h":!0}),_(se)!=="svelte-li5tq6"&&(se.textContent=rt),Lt.forEach(m),Fe=D($),Ie=h($,"TD",{});var kt=I(Ie);ie=h(kt,"BUTTON",{"data-svelte-h":!0}),_(ie)!=="svelte-3esmwe"&&(ie.textContent=lt),kt.forEach(m),We=D($),ve=h($,"TD",{});var Rt=I(ve);ae=h(Rt,"BUTTON",{"data-svelte-h":!0}),_(ae)!=="svelte-sacog4"&&(ae.textContent=ct),Rt.forEach(m),$.forEach(m),qe=D(X),Ae=h(X,"TR",{});var we=I(Ae);ye=h(we,"TD",{});var Tt=I(ye);re=h(Tt,"BUTTON",{"data-svelte-h":!0}),_(re)!=="svelte-1vr5zyk"&&(re.textContent=gt),Tt.forEach(m),Je=D(we),Qe=h(we,"TD",{});var Dt=I(Qe);le=h(Dt,"BUTTON",{"data-svelte-h":!0}),_(le)!=="svelte-1m2jkw7"&&(le.textContent=dt),Dt.forEach(m),we.forEach(m),X.forEach(m),ht.forEach(m),Xe=D(_e),W.l(_e),_e.forEach(m),this.h()},h(){U(o,"class","characterSide svelte-60nygp"),U(A,"class","boardSide svelte-60nygp"),U(t,"class","container svelte-60nygp"),U(y,"class","commands svelte-60nygp"),U(C,"class","container svelte-60nygp")},m(R,M){fe(R,t,M),g(t,o),Ht(n,o,null),g(t,i),g(t,A),Ht(c,A,null),fe(R,f,M),fe(R,C,M),g(C,y),g(y,L),g(L,w),g(w,Z),g(Z,Y),g(w,Be),g(w,j),g(j,s),g(w,r),g(w,l),g(l,u),g(w,p),g(w,v),g(v,S),g(L,be),g(L,G),g(G,he),g(he,ee),g(G,xe),g(G,Oe),g(G,Ue),g(G,Ee),g(Ee,te),g(G,Ye),g(G,Ce),g(Ce,ne),g(L,Ge),g(L,K),g(K,me),g(me,oe),g(K,Ke),g(K,pe),g(pe,se),g(K,Fe),g(K,Ie),g(Ie,ie),g(K,We),g(K,ve),g(ve,ae),g(L,qe),g(L,Ae),g(Ae,ye),g(ye,re),g(Ae,Je),g(Ae,Qe),g(Qe,le),g(C,Xe),W.m(C,null),He=!0,ze||(ft=[P(Y,"click",function(){N(b("UL",e[0]))&&b("UL",e[0]).apply(this,arguments)}),P(s,"click",function(){N(b("U",e[0]))&&b("U",e[0]).apply(this,arguments)}),P(u,"click",function(){N(b("UR",e[0]))&&b("UR",e[0]).apply(this,arguments)}),P(S,"click",function(){N(Yt(e[0]))&&Yt(e[0]).apply(this,arguments)}),P(ee,"click",function(){N(b("L",e[0]))&&b("L",e[0]).apply(this,arguments)}),P(te,"click",function(){N(b("R",e[0]))&&b("R",e[0]).apply(this,arguments)}),P(ne,"click",function(){N(Ut(e[0]))&&Ut(e[0]).apply(this,arguments)}),P(oe,"click",function(){N(b("DL",e[0]))&&b("DL",e[0]).apply(this,arguments)}),P(se,"click",function(){N(b("D",e[0]))&&b("D",e[0]).apply(this,arguments)}),P(ie,"click",function(){N(b("DR",e[0]))&&b("DR",e[0]).apply(this,arguments)}),P(ae,"click",function(){N(xt(e[0]))&&xt(e[0]).apply(this,arguments)}),P(re,"click",function(){N(Nt(e[0]))&&Nt(e[0]).apply(this,arguments)}),P(le,"click",e[2])],ze=!0)},p(R,[M]){e=R;const Le={};M&1&&(Le.state=e[0]),n.$set(Le);const ke={};!d&&M&1&&(d=!0,ke.state=e[0],jt(()=>d=!1)),c.$set(ke),M&1&&Pe(ut,ut=e[0].actionLog)?(W.d(1),W=Ft(),W.c(),W.m(C,null)):W.p(e,M)},i(R){He||(_t(n.$$.fragment,R),_t(c.$$.fragment,R),He=!0)},o(R){wt(n.$$.fragment,R),wt(c.$$.fragment,R),He=!1},d(R){R&&(m(t),m(f),m(C)),St(n),St(c),W.d(R),ze=!1,en(ft)}}}function Rn(e,t,o){let n=rn();$e(()=>{A(),setInterval(A,500),setInterval(i,1e3)});const i=()=>{if(n.dungeon.beaten&&n.dungeon.nextDungeon){o(0,n.dungeon=n.dungeon.nextDungeon,n);const f=Wt.filter(C=>!n.heroes.find(y=>C.name===y.name));n.heroes.push(...f),qt(n.heroes,n.dungeon),o(0,n.actionLog=[],n),n.actionLog.push("You have reached "+n.dungeon.name)}},A=()=>{if(!n||!document)return;const f=document.getElementById("logs"),C=f.getContext("2d");C.clearRect(0,0,f.width,f.height),n.actionLog.slice(-10).reverse().forEach((y,L)=>{C.font="12px Arial",C.fillStyle="black",C.fillText("> "+y,2,(L+1)*12+2),C.stroke()})};function c(f){n=f,o(0,n)}return[n,c,()=>o(0,n=An())]}class bn extends Ze{constructor(t){super(),je(this,t,Rn,kn,Pe,{})}}export{bn as component};
