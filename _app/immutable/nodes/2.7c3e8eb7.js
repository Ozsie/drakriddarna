import{s as Be,n as ge,o as Nn,b as Mn,f as wn,r as Qt}from"../chunks/scheduler.bc760b9c.js";import{S as dn,i as fn,g as f,h as m,j as p,f as d,k as P,a as L,x as c,y as V,s as I,m as w,c as O,n as x,o as pe,z as X,p as mn,t as re,b as hn,d as j,e as be,A as rt,B as xn,r as sn,u as an,v as ln,w as cn,l as yt,C as bo}from"../chunks/index.54d4ae92.js";const To=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Dn(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var $=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))($||{}),F=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(F||{}),ue=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(ue||{}),Me=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(Me||{}),oe=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(oe||{}),b=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(b||{}),U=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))(U||{});const Yn=[{name:"Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:U.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Two-handed Sword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:U.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"Halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:U.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"Flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:U.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"Double Headed Axe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:U.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],Sn=[{name:"Orch Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:U.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Orch Bow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:U.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"Troll Club",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:U.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],Co=[{name:"Chain mail",type:U.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"Plate mail",type:U.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"Dragon Skin mail",type:U.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],kt=[{name:"Orch Mail",defense:0,magicProtection:!1,amountInDeck:4,type:U.ARMOUR,movementReduction:0,value:0},{name:"Troll Skin",defense:1,magicProtection:!1,amountInDeck:4,type:U.ARMOUR,movementReduction:0,value:0}],Qn=" ",Pn="?",Zn="#",je=(e,t,n,o)=>({type:e,name:t,position:{x:n,y:o},found:!1}),Vn=(e,t,n,o)=>({type:e,name:o.name,position:{x:t,y:n},found:!1,item:o}),q=(e,t,n)=>({side:e,x:t,y:n,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),Do=(e,t,n,o)=>({...q(e,t,n),trapped:!0,trapAttacks:o}),Ln=(e,t,n)=>({...q(e,t,n),hidden:!0}),et=(e,t,n)=>({...q(e,t,n),locked:!0}),Ro=(e,t,n,o)=>({...q(e,t,n),hidden:!0,trapped:!0,trapAttacks:o}),ae=(e,t,n,o)=>{const r=Object.values($).indexOf(t),s=Object.keys($)[r];let i=ue.LORD,a=2,l=2,u=4,g=4,T=4,v=Sn[0],k,M=kt[0];switch(e){case F.ORCH:{i=ue.APPRENTICE,l=0,u=2,g=2,T=1,k=Sn[1];break}case F.TROLL:{i=ue.KNIGHT,l=1,u=3,g=3,T=2,v=Sn[2],M=kt[1];break}}return e===F.YELLOW_DARK_LORD&&(a=3),{type:e,level:i,colour:t,actions:a,defense:l,health:u,maxHealth:g,experience:T,name:e+" ("+s+")",movement:3,maxMovement:3,position:{x:n,y:o},weapon:v,armour:M,incapacitated:!1,inventory:[],rangedWeapon:k}},Io=e=>{const t=e.currentActor;if(t.blinded){h(e,`${t.name} is blinded and may not search.`);return}const n=t.inventory.filter(l=>{var u;return(u=l.properties)==null?void 0:u[At]}).map(l=>{var u;return h(e,`${t.name} used the effect of ${l.name} when searching`),(u=l.properties)==null?void 0:u[At]}).reduce((l,u)=>l+u,0),o=In(t.level,1+n);let r,s,i,a;o>=1?(r=$o(e,t,o),r||(s=Lo(e,t,o)),!r&&!s&&(i=No(e,t,o)),!r&&!s&&!i&&(a=Po(e,t,o)),!r&&!s&&!i&&!a&&h(e,`${t.name} searched but found nothing`)):h(e,`${t.name} searched but found nothing`)},Zt=e=>{const t=e.currentActor;if(!t)return!1;const n=e.dungeon.layout.secrets.filter(o=>o.type===oe.TRAP_DOOR).filter(o=>!o.found).find(o=>we(o.position,t.position));return n?(un(e,Oo(n),t,!1),h(e,`${t.name} fell into a pit and is incapacitated for one turn.`),t.movement=0,t.actions=0,t.incapacitated=!0,n.found=!0,!0):!1},Jt=(e,t)=>{const n=e.itemDeck.findIndex(o=>o.type===t.type&&o.name===t.name);e.itemDeck.splice(n,1)},St=(e,t)=>{const n=e.magicItemDeck.findIndex(o=>o.type===t.type&&o.name===t.name);e.magicItemDeck.splice(n,1)},Oo=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:$.Red,maxHealth:0,name:"Trap Door",level:ue.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:U.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),Mo=(e,t)=>e.dungeon.layout.doors.filter(n=>n.hidden).find(n=>Wn({x:n.x,y:n.y},t.x,t.y)),wo=(e,t)=>e.dungeon.layout.doors.filter(n=>n.trapped).find(n=>n.x===t.x&&n.y===t.y),xo=(e,t)=>e.dungeon.layout.secrets.filter(n=>!n.found).find(n=>Wn(n.position,t.x,t.y)),Ho=(e,t)=>e.dungeon.layout.secrets.filter(n=>!n.found).filter(n=>n.type===oe.TRAP_DOOR).find(n=>Wn(n.position,t.x,t.y)),Lo=(e,t,n)=>{const o=Mo(e,t.position);return o?(o.hidden=!1,h(e,`${t.name} searched (${n}) and found a hidden door`),!0):!1},No=(e,t,n)=>{const o=wo(e,t.position);return o?(h(e,`${t.name} searched (${n}) and found a trap in a door`),o.trapped=!1,!0):!1},Po=(e,t,n)=>{const o=xo(e,t.position);if(o){switch(h(e,`${t.name} searched (${n}) and found ${o.name}`),o.found=!0,o.type){case oe.EQUIPMENT:{let r=o.item??Bo(e);r.amountInDeck>0&&(Jt(e,r),h(e,`${t.name} equipped (${r.name})`),ro(e,r,t));break}case oe.MAGIC_ITEM:{let r=o.item??Uo(e);r.amountInDeck>0&&(St(e,r),h(e,`${t.name} found (${r.name})`),t.inventory.push(r),r.pickup&&it[r.pickup](e,r,t));break}}return!0}return!1},Bo=e=>{const t=e.itemDeck.length,n=Math.floor(Math.random()*t);return e.itemDeck[n]},Uo=e=>{const t=e.magicItemDeck.length,n=Math.floor(Math.random()*t);return e.magicItemDeck[n]},$o=(e,t,n)=>{const o=Ho(e,t.position);return o?(h(e,`${t.name} searched (${n}) and found ${o.name}`),o.found=!0,!0):!1},Fn=(e,t)=>(Yn[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:ue.APPRENTICE,health:7,maxHealth:7,colour:t,experience:0,position:{x:-1,y:-1},weapon:Yn[0],incapacitated:!1,inventory:[]}),de=(e,t)=>{t.reRender=!0;const n=t.currentActor;if(!n||n.actions===0)return;const o={x:n.position.x,y:n.position.y};switch(e){case"UL":o.x=n.position.x-1,o.y=n.position.y-1;break;case"U":o.y=n.position.y-1;break;case"UR":o.x=n.position.x+1,o.y=n.position.y-1;break;case"L":o.x=n.position.x-1;break;case"R":o.x=n.position.x+1;break;case"DL":o.x=n.position.x-1,o.y=n.position.y+1;break;case"D":o.y=n.position.y+1;break;case"DR":o.x=n.position.x+1,o.y=n.position.y+1;break}const r=Un(t,o.x,o.y),s=!Jn(t.dungeon.layout,o.x,o.y),i=Bn(t,o.x,o.y);if(!r&&!s){const a=Gn(t.dungeon,o.x,o.y);a?a&&(i?eo(n,t,o):so(n,t,o.x,o.y,1)):Ko(t,n,o.x,o.y)&&On(n,t,o.x,o.y)}else h(t,`${n.name} could not make that move`);Zt(t)||st(n)},nt=e=>{e.reRender=!0;const t=e.currentActor;if(!t)return;if(t.blinded){h(e,`${t.name} is blinded and may not search.`);return}if(!Rn(t)){h(e,`${t.name} has no actions left to pick lock`);return}const n=e.dungeon.layout.doors.find(o=>o.x===t.position.x&&o.y===t.position.y);n&&n.locked&&(In(t.level,1)>=1?(n.locked=!1,h(e,`${t.name} managed to pick the lock`)):h(e,`${t.name} failed to pick the lock`),t.actions>1&&t.movement<3?t.actions-=2:t.actions--,t.movement=Qe(t),t.actions==0&&(t.movement=0))},zt=e=>{e.reRender=!0,e.heroes.forEach((t,n)=>{t.position=e.dungeon.startingPositions[n],t.movement=Qe(t),t.actions=2,t.health=t.maxHealth})},B=e=>e.heroes.filter(t=>t.health>0),_t=e=>{e.reRender=!0;const t=e.currentActor;t&&(t.actions--,t.movement=Qe(t),t.actions===0&&Kn(e))},Rn=e=>e.movement<Qe(e)?e.actions>1:e.actions>0,On=(e,t,n,o)=>{t.reRender=!0;const r=Ye(t.dungeon.layout.grid,n,o);r&&t.dungeon.discoveredRooms.push(r),so(e,t,e.position.x,e.position.y,1),h(t,`${e.name} opened a door`)},eo=(e,t,n)=>{if(t.reRender=!0,e.actions===1&&e.movement<e.maxMovement){h(t,`${e.name} has no actions left to attack`);return}if(!e.weapon.useHearHeroes&&Xo(t,e)){h(t,`${e.name} could not use ${e.weapon.name} near a friend.`);return}const o=qo(t,n);o&&(un(t,e,o,!1),o.health<=0&&Vo(t,o,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},tt=e=>{e.reRender=!0;const t=e.currentActor;if(t){if(t.blinded){h(e,`${t.name} is blinded and may not search.`);return}if(!Rn(t)){h(e,`${t.name} has no actions left to search`);return}Io(e),t.actions>1&&t.movement<Qe(t)?t.actions-=2:t.actions--,t.actions==0&&(t.movement=0)}},Bn=(e,t,n)=>e.dungeon.layout.monsters.some(o=>o.position.x===t&&o.position.y===n&&o.health>0),Un=(e,t,n)=>B(e).some(o=>o.position.x===t&&o.position.y===n),st=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=Qe(e))),e.actions==0&&(e.movement=0)},Go=e=>{e.reRender=!0,B(e).forEach(t=>{const n=t.level;t.experience>=28?t.level=ue.MASTER:t.experience>=18?t.level=ue.LORD:t.experience>=10?t.level=ue.HERO:t.experience>=4&&(t.level=ue.KNIGHT),n!==t.level&&h(e,`${t.name} leveled up to ${t.level}`)})},Wo=e=>{B(e).forEach(t=>t.experience+=4)},Fo=e=>{jo(e).forEach(t=>{t.experience=0,t.health=t.maxHealth,t.movement=t.maxMovement,t.actions=2})},no=(e,t,n)=>!n.open&&!n.hidden&&(!n.locked||n.locked&&t)&&e.movement>0,to=(e,t)=>{const n=e.dungeon.layout.notes.find(o=>we(o.position,t.position));n&&(e.dungeon.layout.doors.some(r=>r.hidden&&we(n.position,{x:r.x,y:r.y}))||h(e,`${t.name} reads: ${n.message}`))},oo=(e,t)=>{const n=e.dungeon.layout.monsters.some(o=>Wn(t.position,o.position.x,o.position.y));return n&&h(e,`${t.name} walked by a monster and lost the momentum`),n},zn=(e,t,n)=>{e.dungeon.layout.items.push({item:t,position:n.position}),t.drop&&uo[t.drop](e,t,n)},ro=(e,t,n)=>{switch(t.type){case U.ARMOUR:n.armour&&zn(e,n.armour,n),n.armour=t;break;case U.SHIELD:n.shield&&zn(e,n.shield,n),n.shield=t;break;case U.WEAPON:n.weapon&&zn(e,n.weapon,n),n.weapon=t;break;default:n.inventory.push(t);break}if(t.pickup){const o=it[t.pickup];o(e,t,n)}},so=(e,t,n,o,r)=>{e.position.x=n,e.position.y=o,to(t,e),oo(t,e)?e.movement=0:e.movement-=r},Ko=(e,t,n,o)=>{const r=e.dungeon.layout.doors.find(i=>i.x===t.position.x&&i.y===t.position.y),s=t.inventory.some(i=>{var a;return(a=i.properties)==null?void 0:a[io]});if(r&&no(t,s,r)){r.locked&&s&&h(e,`${t.name} broke the locked door`);const i=Yo(t.position.x,t.position.y,n,o);if(r.side===i)return r.open=!0,r.trapped&&un(e,ko(r),t,!1),!0}return r&&r.locked&&h(e,"Door is locked"),!1},Yo=(e,t,n,o)=>{if(e===n){if(t>o)return b.UP;if(t<o)return b.DOWN}if(t===o){if(e>n)return b.LEFT;if(e<n)return b.RIGHT}},Vo=(e,t,n)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(o=>o!=t),h(e,`${n.name} killed ${t.name}`),e.dungeon.killCount++,n.experience+=t.experience},qo=(e,t)=>e.dungeon.layout.monsters.find(n=>we(n.position,t)),Xo=(e,t)=>_o(e,t).filter(n=>n!==t).length>0,jo=e=>e.heroes.filter(t=>t.health<=0),Fe="USED",Et="ATTACK_BONUS",At="SEARCH_BONUS",io="BREAK_LOCK",bt="RE_ROLL_ATTACK",Tt="DESCRIPTION",qn="ACTIVE",Xn="MOVEMENT_BONUS",Ct="ACTIONS_BONUS",ao="RESET_ON",lo="NEXT_TURN",Qo="TRADE",co="NEXT_SCENARIO",it={movementBonusOnPickup:(e,t,n)=>{var o,r;n.maxMovement+=(o=t.properties)==null?void 0:o[Xn],n.movement+=(r=t.properties)==null?void 0:r[Xn]}},uo={movementBonusOnDrop:(e,t,n)=>{var o,r;n.maxMovement-1>0&&(n.maxMovement-=(o=t.properties)==null?void 0:o[Xn]),n.movement-1>=0&&(n.movement-=(r=t.properties)==null?void 0:r[Xn])}},Zo={magicHerbsOnUse:(e,t,n,o)=>{if(t.disabled){h(e,`${t.name} cannot be used at this moment.`);return}if(!o){h(e,"No target was selected.");return}if(!Rn(n)){h(e,`${n.name} has no actions left.`);return}if(t.properties){if(t.properties[Fe]){h(e,`${t.name} has no uses left.`);return}t.properties[Fe]=!0;let r=Math.min(In(n.level,3),o.maxHealth-o.health);o.health+=r,h(e,`${n.name} used ${t.name} on ${o.name}, restoring ${r} HP`),n.actions--,n.movement=n.maxMovement}},chaosSwordOnUse:(e,t,n,o)=>{if(t.disabled){h(e,`${t.name} cannot be used at this moment.`);return}},potionOfSpeedOnUse:(e,t,n)=>{var o,r,s;if(t.disabled){h(e,`${t.name} cannot be used at this moment.`);return}(o=t.properties)!=null&&o[Fe]?h(e,`${t.name} has been consumed.`):(n.actions+=(r=t.properties)==null?void 0:r[Ct],t.properties&&(t.properties[Fe]=!0),h(e,`${n.name} used ${t.name}, adding ${(s=t.properties)==null?void 0:s[Ct]} actions`))},necklaceOfLightOnUse:(e,t,n,o)=>{var r;if(t.disabled){h(e,`${t.name} cannot be used at this moment.`);return}if(!o){h(e,"No target was selected.");return}if(!Rn(n)){h(e,`${n.name} has no actions left.`);return}t.properties&&!((r=t.properties)!=null&&r[Fe])&&(t.properties[Fe]=!0,o.ignoredByMonsters=!0,n.actions--)}},fo={magicHerbsOnReset:(e,t)=>{t.properties&&(t.properties[Fe]=!1)},necklaceOfLightOnUse:(e,t)=>{t.properties&&(t.properties[Fe]=!1),e.heroes.forEach(n=>n.ignoredByMonsters=!1)}},Jo=(e,t)=>{if(t.effect&&e.currentActor){const n=Zo[t.effect];n(e,t,e.currentActor,e.targetActor),e.targetActor=void 0}},So=e=>{e.heroes.forEach(t=>{t.inventory.filter(n=>nr(n)).forEach(n=>{if(n.reset){const o=fo[n.reset];o(e,n)}})})},zo=e=>{e.heroes.forEach(t=>{t.inventory.filter(n=>er(n)).forEach(n=>{if(n.reset){const o=fo[n.reset];o(e,n)}})})},er=e=>e.properties?(e.properties[ao]??[]).some(n=>n===lo):!1,nr=e=>e.properties?(e.properties[ao]??[]).some(n=>n===co):!1,Ke=[{name:"Healing Herbs",type:U.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"Chance to heal up to 3 wounds on one hero.",RESET_ON:[Qo,co]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"Thousand League Boots",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives one additional step for each move action.",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"Giants Glove",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional attack die. Breaks locked doors.",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"Ring of Precision",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"May re-roll one completely missed attack.",RE_ROLL_ATTACK:!0}},{name:"Crown of Wisdom",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional die roll when searching.",SEARCH_BONUS:1}},{name:"Sword of Chaos",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"A sword with a will of it's own. Use at your own peril."},effect:"chaosSwordOnUse"},{name:"Potion of Speed",type:U.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives 2 additional actions. Can only be used once.",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"Necklace of Light",type:U.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[lo],ACTIVE:!0},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],mo={name:"The Mines of Evil",beaten:!1,winConditions:[{type:Me.KILL_ALL,fulfilled:!1},{type:Me.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[q(b.UP,2,13),q(b.UP,2,10),q(b.RIGHT,3,8),et(b.RIGHT,6,8),q(b.UP,8,7),q(b.UP,8,4),Ln(b.LEFT,7,2),q(b.LEFT,4,2),et(b.RIGHT,12,2),q(b.RIGHT,15,2),q(b.DOWN,17,7),q(b.DOWN,17,10),Ln(b.DOWN,17,14)],monsters:[ae(F.TROLL,$.Red,3,7),ae(F.ORCH,$.Red,12,8),ae(F.ORCH,$.Green,11,1),ae(F.TROLL,$.Green,2,2),ae(F.ORCH,$.Yellow,18,7),ae(F.TROLL,$.Yellow,17,10)],secrets:[je(oe.EQUIPMENT,"Equipment",1,3),je(oe.EQUIPMENT,"Equipment",3,3),je(oe.EQUIPMENT,"Equipment",15,2),Vn(oe.MAGIC_ITEM,2,3,Ke[1]),Vn(oe.MAGIC_ITEM,16,11,Ke[6])],notes:[{message:"Guard room",position:{x:2,y:10}},{message:"Look in the pillar room for the armory of the dwarf king",position:{x:8,y:10}},{message:"To reach the treasure of the ice dragon, look behind the mirror in the alchemy laboratory.",position:{x:2,y:3}},{message:"A large mirror decorates the far wall of this room.",position:{x:17,y:11}}],items:[]},killCount:0},ho={name:"The Three Gates of Power",nextDungeon:mo,beaten:!1,winConditions:[{type:Me.KILL_ALL,fulfilled:!1},{type:Me.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[q(b.RIGHT,3,5),q(b.RIGHT,6,5),q(b.RIGHT,10,6),q(b.RIGHT,13,6),q(b.RIGHT,10,9),q(b.RIGHT,13,9),q(b.RIGHT,12,3),Ln(b.UP,9,4),Ln(b.RIGHT,15,2)],monsters:[ae(F.ORCH,$.Blue,10,8),ae(F.ORCH,$.Red,13,9),ae(F.TROLL,$.Red,16,2),ae(F.TROLL,$.Yellow,14,7)],secrets:[je(oe.EQUIPMENT,"Random Equipment",10,5),je(oe.EQUIPMENT,"Random Equipment",13,1),je(oe.EQUIPMENT,"Random Equipment",16,10),Vn(oe.MAGIC_ITEM,16,6,Ke[0])],notes:[{message:"Beyond stone and fire you shall find the Dread tunnel, the road to the Ice Dragons treasure.",position:{x:2,y:4}},{message:"The Gate of Water. <There is an image of a sea dragon under the text>",position:{x:9,y:8}},{message:"The Gate of Air. <There is an image of a pegasus under the text>",position:{x:9,y:5}},{message:"The Gate of Fire. <There is an image of a hippogriph under the text>",position:{x:9,y:3}}],items:[]},killCount:0},po={name:"Troll cave",beaten:!1,winConditions:[{type:Me.KILL_ALL,fulfilled:!1}],nextDungeon:ho,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[q(b.RIGHT,3,9),q(b.RIGHT,6,9),q(b.UP,7,7),q(b.UP,7,4)],monsters:[ae(F.ORCH,$.Green,6,9),ae(F.ORCH,$.Yellow,8,10),ae(F.ORCH,$.Red,7,5),ae(F.ORCH,$.Red,9,3),ae(F.TROLL,$.Green,6,1)],secrets:[je(oe.NOTE,"Welcome to Drakriddarna",3,9)],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},tr=[{name:"Large shield",type:U.SHIELD,amountInDeck:2,dice:2,value:2},{name:"Small shield",type:U.SHIELD,amountInDeck:2,dice:1,value:1}],or=()=>{const e=[];return Ke.forEach(t=>{for(let n=0;n<t.amountInDeck;n++)e.push(t)}),e},rr=()=>{const e=[];return Yn.forEach(t=>{for(let n=0;n<t.amountInDeck;n++)e.push(t)}),Co.forEach(t=>{for(let n=0;n<t.amountInDeck;n++)e.push(t)}),tr.forEach(t=>{for(let n=0;n<t.amountInDeck;n++)e.push(t)}),e},rn={name:"Treasure of the Ice Dragon",dungeons:[po,ho,mo],itemDeck:rr(),magicItemDeck:or(),heroes:[Fn("Fearik",$.Yellow),Fn("Helbran",$.Red),Fn("Siedel",$.Green),Fn("Wulf",$.Blue)]},sr=e=>{const t=ur(e);t.length===0&&h(e,"No monsters can act"),t.forEach(n=>{const o=n.actions;for(h(e,`${n.name} acted `);n.actions>0;){e.reRender=!0;const r=_o(e,n).filter(a=>!a.ignoredByMonsters),s=cr(e,n);switch(ir(e,n,r,s)){case"MELEE_ATTACK":{const a=lr(r);Dt(e,n,a,!1);break}case"RANGED_ATTACK":{const a=ar(s,n);Dt(e,n,a,!0);break}case"MOVE":{fr(e,n);break}}n.movement=Qe(n)}n.actions=o,n.movement=Qe(n)})},ir=(e,t,n,o)=>n.length>0?"MELEE_ATTACK":t.rangedWeapon&&o.length>0&&t.rangedWeapon?Math.random()<.1?(h(e,`${t.name} decided to move despite seeing a target.`),"MOVE"):"RANGED_ATTACK":"MOVE",ar=(e,t)=>e.filter(n=>!n.shield).sort(n=>Hn(t.position,n.position)).sort((n,o)=>o.health-n.health||Hn(t.position,n.position)-Hn(t.position,o.position))[0],lr=e=>e.sort((t,n)=>n.health-t.health)[0],cr=(e,t)=>B(e).filter(n=>!n.ignoredByMonsters).filter(n=>at(t.position,n.position,48,e,!1)),ur=e=>e.dungeon.layout.monsters.filter(t=>{const n=Ye(e.dungeon.layout.grid,t.position.x,t.position.y);return n&&Se(e.dungeon,n)&&t.health>0}),Dt=(e,t,n,o)=>{un(e,t,n,o),(t==null?void 0:t.actions)>1&&(t==null?void 0:t.movement)<3?t.actions-=2:t.actions--},dr=(e,t)=>B(e).map(n=>({hero:n,dist:Hn(n.position,t.position)})).sort((n,o)=>n.dist-o.dist)[0],fr=(e,t)=>{const n=dr(e,t);for(;t.movement>0;){if(n.dist>1){const o=mr(e,t.position);if(o.length>0){const r=o.map(s=>({pos:s,dist:Hn(s,n.hero.position)})).sort((s,i)=>s.dist-i.dist)[0].pos;t.position=r,h(e,`${t.name} moved towards ${n.hero.name} (${r.x},${r.y})`)}else h(e,`${t.name} could not move`)}t.movement--}t.actions--},mr=(e,t)=>{const n=t.x,o=t.y,r=[];for(let s=n-1;s<=n+1;s++)for(let i=o-1;i<=o+1;i++)s===n&&i===o||Jn(e.dungeon.layout,s,i)&&Gn(e.dungeon,s,i)&&r.push({x:s,y:i});return r.filter(s=>!B(e).find(i=>i.position.x===s.x&&i.position.y===s.y)).filter(s=>!e.dungeon.layout.monsters.some(i=>i.position.x===s.x&&i.position.y===s.y))},Rt=[{name:"The Hungry Troll",number:1,description:"You suddenly hear a terrible roar echo in the halls behind you. It's the sound of a hungry troll",effect:"theHungryTroll",used:!1},{name:"The Sun Stone",number:2,description:"One of you kicks a pile of rubble, revealing a small, transparent crystal. It radiates a warm, yellow light turning all nearby trolls to stone.",effect:"sunStone",used:!1},{name:"The Time Portal",number:3,description:"You notice how everything around you seem to move slower, as if time it self had slowed down.",effect:"timePortal",used:!1},{name:"The Fountain of Youth",number:4,description:"You hear the weak sound of water running from a wall. When you taste it, you feel stronger than before",effect:"fountainOfYouth",used:!1},{name:"Sleeping Gas Cloud",number:5,description:"Noxious gas seeps through a hole in the wall, making you feel heavy and sleepy.",effect:"sleepingGasCloud",used:!1},{name:"The Lost Orch",number:6,description:"You hear a snarling filled with rage somewhere behind you. You quickly realise there were more monsters here than you thought.",effect:"theLostOrch",used:!1},{name:"The Dragons Breath",number:7,description:"The flames of your torches start to flicker and soon the dungeon is completely dark.",effect:"theDragonsBreath",used:!1},{name:"Landslide",number:8,description:"The ground starts shaking, and you hear a loud crash, as if the ceiling had fallen down.",effect:"landslide",used:!1},{name:"The Magic Node",number:9,description:"You feel a strange, powerful magic course through you. You feel invigorated by it as you press on.",effect:"fountainOfYouth",used:!1},{name:"Foresight",number:10,description:"You see before you a powerful object, hidden behind thick walls.",effect:"foresight",used:!1},{name:"Earthquake",number:11,description:"The whole room starts shaking and you are thrown to the ground. Stones fall from the ceiling and walls and with terror you realise that you ar caught in an earhtquake.",effect:"earthquake",used:!1},{name:"The Magic Storm",number:12,description:"An unsettling wind blows through the dungeon. You freeze as a green glow emanates from one of your magical items",effect:"theMagicStorm",used:!1},{name:"The Elemental Weapon",number:13,description:"A flame suddenly shoots from a silver clad stone in the ceiling, moving towards one of your weapons. The weapon becomes engulfed in flames, feeling more powerful than before.",effect:"theElementalWeapon",used:!1},{name:"The Orch Drums",number:14,description:"You hear the sound of drums from deep below you. As the sound draws nearer, you realise the orchs are on the march.",effect:"theOrchDrums",used:!1},{name:"The Symbol of Weakness",number:15,description:"You walk past a strange symbol on the wall. An evil, yellow glow emanates from it. All of you suddenly feel weaker.",effect:"theSymbolOfWeakness",used:!1}],go=e=>e.events?ot(Rt.filter(t=>{var n;return(n=e==null?void 0:e.events)==null?void 0:n.includes(t.number)})):ot(Rt),vo=e=>{const t=e.eventDeck.filter(n=>!n.used);return t.length>0?t[0]:(ot(e.eventDeck),vo(e))},hr={sunStone:(e,t)=>{Ae(e,t);const n=B(e).length-1,o=Math.floor(Math.random()*n),r=B(e)[o],s=Ye(e.dungeon.layout.grid,r.position.x,r.position.y);e.dungeon.layout.monsters.filter(i=>i.type===F.TROLL).filter(i=>Ye(e.dungeon.layout.grid,i.position.x,i.position.y)===s).forEach(i=>{h(e,`${i.name} was killed by the Sun Stone`),i.health=0}),t.used=!0},theHungryTroll:(e,t)=>{Ae(e,t),It(e,F.TROLL),t.used=!0},timePortal:(e,t)=>{Ae(e,t),e.heroes.forEach(n=>n.actions++),t.used=!0},fountainOfYouth:(e,t)=>{Ae(e,t),B(e).forEach(n=>{if(n.health<n.maxHealth){const o=In(n.level,3);n.health+=Math.min(o,n.maxHealth-n.health)}}),t.used=!0},sleepingGasCloud:(e,t)=>{Ae(e,t),B(e).forEach(n=>{n.actions=Math.max(1,n.actions-1)}),t.used=!0},theLostOrch:(e,t)=>{Ae(e,t),It(e,F.ORCH),t.used=!0},theDragonsBreath:(e,t)=>{Ae(e,t),B(e).forEach(n=>n.blinded=!0),t.used=!0},landslide:(e,t)=>{Ae(e,t);const n=e.dungeon.layout.corridors.filter(i=>!Er(e,i)).filter(i=>Se(e.dungeon,i)),o=n.length-1,r=Math.floor(Math.random()*o),s=n[r];e.dungeon.collapsedCorridor=s,e.dungeon.layout.grid=e.dungeon.layout.grid.map(i=>i.replaceAll(s,Pn)),t.used=!0},foreSight:(e,t)=>{if(Ae(e,t),e.dungeon.layout.secrets.filter(o=>o.type===oe.EQUIPMENT||o.type===oe.MAGIC_ITEM).filter(o=>!o.found).filter(o=>o.item).filter(o=>{const r=Ye(e.dungeon.layout.grid,o.position.x,o.position.y)??"";return!Se(e.dungeon,r)}).length>0){const o=e.dungeon.layout.secrets.pop();o&&o.item&&(h(e,`You sense the object is close to (${o.position.x+2},${o.position.y-1})`),e.dungeon.layout.items.push({item:o.item,position:o.position}))}t.used=!0},earthquake:(e,t)=>{Ae(e,t);const n=yo(e),o={name:"boulder",type:U.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},r={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:o,level:ue.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:$.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(s=>s.type===F.TROLL).filter(s=>Ye(e.dungeon.layout.grid,s.position.x,s.position.y)===n).forEach(s=>un(e,r,s,!1)),B(e).filter(s=>Ye(e.dungeon.layout.grid,s.position.x,s.position.y)===n).forEach(s=>un(e,r,s,!1)),t.used=!0},theMagicStorm:(e,t)=>{var o;Ae(e,t);const n=B(e).filter(r=>r.inventory.filter(s=>!s.disabled).some(s=>s.type===U.MAGIC));if(n.length>0){const r=n.length-1,s=Math.floor(Math.random()*r),i=n[s],a=i.inventory.filter(l=>l.type===U.MAGIC);if(a.length>0){const l=a.length-1,u=Math.floor(Math.random()*l),g=a[u];g.disabled=!0,!((o=g.properties)!=null&&o[qn])&&g.pickup&&g.drop&&uo[g.drop](e,g,i)}}t.used=!0},theElementalWeapon:(e,t)=>{Ae(e,t);const n=B(e),o=n.length-1,r=Math.floor(Math.random()*o),s=n[r];s.weapon.elemental=!0,t.used=!0},theOrchDrums:(e,t)=>{Ae(e,t),e.dungeon.layout.monsters.filter(n=>n.type===F.ORCH).forEach(n=>n.actions=3),t.used=!0},theSymbolOfWeakness:(e,t)=>{Ae(e,t),B(e).forEach(n=>n.weakened=!0),t.used=!0}},pr=e=>{B(e).some(t=>t.weapon.elemental)&&(h(e,"The magic storm calmed down"),B(e).forEach(t=>{t.inventory.forEach(n=>{var o;!((o=n.properties)!=null&&o[qn])&&n.pickup&&it[n.pickup](e,n,t),n.disabled=!1})}))},gr=e=>{e.eventDeck.filter(n=>!n.used).length===0&&(kr(e),vr(e),pr(e)),_r(e),yr(e)},vr=e=>{const t=e.dungeon.collapsedCorridor;t&&(h(e,"The collapsed corridor cleared up."),e.dungeon.layout.grid=e.dungeon.layout.grid.map(n=>n.replaceAll(Pn,t)),e.dungeon.collapsedCorridor=void 0)},yr=e=>{B(e).some(t=>t.blinded)&&(h(e,"You light your torches again."),B(e).forEach(t=>t.blinded=!1))},kr=e=>{B(e).some(t=>t.weapon.elemental)&&(h(e,"The elemental magic died off."),B(e).forEach(t=>t.weapon.elemental=!1))},_r=e=>{B(e).some(t=>t.weakened)&&(h(e,"Your strength returns to you."),B(e).forEach(t=>t.weakened=!1))},yo=e=>{const t=e.dungeon.discoveredRooms.length-1,n=Math.floor(Math.random()*t);return e.dungeon.discoveredRooms[n]},It=(e,t)=>{const n=e.dungeon.layout.monsters.filter(a=>a.type===t);if(n.length===4)return;const r=yo(e),s=[$.Red,$.Green,$.Yellow,$.Blue];n.forEach(a=>{const l=s.indexOf(a.colour);l!==-1&&s.splice(l,1)});let i=!1;for(let a=0;a<e.dungeon.layout.grid.length;a++){const l=$n(e.dungeon.layout.grid[a]);for(let u=0;u<l.length;u++)if(l[u]===r&&!Un(e,u,a)&&!Bn(e,u,a)){e.dungeon.layout.monsters.push(ae(t,s[0],u,a)),i=!0;break}if(i)break}},Ae=(e,t)=>{h(e,`${t.description}`),h(e,`${t.number}. ${t.name}`)},ot=e=>{let t=e.length,n;for(;t>0;)n=Math.floor(Math.random()*t),t--,[e[t],e[n]]=[e[n],e[t]];return e.forEach(o=>o.used=!1),e},Er=(e,t)=>{const n=[];return e.dungeon.layout.grid.forEach((o,r)=>{$n(o).forEach((s,i)=>{s===t&&n.push(Un(e,i,r)||Bn(e,i,r))})}),n.some(o=>o)},Ot=e=>{e.reRender=!0,h(e,"Game saved."),localStorage.setItem("state",JSON.stringify(e))},Mt=()=>{const e=localStorage.getItem("state");if(e){const t=JSON.parse(e);return t.currentActor=t.heroes.find(n=>{var o;return n.name===((o=t.currentActor)==null?void 0:o.name)}),h(t,"Game loaded."),t.reRender=!0,t}},Ar=()=>{const e={heroes:rn.heroes,dungeon:rn.dungeons[0],currentActor:rn.heroes[0],actionLog:[`Playing '${rn.name}'`,"Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."],itemDeck:wt(rn.itemDeck),magicItemDeck:wt(rn.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:go(rn.dungeons[0]),reRender:!0};return zt(e),e},wt=e=>{let t=e.length,n;for(;t>0;)n=Math.floor(Math.random()*t),t--,[e[t],e[n]]=[e[n],e[t]];return e},$n=e=>{let t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t},In=(e,t)=>{let n=[];for(let o=0;o<t;o++)n.push(Math.floor(Math.random()*6)+1);switch(e){case ue.APPRENTICE:n=n.filter(o=>o===5);break;case ue.KNIGHT:case ue.HERO:n=n.filter(o=>o>=4);break;case ue.LORD:case ue.MASTER:n=n.filter(o=>o>=3);break}return n.length},Qe=e=>{var t;return e.maxMovement-(((t=e.armour)==null?void 0:t.movementReduction)??0)},Kn=e=>{if(e.reRender=!0,br(e),e.currentActor!==void 0){h(e,`${e.currentActor.name} ended their turn`);let n=B(e).indexOf(e.currentActor)+1;if(n===B(e).length&&(sr(e),n=0,zo(e)),B(e)[n].incapacitated&&(h(e,`${B(e)[n].name} is no longer incapacitated.`),B(e)[n].incapacitated=!1,n++),e.currentActor.actions=2,e.currentActor.movement=Qe(e.currentActor),e.currentActor=B(e)[n],n===0){gr(e);const o=vo(e);hr[o.effect](e,o)}h(e,`${e.currentActor.name} started their turn`)}},br=e=>{var t;e.dungeon.winConditions.forEach(n=>{var o;switch(n.type){case Me.KILL_ALL:{const r=e.dungeon.layout.monsters.map(s=>s.health).reduce((s,i)=>s+i,0);n.fulfilled=r<=0;break}case Me.REACH_CELL:{n.fulfilled=B(e).some(r=>{var s;return r.position.x===((s=n.targetCell)==null?void 0:s.x)&&r.position.y===n.targetCell.y});break}case Me.KILL_ALL_OF_TYPE:{n.fulfilled=e.dungeon.layout.monsters.filter(r=>r.type===n.targetMonsterType).some(r=>r.health>0);break}case Me.OPEN_DOOR:{n.fulfilled=((o=e.dungeon.layout.doors.find(r=>{var s,i;return r.x===((s=n.targetCell)==null?void 0:s.x)&&r.y===((i=n.targetCell)==null?void 0:i.y)}))==null?void 0:o.open)??!1;break}case Me.KILL_AT_LEAST:{n.fulfilled=(n.killMinCount?n.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(n=>n.fulfilled).reduce((n,o)=>n&&o,!0),e.dungeon.beaten&&(h(e,"All win conditions have been fulfilled"),h(e,`You have cleared ${e.dungeon.name}`),h(e,`Press 'Next' to move on to the next level: ${(t=e.dungeon.nextDungeon)==null?void 0:t.name}`))},ko=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:$.Red,maxHealth:0,name:"Door",level:ue.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:U.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),Jn=(e,t,n)=>{var r,s;let o=!0;if(t<0||t>=e.grid[0].length||n<0||n>=e.grid.length)o=!1;else{const i=(r=e.pits)==null?void 0:r.some(u=>we(u,{x:t,y:n})),a=(s=e.pillars)==null?void 0:s.some(u=>we(u,{x:t,y:n})),l=Ye(e.grid,t,n);(i||a||l===Qn||l===Zn)&&(o=!1)}return o},Gn=(e,t,n)=>{const o=Ye(e.layout.grid,t,n);return o?Se(e,o):!1},Se=(e,t)=>e.discoveredRooms.includes(t),Ye=(e,t,n)=>{let o="";return e.forEach((r,s)=>{$n(r).forEach((i,a)=>{s===n&&a===t&&(o=i)})}),o},Wn=(e,t,n)=>e.x===t&&e.y===n||e.x===t-1&&e.y===n||e.x===t-1&&e.y===n-1||e.x===t&&e.y===n-1||e.x===t+1&&e.y===n-1||e.x===t+1&&e.y===n||e.x===t+1&&e.y===n+1||e.x===t&&e.y===n+1||e.x===t-1&&e.y===n+1,Tr=(e,t,n,o)=>{var s;const r=((s=o.armour)==null?void 0:s.defense)??o.defense;return`${e} damage (${t}-(${r}+${n})=${e})`},we=(e,t)=>e.x===t.x&&e.y===t.y,h=(e,t)=>{e.actionLog=[t,...e.actionLog],e.reRender=!0},un=(e,t,n,o)=>{var y,_;let r=t.weapon;o&&t.rangedWeapon&&(r=t.rangedWeapon);let s=0,i=0;r.ignoresArmour?n.armour&&h(e,`${n.name}'s armour was useless against ${r.name} `):s=((y=n.armour)==null?void 0:y.defense)??n.defense,r.ignoresShield?n.shield&&h(e,`${n.name}'s shield was useless against ${r.name} `):i=In(n.level,((_=n.shield)==null?void 0:_.dice)??0);const a=t.inventory.filter(R=>{var E;return(E=R==null?void 0:R.properties)==null?void 0:E[bt]}).some(R=>{var E;return h(e,`${t.name} used the effect of ${R.name} when attacking`),(E=R.properties)==null?void 0:E[bt]}),l=t.inventory.filter(R=>{var E;return(E=R==null?void 0:R.properties)==null?void 0:E[Et]}).map(R=>{var E;return h(e,`${t.name} used the effect of ${R.name} when attacking`),(E=R.properties)==null?void 0:E[Et]}).reduce((R,E)=>R+E,0);let u=t.blinded?1:0,g=t.weakened?1:0,T=t.weapon.elemental?1:0;const v=l+T,k=u+g,M=In(t.level,r.dice+v-k);let H=Math.max(M-(s+i),0);H===0&&a&&(h(e,`${t.name} missed but got another chance`),H=Math.max(M-(s+i),0)),n.health-=H,h(e,`${t.name} attacked ${n.name} with ${r.name} for ${Tr(H,M,i,n)}`),n.health<=0&&(h(e,`${t.name} killed ${n.name}`),n.health=0,n.level=ue.APPRENTICE)},Cr=(e,t)=>{const n=document.getElementById("gameBoardContainer"),o=document.getElementById("gameBoard");if(n&&o){const r=e.x*t,s=e.y*t,i=o.offsetWidth,a=o.offsetHeight;n.scrollLeft=Math.round(r/i),n.scrollTop=Math.round(s/a),console.log(`scrolling to ${n.scrollLeft} x ${n.scrollTop}`)}},Dr=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=["You have reached "+e.dungeon.name],e.eventDeck=go(e.dungeon),e.reRender=!0,Wo(e),Go(e),Fo(e),zt(e),So(e),Cr({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize))},Hn=(e,t)=>Math.sqrt(Math.pow(e.x-(t==null?void 0:t.x),2)+Math.pow(e.y-(t==null?void 0:t.y),2)),at=(e,t,n,o,r)=>{const s={x:e.x*n-Math.floor(n/2),y:e.y*n-Math.floor(n/2)},i={x:t.x*n-Math.floor(n/2),y:t.y*n-Math.floor(n/2)};return lt(s,e,i,t,n,o,r,[])},lt=(e,t,n,o,r,s,i,a)=>{var H,y;const l=Rr(e,n),u={x:Math.round((l.x+Math.floor(r/2))/r),y:Math.round((l.y+Math.floor(r/2))/r)},g=Ye(s.dungeon.layout.grid,u.x,u.y),T=(H=s.dungeon.layout.pits)==null?void 0:H.some(_=>we(_,u)),v=(y=s.dungeon.layout.pillars)==null?void 0:y.some(_=>we(_,u)),k=s.dungeon.layout.monsters.some(_=>we(_.position,u)),M=B(s).filter(_=>!we(_.position,t)).some(_=>we(_.position,u));return u.x===o.x&&u.y===o.y?(a.push(u),!0):v||k||!i&&M||g===Zn||g===Pn||i&&(T||g===Qn)?!1:(u.x===t.x&&u.y===t.y||a.some(_=>_.x===u.x&&_.y===u.y)||a.push(u),lt(l,t,n,o,r,s,i,a))},Rr=(e,t)=>{const n=e.x,o=e.y,r=t.x-n,s=t.y-o,i=r/Math.pow(Math.pow(r,2)+Math.pow(s,2),1/2),a=s/Math.pow(Math.pow(r,2)+Math.pow(s,2),1/2);let l=Math.round(i+n),u=Math.round(a+o);return{x:l,y:u}},_o=(e,t)=>B(e).filter(n=>Wn(t.position,n.position.x,n.position.y)),Ir=""+new URL("../assets/Dungeon_Tileset.be5b0045.png",import.meta.url).href,Or="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",Mr=(e,t)=>{const n=Math.abs(t.x-e.x),o=Math.abs(t.y-e.y),r=Math.min(n,o),s=Math.max(n,o),i=r,a=s-r;let l=Math.sqrt(2);return a===0&&(l=1),Math.floor(l*i+a)},wr=(e,t)=>{e.reRender=!0;const n=e.currentActor,o=e.dungeon.layout.items.find(s=>we(s.position,n.position));if(o){const s=o.item;s.type===U.MAGIC?St(e,s):Jt(e,s);const i=e.dungeon.layout.items.indexOf(o);e.dungeon.layout.items.splice(i,1),h(e,`${n.name} picked up ${s.name}`),ro(e,s,n);return}const r=e.dungeon.layout.doors.find(s=>s.x===n.position.x&&s.y===n.position.y);if(r&&!r.hidden){const s=n.inventory.some(i=>{var a;return(a=i.properties)==null?void 0:a[io]});if(no(n,s,r)){switch(r.locked&&s&&h(e,`${n.name} broke the locked door`),r.open=!0,r.trapped&&un(e,ko(r),n,!1),r.side){case b.RIGHT:On(n,e,t.x+1,t.y);break;case b.LEFT:On(n,e,t.x-1,t.y);break;case b.DOWN:On(n,e,t.x,t.y+1);break;case b.UP:On(n,e,t.x,t.y-1);break}st(n)}else if(r.locked&&!r.hidden){if(!Rn(n)){h(e,`${n.name} has no actions left`);return}h(e,"Door is locked"),nt(e)}}else{if(!Rn(n)){h(e,`${n.name} has no actions left`);return}tt(e)}},xr=(e,t)=>{e.reRender=!0;const n=e.currentActor;if(n.actions===0){h(e,`${n.name} has no actions left`);return}if(Jn(e.dungeon.layout,t.x,t.y)){const r=Un(e,t.x,t.y),s=Bn(e,t.x,t.y),i=Mr(n.position,t),a=at(n.position,t,2,e,!0);if(!r&&!s&&i<=n.movement&&a){if(n.position=t,n.movement-=i,to(e,n),oo(e,n)&&(n.movement=0),Zt(e))return}else s&&(i<=n.weapon.range?eo(n,e,t):h(e,"Monster is out of range"))}st(n)},Hr=(e,t,n)=>{const o=document.getElementById("gameBoard");if(!o)return;const r=o.getBoundingClientRect(),s=Math.min(Math.floor((e.clientX-r.left)/t),n.dungeon.layout.grid[0].length-1),i=Math.min(Math.floor((e.clientY-r.top)/t),n.dungeon.layout.grid.length-1),a=n.dungeon.layout.grid[i][s],l=n.currentActor;s===l.position.x&&i===l.position.y?wr(n,{x:s,y:i}):Se(n.dungeon,a)&&xr(n,{x:s,y:i})},Lr=(e,t,n,o,r)=>{B(o).forEach(i=>{Nr(e,i,t,n,r)}),$r(e,o,n),Gr(e,o,n)},Nr=(e,t,n,o,r)=>{const s=t.position.x,i=t.position.y;if(e.drawImage(n,4*16,0,16,16,s*o,i*o,o,o),Pr(e,t,s,i,o),Ur(e,t,s,i,o),Br(e,t,s,i,o),r){const a=`(${s},${i})`;e.fillStyle="black",e.font="8px Arial",e.fillText(a,s*o+3,i*o+10)}},Pr=(e,t,n,o,r)=>{const s=e.fillStyle,i=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let a=0;a<t.actions;a++)e.fillRect(n*r+4+6*a,o*r+r-12,5,5),e.rect(n*r+4+6*a,o*r+r-12,5,5),e.stroke();e.fillStyle="blue";for(let a=0;a<t.movement;a++)e.fillRect(n*r+r-22+6*a,o*r+r-12,5,5),e.rect(n*r+r-22+6*a,o*r+r-12,5,5),e.stroke();e.fillStyle=s,e.strokeStyle=i},Br=(e,t,n,o,r)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n*r+4,o*r,r-8,4),e.fillStyle="green",e.fillRect(n*r+4,o*r,(r-8)*(t.health/t.maxHealth),4),e.rect(n*r+4,o*r,r-8,4),e.stroke()},Ur=(e,t,n,o,r)=>{e.beginPath(),e.strokeStyle=t.colour,e.fillStyle=t.colour,e.fillRect(n*r+4,o*r+(r-6),r-8,4),e.stroke()},$r=(e,t,n)=>{const o=t.currentActor;if(o){for(let r=o.position.x-o.movement;r<=o.position.x+o.movement;r++)for(let s=o.position.y-o.movement;s<=o.position.y+o.movement;s++)if(Gn(t.dungeon,r,s)&&!(r===(o==null?void 0:o.position.x)&&s===(o==null?void 0:o.position.y))){const a=Bn(t,r,s),l=Un(t,r,s),u=Jn(t.dungeon.layout,r,s),g=at(o.position,{x:r,y:s},2,t,!0);!l&&!a&&u&&g&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(r*n,s*n,n,n),e.stroke())}}},Gr=(e,t,n)=>{const o=t.currentActor;o&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(o.position.x*n,o.position.y*n),e.lineTo(o.position.x*n+n/3,o.position.y*n),e.moveTo(o.position.x*n,o.position.y*n),e.lineTo(o.position.x*n,o.position.y*n+n/3),e.moveTo(o.position.x*n+n,o.position.y*n),e.lineTo(o.position.x*n+n/3*2,o.position.y*n),e.moveTo(o.position.x*n+n,o.position.y*n),e.lineTo(o.position.x*n+n,o.position.y*n+n/3),e.moveTo(o.position.x*n,o.position.y*n+n),e.lineTo(o.position.x*n,o.position.y*n+n/3*2),e.moveTo(o.position.x*n,o.position.y*n+n),e.lineTo(o.position.x*n+n/3,o.position.y*n+n),e.moveTo(o.position.x*n+n,o.position.y*n+n),e.lineTo(o.position.x*n+n,o.position.y*n+n/3*2),e.moveTo(o.position.x*n+n,o.position.y*n+n),e.lineTo(o.position.x*n+n/3*2,o.position.y*n+n),e.stroke(),e.lineWidth=1)},Wr=(e,t,n,o,r)=>{o.dungeon.layout.monsters.forEach(s=>{Fr(e,t,o,s,n,r)})},Fr=(e,t,n,o,r,s)=>{const i=n.dungeon.layout.grid[o.position.y][o.position.x];if(o&&o.health>0&&Se(n.dungeon,i)){switch(o.type){case F.ORCH:Kr(e,t,r,o);break;case F.TROLL:Yr(e,t,r,o);break;default:Vr(e,t,r,o);break}qr(e,o,r),Xr(e,o,r),jr(e,o,n.heroes,n,r,s)}},Kr=(e,t,n,o)=>{e.drawImage(t,n,16,16,16,o.position.x*n,o.position.y*n,n,n)},Yr=(e,t,n,o)=>{e.drawImage(t,n,16,16,16,o.position.x*n,o.position.y*n,n,n)},Vr=(e,t,n,o)=>{e.drawImage(t,16,16,16,16,o.position.x*n,o.position.y*n,n,n)},qr=(e,t,n)=>{e.beginPath(),e.strokeStyle=t.colour,e.fillStyle=t.colour,e.fillRect(t.position.x*n+4,t.position.y*n+(n-6),n-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Xr=(e,t,n)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(t.position.x*n+4,t.position.y*n,n-8,4),e.fillStyle="green",e.fillRect(t.position.x*n+4,t.position.y*n,(n-8)*(t.health/t.maxHealth),4),e.rect(t.position.x*n+4,t.position.y*n,n-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},jr=(e,t,n,o,r,s)=>{s&&n.forEach(i=>{const a=[],l={x:t.position.x*48-24,y:t.position.y*48-24},u={x:i.position.x*48-24,y:i.position.y*48-24};if(lt(l,t.position,u,i.position,48,o,!1,a)){const T=t.position.x,v=t.position.y,k=i.position.x,M=i.position.y;e.beginPath(),e.strokeStyle=t.colour,e.lineWidth=2,e.moveTo(T*r+r/2,v*r+r/2),e.lineTo(k*r+r/2,M*r+r/2),e.stroke(),e.lineWidth=1}})},Qr=(e,t,n,o,r)=>{o.dungeon.layout.doors.forEach(s=>{ss(e,t,n,o,s,r)})},Zr=(e,t,n,o,r)=>{o.dungeon.layout.grid.forEach((s,i)=>{$n(s).forEach((a,l)=>{es(e,t,o,a,l,i,n),rs(e,a,o,l,i,n,r)})}),Sr(e,t,n,o,r),zr(e,t,n,o,r)},Jr=(e,t,n,o,r)=>{o.dungeon.layout.secrets.filter(s=>s.found).forEach(s=>{switch(s.type){case oe.TRAP_DOOR:ts(e,t,n,s);break;default:os(e,t,n,s);break}}),r&&o.dungeon.layout.secrets.filter(s=>!s.found).forEach(s=>{const i=`${s.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(s.position.x*n,s.position.y*n,n,n),e.fillStyle="black",e.font="12px Arial",e.fillText(i,s.position.x*n,s.position.y*n+10)})},Cn=(e,t,n,o,r,s,i,a)=>{a.dungeon.discoveredRooms.some(l=>xt(s,i,l,a))||xt(s,i,Pn,a)?e.drawImage(t,n*48,o,48,48,s*r,i*r,r,r):Eo(e,s,i,r)},Sr=(e,t,n,o,r)=>{var s,i;(i=(s=o.dungeon.layout.pits)==null?void 0:s.filter(a=>Gn(o.dungeon,a.x,a.y)||r))==null||i.forEach(a=>{Cn(e,t,7,0,n,a.x,a.y,o)})},zr=(e,t,n,o,r)=>{var s,i;(i=(s=o.dungeon.layout.pillars)==null?void 0:s.filter(a=>Gn(o.dungeon,a.x,a.y)||r))==null||i.forEach(a=>{Cn(e,t,6,0,n,a.x,a.y,o)})},es=(e,t,n,o,r,s,i)=>{ns(o,n)?o===Pn?(Cn(e,t,0,0,i,r,s,n),Cn(e,t,5,0,i,r,s,n)):Cn(e,t,1,0,i,r,s,n):jn(o,n)?Eo(e,r,s,i):Cn(e,t,0,0,i,r,s,n)},ns=(e,t)=>is(e)||!Se(t.dungeon,e)&&e!==Qn,Eo=(e,t,n,o)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="black",e.fillRect(t*o,n*o,o,o),e.stroke()},ts=(e,t,n,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(t,3*48,0,48,48,r*n,s*n,n,n)},os=(e,t,n,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(t,4*48,0,48,48,r*n,s*n,n,n)},rs=(e,t,n,o,r,s,i)=>{!i&&(jn(t,n)||t===Zn)||(e.beginPath(),e.strokeStyle="black",e.rect(o*s,r*s,s,s),i&&(e.font="7px Arial",e.fillText(o+","+r,o*s+3,r*s+(s-3))),e.stroke())},ss=(e,t,n,o,r,s)=>{const i=o.dungeon.layout.grid[r.y][r.x];if(r&&!r.hidden&&!r.open&&!jn(i,o))switch(e.fillStyle="brown",r.side){case b.RIGHT:{e.fillRect(r.x*n+(n-2),r.y*n,4,n),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*n+(n-4),r.y*n+(n/2-4),8,8));break}case b.LEFT:{e.fillRect(r.x*n-2,r.y*n,4,n),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*n-4,r.y*n+(n/2-4),8,8));break}case b.UP:{e.fillRect(r.x*n,r.y*n-2,n,4),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*n+(n/2-4),r.y*n-4,8,8));break}case b.DOWN:{e.fillRect(r.x*n,r.y*n+(n-2),n,4),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*n+(n/2-4),r.y*n+(n-4),8,8));break}}s&&!jn(i,o)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${r.hidden?"H":"-"}/${r.trapped?"T"+r.trapAttacks:"-"}/${r.locked?"L":"-"}]`,r.x*n,r.y*n+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(r.x*n,r.y*n,n,n))},is=e=>e===Zn,jn=(e,t)=>e===Qn||!Se(t.dungeon,e),xt=(e,t,n,o)=>{if(!o)return;const r=Math.max(e-1,0),s=Math.max(t-1,0),i=Math.min(t+1,o.dungeon.layout.grid.length-1),a=Math.min(e+1,o.dungeon.layout.grid[0].length-1);for(let l=r;l<=a;l++)for(let u=s;u<=i;u++){const g=o.dungeon.layout.grid[u];if($n(g)[l]===n)return!0}return!1},as=(e,t,n,o)=>{o.dungeon.layout.items.forEach(r=>{switch(r.item.type){case U.MAGIC:Ht(e,t,n,r);break;case U.WEAPON:Ht(e,t,n,r)}})},Ht=(e,t,n,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(t,0,48,48,48,r*n,s*n,n,n)};function ls(e){let t,n,o,r;return{c(){t=f("div"),n=f("canvas"),this.h()},l(s){t=m(s,"DIV",{style:!0,class:!0,id:!0});var i=p(t);n=m(i,"CANVAS",{width:!0,height:!0,id:!0}),p(n).forEach(d),i.forEach(d),this.h()},h(){P(n,"width",e[0]*40),P(n,"height",e[0]*30),P(n,"id","gameBoard"),P(t,"style",e[2]()),P(t,"class","dungeon svelte-a4uhtl"),P(t,"id","gameBoardContainer")},m(s,i){L(s,t,i),c(t,n),o||(r=V(n,"click",e[1]),o=!0)},p:ge,i:ge,o:ge,d(s){s&&d(t),o=!1,r()}}}const Lt=10;function cs(e,t,n){let{state:o}=t,{debugMode:r}=t,s,i;const a=(o==null?void 0:o.settings.cellSize)??48;let l=0,u=0;i=window.innerHeight,s=document.getElementById("footer").offsetHeight,Nn(()=>{const k=new Image;k.src=Ir;const M=new Image;M.src=Or,setInterval(()=>g(k,M),10)});const g=(k,M)=>{if(!o||!document)return;const H=document.getElementById("gameBoard"),y=H.getContext("2d");o.reRender&&(u++,l++,y.clearRect(0,0,H.width,H.height),y.fillStyle="black",y.fillRect(0,0,H.width,H.height),Zr(y,k,a,o,r),Jr(y,k,a,o,r),as(y,k,a,o),Qr(y,k,a,o,r),Wr(y,M,a,o,r),Lr(y,M,a,o,r),r&&(y.fillStyle="white",y.font="8px Arial",y.fillText(`Re-renders: ${l}`,2,10),y.fillText(`FPS: ${u/(Lt/1e3)}`,2,20)),setTimeout(()=>{n(3,o.reRender=!1,o),u=0},Lt))},T=k=>{Hr(k,a,o)},v=()=>`max-height: ${i-s-20}px; max-width: ${a*40}`;return e.$$set=k=>{"state"in k&&n(3,o=k.state),"debugMode"in k&&n(4,r=k.debugMode)},[a,T,v,o,r]}class us extends dn{constructor(t){super(),fn(this,t,cs,ls,Be,{state:3,debugMode:4})}}function Nt(e){let t,n="Use",o,r;return{c(){t=f("button"),t.textContent=n},l(s){t=m(s,"BUTTON",{"data-svelte-h":!0}),X(t)!=="svelte-3f43k6"&&(t.textContent=n)},m(s,i){L(s,t,i),o||(r=V(t,"click",e[2]),o=!0)},p:ge,d(s){s&&d(t),o=!1,r()}}}function ds(e){var k,M,H;let t,n,o,r=e[0].name+"",s,i,a,l,u,g=((k=e[0].properties)==null?void 0:k[Tt])+"",T,v=((M=e[0].properties)==null?void 0:M[qn])&&!((H=e[0].properties)!=null&&H[Fe])&&Nt(e);return{c(){t=f("div"),n=f("span"),v&&v.c(),o=I(),s=w(r),i=I(),a=f("div"),l=f("span"),u=w(" "),T=w(g),this.h()},l(y){t=m(y,"DIV",{class:!0});var _=p(t);n=m(_,"SPAN",{class:!0});var R=p(n);v&&v.l(R),o=O(R),s=x(R,r),R.forEach(d),i=O(_),a=m(_,"DIV",{class:!0});var E=p(a);l=m(E,"SPAN",{class:!0});var K=p(l);u=x(K," "),T=x(K,g),K.forEach(d),E.forEach(d),_.forEach(d),this.h()},h(){P(n,"class","svelte-16r3uh2"),P(l,"class","svelte-16r3uh2"),P(a,"class","description svelte-16r3uh2"),P(t,"class","item-card svelte-16r3uh2")},m(y,_){L(y,t,_),c(t,n),v&&v.m(n,null),c(n,o),c(n,s),c(t,i),c(t,a),c(a,l),c(l,u),c(l,T)},p(y,[_]){var R,E,K;(R=y[0].properties)!=null&&R[qn]&&!((E=y[0].properties)!=null&&E[Fe])?v?v.p(y,_):(v=Nt(y),v.c(),v.m(n,o)):v&&(v.d(1),v=null),_&1&&r!==(r=y[0].name+"")&&pe(s,r),_&1&&g!==(g=((K=y[0].properties)==null?void 0:K[Tt])+"")&&pe(T,g)},i:ge,o:ge,d(y){y&&d(t),v&&v.d()}}}function fs(e,t,n){let{item:o}=t,{state:r}=t;const s=()=>Jo(r,o);return e.$$set=i=>{"item"in i&&n(0,o=i.item),"state"in i&&n(1,r=i.state)},[o,r,s]}class ms extends dn{constructor(t){super(),fn(this,t,fs,ds,Be,{item:0,state:1})}}function Pt(e,t,n){const o=e.slice();return o[5]=t[n],o[6]=t,o[7]=n,o}function Bt(e){let t,n,o;function r(i){e[3](i,e[5],e[6],e[7])}let s={state:e[1]};return e[5]!==void 0&&(s.item=e[5]),t=new ms({props:s}),Mn.push(()=>xn(t,"item",r)),{c(){sn(t.$$.fragment)},l(i){an(t.$$.fragment,i)},m(i,a){ln(t,i,a),o=!0},p(i,a){e=i;const l={};a&2&&(l.state=e[1]),!n&&a&1&&(n=!0,l.item=e[5],wn(()=>n=!1)),t.$set(l)},i(i){o||(j(t.$$.fragment,i),o=!0)},o(i){re(t.$$.fragment,i),o=!1},d(i){cn(t,i)}}}function Ut(e){let t,n,o=Dn(e[0]),r=[];for(let i=0;i<o.length;i+=1)r[i]=Bt(Pt(e,o,i));const s=i=>re(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();t=be()},l(i){for(let a=0;a<r.length;a+=1)r[a].l(i);t=be()},m(i,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(i,a);L(i,t,a),n=!0},p(i,a){if(a&3){o=Dn(i[0]);let l;for(l=0;l<o.length;l+=1){const u=Pt(i,o,l);r[l]?(r[l].p(u,a),j(r[l],1)):(r[l]=Bt(u),r[l].c(),j(r[l],1),r[l].m(t.parentNode,t))}for(mn(),l=o.length;l<r.length;l+=1)s(l);hn()}},i(i){if(!n){for(let a=0;a<o.length;a+=1)j(r[a]);n=!0}},o(i){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)re(r[a]);n=!1},d(i){i&&d(t),rt(r,i)}}}function hs(e){let t,n,o="Inventory",r,s=e[2],i,a=Ut(e);return{c(){t=f("div"),n=f("span"),n.textContent=o,r=I(),a.c(),this.h()},l(l){t=m(l,"DIV",{class:!0});var u=p(t);n=m(u,"SPAN",{class:!0,"data-svelte-h":!0}),X(n)!=="svelte-5cqt1m"&&(n.textContent=o),r=O(u),a.l(u),u.forEach(d),this.h()},h(){P(n,"class","svelte-17j3oea"),P(t,"class","inventory svelte-17j3oea")},m(l,u){L(l,t,u),c(t,n),c(t,r),a.m(t,null),i=!0},p(l,[u]){u&4&&Be(s,s=l[2])?(mn(),re(a,1,1,ge),hn(),a=Ut(l),a.c(),j(a,1),a.m(t,null)):a.p(l,u)},i(l){i||(j(a),i=!0)},o(l){re(a),i=!1},d(l){l&&d(t),a.d(l)}}}function ps(e,t,n){let{inventory:o}=t,{state:r}=t,s=!1;Nn(()=>{i(),setInterval(i,100)});const i=()=>{n(2,s=!s)};function a(l,u,g,T){g[T]=l,n(0,o)}return e.$$set=l=>{"inventory"in l&&n(0,o=l.inventory),"state"in l&&n(1,r=l.state)},[o,r,s,a]}class gs extends dn{constructor(t){super(),fn(this,t,ps,hs,Be,{inventory:0,state:1})}}function $t(e){let t;return{c(){t=w("*")},l(n){t=x(n,"*")},m(n,o){L(n,t,o)},d(n){n&&d(t)}}}function vs(e){let t;return{c(){t=w("Unselect")},l(n){t=x(n,"Unselect")},m(n,o){L(n,t,o)},d(n){n&&d(t)}}}function ys(e){let t;return{c(){t=w("Target")},l(n){t=x(n,"Target")},m(n,o){L(n,t,o)},d(n){n&&d(t)}}}function ks(e){let t;return{c(){t=w("None (0)")},l(n){t=x(n,"None (0)")},m(n,o){L(n,t,o)},p:ge,d(n){n&&d(t)}}}function _s(e){let t=e[0].armour.name+"",n,o,r=e[0].armour.defense+"",s,i;return{c(){n=w(t),o=w(" ("),s=w(r),i=w(")")},l(a){n=x(a,t),o=x(a," ("),s=x(a,r),i=x(a,")")},m(a,l){L(a,n,l),L(a,o,l),L(a,s,l),L(a,i,l)},p(a,l){l&1&&t!==(t=a[0].armour.name+"")&&pe(n,t),l&1&&r!==(r=a[0].armour.defense+"")&&pe(s,r)},d(a){a&&(d(n),d(o),d(s),d(i))}}}function Es(e){let t;return{c(){t=w("None (0)")},l(n){t=x(n,"None (0)")},m(n,o){L(n,t,o)},p:ge,d(n){n&&d(t)}}}function As(e){let t=e[0].shield.name+"",n,o,r=e[0].shield.dice+"",s,i;return{c(){n=w(t),o=w(" ("),s=w(r),i=w(")")},l(a){n=x(a,t),o=x(a," ("),s=x(a,r),i=x(a,")")},m(a,l){L(a,n,l),L(a,o,l),L(a,s,l),L(a,i,l)},p(a,l){l&1&&t!==(t=a[0].shield.name+"")&&pe(n,t),l&1&&r!==(r=a[0].shield.dice+"")&&pe(s,r)},d(a){a&&(d(n),d(o),d(s),d(i))}}}function Gt(e){let t,n,o,r;function s(a){e[4](a)}let i={state:e[1]};return e[0].inventory!==void 0&&(i.inventory=e[0].inventory),n=new gs({props:i}),Mn.push(()=>xn(n,"inventory",s)),{c(){t=f("div"),sn(n.$$.fragment),this.h()},l(a){t=m(a,"DIV",{class:!0});var l=p(t);an(n.$$.fragment,l),l.forEach(d),this.h()},h(){P(t,"class","equipment")},m(a,l){L(a,t,l),ln(n,t,null),r=!0},p(a,l){const u={};l&2&&(u.state=a[1]),!o&&l&1&&(o=!0,u.inventory=a[0].inventory,wn(()=>o=!1)),n.$set(u)},i(a){r||(j(n.$$.fragment,a),r=!0)},o(a){re(n.$$.fragment,a),r=!1},d(a){a&&d(t),cn(n)}}}function Wt(e){let t,n,o,r=e[0].name+"",s,i,a,l,u=e[0].level+"",g,T,v=e[0].experience+"",k,M,H,y,_,R,E,K,Y=e[0].health+"",G,ve,z,A,N=e[0].actions+"",W,Z,J,ye,se=e[0].movement+"",le,Ue,S,xe="Equipment:",He,Te,ke,Ve,Ce=e[0].weapon.name+"",ze,en,Le=e[0].weapon.dice+"",Re,pn,nn,_e,Ne,gn,Ie,ce,qe,ee,vn,yn,ne=e[1].targetActor===e[0]&&$t();function $e(C,D){return C[1].targetActor!==C[0]?ys:vs}let tn=$e(e),De=tn(e);function Ze(C,D){return C[0].armour?_s:ks}let Oe=Ze(e),Ee=Oe(e);function kn(C,D){return C[0].shield?As:Es}let Ge=kn(e),ie=Ge(e),Q=e[0]===e[1].currentActor&&Gt(e);return{c(){t=f("div"),n=f("div"),o=f("b"),ne&&ne.c(),s=w(r),i=w(" -"),a=I(),l=f("b"),g=w(u),T=w(" ("),k=w(v),M=w(")"),H=I(),y=f("span"),_=f("button"),De.c(),R=I(),E=f("span"),K=w("HP: "),G=w(Y),ve=I(),z=f("span"),A=w("Actions: "),W=w(N),Z=I(),J=f("span"),ye=w("Moves: "),le=w(se),Ue=I(),S=f("span"),S.textContent=xe,He=I(),Te=f("div"),ke=f("span"),Ve=w("🗡️ "),ze=w(Ce),en=w(" ("),Re=w(Le),pn=w(")"),nn=I(),_e=f("span"),Ne=w(`🧱
      `),Ee.c(),gn=I(),Ie=f("span"),ce=w(`🛡️
      `),ie.c(),qe=I(),Q&&Q.c(),this.h()},l(C){t=m(C,"DIV",{class:!0,style:!0});var D=p(t);n=m(D,"DIV",{class:!0});var on=p(n);o=m(on,"B",{class:!0});var te=p(o);ne&&ne.l(te),s=x(te,r),i=x(te," -"),te.forEach(d),a=O(on),l=m(on,"B",{class:!0});var fe=p(l);g=x(fe,u),T=x(fe," ("),k=x(fe,v),M=x(fe,")"),fe.forEach(d),on.forEach(d),H=O(D),y=m(D,"SPAN",{class:!0});var me=p(y);_=m(me,"BUTTON",{});var Pe=p(_);De.l(Pe),Pe.forEach(d),me.forEach(d),R=O(D),E=m(D,"SPAN",{class:!0});var _n=p(E);K=x(_n,"HP: "),G=x(_n,Y),_n.forEach(d),ve=O(D),z=m(D,"SPAN",{class:!0});var En=p(z);A=x(En,"Actions: "),W=x(En,N),En.forEach(d),Z=O(D),J=m(D,"SPAN",{class:!0});var An=p(J);ye=x(An,"Moves: "),le=x(An,se),An.forEach(d),Ue=O(D),S=m(D,"SPAN",{class:!0,"data-svelte-h":!0}),X(S)!=="svelte-1ue18fw"&&(S.textContent=xe),He=O(D),Te=m(D,"DIV",{class:!0});var Xe=p(Te);ke=m(Xe,"SPAN",{class:!0});var he=p(ke);Ve=x(he,"🗡️ "),ze=x(he,Ce),en=x(he," ("),Re=x(he,Le),pn=x(he,")"),he.forEach(d),nn=O(Xe),_e=m(Xe,"SPAN",{class:!0});var bn=p(_e);Ne=x(bn,`🧱
      `),Ee.l(bn),bn.forEach(d),gn=O(Xe),Ie=m(Xe,"SPAN",{class:!0});var Tn=p(Ie);ce=x(Tn,`🛡️
      `),ie.l(Tn),Tn.forEach(d),Xe.forEach(d),qe=O(D),Q&&Q.l(D),D.forEach(d),this.h()},h(){P(o,"class","svelte-pgtred"),P(l,"class","svelte-pgtred"),P(n,"class","hero-title svelte-pgtred"),P(y,"class","svelte-pgtred"),P(E,"class","svelte-pgtred"),P(z,"class","svelte-pgtred"),P(J,"class","svelte-pgtred"),P(S,"class","svelte-pgtred"),P(ke,"class","svelte-pgtred"),P(_e,"class","svelte-pgtred"),P(Ie,"class","svelte-pgtred"),P(Te,"class","equipment"),P(t,"class","hero-card svelte-pgtred"),yt(t,"background-color",e[0].colour)},m(C,D){L(C,t,D),c(t,n),c(n,o),ne&&ne.m(o,null),c(o,s),c(o,i),c(n,a),c(n,l),c(l,g),c(l,T),c(l,k),c(l,M),c(t,H),c(t,y),c(y,_),De.m(_,null),c(t,R),c(t,E),c(E,K),c(E,G),c(t,ve),c(t,z),c(z,A),c(z,W),c(t,Z),c(t,J),c(J,ye),c(J,le),c(t,Ue),c(t,S),c(t,He),c(t,Te),c(Te,ke),c(ke,Ve),c(ke,ze),c(ke,en),c(ke,Re),c(ke,pn),c(Te,nn),c(Te,_e),c(_e,Ne),Ee.m(_e,null),c(Te,gn),c(Te,Ie),c(Ie,ce),ie.m(Ie,null),c(t,qe),Q&&Q.m(t,null),ee=!0,vn||(yn=V(_,"click",e[3]),vn=!0)},p(C,D){C[1].targetActor===C[0]?ne||(ne=$t(),ne.c(),ne.m(o,s)):ne&&(ne.d(1),ne=null),(!ee||D&1)&&r!==(r=C[0].name+"")&&pe(s,r),(!ee||D&1)&&u!==(u=C[0].level+"")&&pe(g,u),(!ee||D&1)&&v!==(v=C[0].experience+"")&&pe(k,v),tn!==(tn=$e(C))&&(De.d(1),De=tn(C),De&&(De.c(),De.m(_,null))),(!ee||D&1)&&Y!==(Y=C[0].health+"")&&pe(G,Y),(!ee||D&1)&&N!==(N=C[0].actions+"")&&pe(W,N),(!ee||D&1)&&se!==(se=C[0].movement+"")&&pe(le,se),(!ee||D&1)&&Ce!==(Ce=C[0].weapon.name+"")&&pe(ze,Ce),(!ee||D&1)&&Le!==(Le=C[0].weapon.dice+"")&&pe(Re,Le),Oe===(Oe=Ze(C))&&Ee?Ee.p(C,D):(Ee.d(1),Ee=Oe(C),Ee&&(Ee.c(),Ee.m(_e,null))),Ge===(Ge=kn(C))&&ie?ie.p(C,D):(ie.d(1),ie=Ge(C),ie&&(ie.c(),ie.m(Ie,null))),C[0]===C[1].currentActor?Q?(Q.p(C,D),D&3&&j(Q,1)):(Q=Gt(C),Q.c(),j(Q,1),Q.m(t,null)):Q&&(mn(),re(Q,1,1,()=>{Q=null}),hn()),(!ee||D&1)&&yt(t,"background-color",C[0].colour)},i(C){ee||(j(Q),ee=!0)},o(C){re(Q),ee=!1},d(C){C&&d(t),ne&&ne.d(),De.d(),Ee.d(),ie.d(),Q&&Q.d(),vn=!1,yn()}}}function bs(e){let t=e[1].targetActor,n,o,r=Wt(e);return{c(){r.c(),n=be()},l(s){r.l(s),n=be()},m(s,i){r.m(s,i),L(s,n,i),o=!0},p(s,[i]){i&2&&Be(t,t=s[1].targetActor)?(mn(),re(r,1,1,ge),hn(),r=Wt(s),r.c(),j(r,1),r.m(n.parentNode,n)):r.p(s,i)},i(s){o||(j(r),o=!0)},o(s){re(r),o=!1},d(s){s&&d(n),r.d(s)}}}function Ts(e,t,n){let{hero:o}=t,{state:r}=t;const s=l=>{r.targetActor&&l===r.targetActor?n(1,r.targetActor=void 0,r):n(1,r.targetActor=l,r)},i=()=>s(o);function a(l){e.$$.not_equal(o.inventory,l)&&(o.inventory=l,n(0,o))}return e.$$set=l=>{"hero"in l&&n(0,o=l.hero),"state"in l&&n(1,r=l.state)},[o,r,s,i,a]}class Ao extends dn{constructor(t){super(),fn(this,t,Ts,bs,Be,{hero:0,state:1})}}function Ft(e,t,n){const o=e.slice();return o[3]=t[n],o[5]=n,o}function Cs(e){let t,n,o,r;return n=new Ao({props:{hero:e[3],state:e[0]}}),{c(){t=f("div"),sn(n.$$.fragment),o=I(),this.h()},l(s){t=m(s,"DIV",{class:!0});var i=p(t);an(n.$$.fragment,i),o=O(i),i.forEach(d),this.h()},h(){P(t,"class","not-current-actor svelte-gyascg")},m(s,i){L(s,t,i),ln(n,t,null),c(t,o),r=!0},p(s,i){const a={};i&1&&(a.hero=s[3]),i&1&&(a.state=s[0]),n.$set(a)},i(s){r||(j(n.$$.fragment,s),r=!0)},o(s){re(n.$$.fragment,s),r=!1},d(s){s&&d(t),cn(n)}}}function Ds(e){let t,n,o,r;return n=new Ao({props:{hero:e[3],state:e[0]}}),{c(){t=f("div"),sn(n.$$.fragment),o=I(),this.h()},l(s){t=m(s,"DIV",{class:!0});var i=p(t);an(n.$$.fragment,i),o=O(i),i.forEach(d),this.h()},h(){P(t,"class","is-current-actor svelte-gyascg")},m(s,i){L(s,t,i),ln(n,t,null),c(t,o),r=!0},p(s,i){const a={};i&1&&(a.hero=s[3]),i&1&&(a.state=s[0]),n.$set(a)},i(s){r||(j(n.$$.fragment,s),r=!0)},o(s){re(n.$$.fragment,s),r=!1},d(s){s&&d(t),cn(n)}}}function Kt(e){let t,n,o,r;const s=[Ds,Cs],i=[];function a(l,u){return l[3]===l[0].currentActor?0:1}return t=a(e),n=i[t]=s[t](e),{c(){n.c(),o=be()},l(l){n.l(l),o=be()},m(l,u){i[t].m(l,u),L(l,o,u),r=!0},p(l,u){let g=t;t=a(l),t===g?i[t].p(l,u):(mn(),re(i[g],1,1,()=>{i[g]=null}),hn(),n=i[t],n?n.p(l,u):(n=i[t]=s[t](l),n.c()),j(n,1),n.m(o.parentNode,o))},i(l){r||(j(n),r=!0)},o(l){re(n),r=!1},d(l){l&&d(o),i[t].d(l)}}}function Yt(e){let t=e[1],n,o,r=Kt(e);return{c(){r.c(),n=be()},l(s){r.l(s),n=be()},m(s,i){r.m(s,i),L(s,n,i),o=!0},p(s,i){i&2&&Be(t,t=s[1])?(mn(),re(r,1,1,ge),hn(),r=Kt(s),r.c(),j(r,1),r.m(n.parentNode,n)):r.p(s,i)},i(s){o||(j(r),o=!0)},o(s){re(r),o=!1},d(s){s&&d(n),r.d(s)}}}function Rs(e){let t,n,o=Dn(B(e[0])),r=[];for(let i=0;i<o.length;i+=1)r[i]=Yt(Ft(e,o,i));const s=i=>re(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();t=be()},l(i){for(let a=0;a<r.length;a+=1)r[a].l(i);t=be()},m(i,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(i,a);L(i,t,a),n=!0},p(i,[a]){if(a&3){o=Dn(B(i[0]));let l;for(l=0;l<o.length;l+=1){const u=Ft(i,o,l);r[l]?(r[l].p(u,a),j(r[l],1)):(r[l]=Yt(u),r[l].c(),j(r[l],1),r[l].m(t.parentNode,t))}for(mn(),l=o.length;l<r.length;l+=1)s(l);hn()}},i(i){if(!n){for(let a=0;a<o.length;a+=1)j(r[a]);n=!0}},o(i){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)re(r[a]);n=!1},d(i){i&&d(t),rt(r,i)}}}function Is(e,t,n){let{state:o}=t,r=!1;Nn(()=>{s(),setInterval(s,100)});const s=()=>{o.reRender&&n(1,r=!r)};return e.$$set=i=>{"state"in i&&n(0,o=i.state)},[o,r]}class Os extends dn{constructor(t){super(),fn(this,t,Is,Rs,Be,{state:0})}}function Vt(e,t,n){const o=e.slice();return o[3]=t[n],o[5]=n,o}function Ms(e){let t,n,o=e[3]+"",r;return{c(){t=f("p"),n=w(">"),r=w(o),this.h()},l(s){t=m(s,"P",{class:!0});var i=p(t);n=x(i,">"),r=x(i,o),i.forEach(d),this.h()},h(){P(t,"class","svelte-axhg6g")},m(s,i){L(s,t,i),c(t,n),c(t,r)},p(s,i){i&1&&o!==(o=s[3]+"")&&pe(r,o)},d(s){s&&d(t)}}}function qt(e){let t,n=e[5]<25&&Ms(e);return{c(){n&&n.c(),t=be()},l(o){n&&n.l(o),t=be()},m(o,r){n&&n.m(o,r),L(o,t,r)},p(o,r){o[5]<25&&n.p(o,r)},d(o){o&&d(t),n&&n.d(o)}}}function Xt(e){let t,n=Dn(e[0].actionLog),o=[];for(let r=0;r<n.length;r+=1)o[r]=qt(Vt(e,n,r));return{c(){for(let r=0;r<o.length;r+=1)o[r].c();t=be()},l(r){for(let s=0;s<o.length;s+=1)o[s].l(r);t=be()},m(r,s){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,s);L(r,t,s)},p(r,s){if(s&1){n=Dn(r[0].actionLog);let i;for(i=0;i<n.length;i+=1){const a=Vt(r,n,i);o[i]?o[i].p(a,s):(o[i]=qt(a),o[i].c(),o[i].m(t.parentNode,t))}for(;i<o.length;i+=1)o[i].d(1);o.length=n.length}},d(r){r&&d(t),rt(o,r)}}}function ws(e){let t,n=e[1],o=Xt(e);return{c(){t=f("div"),o.c(),this.h()},l(r){t=m(r,"DIV",{class:!0});var s=p(t);o.l(s),s.forEach(d),this.h()},h(){P(t,"class","log svelte-axhg6g")},m(r,s){L(r,t,s),o.m(t,null)},p(r,[s]){s&2&&Be(n,n=r[1])?(o.d(1),o=Xt(r),o.c(),o.m(t,null)):o.p(r,s)},i:ge,o:ge,d(r){r&&d(t),o.d(r)}}}function xs(e,t,n){let{state:o}=t,r=!1;Nn(()=>{s(),setInterval(s,500)});const s=()=>{o.reRender&&n(1,r=!r)};return e.$$set=i=>{"state"in i&&n(0,o=i.state)},[o,r]}class Hs extends dn{constructor(t){super(),fn(this,t,xs,ws,Be,{state:0})}}const Ls={name:"Testing Grounds",beaten:!1,winConditions:[{type:Me.KILL_ALL,fulfilled:!1}],nextDungeon:po,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A","D"],layout:{grid:["###########","#CCCCCCCCC#","#CCCCCCCCC#","#CCCCCCCCC#","#######E###","  #####E#  ","  #FFFFE## ","###F###AA# ","#AAAAAAAA#D","#AAAAAAAA#D","#AAAAAAAA#D","##G####### "," #G#       "," #G#       "," ###       "],pillars:[{x:8,y:3},{x:7,y:9}],pits:[{x:6,y:3},{x:6,y:2}],corridors:["G","E","F"],doors:[Ro(b.UP,3,8,1),et(b.LEFT,7,6),Do(b.UP,7,7,1),q(b.UP,7,4),Ln(b.DOWN,2,10)],monsters:[ae(F.ORCH,$.Green,1,1),ae(F.ORCH,$.Red,4,9),ae(F.TROLL,$.Green,5,1)],secrets:[je(oe.TRAP_DOOR,"Welcome to Drakriddarna",3,9),je(oe.EQUIPMENT,"Random Equipment",1,10),Vn(oe.EQUIPMENT,5,10,Yn[2])],notes:[],items:[{item:Ke[0],position:{x:3,y:10}},{item:Ke[1],position:{x:4,y:10}},{item:Ke[6],position:{x:5,y:10}},{item:Ke[2],position:{x:6,y:10}},{item:Ke[3],position:{x:7,y:10}},{item:Ke[4],position:{x:8,y:10}}]},killCount:0};const{window:Ns}=To;function Ps(e){let t,n,o,r,s="UL",i,a,l,u="U",g,T,v,k="UR",M,H,y,_="Next",R,E,K,Y,G="L",ve,z,A,N,W,Z="R",J,ye,se,le="Search",Ue,S,xe,He,Te="DL",ke,Ve,Ce,ze="D",en,Le,Re,pn="DR",nn,_e,Ne,gn="Pick lock",Ie,ce,qe,ee,vn="Save",yn,ne,$e,tn="Load",De,Ze,Oe,Ee="Debug",kn,Ge,ie,Q="End action",C,D,on,te=e[1]&&jt(e);return{c(){t=f("table"),n=f("tr"),o=f("td"),r=f("button"),r.textContent=s,i=I(),a=f("td"),l=f("button"),l.textContent=u,g=I(),T=f("td"),v=f("button"),v.textContent=k,M=I(),H=f("td"),y=f("button"),y.textContent=_,R=I(),E=f("tr"),K=f("td"),Y=f("button"),Y.textContent=G,ve=I(),z=f("td"),A=I(),N=f("td"),W=f("button"),W.textContent=Z,J=I(),ye=f("td"),se=f("button"),se.textContent=le,Ue=I(),S=f("tr"),xe=f("td"),He=f("button"),He.textContent=Te,ke=I(),Ve=f("td"),Ce=f("button"),Ce.textContent=ze,en=I(),Le=f("td"),Re=f("button"),Re.textContent=pn,nn=I(),_e=f("td"),Ne=f("button"),Ne.textContent=gn,Ie=I(),ce=f("tr"),qe=f("td"),ee=f("button"),ee.textContent=vn,yn=I(),ne=f("td"),$e=f("button"),$e.textContent=tn,De=I(),Ze=f("td"),Oe=f("button"),Oe.textContent=Ee,kn=I(),Ge=f("td"),ie=f("button"),ie.textContent=Q,C=I(),te&&te.c()},l(fe){t=m(fe,"TABLE",{});var me=p(t);n=m(me,"TR",{});var Pe=p(n);o=m(Pe,"TD",{});var _n=p(o);r=m(_n,"BUTTON",{"data-svelte-h":!0}),X(r)!=="svelte-1vu0fc2"&&(r.textContent=s),_n.forEach(d),i=O(Pe),a=m(Pe,"TD",{});var En=p(a);l=m(En,"BUTTON",{"data-svelte-h":!0}),X(l)!=="svelte-m1j18o"&&(l.textContent=u),En.forEach(d),g=O(Pe),T=m(Pe,"TD",{});var An=p(T);v=m(An,"BUTTON",{"data-svelte-h":!0}),X(v)!=="svelte-8eygoe"&&(v.textContent=k),An.forEach(d),M=O(Pe),H=m(Pe,"TD",{});var Xe=p(H);y=m(Xe,"BUTTON",{"data-svelte-h":!0}),X(y)!=="svelte-1axp1ke"&&(y.textContent=_),Xe.forEach(d),Pe.forEach(d),R=O(me),E=m(me,"TR",{});var he=p(E);K=m(he,"TD",{});var bn=p(K);Y=m(bn,"BUTTON",{"data-svelte-h":!0}),X(Y)!=="svelte-amyars"&&(Y.textContent=G),bn.forEach(d),ve=O(he),z=m(he,"TD",{}),p(z).forEach(d),A=O(he),N=m(he,"TD",{});var Tn=p(N);W=m(Tn,"BUTTON",{"data-svelte-h":!0}),X(W)!=="svelte-2zfta0"&&(W.textContent=Z),Tn.forEach(d),J=O(he),ye=m(he,"TD",{});var ct=p(ye);se=m(ct,"BUTTON",{"data-svelte-h":!0}),X(se)!=="svelte-1kis6k4"&&(se.textContent=le),ct.forEach(d),he.forEach(d),Ue=O(me),S=m(me,"TR",{});var Je=p(S);xe=m(Je,"TD",{});var ut=p(xe);He=m(ut,"BUTTON",{"data-svelte-h":!0}),X(He)!=="svelte-57p0uk"&&(He.textContent=Te),ut.forEach(d),ke=O(Je),Ve=m(Je,"TD",{});var dt=p(Ve);Ce=m(dt,"BUTTON",{"data-svelte-h":!0}),X(Ce)!=="svelte-1nly394"&&(Ce.textContent=ze),dt.forEach(d),en=O(Je),Le=m(Je,"TD",{});var ft=p(Le);Re=m(ft,"BUTTON",{"data-svelte-h":!0}),X(Re)!=="svelte-7ds02w"&&(Re.textContent=pn),ft.forEach(d),nn=O(Je),_e=m(Je,"TD",{});var mt=p(_e);Ne=m(mt,"BUTTON",{"data-svelte-h":!0}),X(Ne)!=="svelte-90j6ve"&&(Ne.textContent=gn),mt.forEach(d),Je.forEach(d),Ie=O(me),ce=m(me,"TR",{});var We=p(ce);qe=m(We,"TD",{});var ht=p(qe);ee=m(ht,"BUTTON",{"data-svelte-h":!0}),X(ee)!=="svelte-fxtyz6"&&(ee.textContent=vn),ht.forEach(d),yn=O(We),ne=m(We,"TD",{});var pt=p(ne);$e=m(pt,"BUTTON",{"data-svelte-h":!0}),X($e)!=="svelte-1m2jkw7"&&($e.textContent=tn),pt.forEach(d),De=O(We),Ze=m(We,"TD",{});var gt=p(Ze);Oe=m(gt,"BUTTON",{"data-svelte-h":!0}),X(Oe)!=="svelte-5alhx0"&&(Oe.textContent=Ee),gt.forEach(d),kn=O(We),Ge=m(We,"TD",{});var vt=p(Ge);ie=m(vt,"BUTTON",{"data-svelte-h":!0}),X(ie)!=="svelte-1de77je"&&(ie.textContent=Q),vt.forEach(d),C=O(We),te&&te.l(We),We.forEach(d),me.forEach(d)},m(fe,me){L(fe,t,me),c(t,n),c(n,o),c(o,r),c(n,i),c(n,a),c(a,l),c(n,g),c(n,T),c(T,v),c(n,M),c(n,H),c(H,y),c(t,R),c(t,E),c(E,K),c(K,Y),c(E,ve),c(E,z),c(E,A),c(E,N),c(N,W),c(E,J),c(E,ye),c(ye,se),c(t,Ue),c(t,S),c(S,xe),c(xe,He),c(S,ke),c(S,Ve),c(Ve,Ce),c(S,en),c(S,Le),c(Le,Re),c(S,nn),c(S,_e),c(_e,Ne),c(t,Ie),c(t,ce),c(ce,qe),c(qe,ee),c(ce,yn),c(ce,ne),c(ne,$e),c(ce,De),c(ce,Ze),c(Ze,Oe),c(ce,kn),c(ce,Ge),c(Ge,ie),c(ce,C),te&&te.m(ce,null),D||(on=[V(r,"click",e[12]),V(l,"click",e[13]),V(v,"click",e[14]),V(y,"click",e[15]),V(Y,"click",e[16]),V(W,"click",e[17]),V(se,"click",e[18]),V(He,"click",e[19]),V(Ce,"click",e[20]),V(Re,"click",e[21]),V(Ne,"click",e[22]),V(ee,"click",e[23]),V($e,"click",e[24]),V(Oe,"click",e[25]),V(ie,"click",e[26])],D=!0)},p(fe,me){fe[1]?te?te.p(fe,me):(te=jt(fe),te.c(),te.m(ce,null)):te&&(te.d(1),te=null)},d(fe){fe&&d(t),te&&te.d(),D=!1,Qt(on)}}}function Bs(e){let t,n,o,r,s="Next",i,a,l,u="End action",g,T,v,k,M="Save",H,y,_,R="Load",E,K,Y,G,ve="Debug",z,A;return{c(){t=f("table"),n=f("tr"),o=f("td"),r=f("button"),r.textContent=s,i=I(),a=f("td"),l=f("button"),l.textContent=u,g=I(),T=f("tr"),v=f("td"),k=f("button"),k.textContent=M,H=I(),y=f("td"),_=f("button"),_.textContent=R,E=I(),K=f("tr"),Y=f("td"),G=f("button"),G.textContent=ve},l(N){t=m(N,"TABLE",{});var W=p(t);n=m(W,"TR",{});var Z=p(n);o=m(Z,"TD",{});var J=p(o);r=m(J,"BUTTON",{"data-svelte-h":!0}),X(r)!=="svelte-1axp1ke"&&(r.textContent=s),J.forEach(d),i=O(Z),a=m(Z,"TD",{});var ye=p(a);l=m(ye,"BUTTON",{"data-svelte-h":!0}),X(l)!=="svelte-1de77je"&&(l.textContent=u),ye.forEach(d),Z.forEach(d),g=O(W),T=m(W,"TR",{});var se=p(T);v=m(se,"TD",{});var le=p(v);k=m(le,"BUTTON",{"data-svelte-h":!0}),X(k)!=="svelte-fxtyz6"&&(k.textContent=M),le.forEach(d),H=O(se),y=m(se,"TD",{});var Ue=p(y);_=m(Ue,"BUTTON",{"data-svelte-h":!0}),X(_)!=="svelte-1m2jkw7"&&(_.textContent=R),Ue.forEach(d),se.forEach(d),E=O(W),K=m(W,"TR",{});var S=p(K);Y=m(S,"TD",{});var xe=p(Y);G=m(xe,"BUTTON",{"data-svelte-h":!0}),X(G)!=="svelte-5alhx0"&&(G.textContent=ve),xe.forEach(d),S.forEach(d),W.forEach(d)},m(N,W){L(N,t,W),c(t,n),c(n,o),c(o,r),c(n,i),c(n,a),c(a,l),c(t,g),c(t,T),c(T,v),c(v,k),c(T,H),c(T,y),c(y,_),c(t,E),c(t,K),c(K,Y),c(Y,G),z||(A=[V(r,"click",e[7]),V(l,"click",e[8]),V(k,"click",e[9]),V(_,"click",e[10]),V(G,"click",e[11])],z=!0)},p:ge,d(N){N&&d(t),z=!1,Qt(A)}}}function jt(e){let t,n,o="To Testing Grounds",r,s;return{c(){t=f("td"),n=f("button"),n.textContent=o},l(i){t=m(i,"TD",{});var a=p(t);n=m(a,"BUTTON",{"data-svelte-h":!0}),X(n)!=="svelte-1rubhw6"&&(n.textContent=o),a.forEach(d)},m(i,a){L(i,t,a),c(t,n),r||(s=V(n,"click",e[27]),r=!0)},p:ge,d(i){i&&d(t),r=!1,s()}}}function Us(e){let t,n,o,r,s,i,a,l,u,g,T,v,k,M,H,y;o=new Os({props:{state:e[0]}});function _(A){e[5](A)}function R(A){e[6](A)}let E={};e[0]!==void 0&&(E.state=e[0]),e[1]!==void 0&&(E.debugMode=e[1]),s=new us({props:E}),Mn.push(()=>xn(s,"state",_)),Mn.push(()=>xn(s,"debugMode",R));function K(A,N){return A[2]<600?Bs:Ps}let Y=K(e),G=Y(e);function ve(A){e[28](A)}let z={};return e[0]!==void 0&&(z.state=e[0]),v=new Hs({props:z}),Mn.push(()=>xn(v,"state",ve)),{c(){t=f("div"),n=f("div"),sn(o.$$.fragment),r=I(),sn(s.$$.fragment),l=I(),u=f("div"),g=f("div"),G.c(),T=I(),sn(v.$$.fragment),this.h()},l(A){t=m(A,"DIV",{class:!0});var N=p(t);n=m(N,"DIV",{class:!0});var W=p(n);an(o.$$.fragment,W),W.forEach(d),r=O(N),an(s.$$.fragment,N),N.forEach(d),l=O(A),u=m(A,"DIV",{class:!0,id:!0});var Z=p(u);g=m(Z,"DIV",{class:!0});var J=p(g);G.l(J),J.forEach(d),T=O(Z),an(v.$$.fragment,Z),Z.forEach(d),this.h()},h(){P(n,"class","characterSide svelte-8a7at9"),P(t,"class","container svelte-8a7at9"),P(g,"class","commands svelte-8a7at9"),P(u,"class","container svelte-8a7at9"),P(u,"id","footer")},m(A,N){L(A,t,N),c(t,n),ln(o,n,null),c(t,r),ln(s,t,null),L(A,l,N),L(A,u,N),c(u,g),G.m(g,null),c(u,T),ln(v,u,null),M=!0,H||(y=V(Ns,"keydown",bo(e[4])),H=!0)},p(A,[N]){const W={};N&1&&(W.state=A[0]),o.$set(W);const Z={};!i&&N&1&&(i=!0,Z.state=A[0],wn(()=>i=!1)),!a&&N&2&&(a=!0,Z.debugMode=A[1],wn(()=>a=!1)),s.$set(Z),Y===(Y=K(A))&&G?G.p(A,N):(G.d(1),G=Y(A),G&&(G.c(),G.m(g,null)));const J={};!k&&N&1&&(k=!0,J.state=A[0],wn(()=>k=!1)),v.$set(J)},i(A){M||(j(o.$$.fragment,A),j(s.$$.fragment,A),j(v.$$.fragment,A),M=!0)},o(A){re(o.$$.fragment,A),re(s.$$.fragment,A),re(v.$$.fragment,A),M=!1},d(A){A&&(d(t),d(l),d(u)),cn(o),cn(s),G.d(),cn(v),H=!1,y()}}}function $s(e,t,n){let o=Ar(),r=o.settings.debug,s;Nn(()=>{setInterval(()=>Dr(o),1e3)}),s=window.innerWidth;const i=()=>{n(1,r=!r),n(0,o.settings.debug=r,o),n(0,o.reRender=!0,o)};function a(le){switch(le.key){case"6":case"d":de("R",o);break;case"9":case"e":de("UR",o);break;case"8":case"w":de("U",o);break;case"7":case"q":de("UL",o);break;case"4":case"a":de("L",o);break;case"1":case"z":de("DL",o);break;case"2":case"x":de("D",o);break;case"3":case"c":de("DR",o);break;case"0":case" ":Kn(o);break;case"-":case"r":nt(o);break;case"+":case"f":tt(o);break}}function l(le){o=le,n(0,o)}function u(le){r=le,n(1,r)}const g=()=>Kn(o),T=()=>_t(o),v=()=>Ot(o),k=()=>n(0,o=Mt()),M=()=>i(),H=()=>de("UL",o),y=()=>de("U",o),_=()=>de("UR",o),R=()=>Kn(o),E=()=>de("L",o),K=()=>de("R",o),Y=()=>tt(o),G=()=>de("DL",o),ve=()=>de("D",o),z=()=>de("DR",o),A=()=>nt(o),N=()=>Ot(o),W=()=>n(0,o=Mt()),Z=()=>i(),J=()=>_t(o),ye=()=>{n(0,o.dungeon=Ls,o),n(0,o.reRender=!0,o)};function se(le){o=le,n(0,o)}return[o,r,s,i,a,l,u,g,T,v,k,M,H,y,_,R,E,K,Y,G,ve,z,A,N,W,Z,J,ye,se]}class Fs extends dn{constructor(t){super(),fn(this,t,$s,Us,Be,{})}}export{Fs as component};
