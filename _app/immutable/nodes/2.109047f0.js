import{s as be,n as ye,o as kn,f as Ot,b as rn,h as sn,r as et}from"../chunks/scheduler.ba91754d.js";import{S as Xe,i as Je,e as ve,a as I,f as d,g as h,m as G,h as p,j as E,n as $,k as M,x as u,o as fe,s as N,c as H,y as te,d as re,p as Qe,b as Ze,t as ue,z as Gn,A as ln,r as $e,u as Ke,v as Fe,w as We,B as oe,l as Nn,C as Fo}from"../chunks/index.442d7a48.js";const Wo=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ve(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var F=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(F||{}),x=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(x||{}),de=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(de||{}),ce=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(ce||{}),le=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(le||{}),T=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(T||{}),q=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))(q||{});const Hn=[{name:"Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:q.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Two-handed Sword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:q.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"Halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:q.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"Flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:q.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"Double Headed Axe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:q.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],jn=[{name:"Orch Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:q.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Orch Bow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:q.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"Troll Club",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:q.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],Yo=[{name:"Chain mail",type:q.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"Plate mail",type:q.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"Dragon Skin mail",type:q.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],Dt=[{name:"Orch Mail",defense:0,magicProtection:!1,amountInDeck:4,type:q.ARMOUR,movementReduction:0,value:0},{name:"Troll Skin",defense:1,magicProtection:!1,amountInDeck:4,type:q.ARMOUR,movementReduction:0,value:0}],An=" ",dn="?",En="#",Ee=(e,n,t,o)=>({type:e,name:n,position:{x:t,y:o},found:!1}),_n=(e,n,t,o)=>({type:e,name:o.name,position:{x:n,y:t},found:!1,item:o}),j=(e,n,t)=>({side:e,x:n,y:t,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),Vo=(e,n,t,o)=>({...j(e,n,t),trapped:!0,trapAttacks:o}),Ye=(e,n,t)=>({...j(e,n,t),hidden:!0}),xn=(e,n,t)=>({...j(e,n,t),locked:!0}),Dn=(e,n,t,o)=>({...j(e,n,t),locked:!0,trapped:!0,trapAttacks:o}),qo=(e,n,t,o)=>({...j(e,n,t),hidden:!0,trapped:!0,trapAttacks:o}),jo=(e,n,t,o,r)=>{const s=ae(e,n,t,o);return s.inventory=r,s},ae=(e,n,t,o)=>{const r=Object.values(F).indexOf(n),s=Object.keys(F)[r];let i=de.LORD,l=2,a=2,c=4,g=4,f=4,m=jn[0],_,R=Dt[0];switch(e){case x.ORCH:{i=de.APPRENTICE,a=0,c=2,g=2,f=1,_=jn[1];break}case x.TROLL:{i=de.KNIGHT,a=1,c=3,g=3,f=2,m=jn[2],R=Dt[1];break}}return e===x.YELLOW_DARK_LORD&&(l=3),{type:e,level:i,colour:n,actions:l,defense:a,health:c,maxHealth:g,experience:f,name:e+" ("+s+")",movement:3,maxMovement:3,position:{x:t,y:o},weapon:m,armour:R,incapacitated:!1,inventory:[],rangedWeapon:_}},Xo=e=>{const n=e.currentActor;if(n.blinded){v(e,`${n.name} is blinded and may not search.`);return}const t=n.inventory.filter(a=>{var c;return(c=a.properties)==null?void 0:c[Lt]}).map(a=>{var c;return v(e,`${n.name} used the effect of ${a.name} when searching`),(c=a.properties)==null?void 0:c[Lt]}).reduce((a,c)=>a+c,0),o=un(n.level,1+t);let r,s,i,l;o>=1?(r=sr(e,n,o),r||(s=er(e,n,o)),!r&&!s&&(i=nr(e,n,o)),!r&&!s&&!i&&(l=tr(e,n,o)),!r&&!s&&!i&&!l&&v(e,`${n.name} searched but found nothing`)):v(e,`${n.name} searched but found nothing`)},fo=e=>{const n=e.currentActor;if(!n)return!1;const t=e.dungeon.layout.secrets.filter(o=>o.type===le.TRAP_DOOR).filter(o=>!o.found).find(o=>De(o.position,n.position));return t?(je(e,Jo(t),n,!1),v(e,`${n.name} fell into a pit and is incapacitated for one turn.`),n.movement=0,n.actions=0,n.incapacitated=!0,t.found=!0,!0):!1},mo=(e,n)=>{const t=e.itemDeck.findIndex(o=>o.type===n.type&&o.name===n.name);e.itemDeck.splice(t,1)},ho=(e,n)=>{const t=e.magicItemDeck.findIndex(o=>o.type===n.type&&o.name===n.name);e.magicItemDeck.splice(t,1)},Jo=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:F.Red,maxHealth:0,name:"Trap Door",level:de.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:q.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),Qo=(e,n)=>e.dungeon.layout.doors.filter(t=>t.hidden).find(t=>In({x:t.x,y:t.y},n.x,n.y)),Zo=(e,n)=>e.dungeon.layout.doors.filter(t=>t.trapped).find(t=>t.x===n.x&&t.y===n.y),So=(e,n)=>e.dungeon.layout.secrets.filter(t=>!t.found).find(t=>In(t.position,n.x,n.y)),zo=(e,n)=>e.dungeon.layout.secrets.filter(t=>!t.found).filter(t=>t.type===le.TRAP_DOOR).find(t=>In(t.position,n.x,n.y)),er=(e,n,t)=>{const o=Qo(e,n.position);return o?(o.hidden=!1,v(e,`${n.name} searched (${t}) and found a hidden door`),!0):!1},nr=(e,n,t)=>{const o=Zo(e,n.position);return o?(v(e,`${n.name} searched (${t}) and found a trap in a door`),o.trapped=!1,!0):!1},tr=(e,n,t)=>{const o=So(e,n.position);if(o){switch(v(e,`${n.name} searched (${t}) and found ${o.name}`),o.found=!0,o.type){case le.EQUIPMENT:{const r=o.item??or(e);r.amountInDeck>0&&(mo(e,r),v(e,`${n.name} equipped (${r.name})`),ko(e,r,n));break}case le.MAGIC_ITEM:{const r=o.item??rr(e);r.amountInDeck>0&&(ho(e,r),v(e,`${n.name} found (${r.name})`),n.inventory.push(r),r.pickup&&ot[r.pickup](e,r,n));break}}return!0}return!1},or=e=>{const n=e.itemDeck.length,t=Math.floor(Math.random()*n);return e.itemDeck[t]},rr=e=>{const n=e.magicItemDeck.length,t=Math.floor(Math.random()*n);return e.magicItemDeck[t]},sr=(e,n,t)=>{const o=zo(e,n.position);return o?(v(e,`${n.name} searched (${t}) and found ${o.name}`),o.found=!0,!0):!1},Mn=(e,n)=>(Hn[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:de.APPRENTICE,health:7,maxHealth:7,colour:n,experience:0,position:{x:-1,y:-1},weapon:Hn[0],incapacitated:!1,inventory:[],isInventoryOpen:!1}),ge=(e,n)=>{n.reRender=!0;const t=n.currentActor;if(!t||t.actions===0)return;const o={x:t.position.x,y:t.position.y};switch(e){case"UL":o.x=t.position.x-1,o.y=t.position.y-1;break;case"U":o.y=t.position.y-1;break;case"UR":o.x=t.position.x+1,o.y=t.position.y-1;break;case"L":o.x=t.position.x-1;break;case"R":o.x=t.position.x+1;break;case"DL":o.x=t.position.x-1,o.y=t.position.y+1;break;case"D":o.y=t.position.y+1;break;case"DR":o.x=t.position.x+1,o.y=t.position.y+1;break}const r=Tn(n,o.x,o.y),s=!$n(n.dungeon.layout,o.x,o.y),i=bn(n,o.x,o.y);if(!r&&!s){const l=Rn(n.dungeon,o.x,o.y);l?l&&(i?po(t,n,o):Ao(t,n,o.x,o.y,1)):ar(n,t,o.x,o.y)&&yn(t,n,o.x,o.y)}else v(n,`${t.name} could not make that move`);fo(n)||tt(t)},Zn=e=>{e.reRender=!0;const n=e.currentActor;if(!n)return;if(n.blinded){v(e,`${n.name} is blinded and may not search.`);return}if(!cn(n)){v(e,`${n.name} has no actions left to pick lock`);return}const t=e.dungeon.layout.doors.find(o=>o.x===n.position.x&&o.y===n.position.y);t&&t.locked&&(un(n.level,1)>=1?(t.locked=!1,v(e,`${n.name} managed to pick the lock`)):v(e,`${n.name} failed to pick the lock`),n.actions>1&&n.movement<3?n.actions-=2:n.actions--,n.movement=xe(n),n.actions==0&&(n.movement=0))},nt=e=>{e.reRender=!0,e.heroes.forEach((n,t)=>{n.position=e.dungeon.startingPositions[t],n.movement=xe(n),n.actions=2,n.health=n.maxHealth})},Y=e=>e.heroes.filter(n=>n.health>0).map(n=>n),Mt=e=>{e.reRender=!0;const n=e.currentActor;n&&(n.actions--,n.movement=xe(n),n.actions===0&&Ln(e))},cn=e=>e.movement<xe(e)?e.actions>1:e.actions>0,yn=(e,n,t,o)=>{n.reRender=!0;const r=Oe(n.dungeon.layout.grid,t,o);r&&![En,An,dn].includes(r)&&n.dungeon.discoveredRooms.push(r),Ao(e,n,e.position.x,e.position.y,1),v(n,`${e.name} opened a door`)},po=(e,n,t)=>{if(n.reRender=!0,e.actions===1&&e.movement<e.maxMovement){v(n,`${e.name} has no actions left to attack`);return}if(!e.weapon.useHearHeroes&&fr(n,e)){v(n,`${e.name} could not use ${e.weapon.name} near a friend.`);return}const o=dr(n,t);o&&(je(n,e,o,!1),o.health<=0&&ur(n,o,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},Sn=e=>{e.reRender=!0;const n=e.currentActor;if(n){if(n.blinded){v(e,`${n.name} is blinded and may not search.`);return}if(!cn(n)){v(e,`${n.name} has no actions left to search`);return}Xo(e),n.actions>1&&n.movement<xe(n)?n.actions-=2:n.actions--,n.actions==0&&(n.movement=0)}},bn=(e,n,t)=>e.dungeon.layout.monsters.some(o=>o.position.x===n&&o.position.y===t&&o.health>0),Tn=(e,n,t)=>Y(e).some(o=>o.position.x===n&&o.position.y===t),tt=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=xe(e))),e.actions==0&&(e.movement=0)},ir=e=>{e.reRender=!0,Y(e).forEach(n=>{const t=n.level;n.experience>=28?n.level=de.MASTER:n.experience>=18?n.level=de.LORD:n.experience>=10?n.level=de.HERO:n.experience>=4&&(n.level=de.KNIGHT),t!==n.level&&v(e,`${n.name} leveled up to ${n.level}`)})},lr=e=>{Y(e).forEach(n=>n.experience+=1)},go=e=>{mr(e).forEach(n=>{n.experience=0,n.health=n.maxHealth,n.movement=n.maxMovement,n.actions=2})},yo=(e,n,t)=>!t.open&&!t.hidden&&(!t.locked||t.locked&&n)&&e.movement>0,vo=(e,n)=>{const t=e.dungeon.layout.notes.find(o=>De(o.position,n.position));t&&(e.dungeon.layout.doors.some(r=>r.hidden&&De(t.position,{x:r.x,y:r.y}))||v(e,`${n.name} reads: ${t.message}`))},_o=(e,n)=>{const t=e.dungeon.layout.monsters.some(o=>In(n.position,o.position.x,o.position.y));return t&&v(e,`${n.name} walked by a monster and lost the momentum`),t},Xn=(e,n,t)=>{v(e,`${t.name} dropped ${n.name}.`),e.dungeon.layout.items.push({item:n,position:t.position}),n.drop&&Ro[n.drop](e,n,t)},ko=(e,n,t)=>{switch(n.type){case q.ARMOUR:t.armour&&Xn(e,t.armour,t),t.armour=n;break;case q.SHIELD:t.shield&&Xn(e,t.shield,t),t.shield=n;break;case q.WEAPON:t.weapon&&Xn(e,t.weapon,t),t.weapon=n;break;default:t.inventory.push(n);break}if(n.pickup){const o=ot[n.pickup];o(e,n,t)}},Ao=(e,n,t,o,r)=>{e.position.x=t,e.position.y=o,vo(n,e),_o(n,e)?e.movement=0:e.movement-=r},ar=(e,n,t,o)=>{const r=e.dungeon.layout.doors.find(i=>i.x===n.position.x&&i.y===n.position.y),s=n.inventory.some(i=>{var l;return(l=i.properties)==null?void 0:l[Eo]});if(r&&yo(n,s,r)){r.locked&&s&&v(e,`${n.name} broke the locked door`);const i=cr(n.position.x,n.position.y,t,o);if(r.side===i)return r.open=!0,r.trapped&&je(e,Bo(r),n,!1),!0}return r&&r.locked&&v(e,"Door is locked"),!1},cr=(e,n,t,o)=>{if(e===t){if(n>o)return T.UP;if(n<o)return T.DOWN}if(n===o){if(e>t)return T.LEFT;if(e<t)return T.RIGHT}},ur=(e,n,t)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(o=>o!=n),v(e,`${t.name} killed ${n.name}`),e.dungeon.killCount++,t.experience+=n.experience},dr=(e,n)=>e.dungeon.layout.monsters.find(t=>De(t.position,n)),fr=(e,n)=>Go(e,n).filter(t=>t!==n).length>0,mr=e=>e.heroes.filter(n=>n.health<=0).map(n=>n),He="USED",wt="ATTACK_BONUS",Lt="SEARCH_BONUS",Eo="BREAK_LOCK",Nt="RE_ROLL_ATTACK",wn="DESCRIPTION",Pn="ACTIVE",Bn="MOVEMENT_BONUS",Ht="ACTIONS_BONUS",bo="RESET_ON",To="NEXT_TURN",hr="TRADE",Co="NEXT_SCENARIO",ot={movementBonusOnPickup:(e,n,t)=>{var o,r;t.maxMovement+=(o=n.properties)==null?void 0:o[Bn],t.actions>0&&(t.movement+=(r=n.properties)==null?void 0:r[Bn])}},Ro={movementBonusOnDrop:(e,n,t)=>{var o,r;t.maxMovement-1>0&&(t.maxMovement-=(o=n.properties)==null?void 0:o[Bn]),t.movement-1>=0&&(t.movement-=(r=n.properties)==null?void 0:r[Bn])}},pr={magicHerbsOnUse:(e,n,t,o)=>{if(n.disabled){v(e,`${n.name} cannot be used at this moment.`);return}if(!o){v(e,"No target was selected.");return}if(!cn(t)){v(e,`${t.name} has no actions left.`);return}if(n.properties){if(n.properties[He]){v(e,`${n.name} has no uses left.`);return}n.properties[He]=!0;const r=Math.min(un(t.level,3),o.maxHealth-o.health);o.health+=r,v(e,`${t.name} used ${n.name} on ${o.name}, restoring ${r} HP`),t.actions--,t.movement=t.maxMovement}},chaosSwordOnUse:(e,n,t,o)=>{if(n.disabled){v(e,`${n.name} cannot be used at this moment. ${t.name} tried it.`);return}},potionOfSpeedOnUse:(e,n,t)=>{var o,r,s;if(n.disabled){v(e,`${n.name} cannot be used at this moment.`);return}(o=n.properties)!=null&&o[He]?v(e,`${n.name} has been consumed.`):(t.actions+=(r=n.properties)==null?void 0:r[Ht],n.properties&&(n.properties[He]=!0),v(e,`${t.name} used ${n.name}, adding ${(s=n.properties)==null?void 0:s[Ht]} actions`))},necklaceOfLightOnUse:(e,n,t,o)=>{var r;if(n.disabled){v(e,`${n.name} cannot be used at this moment.`);return}if(!o){v(e,"No target was selected.");return}if(!cn(t)){v(e,`${t.name} has no actions left.`);return}n.properties&&!((r=n.properties)!=null&&r[He])&&(n.properties[He]=!0,o.ignoredByMonsters=!0,t.actions--)}},Io={magicHerbsOnReset:(e,n)=>{n.properties&&(n.properties[He]=!1)},necklaceOfLightOnUse:(e,n)=>{n.properties&&(n.properties[He]=!1),e.heroes.forEach(t=>t.ignoredByMonsters=!1)}},gr=(e,n)=>{if(n.effect&&e.currentActor){const t=pr[n.effect];t(e,n,e.currentActor,e.targetActor),e.targetActor=void 0}},Oo=e=>{e.heroes.forEach(n=>{n.inventory.filter(t=>vr(t)).forEach(t=>{if(t.reset){const o=Io[t.reset];o(e,t)}})})},Do=e=>{e.heroes.forEach(n=>{n.inventory.filter(t=>yr(t)).forEach(t=>{if(t.reset){const o=Io[t.reset];o(e,t)}})})},yr=e=>e.properties?(e.properties[bo]??[]).some(t=>t===To):!1,vr=e=>e.properties?(e.properties[bo]??[]).some(t=>t===Co):!1,Ie=[{name:"Healing Herbs",type:q.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"Chance to heal up to 3 wounds on one hero.",RESET_ON:[hr,Co]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"Thousand League Boots",type:q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives one additional step for each move action.",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"Giants Glove",type:q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional attack die. Breaks locked doors.",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"Ring of Precision",type:q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"May re-roll one completely missed attack.",RE_ROLL_ATTACK:!0}},{name:"Crown of Wisdom",type:q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"One additional die roll when searching.",SEARCH_BONUS:1}},{name:"Sword of Chaos",type:q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"A sword with a will of it's own. Use at your own peril."},effect:"chaosSwordOnUse"},{name:"Potion of Speed",type:q.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"Gives 2 additional actions. Can only be used once.",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"Necklace of Light",type:q.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[To],ACTIVE:!0},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],Mo={name:"The Dread Labyrinth",beaten:!1,winConditions:[{type:ce.KILL_ALL,fulfilled:!1},{type:ce.OPEN_DOOR,targetCell:{x:18,y:4},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["       ########     ","     ###DDDEEE#     ","     #CCC##EEE#     ","######CCC##EEE######","#AAA##CCC####F#IIII#","#AAABBB#J####F#IIII#","#AAA####J##G#F#IIII#","##### ##J##GGF#IIII#","   ####KKK###F#IIII#","   #LLLKKK# #FMIIII#","   ####KKK####M#####","      #KKKMMMMM#    ","      ####MMMM##    ","         ######     "],corridors:["B","D","F","L"],pits:[{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:15,y:8},{x:16,y:8},{x:17,y:8}],doors:[j(T.RIGHT,3,5),Dn(T.DOWN,6,5,1),j(T.UP,6,5),j(T.DOWN,8,4),Ye(T.UP,8,2),j(T.DOWN,8,7),j(T.LEFT,7,9),Dn(T.LEFT,4,9,1),Dn(T.RIGHT,9,11,1),Ye(T.RIGHT,14,9),Ye(T.UP,18,4),Dn(T.LEFT,14,9,1),j(T.LEFT,13,7),xn(T.UP,11,6),j(T.UP,13,4),j(T.LEFT,11,1)],monsters:[ae(x.ORCH,F.Yellow,5,5),jo(x.TROLL,F.Yellow,7,3,[Ie[3]]),ae(x.ORCH,F.Red,7,11),ae(x.ORCH,F.Blue,11,2),ae(x.ORCH,F.Blue,14,11),ae(x.YELLOW_DARK_LORD,F.Yellow,18,5)],secrets:[_n(le.MAGIC_ITEM,8,10,Ie[2]),Ee(le.TRAP_DOOR,"Trap door",8,6),Ee(le.TRAP_DOOR,"Trap door",11,1),Ee(le.TRAP_DOOR,"Trap door",11,7),Ee(le.TRAP_DOOR,"Trap door",13,11)],notes:[{position:{x:6,y:5},message:"An arrow on the far wall of the corridor points to the left."},{position:{x:8,y:3},message:"An arrow on the far wall of the corridor points to the right."},{position:{x:8,y:8},message:"There is a mosaic in the floor. It depicts a snake coiling around a dwarf, while battling an ice dragon. In the jaws of the snake is treasure chest."},{position:{x:14,y:10},message:"An arrow on the far wall of the corridor points to the left"}],items:[]},killCount:0},wo={name:"The Mines of Evil",nextDungeon:Mo,beaten:!1,winConditions:[{type:ce.KILL_ALL,fulfilled:!1},{type:ce.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[j(T.UP,2,13),j(T.UP,2,10),j(T.RIGHT,3,8),xn(T.RIGHT,6,8),j(T.UP,8,7),j(T.UP,8,4),Ye(T.LEFT,7,2),j(T.LEFT,4,2),xn(T.RIGHT,12,2),j(T.RIGHT,15,2),j(T.DOWN,17,7),j(T.DOWN,17,10),Ye(T.DOWN,17,14)],monsters:[ae(x.TROLL,F.Red,3,7),ae(x.ORCH,F.Red,12,8),ae(x.ORCH,F.Green,11,1),ae(x.TROLL,F.Green,2,2),ae(x.ORCH,F.Yellow,18,7),ae(x.TROLL,F.Yellow,17,10)],secrets:[Ee(le.EQUIPMENT,"Equipment",1,3),Ee(le.EQUIPMENT,"Equipment",3,3),Ee(le.EQUIPMENT,"Equipment",15,2),_n(le.MAGIC_ITEM,2,3,Ie[1]),_n(le.MAGIC_ITEM,16,11,Ie[6])],notes:[{message:"Guard room",position:{x:2,y:10}},{message:"Look in the pillar room for the armory of the dwarf king",position:{x:8,y:10}},{message:"To reach the treasure of the ice dragon, look behind the mirror in the alchemy laboratory.",position:{x:2,y:3}},{message:"A large mirror decorates the far wall of this room.",position:{x:17,y:11}}],items:[]},killCount:0},Lo={name:"The Three Gates of Power",nextDungeon:wo,beaten:!1,winConditions:[{type:ce.KILL_ALL,fulfilled:!1},{type:ce.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[j(T.RIGHT,3,5),j(T.RIGHT,6,5),j(T.RIGHT,10,6),j(T.RIGHT,13,6),j(T.RIGHT,10,9),j(T.RIGHT,13,9),j(T.RIGHT,12,3),Ye(T.UP,9,4),Ye(T.RIGHT,15,2)],monsters:[ae(x.ORCH,F.Blue,10,8),ae(x.ORCH,F.Red,13,9),ae(x.TROLL,F.Red,16,2),ae(x.TROLL,F.Yellow,14,7)],secrets:[Ee(le.EQUIPMENT,"Random Equipment",10,5),Ee(le.EQUIPMENT,"Random Equipment",13,1),Ee(le.EQUIPMENT,"Random Equipment",16,10),_n(le.MAGIC_ITEM,16,6,Ie[0])],notes:[{message:"Beyond stone and fire you shall find the Dread tunnel, the road to the Ice Dragons treasure.",position:{x:2,y:4}},{message:"The Gate of Water. <There is an image of a sea dragon under the text>",position:{x:9,y:8}},{message:"The Gate of Air. <There is an image of a pegasus under the text>",position:{x:9,y:5}},{message:"The Gate of Fire. <There is an image of a hippogriph under the text>",position:{x:9,y:3}}],items:[]},killCount:0},No={name:"Troll cave",beaten:!1,winConditions:[{type:ce.KILL_ALL,fulfilled:!1}],nextDungeon:Lo,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[j(T.RIGHT,3,9),j(T.RIGHT,6,9),j(T.UP,7,7),j(T.UP,7,4)],monsters:[ae(x.ORCH,F.Green,6,9),ae(x.ORCH,F.Yellow,8,10),ae(x.ORCH,F.Red,7,5),ae(x.ORCH,F.Red,9,3),ae(x.TROLL,F.Green,6,1)],secrets:[Ee(le.NOTE,"Welcome to Drakriddarna",3,9)],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},_r=[{name:"Large shield",type:q.SHIELD,amountInDeck:2,dice:2,value:2},{name:"Small shield",type:q.SHIELD,amountInDeck:2,dice:1,value:1}],kr=()=>{const e=[];return Ie.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),e},Ar=()=>{const e=[];return Hn.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),Yo.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),_r.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),e},tn={name:"Treasure of the Ice Dragon",dungeons:[No,Lo,wo,Mo],itemDeck:Ar(),magicItemDeck:kr(),heroes:[Mn("Fearik",F.Yellow),Mn("Helbran",F.Red),Mn("Siedel",F.Green),Mn("Wulf",F.Blue)]},rt=(e,n)=>{const t=Math.abs(n.x-e.x),o=Math.abs(n.y-e.y),r=Math.min(t,o),s=Math.max(t,o),i=r,l=s-r;let a=Math.sqrt(2);return l===0&&(a=1),Math.floor(a*i+l)},Er=(e,n)=>{e.reRender=!0;const t=e.currentActor,o=e.dungeon.layout.items.find(s=>De(s.position,t.position));if(o){const s=o.item;s.type===q.MAGIC?ho(e,s):mo(e,s);const i=e.dungeon.layout.items.indexOf(o);e.dungeon.layout.items.splice(i,1),v(e,`${t.name} picked up ${s.name}`),ko(e,s,t);return}const r=e.dungeon.layout.doors.find(s=>s.x===t.position.x&&s.y===t.position.y&&!s.open);if(r&&!r.hidden){const s=t.inventory.some(i=>{var l;return(l=i.properties)==null?void 0:l[Eo]});if(yo(t,s,r)){switch(r.locked&&s&&v(e,`${t.name} broke the locked door`),r.open=!0,r.trapped&&je(e,Bo(r),t,!1),r.side){case T.RIGHT:yn(t,e,n.x+1,n.y);break;case T.LEFT:yn(t,e,n.x-1,n.y);break;case T.DOWN:yn(t,e,n.x,n.y+1);break;case T.UP:yn(t,e,n.x,n.y-1);break}tt(t)}else if(r.locked&&!r.hidden){if(!cn(t)){v(e,`${t.name} has no actions left`);return}v(e,"Door is locked"),Zn(e)}}else{if(!cn(t)){v(e,`${t.name} has no actions left`);return}Sn(e)}},br=(e,n)=>{e.reRender=!0;const t=e.currentActor;if(t.actions===0){t.movement=0,v(e,`${t.name} has no actions left`);return}if($n(e.dungeon.layout,n.x,n.y)){const r=Tn(e,n.x,n.y),s=bn(e,n.x,n.y),i=rt(t.position,n),l=st(t.position,n,2,e,!0);if(!r&&!s&&i<=t.movement&&l){if(t.position=n,t.movement-=i,vo(e,t),_o(e,t)&&(t.movement=0),fo(e))return}else s&&(i<=t.weapon.range?po(t,e,n):v(e,"Monster is out of range"))}tt(t)},Tr=(e,n,t)=>{const o=document.getElementById("gameBoard");if(!o)return;const r=o.getBoundingClientRect(),s=Math.min(Math.floor((e.clientX-r.left)/n),t.dungeon.layout.grid[0].length-1),i=Math.min(Math.floor((e.clientY-r.top)/n),t.dungeon.layout.grid.length-1),l=t.dungeon.layout.grid[i][s],a=t.currentActor;s===a.position.x&&i===a.position.y?Er(t,{x:s,y:i}):qe(t.dungeon,l)&&br(t,{x:s,y:i})},Jn=e=>e.dungeon.layout.monsters.filter(n=>[x.ORCH,x.TROLL].includes(n.type)),Cr=e=>{const n=Mr(e);n.length===0&&v(e,"No monsters can act"),n.forEach(t=>{const o=t.actions;for(v(e,`${t.name} acted `);t.actions>0;){e.reRender=!0;const r=Go(e,t).filter(g=>!g.ignoredByMonsters),s=Dr(e,t),i=Hr([...s,...Jn(e)],t),l=xr([...s,...Jn(e)],t),a=Pr([...Y(e),...Jn(e)],t,e);switch(Rr(e,t,r,s,i,l,a)){case"MELEE_ATTACK":{const g=Or(r);xt(e,t,g,!1);break}case"RANGED_ATTACK":{const g=Ir(s,t);xt(e,t,g,!0);break}case"MOVE":{Lr(e,t);break}case"DIAGONAL_FIRE_ATTACK":Qn(e,t,i);break;case"ORTHOGONAL_FIRE_ATTACK":Qn(e,t,l);break;case"SAME_ROOM_FIRE_ATTACK":Qn(e,t,a)}t.movement=xe(t)}t.actions=o,t.movement=xe(t)})},Rr=(e,n,t,o,r,s,i)=>t.length>0?"MELEE_ATTACK":!n.rangedWeapon&&r.length===0?"MOVE":o.length>0&&n.rangedWeapon?Math.random()<.1?(v(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"RANGED_ATTACK":i.length>0?Math.random()<.1?(v(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"SAME_ROOM_FIRE_ATTACK":o.length>0&&s.length>0?Math.random()<.1?(v(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"ORTHOGONAL_FIRE_ATTACK":o.length>0&&r.length>0?Math.random()<.1?(v(e,`${n.name} decided to move despite seeing a target.`),"MOVE"):"DIAGONAL_FIRE_ATTACK":"MOVE",Ir=(e,n)=>e.filter(t=>!t.shield).sort(t=>vn(n.position,t.position)).sort((t,o)=>o.health-t.health||vn(n.position,t.position)-vn(n.position,o.position))[0],Or=e=>e.sort((n,t)=>t.health-n.health)[0],Dr=(e,n)=>Y(e).filter(t=>!t.ignoredByMonsters).filter(t=>st(n.position,t.position,48,e,!1)),Mr=e=>e.dungeon.layout.monsters.filter(n=>{const t=Oe(e.dungeon.layout.grid,n.position.x,n.position.y);return t&&qe(e.dungeon,t)&&n.health>0}),xt=(e,n,t,o)=>{je(e,n,t,o),(n==null?void 0:n.actions)>1&&(n==null?void 0:n.movement)<3?n.actions-=2:n.actions--},wr=(e,n)=>Y(e).map(t=>({hero:t,dist:vn(t.position,n.position)})).sort((t,o)=>t.dist-o.dist)[0],Lr=(e,n)=>{const t=wr(e,n);for(;n.movement>0;){if(t&&t.dist>1){const o=Nr(e,n.position);if(o.length>0){const r=o.map(s=>({pos:s,dist:vn(s,t.hero.position)})).sort((s,i)=>s.dist-i.dist)[0].pos;n.position=r,v(e,`${n.name} moved towards ${t.hero.name} (${r.x},${r.y})`)}else v(e,`${n.name} could not move`)}n.movement--}n.actions--},Nr=(e,n)=>{const t=n.x,o=n.y,r=[];for(let s=t-1;s<=t+1;s++)for(let i=o-1;i<=o+1;i++)s===t&&i===o||$n(e.dungeon.layout,s,i)&&Rn(e.dungeon,s,i)&&r.push({x:s,y:i});return r.filter(s=>!Y(e).find(i=>i.position.x===s.x&&i.position.y===s.y)).filter(s=>!e.dungeon.layout.monsters.some(i=>i.position.x===s.x&&i.position.y===s.y))},Hr=(e,n)=>e.filter(t=>[x.YELLOW_DARK_LORD,x.BLUE_DARK_LORD].includes(n.type)&&Math.abs(n.position.x-t.position.x)===Math.abs(n.position.y-t.position.y)&&rt(n.position,t.position)>1),xr=(e,n)=>e.filter(t=>[x.RED_DARK_LORD,x.BLUE_DARK_LORD].includes(n.type)&&(n.position.x===t.position.x||n.position.y===t.position.y)&&rt(n.position,t.position)>1),Pr=(e,n,t)=>e.filter(o=>[x.GREEN_DARK_LORD,x.BLUE_DARK_LORD].includes(n.type)&&Oe(t.dungeon.layout.grid,n.position.x,n.position.y)===Oe(t.dungeon.layout.grid,o.position.x,o.position.y)),Qn=(e,n,t)=>{t.forEach(o=>{var r,s;(r=o.armour)!=null&&r.magicProtection?v(e,`${n.name} attempted a fire attack, but ${o.name}s ${(s=o.armour)==null?void 0:s.name} deflected it.`):je(e,n,o,!0)})},Pt=[{name:"The Hungry Troll",number:1,description:"You suddenly hear a terrible roar echo in the halls behind you. It's the sound of a hungry troll",effect:"theHungryTroll",used:!1},{name:"The Sun Stone",number:2,description:"One of you kicks a pile of rubble, revealing a small, transparent crystal. It radiates a warm, yellow light turning all nearby trolls to stone.",effect:"sunStone",used:!1},{name:"The Time Portal",number:3,description:"You notice how everything around you seem to move slower, as if time it self had slowed down.",effect:"timePortal",used:!1},{name:"The Fountain of Youth",number:4,description:"You hear the weak sound of water running from a wall. When you taste it, you feel stronger than before",effect:"fountainOfYouth",used:!1},{name:"Sleeping Gas Cloud",number:5,description:"Noxious gas seeps through a hole in the wall, making you feel heavy and sleepy.",effect:"sleepingGasCloud",used:!1},{name:"The Lost Orch",number:6,description:"You hear a snarling filled with rage somewhere behind you. You quickly realise there were more monsters here than you thought.",effect:"theLostOrch",used:!1},{name:"The Dragons Breath",number:7,description:"The flames of your torches start to flicker and soon the dungeon is completely dark.",effect:"theDragonsBreath",used:!1},{name:"Landslide",number:8,description:"The ground starts shaking, and you hear a loud crash, as if the ceiling had fallen down.",effect:"landslide",used:!1},{name:"The Magic Node",number:9,description:"You feel a strange, powerful magic course through you. You feel invigorated by it as you press on.",effect:"fountainOfYouth",used:!1},{name:"Foresight",number:10,description:"You see before you a powerful object, hidden behind thick walls.",effect:"foresight",used:!1},{name:"Earthquake",number:11,description:"The whole room starts shaking and you are thrown to the ground. Stones fall from the ceiling and walls and with terror you realise that you ar caught in an earhtquake.",effect:"earthquake",used:!1},{name:"The Magic Storm",number:12,description:"An unsettling wind blows through the dungeon. You freeze as a green glow emanates from one of your magical items",effect:"theMagicStorm",used:!1},{name:"The Elemental Weapon",number:13,description:"A flame suddenly shoots from a silver clad stone in the ceiling, moving towards one of your weapons. The weapon becomes engulfed in flames, feeling more powerful than before.",effect:"theElementalWeapon",used:!1},{name:"The Orch Drums",number:14,description:"You hear the sound of drums from deep below you. As the sound draws nearer, you realise the orchs are on the march.",effect:"theOrchDrums",used:!1},{name:"The Symbol of Weakness",number:15,description:"You walk past a strange symbol on the wall. An evil, yellow glow emanates from it. All of you suddenly feel weaker.",effect:"theSymbolOfWeakness",used:!1}],Ho=e=>e.events?zn(Pt.filter(n=>{var t;return(t=e==null?void 0:e.events)==null?void 0:t.includes(n.number)})):zn(Pt),xo=e=>{const n=e.eventDeck.filter(t=>!t.used);return n.length>0?n[0]:(zn(e.eventDeck),xo(e))},Br={sunStone:(e,n)=>{_e(e,n);const t=Y(e).length-1,o=Math.floor(Math.random()*t),r=Y(e)[o],s=Oe(e.dungeon.layout.grid,r.position.x,r.position.y);e.dungeon.layout.monsters.filter(i=>i.type===x.TROLL).filter(i=>Oe(e.dungeon.layout.grid,i.position.x,i.position.y)===s).forEach(i=>{v(e,`${i.name} was killed by the Sun Stone`),i.health=0}),n.used=!0},theHungryTroll:(e,n)=>{_e(e,n),Bt(e,x.TROLL),n.used=!0},timePortal:(e,n)=>{_e(e,n),e.heroes.forEach(t=>t.actions++),n.used=!0},fountainOfYouth:(e,n)=>{_e(e,n),Y(e).forEach(t=>{if(t.health<t.maxHealth){const o=un(t.level,3);t.health+=Math.min(o,t.maxHealth-t.health)}}),n.used=!0},sleepingGasCloud:(e,n)=>{_e(e,n),Y(e).forEach(t=>{t.actions=Math.max(1,t.actions-1)}),n.used=!0},theLostOrch:(e,n)=>{_e(e,n),Bt(e,x.ORCH),n.used=!0},theDragonsBreath:(e,n)=>{_e(e,n),Y(e).forEach(t=>t.blinded=!0),n.used=!0},landslide:(e,n)=>{_e(e,n);const t=e.dungeon.layout.corridors.filter(i=>!Yr(e,i)).filter(i=>qe(e.dungeon,i)),o=t.length-1,r=Math.floor(Math.random()*o),s=t[r];e.dungeon.collapsedCorridor=s,e.dungeon.layout.grid=e.dungeon.layout.grid.map(i=>i.replaceAll(s,dn)),n.used=!0},foreSight:(e,n)=>{if(_e(e,n),e.dungeon.layout.secrets.filter(o=>o.type===le.EQUIPMENT||o.type===le.MAGIC_ITEM).filter(o=>!o.found).filter(o=>o.item).filter(o=>{const r=Oe(e.dungeon.layout.grid,o.position.x,o.position.y)??"";return!qe(e.dungeon,r)}).length>0){const o=e.dungeon.layout.secrets.pop();o&&o.item&&(v(e,`You sense the object is close to (${o.position.x+2},${o.position.y-1})`),e.dungeon.layout.items.push({item:o.item,position:o.position}))}n.used=!0},earthquake:(e,n)=>{_e(e,n);const t=Po(e),o={name:"boulder",type:q.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},r={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:o,level:de.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:F.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(s=>s.type===x.TROLL).filter(s=>Oe(e.dungeon.layout.grid,s.position.x,s.position.y)===t).forEach(s=>je(e,r,s,!1)),Y(e).filter(s=>Oe(e.dungeon.layout.grid,s.position.x,s.position.y)===t).forEach(s=>je(e,r,s,!1)),n.used=!0},theMagicStorm:(e,n)=>{var o;_e(e,n);const t=Y(e).filter(r=>r.inventory.filter(s=>!s.disabled).some(s=>s.type===q.MAGIC));if(t.length>0){const r=t.length-1,s=Math.floor(Math.random()*r),i=t[s],l=i.inventory.filter(a=>a.type===q.MAGIC);if(l.length>0){const a=l.length-1,c=Math.floor(Math.random()*a),g=l[c];g.disabled=!0,!((o=g.properties)!=null&&o[Pn])&&g.pickup&&g.drop&&Ro[g.drop](e,g,i)}}n.used=!0},theElementalWeapon:(e,n)=>{_e(e,n);const t=Y(e),o=t.length-1,r=Math.floor(Math.random()*o),s=t[r];s.weapon.elemental=!0,n.used=!0},theOrchDrums:(e,n)=>{_e(e,n),e.dungeon.layout.monsters.filter(t=>t.type===x.ORCH).forEach(t=>t.actions=3),n.used=!0},theSymbolOfWeakness:(e,n)=>{_e(e,n),Y(e).forEach(t=>t.weakened=!0),n.used=!0}},Ur=e=>{Y(e).some(n=>n.weapon.elemental)&&(v(e,"The magic storm calmed down"),Y(e).forEach(n=>{n.inventory.forEach(t=>{var o;!((o=t.properties)!=null&&o[Pn])&&t.pickup&&ot[t.pickup](e,t,n),t.disabled=!1})}))},Gr=e=>{e.eventDeck.filter(t=>!t.used).length===0&&(Fr(e),$r(e),Ur(e)),Wr(e),Kr(e)},$r=e=>{const n=e.dungeon.collapsedCorridor;n&&(v(e,"The collapsed corridor cleared up."),e.dungeon.layout.grid=e.dungeon.layout.grid.map(t=>t.replaceAll(dn,n)),e.dungeon.collapsedCorridor=void 0)},Kr=e=>{Y(e).some(n=>n.blinded)&&(v(e,"You light your torches again."),Y(e).forEach(n=>n.blinded=!1))},Fr=e=>{Y(e).some(n=>n.weapon.elemental)&&(v(e,"The elemental magic died off."),Y(e).forEach(n=>n.weapon.elemental=!1))},Wr=e=>{Y(e).some(n=>n.weakened)&&(v(e,"Your strength returns to you."),Y(e).forEach(n=>n.weakened=!1))},Po=e=>{const n=e.dungeon.discoveredRooms.length-1,t=Math.floor(Math.random()*n);return e.dungeon.discoveredRooms[t]},Bt=(e,n)=>{const t=e.dungeon.layout.monsters.filter(l=>l.type===n);if(t.length===4)return;const r=Po(e),s=[F.Red,F.Green,F.Yellow,F.Blue];t.forEach(l=>{const a=s.indexOf(l.colour);a!==-1&&s.splice(a,1)});let i=!1;for(let l=0;l<e.dungeon.layout.grid.length;l++){const a=Cn(e.dungeon.layout.grid[l]);for(let c=0;c<a.length;c++)if(a[c]===r&&!Tn(e,c,l)&&!bn(e,c,l)){e.dungeon.layout.monsters.push(ae(n,s[0],c,l)),i=!0;break}if(i)break}},_e=(e,n)=>{v(e,`${n.description}`),v(e,`${n.number}. ${n.name}`)},zn=e=>{let n=e.length,t;for(;n>0;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e.forEach(o=>o.used=!1),e},Yr=(e,n)=>{const t=[];return e.dungeon.layout.grid.forEach((o,r)=>{Cn(o).forEach((s,i)=>{s===n&&t.push(Tn(e,i,r)||bn(e,i,r))})}),t.some(o=>o)},Ut=e=>{e.reRender=!0,v(e,"Game saved."),localStorage.setItem("state",JSON.stringify(e))},Gt=()=>{const e=localStorage.getItem("state");if(e){const n=JSON.parse(e);return n.currentActor=n.heroes.find(t=>{var o;return t.name===((o=n.currentActor)==null?void 0:o.name)}),v(n,"Game loaded."),n.reRender=!0,n}},Vr=()=>{const e={heroes:tn.heroes,dungeon:tn.dungeons[0],currentActor:tn.heroes[0],actionLog:[`Playing '${tn.name}'`,"Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."],itemDeck:$t(tn.itemDeck),magicItemDeck:$t(tn.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:Ho(tn.dungeons[0]),reRender:!0};return nt(e),localStorage.setItem("autosave",JSON.stringify(e)),e},$t=e=>{let n=e.length,t;for(;n>0;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e},Cn=e=>{const n=[];for(let t=0;t<e.length;t++)n.push(e[t]);return n},un=(e,n)=>{let t=[];for(let o=0;o<n;o++)t.push(Math.floor(Math.random()*6)+1);switch(e){case de.APPRENTICE:t=t.filter(o=>o===5);break;case de.KNIGHT:case de.HERO:t=t.filter(o=>o>=4);break;case de.LORD:case de.MASTER:t=t.filter(o=>o>=3);break}return t.length},xe=e=>{var n;return e.maxMovement-(((n=e.armour)==null?void 0:n.movementReduction)??0)},qr=e=>e.dungeon.winConditions.filter(n=>n.type!==ce.KILL_ALL).some(n=>!n.fulfilled),Ln=e=>{if(e.settings.debug&&console.log(e),e.reRender=!0,Xr(e),e.currentActor===void 0)return e;{v(e,`${e.currentActor.name} ended their turn`);let t=Y(e).indexOf(e.currentActor)+1;if(t===Y(e).length&&(Cr(e),t=0,Do(e)),Y(e).length===0)return jr();if(Y(e)[t].incapacitated&&(v(e,`${Y(e)[t].name} is no longer incapacitated.`),Y(e)[t].incapacitated=!1,t++),e.currentActor.actions=2,e.currentActor.movement=xe(e.currentActor),e.currentActor=Y(e)[t],t===0&&qr(e)){Gr(e);const o=xo(e);Br[o.effect](e,o)}v(e,`${e.currentActor.name} started their turn`)}return e},jr=()=>{const e=localStorage.getItem("autosave");if(e){const n=JSON.parse(e);return n.reRender=!0,go(n),nt(n),Oo(n),Do(n),Uo({x:n.dungeon.startingPositions[0].x,y:n.dungeon.startingPositions[0].y},n.settings.cellSize),n.currentActor=n.heroes.find(t=>{var o;return t.name===((o=n.currentActor)==null?void 0:o.name)}),v(n,"All the heroes fell in combat. But worry not, you can try again."),n}},Xr=e=>{var n,t;e.dungeon.winConditions.forEach(o=>{var r;switch(o.type){case ce.KILL_ALL:{const s=e.dungeon.layout.monsters.map(i=>i.health).reduce((i,l)=>i+l,0);o.fulfilled=s<=0;break}case ce.REACH_CELL:{o.fulfilled=Y(e).some(s=>{var i;return s.position.x===((i=o.targetCell)==null?void 0:i.x)&&s.position.y===o.targetCell.y});break}case ce.KILL_ALL_OF_TYPE:{o.fulfilled=e.dungeon.layout.monsters.filter(s=>s.type===o.targetMonsterType).some(s=>s.health>0);break}case ce.OPEN_DOOR:{o.fulfilled=((r=e.dungeon.layout.doors.find(s=>{var i,l;return s.x===((i=o.targetCell)==null?void 0:i.x)&&s.y===((l=o.targetCell)==null?void 0:l.y)}))==null?void 0:r.open)??!1;break}case ce.KILL_AT_LEAST:{o.fulfilled=(o.killMinCount?o.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(o=>o.fulfilled).reduce((o,r)=>o&&r,!0),e.dungeon.beaten&&(v(e,"All win conditions have been fulfilled"),v(e,`You have cleared ${e.dungeon.name}`),(n=e.dungeon.nextDungeon)!=null&&n.name&&v(e,`Press 'Next' to move on to the next level: ${(t=e.dungeon.nextDungeon)==null?void 0:t.name}`))},Bo=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:F.Red,maxHealth:0,name:"Door",level:de.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:q.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),$n=(e,n,t)=>{var r,s;let o=!0;if(n<0||n>=e.grid[0].length||t<0||t>=e.grid.length)o=!1;else{const i=(r=e.pits)==null?void 0:r.some(c=>De(c,{x:n,y:t})),l=(s=e.pillars)==null?void 0:s.some(c=>De(c,{x:n,y:t})),a=Oe(e.grid,n,t);(i||l||a===An||a===En)&&(o=!1)}return o},Rn=(e,n,t)=>{const o=Oe(e.layout.grid,n,t);return o?qe(e,o):!1},qe=(e,n)=>e.discoveredRooms.includes(n),Oe=(e,n,t)=>{let o="";return e.forEach((r,s)=>{Cn(r).forEach((i,l)=>{s===t&&l===n&&(o=i)})}),o},In=(e,n,t)=>e.x===n&&e.y===t||e.x===n-1&&e.y===t||e.x===n-1&&e.y===t-1||e.x===n&&e.y===t-1||e.x===n+1&&e.y===t-1||e.x===n+1&&e.y===t||e.x===n+1&&e.y===t+1||e.x===n&&e.y===t+1||e.x===n-1&&e.y===t+1,Jr=(e,n,t,o)=>{var s;const r=((s=o.armour)==null?void 0:s.defense)??o.defense;return`${e} damage (${n}-(${r}+${t})=${e})`},De=(e,n)=>e.x===n.x&&e.y===n.y,v=(e,n)=>{e.actionLog=[n,...e.actionLog],e.reRender=!0},je=(e,n,t,o)=>{var k,C;let r=n.weapon;o&&n.rangedWeapon&&(r=n.rangedWeapon);let s=0,i=0;r.ignoresArmour?t.armour&&v(e,`${t.name}'s armour was useless against ${r.name} `):s=((k=t.armour)==null?void 0:k.defense)??t.defense,r.ignoresShield?t.shield&&v(e,`${t.name}'s shield was useless against ${r.name} `):i=un(t.level,((C=t.shield)==null?void 0:C.dice)??0);const l=n.inventory.filter(O=>{var y;return(y=O==null?void 0:O.properties)==null?void 0:y[Nt]}).some(O=>{var y;return v(e,`${n.name} used the effect of ${O.name} when attacking`),(y=O.properties)==null?void 0:y[Nt]}),a=n.inventory.filter(O=>{var y;return(y=O==null?void 0:O.properties)==null?void 0:y[wt]}).map(O=>{var y;return v(e,`${n.name} used the effect of ${O.name} when attacking`),(y=O.properties)==null?void 0:y[wt]}).reduce((O,y)=>O+y,0),c=n.blinded?1:0,g=n.weakened?1:0,f=n.weapon.elemental?1:0,m=a+f,_=c+g,R=un(n.level,r.dice+m-_);let w=Math.max(R-(s+i),0);w===0&&l&&(v(e,`${n.name} missed but got another chance`),w=Math.max(R-(s+i),0)),t.health-=w,v(e,`${n.name} attacked ${t.name} with ${r.name} for ${Jr(w,R,i,t)}`),t.health<=0&&(v(e,`${n.name} killed ${t.name}`),t.health=0,t.level=de.APPRENTICE)},Uo=(e,n)=>{const t=document.getElementById("gameBoardContainer"),o=document.getElementById("gameBoard");if(t&&o){const r=e.x*n,s=e.y*n,i=o.offsetWidth,l=o.offsetHeight;t.scrollLeft=Math.round(r/i),t.scrollTop=Math.round(s/l)}},Qr=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=["You have reached "+e.dungeon.name],e.eventDeck=Ho(e.dungeon),e.reRender=!0,lr(e),ir(e),go(e),nt(e),Oo(e),Uo({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize),localStorage.setItem("autosave",JSON.stringify(e)))},vn=(e,n)=>Math.sqrt(Math.pow(e.x-(n==null?void 0:n.x),2)+Math.pow(e.y-(n==null?void 0:n.y),2)),st=(e,n,t,o,r)=>{const s={x:e.x*t-Math.floor(t/2),y:e.y*t-Math.floor(t/2)},i={x:n.x*t-Math.floor(t/2),y:n.y*t-Math.floor(t/2)};return it(s,e,i,n,t,o,r,[])},it=(e,n,t,o,r,s,i,l)=>{var w,k;if(isNaN(e.x)||isNaN(e.y))return!1;const a=Zr(e,t),c={x:Math.round((a.x+Math.floor(r/2))/r),y:Math.round((a.y+Math.floor(r/2))/r)};if(isNaN(c.x)||isNaN(c.y)||isNaN(a.x)||isNaN(a.y))return!1;const g=Oe(s.dungeon.layout.grid,c.x,c.y),f=(w=s.dungeon.layout.pits)==null?void 0:w.some(C=>De(C,c)),m=(k=s.dungeon.layout.pillars)==null?void 0:k.some(C=>De(C,c)),_=s.dungeon.layout.monsters.some(C=>De(C.position,c)),R=Y(s).filter(C=>!De(C.position,n)).some(C=>De(C.position,c));return c.x===o.x&&c.y===o.y?(l.push(c),!0):m||_||!i&&R||g===En||g===dn||i&&(f||g===An)?!1:(c.x===n.x&&c.y===n.y||l.some(C=>C.x===c.x&&C.y===c.y)||l.push(c),it(a,n,t,o,r,s,i,l))},Zr=(e,n)=>{const t=e.x,o=e.y,r=n.x-t,s=n.y-o,i=r/Math.pow(Math.pow(r,2)+Math.pow(s,2),1/2),l=s/Math.pow(Math.pow(r,2)+Math.pow(s,2),1/2),a=Math.round(i+t),c=Math.round(l+o);return{x:a,y:c}},Go=(e,n)=>Y(e).filter(t=>In(n.position,t.position.x,t.position.y)),Sr=""+new URL("../assets/Dungeon_Tileset.e372bb4f.png",import.meta.url).href,zr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",es=(e,n,t,o,r)=>{Y(o).forEach(i=>{ns(e,i,n,t,r)}),ss(e,o,t),is(e,o,t)},ns=(e,n,t,o,r)=>{const s=n.position.x,i=n.position.y;if(e.drawImage(t,4*16,0,16,16,s*o,i*o,o,o),ts(e,n,s,i,o),rs(e,n,s,i,o),os(e,n,s,i,o),r){const l=`(${s},${i})`;e.fillStyle="black",e.font="8px Arial",e.fillText(l,s*o+3,i*o+10)}},ts=(e,n,t,o,r)=>{const s=e.fillStyle,i=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let l=0;l<n.actions;l++)e.fillRect(t*r+4+6*l,o*r+r-12,5,5),e.rect(t*r+4+6*l,o*r+r-12,5,5),e.stroke();e.fillStyle="blue";for(let l=0;l<n.movement;l++)e.fillRect(t*r+r-22+6*l,o*r+r-12,5,5),e.rect(t*r+r-22+6*l,o*r+r-12,5,5),e.stroke();e.fillStyle=s,e.strokeStyle=i},os=(e,n,t,o,r)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(t*r+4,o*r,r-8,4),e.fillStyle="green",e.fillRect(t*r+4,o*r,(r-8)*(n.health/n.maxHealth),4),e.rect(t*r+4,o*r,r-8,4),e.stroke()},rs=(e,n,t,o,r)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(t*r+4,o*r+(r-6),r-8,4),e.stroke()},ss=(e,n,t)=>{const o=n.currentActor;if(o){for(let r=o.position.x-o.movement;r<=o.position.x+o.movement;r++)for(let s=o.position.y-o.movement;s<=o.position.y+o.movement;s++)if(Rn(n.dungeon,r,s)&&!(r===(o==null?void 0:o.position.x)&&s===(o==null?void 0:o.position.y))){const l=bn(n,r,s),a=Tn(n,r,s),c=$n(n.dungeon.layout,r,s),g=st(o.position,{x:r,y:s},2,n,!0);!a&&!l&&c&&g&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(r*t,s*t,t,t),e.stroke())}}},is=(e,n,t)=>{const o=n.currentActor;o&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(o.position.x*t,o.position.y*t),e.lineTo(o.position.x*t+t/3,o.position.y*t),e.moveTo(o.position.x*t,o.position.y*t),e.lineTo(o.position.x*t,o.position.y*t+t/3),e.moveTo(o.position.x*t+t,o.position.y*t),e.lineTo(o.position.x*t+t/3*2,o.position.y*t),e.moveTo(o.position.x*t+t,o.position.y*t),e.lineTo(o.position.x*t+t,o.position.y*t+t/3),e.moveTo(o.position.x*t,o.position.y*t+t),e.lineTo(o.position.x*t,o.position.y*t+t/3*2),e.moveTo(o.position.x*t,o.position.y*t+t),e.lineTo(o.position.x*t+t/3,o.position.y*t+t),e.moveTo(o.position.x*t+t,o.position.y*t+t),e.lineTo(o.position.x*t+t,o.position.y*t+t/3*2),e.moveTo(o.position.x*t+t,o.position.y*t+t),e.lineTo(o.position.x*t+t/3*2,o.position.y*t+t),e.stroke(),e.lineWidth=1)},ls=(e,n,t,o,r)=>{o.dungeon.layout.monsters.forEach(s=>{as(e,n,o,s,t,r)})},as=(e,n,t,o,r,s)=>{const i=t.dungeon.layout.grid[o.position.y][o.position.x];if(o&&o.health>0&&qe(t.dungeon,i)){switch(o.type){case x.ORCH:cs(e,n,r,o);break;case x.TROLL:us(e,n,r,o);break;default:ds(e,n,r,o);break}fs(e,o,r),ms(e,o,r),hs(e,o,t.heroes,t,r,s)}},cs=(e,n,t,o)=>{e.drawImage(n,t,16,16,16,o.position.x*t,o.position.y*t,t,t)},us=(e,n,t,o)=>{e.drawImage(n,t,16,16,16,o.position.x*t,o.position.y*t,t,t)},ds=(e,n,t,o)=>{e.drawImage(n,16,16,16,16,o.position.x*t,o.position.y*t,t,t)},fs=(e,n,t)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(n.position.x*t+4,n.position.y*t+(t-6),t-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},ms=(e,n,t)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n.position.x*t+4,n.position.y*t,t-8,4),e.fillStyle="green",e.fillRect(n.position.x*t+4,n.position.y*t,(t-8)*(n.health/n.maxHealth),4),e.rect(n.position.x*t+4,n.position.y*t,t-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},hs=(e,n,t,o,r,s)=>{s&&t.forEach(i=>{const l=[],a={x:n.position.x*48-24,y:n.position.y*48-24},c={x:i.position.x*48-24,y:i.position.y*48-24};if(it(a,n.position,c,i.position,48,o,!1,l)){const f=n.position.x,m=n.position.y,_=i.position.x,R=i.position.y;e.beginPath(),e.strokeStyle=n.colour,e.lineWidth=2,e.moveTo(f*r+r/2,m*r+r/2),e.lineTo(_*r+r/2,R*r+r/2),e.stroke(),e.lineWidth=1}})},ps=(e,n,t,o,r)=>{o.dungeon.layout.doors.forEach(s=>{Cs(e,n,t,o,s,r)})},gs=(e,n,t,o,r)=>{o.dungeon.layout.grid.forEach((s,i)=>{Cn(s).forEach((l,a)=>{ks(e,n,o,l,a,i,t),Ts(e,l,o,a,i,t,r)})}),vs(e,n,t,o,r),_s(e,n,t,o,r)},ys=(e,n,t,o,r)=>{o.dungeon.layout.secrets.filter(s=>s.found).forEach(s=>{switch(s.type){case le.TRAP_DOOR:Es(e,n,t,s);break;default:bs(e,n,t,s);break}}),o.dungeon.layout.secrets.filter(s=>!s.found).forEach(s=>{if(e.globalAlpha=.6,on(e,n,8,0,t,s.position.x,s.position.y,o),e.globalAlpha=1,r){const i=`${s.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(s.position.x*t,s.position.y*t,t,t),e.fillStyle="black",e.font="12px Arial",e.fillText(i,s.position.x*t,s.position.y*t+10)}})},on=(e,n,t,o,r,s,i,l)=>{l.dungeon.discoveredRooms.some(a=>Kt(s,i,a,l))||Kt(s,i,dn,l)?e.drawImage(n,t*48,o,48,48,s*r,i*r,r,r):$o(e,s,i,r)},vs=(e,n,t,o,r)=>{var s,i;(i=(s=o.dungeon.layout.pits)==null?void 0:s.filter(l=>Rn(o.dungeon,l.x,l.y)||r))==null||i.forEach(l=>{on(e,n,7,0,t,l.x,l.y,o)})},_s=(e,n,t,o,r)=>{var s,i;(i=(s=o.dungeon.layout.pillars)==null?void 0:s.filter(l=>Rn(o.dungeon,l.x,l.y)||r))==null||i.forEach(l=>{on(e,n,6,0,t,l.x,l.y,o)})},ks=(e,n,t,o,r,s,i)=>{As(o,t)?o===dn?(on(e,n,0,0,i,r,s,t),on(e,n,5,0,i,r,s,t)):on(e,n,1,0,i,r,s,t):Un(o,t)?$o(e,r,s,i):on(e,n,0,0,i,r,s,t)},As=(e,n)=>Rs(e)||!qe(n.dungeon,e)&&e!==An,$o=(e,n,t,o)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="black",e.fillRect(n*o,t*o,o,o),e.stroke()},Es=(e,n,t,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(n,3*48,0,48,48,r*t,s*t,t,t)},bs=(e,n,t,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(n,4*48,0,48,48,r*t,s*t,t,t)},Ts=(e,n,t,o,r,s,i)=>{!i&&(Un(n,t)||n===En)||(e.beginPath(),e.strokeStyle="black",e.rect(o*s,r*s,s,s),i&&(e.font="7px Arial",e.fillText(`${o},${r}`,o*s+3,r*s+(s-3))),e.stroke())},Cs=(e,n,t,o,r,s)=>{const i=o.dungeon.layout.grid[r.y][r.x];if(r&&!r.hidden&&!r.open&&!Un(i,o))switch(e.fillStyle="brown",r.side){case T.RIGHT:{e.fillRect(r.x*t+(t-2),r.y*t,4,t),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t+(t-4),r.y*t+(t/2-4),8,8));break}case T.LEFT:{e.fillRect(r.x*t-2,r.y*t,4,t),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t-4,r.y*t+(t/2-4),8,8));break}case T.UP:{e.fillRect(r.x*t,r.y*t-2,t,4),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t+(t/2-4),r.y*t-4,8,8));break}case T.DOWN:{e.fillRect(r.x*t,r.y*t+(t-2),t,4),r.locked&&s&&(e.fillStyle="grey",e.fillRect(r.x*t+(t/2-4),r.y*t+(t-4),8,8));break}}s&&!Un(i,o)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${r.hidden?"H":"-"}/${r.trapped?`T${r.trapAttacks}`:"-"}/${r.locked?"L":"-"}]`,r.x*t,r.y*t+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(r.x*t,r.y*t,t,t))},Rs=e=>e===En,Un=(e,n)=>e===An||!qe(n.dungeon,e),Kt=(e,n,t,o)=>{if(!o)return;const r=Math.max(e-1,0),s=Math.max(n-1,0),i=Math.min(n+1,o.dungeon.layout.grid.length-1),l=Math.min(e+1,o.dungeon.layout.grid[0].length-1);for(let a=r;a<=l;a++)for(let c=s;c<=i;c++){const g=o.dungeon.layout.grid[c];if(Cn(g)[a]===t)return!0}return!1},Is=(e,n,t,o)=>{o.dungeon.layout.items.forEach(r=>{switch(r.item.type){case q.MAGIC:Ft(e,n,t,r);break;case q.WEAPON:Ft(e,n,t,r)}})},Ft=(e,n,t,o)=>{const r=o.position.x,s=o.position.y;e.drawImage(n,0,48,48,48,r*t,s*t,t,t)};function Wt(e){let n,t,o=e[2](e[0])+"",r,s;return{c(){n=h("p"),t=G(" "),r=G(o),this.h()},l(i){n=p(i,"P",{class:!0});var l=E(n);t=$(l," "),r=$(l,o),l.forEach(d),this.h()},h(){M(n,"class",s=Ot(e[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")},m(i,l){I(i,n,l),u(n,t),u(n,r)},p(i,l){l&1&&o!==(o=i[2](i[0])+"")&&fe(r,o),l&1&&s!==(s=Ot(i[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")&&M(n,"class",s)},d(i){i&&d(n)}}}function Os(e){let n=e[1],t,o=Wt(e);return{c(){o.c(),t=ve()},l(r){o.l(r),t=ve()},m(r,s){o.m(r,s),I(r,t,s)},p(r,[s]){s&2&&be(n,n=r[1])?(o.d(1),o=Wt(r),o.c(),o.m(t.parentNode,t)):o.p(r,s)},i:ye,o:ye,d(r){r&&d(t),o.d(r)}}}function Ds(e,n,t){let{condition:o}=n,{state:r}=n,s=!1;const i=a=>{switch(a.type){case ce.KILL_ALL:return"Kill all monsters";case ce.KILL_ALL_OF_TYPE:return`Kill all ${a.targetMonsterType}`;case ce.KILL_AT_LEAST:return`Kill at least ${a.killMinCount} monsters. (${r.dungeon.killCount}/${a.killMinCount})`;case ce.OPEN_DOOR:return"Open a certain door";case ce.REACH_CELL:return"Reach a certain cell"}};kn(()=>{l(),setInterval(l,100)});const l=()=>{r.reRender&&t(1,s=!s)};return e.$$set=a=>{"condition"in a&&t(0,o=a.condition),"state"in a&&t(3,r=a.state)},[o,s,i,r]}class Ms extends Xe{constructor(n){super(),Je(this,n,Ds,Os,be,{condition:0,state:3})}}function Yt(e,n,t){const o=e.slice();return o[12]=n[t],o[13]=n,o[14]=t,o}function Vt(e){let n,t,o,r;function s(a){e[5](a,e[12],e[13],e[14])}function i(a){e[6](a)}let l={};return e[12]!==void 0&&(l.condition=e[12]),e[0]!==void 0&&(l.state=e[0]),n=new Ms({props:l}),rn.push(()=>ln(n,"condition",s)),rn.push(()=>ln(n,"state",i)),{c(){$e(n.$$.fragment)},l(a){Ke(n.$$.fragment,a)},m(a,c){Fe(n,a,c),r=!0},p(a,c){e=a;const g={};!t&&c&1&&(t=!0,g.condition=e[12],sn(()=>t=!1)),!o&&c&1&&(o=!0,g.state=e[0],sn(()=>o=!1)),n.$set(g)},i(a){r||(re(n.$$.fragment,a),r=!0)},o(a){ue(n.$$.fragment,a),r=!1},d(a){We(n,a)}}}function ws(e){let n,t,o,r,s,i,l,a=Ve(e[0].dungeon.winConditions.sort(jt)),c=[];for(let f=0;f<a.length;f+=1)c[f]=Vt(Yt(e,a,f));const g=f=>ue(c[f],1,1,()=>{c[f]=null});return{c(){n=h("div"),t=h("canvas"),o=N(),r=h("div");for(let f=0;f<c.length;f+=1)c[f].c();this.h()},l(f){n=p(f,"DIV",{style:!0,class:!0,id:!0});var m=E(n);t=p(m,"CANVAS",{width:!0,height:!0,id:!0}),E(t).forEach(d),o=H(m),r=p(m,"DIV",{class:!0});var _=E(r);for(let R=0;R<c.length;R+=1)c[R].l(_);_.forEach(d),m.forEach(d),this.h()},h(){M(t,"width",e[1]*40),M(t,"height",e[1]*30),M(t,"id","gameBoard"),M(r,"class","winConditions svelte-1iwnxag"),M(n,"style",e[3]()),M(n,"class","dungeon svelte-1iwnxag"),M(n,"id","gameBoardContainer")},m(f,m){I(f,n,m),u(n,t),u(n,o),u(n,r);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(r,null);s=!0,i||(l=te(t,"click",e[2]),i=!0)},p(f,[m]){if(m&1){a=Ve(f[0].dungeon.winConditions.sort(jt));let _;for(_=0;_<a.length;_+=1){const R=Yt(f,a,_);c[_]?(c[_].p(R,m),re(c[_],1)):(c[_]=Vt(R),c[_].c(),re(c[_],1),c[_].m(r,null))}for(Qe(),_=a.length;_<c.length;_+=1)g(_);Ze()}},i(f){if(!s){for(let m=0;m<a.length;m+=1)re(c[m]);s=!0}},o(f){c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)ue(c[m]);s=!1},d(f){f&&d(n),Gn(c,f),i=!1,l()}}}const qt=10,jt=(e,n)=>e.fulfilled===n.fulfilled?0:e.fulfilled?1:-1;function Ls(e,n,t){var w;let{state:o}=n,{debugMode:r}=n,s,i;const l=(o==null?void 0:o.settings.cellSize)??48;let a=0,c=0;i=window.innerHeight,s=((w=document.getElementById("footer"))==null?void 0:w.offsetHeight)??0,kn(()=>{const k=new Image;k.src=Sr;const C=new Image;C.src=zr,setInterval(()=>g(k,C),10)});const g=(k,C)=>{if(!o||!document)return;const O=document.getElementById("gameBoard"),y=O.getContext("2d");o.reRender&&(c++,a++,y.clearRect(0,0,O.width,O.height),y.fillStyle="black",y.fillRect(0,0,O.width,O.height),gs(y,k,l,o,r),ys(y,k,l,o,r),Is(y,k,l,o),ps(y,k,l,o,r),ls(y,C,l,o,r),es(y,C,l,o,r),r&&(y.fillStyle="white",y.font="8px Arial",y.fillText(`Re-renders: ${a}`,2,10),y.fillText(`FPS: ${c/(qt/1e3)}`,2,20)),setTimeout(()=>{t(0,o.reRender=!1,o),c=0},qt))},f=k=>{Tr(k,l,o)},m=()=>`max-height: ${i-s-20}px; max-width: ${l*40}`;function _(k,C,O,y){O[y]=k,t(0,o)}function R(k){o=k,t(0,o)}return e.$$set=k=>{"state"in k&&t(0,o=k.state),"debugMode"in k&&t(4,r=k.debugMode)},[o,l,f,m,r,_,R]}class Ns extends Xe{constructor(n){super(),Je(this,n,Ls,ws,be,{state:0,debugMode:4})}}function Hs(e){let n,t="Used";return{c(){n=h("button"),n.textContent=t,this.h()},l(o){n=p(o,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(n)!=="svelte-fgo135"&&(n.textContent=t),this.h()},h(){n.disabled=!0,M(n,"class","svelte-gca2x5")},m(o,r){I(o,n,r)},p:ye,d(o){o&&d(n)}}}function xs(e){let n,t="Use",o,r;return{c(){n=h("button"),n.textContent=t,this.h()},l(s){n=p(s,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(n)!=="svelte-3f43k6"&&(n.textContent=t),this.h()},h(){M(n,"class","svelte-gca2x5")},m(s,i){I(s,n,i),o||(r=te(n,"click",e[2]),o=!0)},p:ye,d(s){s&&d(n),o=!1,r()}}}function Ps(e){var Z,X;let n,t="",o,r,s,i=e[0].name+"",l,a,c,g=((Z=e[0].properties)==null?void 0:Z[wn])+"",f,m,_=((X=e[0].properties)==null?void 0:X[wn])+"",R,w,k;function C(b,V){var B,A,K;if((B=b[0].properties)!=null&&B[Pn]&&!((A=b[0].properties)!=null&&A[He]))return xs;if((K=b[0].properties)!=null&&K[Pn])return Hs}let O=C(e),y=O&&O(e);return{c(){n=h("div"),n.innerHTML=t,o=N(),r=h("div"),s=h("b"),l=G(i),a=N(),c=h("span"),f=G(g),m=N(),R=G(_),w=N(),k=h("div"),y&&y.c(),this.h()},l(b){n=p(b,"DIV",{class:!0,"data-svelte-h":!0}),oe(n)!=="svelte-pn8o3r"&&(n.innerHTML=t),o=H(b),r=p(b,"DIV",{class:!0});var V=E(r);s=p(V,"B",{class:!0});var B=E(s);l=$(B,i),B.forEach(d),a=H(V),c=p(V,"SPAN",{class:!0});var A=E(c);f=$(A,g),m=H(A),R=$(A,_),A.forEach(d),V.forEach(d),w=H(b),k=p(b,"DIV",{class:!0});var K=E(k);y&&y.l(K),K.forEach(d),this.h()},h(){M(n,"class","item item-icon svelte-gca2x5"),M(s,"class","svelte-gca2x5"),M(c,"class","svelte-gca2x5"),M(r,"class","item item-description bottom-border svelte-gca2x5"),M(k,"class","item item-action svelte-gca2x5")},m(b,V){I(b,n,V),I(b,o,V),I(b,r,V),u(r,s),u(s,l),u(r,a),u(r,c),u(c,f),u(c,m),u(c,R),I(b,w,V),I(b,k,V),y&&y.m(k,null)},p(b,[V]){var B,A;V&1&&i!==(i=b[0].name+"")&&fe(l,i),V&1&&g!==(g=((B=b[0].properties)==null?void 0:B[wn])+"")&&fe(f,g),V&1&&_!==(_=((A=b[0].properties)==null?void 0:A[wn])+"")&&fe(R,_),O===(O=C(b))&&y?y.p(b,V):(y&&y.d(1),y=O&&O(b),y&&(y.c(),y.m(k,null)))},i:ye,o:ye,d(b){b&&(d(n),d(o),d(r),d(w),d(k)),y&&y.d()}}}function Bs(e,n,t){let{item:o}=n,{state:r}=n;const s=()=>gr(r,o);return e.$$set=i=>{"item"in i&&t(0,o=i.item),"state"in i&&t(1,r=i.state)},[o,r,s]}class Us extends Xe{constructor(n){super(),Je(this,n,Bs,Ps,be,{item:0,state:1})}}function Xt(e,n,t){const o=e.slice();return o[5]=n[t],o[6]=n,o[7]=t,o}function Jt(e){let n,t,o;function r(i){e[3](i,e[5],e[6],e[7])}let s={state:e[1]};return e[5]!==void 0&&(s.item=e[5]),n=new Us({props:s}),rn.push(()=>ln(n,"item",r)),{c(){$e(n.$$.fragment)},l(i){Ke(n.$$.fragment,i)},m(i,l){Fe(n,i,l),o=!0},p(i,l){e=i;const a={};l&2&&(a.state=e[1]),!t&&l&1&&(t=!0,a.item=e[5],sn(()=>t=!1)),n.$set(a)},i(i){o||(re(n.$$.fragment,i),o=!0)},o(i){ue(n.$$.fragment,i),o=!1},d(i){We(n,i)}}}function Qt(e){let n,t,o=Ve(e[0]),r=[];for(let i=0;i<o.length;i+=1)r[i]=Jt(Xt(e,o,i));const s=i=>ue(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();n=ve()},l(i){for(let l=0;l<r.length;l+=1)r[l].l(i);n=ve()},m(i,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,l);I(i,n,l),t=!0},p(i,l){if(l&3){o=Ve(i[0]);let a;for(a=0;a<o.length;a+=1){const c=Xt(i,o,a);r[a]?(r[a].p(c,l),re(r[a],1)):(r[a]=Jt(c),r[a].c(),re(r[a],1),r[a].m(n.parentNode,n))}for(Qe(),a=o.length;a<r.length;a+=1)s(a);Ze()}},i(i){if(!t){for(let l=0;l<o.length;l+=1)re(r[l]);t=!0}},o(i){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)ue(r[l]);t=!1},d(i){i&&d(n),Gn(r,i)}}}function Gs(e){var g;let n,t=((g=e[1].currentActor)==null?void 0:g.name)+"",o,r,s,i,l=e[2],a,c=Qt(e);return{c(){n=h("h4"),o=G(t),r=G("s  Inventory"),s=N(),i=h("div"),c.c(),this.h()},l(f){n=p(f,"H4",{class:!0});var m=E(n);o=$(m,t),r=$(m,"s  Inventory"),m.forEach(d),s=H(f),i=p(f,"DIV",{class:!0});var _=E(i);c.l(_),_.forEach(d),this.h()},h(){M(n,"class","svelte-1sdwrze"),M(i,"class","inventory svelte-1sdwrze")},m(f,m){I(f,n,m),u(n,o),u(n,r),I(f,s,m),I(f,i,m),c.m(i,null),a=!0},p(f,[m]){var _;(!a||m&2)&&t!==(t=((_=f[1].currentActor)==null?void 0:_.name)+"")&&fe(o,t),m&4&&be(l,l=f[2])?(Qe(),ue(c,1,1,ye),Ze(),c=Qt(f),c.c(),re(c,1),c.m(i,null)):c.p(f,m)},i(f){a||(re(c),a=!0)},o(f){ue(c),a=!1},d(f){f&&(d(n),d(s),d(i)),c.d(f)}}}function $s(e,n,t){let{inventory:o}=n,{state:r}=n,s=!1;kn(()=>{i(),setInterval(i,100)});const i=()=>{t(2,s=!s)};function l(a,c,g,f){g[f]=a,t(0,o)}return e.$$set=a=>{"inventory"in a&&t(0,o=a.inventory),"state"in a&&t(1,r=a.state)},[o,r,s,l]}class Ks extends Xe{constructor(n){super(),Je(this,n,$s,Gs,be,{inventory:0,state:1})}}function Zt(e){let n;return{c(){n=G("*")},l(t){n=$(t,"*")},m(t,o){I(t,n,o)},d(t){t&&d(n)}}}function Fs(e){let n;return{c(){n=G("")},l(t){n=$(t,"")},m(t,o){I(t,n,o)},d(t){t&&d(n)}}}function Ws(e){let n;return{c(){n=G("")},l(t){n=$(t,"")},m(t,o){I(t,n,o)},d(t){t&&d(n)}}}function St(e){let n,t,o,r,s;function i(a){e[7](a)}let l={state:e[1]};return e[0].inventory!==void 0&&(l.inventory=e[0].inventory),t=new Ks({props:l}),rn.push(()=>ln(t,"inventory",i)),{c(){n=h("div"),$e(t.$$.fragment),this.h()},l(a){n=p(a,"DIV",{class:!0,id:!0,style:!0});var c=E(n);Ke(t.$$.fragment,c),c.forEach(d),this.h()},h(){M(n,"class","hero-inventory svelte-1jgurl5"),M(n,"id",r=e[0].name+"s-inventory"),Nn(n,"display",e[2])},m(a,c){I(a,n,c),Fe(t,n,null),s=!0},p(a,c){const g={};c&2&&(g.state=a[1]),!o&&c&1&&(o=!0,g.inventory=a[0].inventory,sn(()=>o=!1)),t.$set(g),(!s||c&1&&r!==(r=a[0].name+"s-inventory"))&&M(n,"id",r),(!s||c&4)&&Nn(n,"display",a[2])},i(a){s||(re(t.$$.fragment,a),s=!0)},o(a){ue(t.$$.fragment,a),s=!1},d(a){a&&d(n),We(t)}}}function zt(e){let n,t,o=e[0].actions+"",r,s,i,l,a=e[0].movement+"",c,g,f,m="Equipment:",_,R,w,k,C=e[0].weapon.name+"",O,y,Z=e[0].weapon.dice+"",X,b,V,B,A,K,D,J;function ee(L,P){return L[0].armour?Vs:Ys}let se=ee(e),ne=se(e);function ke(L,P){return L[0].shield?js:qs}let S=ke(e),W=S(e);return{c(){n=h("span"),t=G("Actions: "),r=G(o),s=N(),i=h("span"),l=G("Moves: "),c=G(a),g=N(),f=h("span"),f.textContent=m,_=N(),R=h("div"),w=h("span"),k=G(" "),O=G(C),y=G(" ("),X=G(Z),b=G(")"),V=N(),B=h("span"),A=G(`
        `),ne.c(),K=N(),D=h("span"),J=G(`
        `),W.c(),this.h()},l(L){n=p(L,"SPAN",{class:!0});var P=E(n);t=$(P,"Actions: "),r=$(P,o),P.forEach(d),s=H(L),i=p(L,"SPAN",{class:!0});var z=E(i);l=$(z,"Moves: "),c=$(z,a),z.forEach(d),g=H(L),f=p(L,"SPAN",{class:!0,"data-svelte-h":!0}),oe(f)!=="svelte-1ue18fw"&&(f.textContent=m),_=H(L),R=p(L,"DIV",{class:!0});var ie=E(R);w=p(ie,"SPAN",{class:!0});var U=E(w);k=$(U," "),O=$(U,C),y=$(U," ("),X=$(U,Z),b=$(U,")"),U.forEach(d),V=H(ie),B=p(ie,"SPAN",{class:!0});var Q=E(B);A=$(Q,`
        `),ne.l(Q),Q.forEach(d),K=H(ie),D=p(ie,"SPAN",{class:!0});var Me=E(D);J=$(Me,`
        `),W.l(Me),Me.forEach(d),ie.forEach(d),this.h()},h(){M(n,"class","svelte-1jgurl5"),M(i,"class","svelte-1jgurl5"),M(f,"class","svelte-1jgurl5"),M(w,"class","svelte-1jgurl5"),M(B,"class","svelte-1jgurl5"),M(D,"class","svelte-1jgurl5"),M(R,"class","equipment svelte-1jgurl5")},m(L,P){I(L,n,P),u(n,t),u(n,r),I(L,s,P),I(L,i,P),u(i,l),u(i,c),I(L,g,P),I(L,f,P),I(L,_,P),I(L,R,P),u(R,w),u(w,k),u(w,O),u(w,y),u(w,X),u(w,b),u(R,V),u(R,B),u(B,A),ne.m(B,null),u(R,K),u(R,D),u(D,J),W.m(D,null)},p(L,P){P&1&&o!==(o=L[0].actions+"")&&fe(r,o),P&1&&a!==(a=L[0].movement+"")&&fe(c,a),P&1&&C!==(C=L[0].weapon.name+"")&&fe(O,C),P&1&&Z!==(Z=L[0].weapon.dice+"")&&fe(X,Z),se===(se=ee(L))&&ne?ne.p(L,P):(ne.d(1),ne=se(L),ne&&(ne.c(),ne.m(B,null))),S===(S=ke(L))&&W?W.p(L,P):(W.d(1),W=S(L),W&&(W.c(),W.m(D,null)))},d(L){L&&(d(n),d(s),d(i),d(g),d(f),d(_),d(R)),ne.d(),W.d()}}}function Ys(e){let n;return{c(){n=G("None (0)")},l(t){n=$(t,"None (0)")},m(t,o){I(t,n,o)},p:ye,d(t){t&&d(n)}}}function Vs(e){let n=e[0].armour.name+"",t,o,r=e[0].armour.defense+"",s,i;return{c(){t=G(n),o=G(" ("),s=G(r),i=G(")")},l(l){t=$(l,n),o=$(l," ("),s=$(l,r),i=$(l,")")},m(l,a){I(l,t,a),I(l,o,a),I(l,s,a),I(l,i,a)},p(l,a){a&1&&n!==(n=l[0].armour.name+"")&&fe(t,n),a&1&&r!==(r=l[0].armour.defense+"")&&fe(s,r)},d(l){l&&(d(t),d(o),d(s),d(i))}}}function qs(e){let n;return{c(){n=G("None (0)")},l(t){n=$(t,"None (0)")},m(t,o){I(t,n,o)},p:ye,d(t){t&&d(n)}}}function js(e){let n=e[0].shield.name+"",t,o,r=e[0].shield.dice+"",s,i;return{c(){t=G(n),o=G(" ("),s=G(r),i=G(")")},l(l){t=$(l,n),o=$(l," ("),s=$(l,r),i=$(l,")")},m(l,a){I(l,t,a),I(l,o,a),I(l,s,a),I(l,i,a)},p(l,a){a&1&&n!==(n=l[0].shield.name+"")&&fe(t,n),a&1&&r!==(r=l[0].shield.dice+"")&&fe(s,r)},d(l){l&&(d(t),d(o),d(s),d(i))}}}function eo(e){let n,t,o,r=e[0].name+"",s,i,l,a,c=e[0].level+"",g,f,m=e[0].experience+"",_,R,w,k,C,O,y,Z="",X,b,V,B,A,K,D=e[0].health+"",J,ee,se,ne,ke,S=e[1].targetActor===e[0]&&Zt();function W(U,Q){return U[1].targetActor!==U[0]?Ws:Fs}let L=W(e),P=L(e),z=e[1].currentActor==e[0]&&St(e),ie=e[1].currentActor==e[0]&&zt(e);return{c(){n=h("div"),t=h("div"),o=h("b"),S&&S.c(),s=G(r),i=G(" -"),l=N(),a=h("b"),g=G(c),f=G(" ("),_=G(m),R=G(")"),w=N(),k=h("div"),C=h("button"),P.c(),O=N(),y=h("button"),y.textContent=Z,X=N(),b=h("div"),z&&z.c(),V=N(),B=h("div"),A=h("span"),K=G("HP: "),J=G(D),ee=N(),ie&&ie.c(),this.h()},l(U){n=p(U,"DIV",{class:!0,style:!0});var Q=E(n);t=p(Q,"DIV",{class:!0});var Me=E(t);o=p(Me,"B",{class:!0});var Pe=E(o);S&&S.l(Pe),s=$(Pe,r),i=$(Pe," -"),Pe.forEach(d),l=H(Me),a=p(Me,"B",{class:!0});var we=E(a);g=$(we,c),f=$(we," ("),_=$(we,m),R=$(we,")"),we.forEach(d),Me.forEach(d),w=H(Q),k=p(Q,"DIV",{class:!0});var Te=E(k);C=p(Te,"BUTTON",{title:!0});var fn=E(C);P.l(fn),fn.forEach(d),O=H(Te),y=p(Te,"BUTTON",{title:!0,"data-svelte-h":!0}),oe(y)!=="svelte-qrm7uk"&&(y.textContent=Z),Te.forEach(d),X=H(Q),b=p(Q,"DIV",{class:!0});var an=E(b);z&&z.l(an),an.forEach(d),V=H(Q),B=p(Q,"DIV",{class:!0});var Ne=E(B);A=p(Ne,"SPAN",{class:!0});var Le=E(A);K=$(Le,"HP: "),J=$(Le,D),Le.forEach(d),ee=H(Ne),ie&&ie.l(Ne),Ne.forEach(d),Q.forEach(d),this.h()},h(){M(o,"class","svelte-1jgurl5"),M(a,"class","svelte-1jgurl5"),M(t,"class","hero-title svelte-1jgurl5"),M(C,"title","select target hero"),M(y,"title","Open inventory"),M(k,"class","hero-action-buttons svelte-1jgurl5"),M(b,"class","hero-information svelte-1jgurl5"),M(A,"class","svelte-1jgurl5"),M(B,"class","hero-stats-and-equipmnet svelte-1jgurl5"),M(n,"class","hero-card svelte-1jgurl5"),Nn(n,"background-color",e[0].colour)},m(U,Q){I(U,n,Q),u(n,t),u(t,o),S&&S.m(o,null),u(o,s),u(o,i),u(t,l),u(t,a),u(a,g),u(a,f),u(a,_),u(a,R),u(n,w),u(n,k),u(k,C),P.m(C,null),u(k,O),u(k,y),u(n,X),u(n,b),z&&z.m(b,null),u(n,V),u(n,B),u(B,A),u(A,K),u(A,J),u(B,ee),ie&&ie.m(B,null),se=!0,ne||(ke=[te(C,"click",e[5]),te(y,"click",e[6])],ne=!0)},p(U,Q){U[1].targetActor===U[0]?S||(S=Zt(),S.c(),S.m(o,s)):S&&(S.d(1),S=null),(!se||Q&1)&&r!==(r=U[0].name+"")&&fe(s,r),(!se||Q&1)&&c!==(c=U[0].level+"")&&fe(g,c),(!se||Q&1)&&m!==(m=U[0].experience+"")&&fe(_,m),L!==(L=W(U))&&(P.d(1),P=L(U),P&&(P.c(),P.m(C,null))),U[1].currentActor==U[0]?z?(z.p(U,Q),Q&3&&re(z,1)):(z=St(U),z.c(),re(z,1),z.m(b,null)):z&&(Qe(),ue(z,1,1,()=>{z=null}),Ze()),(!se||Q&1)&&D!==(D=U[0].health+"")&&fe(J,D),U[1].currentActor==U[0]?ie?ie.p(U,Q):(ie=zt(U),ie.c(),ie.m(B,null)):ie&&(ie.d(1),ie=null),(!se||Q&1)&&Nn(n,"background-color",U[0].colour)},i(U){se||(re(z),se=!0)},o(U){ue(z),se=!1},d(U){U&&d(n),S&&S.d(),P.d(),z&&z.d(),ie&&ie.d(),ne=!1,et(ke)}}}function Xs(e){let n=e[1].targetActor,t,o,r=eo(e);return{c(){r.c(),t=ve()},l(s){r.l(s),t=ve()},m(s,i){r.m(s,i),I(s,t,i),o=!0},p(s,[i]){i&2&&be(n,n=s[1].targetActor)?(Qe(),ue(r,1,1,ye),Ze(),r=eo(s),r.c(),re(r,1),r.m(t.parentNode,t)):r.p(s,i)},i(s){o||(re(r),o=!0)},o(s){ue(r),o=!1},d(s){s&&d(t),r.d(s)}}}function Js(e,n,t){let{hero:o}=n,{state:r}=n,s="none";const i=m=>{r.targetActor&&m===r.targetActor?t(1,r.targetActor=void 0,r):t(1,r.targetActor=m,r)},l=m=>{const _=document.getElementById(m.name+"s-inventory");console.log(m.isInventoryOpen),_!=null&&(m.isInventoryOpen=!m.isInventoryOpen,a(),_.style.display=s)},a=()=>{o.isInventoryOpen?t(2,s="inline-block"):t(2,s="none")};a();const c=()=>i(o),g=()=>l(o);function f(m){e.$$.not_equal(o.inventory,m)&&(o.inventory=m,t(0,o))}return e.$$set=m=>{"hero"in m&&t(0,o=m.hero),"state"in m&&t(1,r=m.state)},[o,r,s,i,l,c,g,f]}class Ko extends Xe{constructor(n){super(),Je(this,n,Js,Xs,be,{hero:0,state:1})}}function no(e,n,t){const o=e.slice();return o[3]=n[t],o[5]=t,o}function Qs(e){let n,t,o,r;return t=new Ko({props:{hero:e[3],state:e[0]}}),{c(){n=h("div"),$e(t.$$.fragment),o=N(),this.h()},l(s){n=p(s,"DIV",{class:!0});var i=E(n);Ke(t.$$.fragment,i),o=H(i),i.forEach(d),this.h()},h(){M(n,"class","not-current-actor svelte-gyascg")},m(s,i){I(s,n,i),Fe(t,n,null),u(n,o),r=!0},p(s,i){const l={};i&1&&(l.hero=s[3]),i&1&&(l.state=s[0]),t.$set(l)},i(s){r||(re(t.$$.fragment,s),r=!0)},o(s){ue(t.$$.fragment,s),r=!1},d(s){s&&d(n),We(t)}}}function Zs(e){let n,t,o,r;return t=new Ko({props:{hero:e[3],state:e[0]}}),{c(){n=h("div"),$e(t.$$.fragment),o=N(),this.h()},l(s){n=p(s,"DIV",{class:!0});var i=E(n);Ke(t.$$.fragment,i),o=H(i),i.forEach(d),this.h()},h(){M(n,"class","is-current-actor svelte-gyascg")},m(s,i){I(s,n,i),Fe(t,n,null),u(n,o),r=!0},p(s,i){const l={};i&1&&(l.hero=s[3]),i&1&&(l.state=s[0]),t.$set(l)},i(s){r||(re(t.$$.fragment,s),r=!0)},o(s){ue(t.$$.fragment,s),r=!1},d(s){s&&d(n),We(t)}}}function to(e){let n,t,o,r;const s=[Zs,Qs],i=[];function l(a,c){return a[3]===a[0].currentActor?0:1}return n=l(e),t=i[n]=s[n](e),{c(){t.c(),o=ve()},l(a){t.l(a),o=ve()},m(a,c){i[n].m(a,c),I(a,o,c),r=!0},p(a,c){let g=n;n=l(a),n===g?i[n].p(a,c):(Qe(),ue(i[g],1,1,()=>{i[g]=null}),Ze(),t=i[n],t?t.p(a,c):(t=i[n]=s[n](a),t.c()),re(t,1),t.m(o.parentNode,o))},i(a){r||(re(t),r=!0)},o(a){ue(t),r=!1},d(a){a&&d(o),i[n].d(a)}}}function oo(e){let n=e[1],t,o,r=to(e);return{c(){r.c(),t=ve()},l(s){r.l(s),t=ve()},m(s,i){r.m(s,i),I(s,t,i),o=!0},p(s,i){i&2&&be(n,n=s[1])?(Qe(),ue(r,1,1,ye),Ze(),r=to(s),r.c(),re(r,1),r.m(t.parentNode,t)):r.p(s,i)},i(s){o||(re(r),o=!0)},o(s){ue(r),o=!1},d(s){s&&d(t),r.d(s)}}}function Ss(e){let n,t,o=Ve(Y(e[0])),r=[];for(let i=0;i<o.length;i+=1)r[i]=oo(no(e,o,i));const s=i=>ue(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();n=ve()},l(i){for(let l=0;l<r.length;l+=1)r[l].l(i);n=ve()},m(i,l){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(i,l);I(i,n,l),t=!0},p(i,[l]){if(l&3){o=Ve(Y(i[0]));let a;for(a=0;a<o.length;a+=1){const c=no(i,o,a);r[a]?(r[a].p(c,l),re(r[a],1)):(r[a]=oo(c),r[a].c(),re(r[a],1),r[a].m(n.parentNode,n))}for(Qe(),a=o.length;a<r.length;a+=1)s(a);Ze()}},i(i){if(!t){for(let l=0;l<o.length;l+=1)re(r[l]);t=!0}},o(i){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)ue(r[l]);t=!1},d(i){i&&d(n),Gn(r,i)}}}function zs(e,n,t){let{state:o}=n,r=!1;kn(()=>{s(),setInterval(s,100)});const s=()=>{o.reRender&&t(1,r=!r)};return e.$$set=i=>{"state"in i&&t(0,o=i.state)},[o,r]}class ei extends Xe{constructor(n){super(),Je(this,n,zs,Ss,be,{state:0})}}function ro(e,n,t){const o=e.slice();return o[3]=n[t],o[5]=t,o}function ni(e){let n,t,o=e[3]+"",r;return{c(){n=h("p"),t=G(">"),r=G(o),this.h()},l(s){n=p(s,"P",{class:!0});var i=E(n);t=$(i,">"),r=$(i,o),i.forEach(d),this.h()},h(){M(n,"class","svelte-axhg6g")},m(s,i){I(s,n,i),u(n,t),u(n,r)},p(s,i){i&1&&o!==(o=s[3]+"")&&fe(r,o)},d(s){s&&d(n)}}}function so(e){let n,t=e[5]<25&&ni(e);return{c(){t&&t.c(),n=ve()},l(o){t&&t.l(o),n=ve()},m(o,r){t&&t.m(o,r),I(o,n,r)},p(o,r){o[5]<25&&t.p(o,r)},d(o){o&&d(n),t&&t.d(o)}}}function io(e){let n,t=Ve(e[0].actionLog),o=[];for(let r=0;r<t.length;r+=1)o[r]=so(ro(e,t,r));return{c(){for(let r=0;r<o.length;r+=1)o[r].c();n=ve()},l(r){for(let s=0;s<o.length;s+=1)o[s].l(r);n=ve()},m(r,s){for(let i=0;i<o.length;i+=1)o[i]&&o[i].m(r,s);I(r,n,s)},p(r,s){if(s&1){t=Ve(r[0].actionLog);let i;for(i=0;i<t.length;i+=1){const l=ro(r,t,i);o[i]?o[i].p(l,s):(o[i]=so(l),o[i].c(),o[i].m(n.parentNode,n))}for(;i<o.length;i+=1)o[i].d(1);o.length=t.length}},d(r){r&&d(n),Gn(o,r)}}}function ti(e){let n,t=e[1],o=io(e);return{c(){n=h("div"),o.c(),this.h()},l(r){n=p(r,"DIV",{class:!0});var s=E(n);o.l(s),s.forEach(d),this.h()},h(){M(n,"class","log svelte-axhg6g")},m(r,s){I(r,n,s),o.m(n,null)},p(r,[s]){s&2&&be(t,t=r[1])?(o.d(1),o=io(r),o.c(),o.m(n,null)):o.p(r,s)},i:ye,o:ye,d(r){r&&d(n),o.d(r)}}}function oi(e,n,t){let{state:o}=n,r=!1;kn(()=>{s(),setInterval(s,500)});const s=()=>{o.reRender&&t(1,r=!r)};return e.$$set=i=>{"state"in i&&t(0,o=i.state)},[o,r]}class ri extends Xe{constructor(n){super(),Je(this,n,oi,ti,be,{state:0})}}const lo={name:"Testing Grounds",beaten:!0,winConditions:[{type:ce.KILL_ALL,fulfilled:!0},{type:ce.OPEN_DOOR,targetCell:{x:2,y:10},fulfilled:!1},{type:ce.KILL_ALL_OF_TYPE,targetMonsterType:x.ORCH,fulfilled:!1},{type:ce.REACH_CELL,targetCell:{x:2,y:10},fulfilled:!1},{type:ce.KILL_AT_LEAST,killMinCount:5,fulfilled:!1}],nextDungeon:No,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A","D"],layout:{grid:["###########","#CCCCCCCCC#","#CCCCCCCCC#","#CCCCCCCCC#","#######E###","  #####E#  ","  #FFFFE## ","###F###AA# ","#AAAAAAAA#D","#AAAAAAAA#D","#AAAAAAAA#D","##G####### "," #G#       "," #G#       "," ###       "],pillars:[{x:8,y:3},{x:7,y:9}],pits:[{x:6,y:3},{x:6,y:2}],corridors:["G","E","F"],doors:[qo(T.UP,3,8,1),xn(T.LEFT,7,6),Vo(T.UP,7,7,1),j(T.UP,7,4),Ye(T.DOWN,2,10)],monsters:[ae(x.ORCH,F.Green,1,1),ae(x.ORCH,F.Red,4,9),ae(x.TROLL,F.Green,5,1)],secrets:[Ee(le.TRAP_DOOR,"Welcome to Drakriddarna",3,9),Ee(le.EQUIPMENT,"Random Equipment",1,10),_n(le.EQUIPMENT,5,10,Hn[2])],notes:[],items:[{item:Ie[0],position:{x:3,y:10}},{item:Ie[1],position:{x:4,y:10}},{item:Ie[6],position:{x:5,y:10}},{item:Ie[2],position:{x:6,y:10}},{item:Ie[3],position:{x:7,y:10}},{item:Ie[4],position:{x:8,y:10}}]},killCount:0};const{window:si}=Wo;function ii(e){let n,t,o,r,s="UL",i,l,a,c="U",g,f,m,_="UR",R,w,k,C="Next",O,y,Z,X,b="L",V,B,A,K,D,J="R",ee,se,ne,ke="Search",S,W,L,P,z="DL",ie,U,Q,Me="D",Pe,we,Te,fn="DR",an,Ne,Le,lt="Pick lock",Kn,me,mn,Se,at="Save",Fn,hn,ze,ct="Load",Wn,pn,en,ut="Debug",Yn,gn,nn,dt="End action",Vn,On,qn,ft,he=e[0].dungeon.beaten&&ao(e),pe=e[1]&&co(e);return{c(){n=h("table"),t=h("tr"),o=h("td"),r=h("button"),r.textContent=s,i=N(),l=h("td"),a=h("button"),a.textContent=c,g=N(),f=h("td"),m=h("button"),m.textContent=_,R=N(),w=h("td"),k=h("button"),k.textContent=C,O=N(),y=h("tr"),Z=h("td"),X=h("button"),X.textContent=b,V=N(),B=h("td"),A=N(),K=h("td"),D=h("button"),D.textContent=J,ee=N(),se=h("td"),ne=h("button"),ne.textContent=ke,S=N(),W=h("tr"),L=h("td"),P=h("button"),P.textContent=z,ie=N(),U=h("td"),Q=h("button"),Q.textContent=Me,Pe=N(),we=h("td"),Te=h("button"),Te.textContent=fn,an=N(),Ne=h("td"),Le=h("button"),Le.textContent=lt,Kn=N(),me=h("tr"),mn=h("td"),Se=h("button"),Se.textContent=at,Fn=N(),hn=h("td"),ze=h("button"),ze.textContent=ct,Wn=N(),pn=h("td"),en=h("button"),en.textContent=ut,Yn=N(),gn=h("td"),nn=h("button"),nn.textContent=dt,Vn=N(),he&&he.c(),On=N(),pe&&pe.c()},l(Ce){n=p(Ce,"TABLE",{});var Ae=E(n);t=p(Ae,"TR",{});var Be=E(t);o=p(Be,"TD",{});var mt=E(o);r=p(mt,"BUTTON",{"data-svelte-h":!0}),oe(r)!=="svelte-1vu0fc2"&&(r.textContent=s),mt.forEach(d),i=H(Be),l=p(Be,"TD",{});var ht=E(l);a=p(ht,"BUTTON",{"data-svelte-h":!0}),oe(a)!=="svelte-m1j18o"&&(a.textContent=c),ht.forEach(d),g=H(Be),f=p(Be,"TD",{});var pt=E(f);m=p(pt,"BUTTON",{"data-svelte-h":!0}),oe(m)!=="svelte-8eygoe"&&(m.textContent=_),pt.forEach(d),R=H(Be),w=p(Be,"TD",{});var gt=E(w);k=p(gt,"BUTTON",{"data-svelte-h":!0}),oe(k)!=="svelte-1lp5xnk"&&(k.textContent=C),gt.forEach(d),Be.forEach(d),O=H(Ae),y=p(Ae,"TR",{});var Ue=E(y);Z=p(Ue,"TD",{});var yt=E(Z);X=p(yt,"BUTTON",{"data-svelte-h":!0}),oe(X)!=="svelte-amyars"&&(X.textContent=b),yt.forEach(d),V=H(Ue),B=p(Ue,"TD",{}),E(B).forEach(d),A=H(Ue),K=p(Ue,"TD",{});var vt=E(K);D=p(vt,"BUTTON",{"data-svelte-h":!0}),oe(D)!=="svelte-2zfta0"&&(D.textContent=J),vt.forEach(d),ee=H(Ue),se=p(Ue,"TD",{});var _t=E(se);ne=p(_t,"BUTTON",{"data-svelte-h":!0}),oe(ne)!=="svelte-1kis6k4"&&(ne.textContent=ke),_t.forEach(d),Ue.forEach(d),S=H(Ae),W=p(Ae,"TR",{});var Ge=E(W);L=p(Ge,"TD",{});var kt=E(L);P=p(kt,"BUTTON",{"data-svelte-h":!0}),oe(P)!=="svelte-57p0uk"&&(P.textContent=z),kt.forEach(d),ie=H(Ge),U=p(Ge,"TD",{});var At=E(U);Q=p(At,"BUTTON",{"data-svelte-h":!0}),oe(Q)!=="svelte-1nly394"&&(Q.textContent=Me),At.forEach(d),Pe=H(Ge),we=p(Ge,"TD",{});var Et=E(we);Te=p(Et,"BUTTON",{"data-svelte-h":!0}),oe(Te)!=="svelte-7ds02w"&&(Te.textContent=fn),Et.forEach(d),an=H(Ge),Ne=p(Ge,"TD",{});var bt=E(Ne);Le=p(bt,"BUTTON",{"data-svelte-h":!0}),oe(Le)!=="svelte-90j6ve"&&(Le.textContent=lt),bt.forEach(d),Ge.forEach(d),Kn=H(Ae),me=p(Ae,"TR",{});var Re=E(me);mn=p(Re,"TD",{});var Tt=E(mn);Se=p(Tt,"BUTTON",{"data-svelte-h":!0}),oe(Se)!=="svelte-fxtyz6"&&(Se.textContent=at),Tt.forEach(d),Fn=H(Re),hn=p(Re,"TD",{});var Ct=E(hn);ze=p(Ct,"BUTTON",{"data-svelte-h":!0}),oe(ze)!=="svelte-1m2jkw7"&&(ze.textContent=ct),Ct.forEach(d),Wn=H(Re),pn=p(Re,"TD",{});var Rt=E(pn);en=p(Rt,"BUTTON",{"data-svelte-h":!0}),oe(en)!=="svelte-5alhx0"&&(en.textContent=ut),Rt.forEach(d),Yn=H(Re),gn=p(Re,"TD",{});var It=E(gn);nn=p(It,"BUTTON",{"data-svelte-h":!0}),oe(nn)!=="svelte-1de77je"&&(nn.textContent=dt),It.forEach(d),Vn=H(Re),he&&he.l(Re),On=H(Re),pe&&pe.l(Re),Re.forEach(d),Ae.forEach(d)},m(Ce,Ae){I(Ce,n,Ae),u(n,t),u(t,o),u(o,r),u(t,i),u(t,l),u(l,a),u(t,g),u(t,f),u(f,m),u(t,R),u(t,w),u(w,k),u(n,O),u(n,y),u(y,Z),u(Z,X),u(y,V),u(y,B),u(y,A),u(y,K),u(K,D),u(y,ee),u(y,se),u(se,ne),u(n,S),u(n,W),u(W,L),u(L,P),u(W,ie),u(W,U),u(U,Q),u(W,Pe),u(W,we),u(we,Te),u(W,an),u(W,Ne),u(Ne,Le),u(n,Kn),u(n,me),u(me,mn),u(mn,Se),u(me,Fn),u(me,hn),u(hn,ze),u(me,Wn),u(me,pn),u(pn,en),u(me,Yn),u(me,gn),u(gn,nn),u(me,Vn),he&&he.m(me,null),u(me,On),pe&&pe.m(me,null),qn||(ft=[te(r,"click",e[13]),te(a,"click",e[14]),te(m,"click",e[15]),te(k,"click",e[16]),te(X,"click",e[17]),te(D,"click",e[18]),te(ne,"click",e[19]),te(P,"click",e[20]),te(Q,"click",e[21]),te(Te,"click",e[22]),te(Le,"click",e[23]),te(Se,"click",e[24]),te(ze,"click",e[25]),te(en,"click",e[26]),te(nn,"click",e[27])],qn=!0)},p(Ce,Ae){Ce[0].dungeon.beaten?he?he.p(Ce,Ae):(he=ao(Ce),he.c(),he.m(me,On)):he&&(he.d(1),he=null),Ce[1]?pe?pe.p(Ce,Ae):(pe=co(Ce),pe.c(),pe.m(me,null)):pe&&(pe.d(1),pe=null)},d(Ce){Ce&&d(n),he&&he.d(),pe&&pe.d(),qn=!1,et(ft)}}}function li(e){let n,t,o,r,s="Next",i,l,a,c="End action",g,f,m,_,R="Save",w,k,C,O="Load",y,Z,X,b,V="Debug",B,A,K,D=e[1]&&uo(e);return{c(){n=h("table"),t=h("tr"),o=h("td"),r=h("button"),r.textContent=s,i=N(),l=h("td"),a=h("button"),a.textContent=c,g=N(),f=h("tr"),m=h("td"),_=h("button"),_.textContent=R,w=N(),k=h("td"),C=h("button"),C.textContent=O,y=N(),Z=h("tr"),X=h("td"),b=h("button"),b.textContent=V,B=N(),D&&D.c()},l(J){n=p(J,"TABLE",{});var ee=E(n);t=p(ee,"TR",{});var se=E(t);o=p(se,"TD",{});var ne=E(o);r=p(ne,"BUTTON",{"data-svelte-h":!0}),oe(r)!=="svelte-1axp1ke"&&(r.textContent=s),ne.forEach(d),i=H(se),l=p(se,"TD",{});var ke=E(l);a=p(ke,"BUTTON",{"data-svelte-h":!0}),oe(a)!=="svelte-1de77je"&&(a.textContent=c),ke.forEach(d),se.forEach(d),g=H(ee),f=p(ee,"TR",{});var S=E(f);m=p(S,"TD",{});var W=E(m);_=p(W,"BUTTON",{"data-svelte-h":!0}),oe(_)!=="svelte-fxtyz6"&&(_.textContent=R),W.forEach(d),w=H(S),k=p(S,"TD",{});var L=E(k);C=p(L,"BUTTON",{"data-svelte-h":!0}),oe(C)!=="svelte-1m2jkw7"&&(C.textContent=O),L.forEach(d),S.forEach(d),y=H(ee),Z=p(ee,"TR",{});var P=E(Z);X=p(P,"TD",{});var z=E(X);b=p(z,"BUTTON",{"data-svelte-h":!0}),oe(b)!=="svelte-5alhx0"&&(b.textContent=V),z.forEach(d),B=H(P),D&&D.l(P),P.forEach(d),ee.forEach(d)},m(J,ee){I(J,n,ee),u(n,t),u(t,o),u(o,r),u(t,i),u(t,l),u(l,a),u(n,g),u(n,f),u(f,m),u(m,_),u(f,w),u(f,k),u(k,C),u(n,y),u(n,Z),u(Z,X),u(X,b),u(Z,B),D&&D.m(Z,null),A||(K=[te(r,"click",e[7]),te(a,"click",e[8]),te(_,"click",e[9]),te(C,"click",e[10]),te(b,"click",e[11])],A=!0)},p(J,ee){J[1]?D?D.p(J,ee):(D=uo(J),D.c(),D.m(Z,null)):D&&(D.d(1),D=null)},d(J){J&&d(n),D&&D.d(),A=!1,et(K)}}}function ao(e){let n,t="Next level",o,r;return{c(){n=h("button"),n.textContent=t},l(s){n=p(s,"BUTTON",{"data-svelte-h":!0}),oe(n)!=="svelte-107iljd"&&(n.textContent=t)},m(s,i){I(s,n,i),o||(r=te(n,"click",e[28]),o=!0)},p:ye,d(s){s&&d(n),o=!1,r()}}}function co(e){let n,t,o="To Testing Grounds",r,s;return{c(){n=h("td"),t=h("button"),t.textContent=o},l(i){n=p(i,"TD",{});var l=E(n);t=p(l,"BUTTON",{"data-svelte-h":!0}),oe(t)!=="svelte-1rubhw6"&&(t.textContent=o),l.forEach(d)},m(i,l){I(i,n,l),u(n,t),r||(s=te(t,"click",e[29]),r=!0)},p:ye,d(i){i&&d(n),r=!1,s()}}}function uo(e){let n,t,o="To Testing Grounds",r,s;return{c(){n=h("td"),t=h("button"),t.textContent=o},l(i){n=p(i,"TD",{});var l=E(n);t=p(l,"BUTTON",{"data-svelte-h":!0}),oe(t)!=="svelte-1rubhw6"&&(t.textContent=o),l.forEach(d)},m(i,l){I(i,n,l),u(n,t),r||(s=te(t,"click",e[12]),r=!0)},p:ye,d(i){i&&d(n),r=!1,s()}}}function ai(e){let n,t,o,r,s,i,l,a,c,g,f,m,_,R,w,k;o=new ei({props:{state:e[0]}});function C(A){e[5](A)}function O(A){e[6](A)}let y={};e[0]!==void 0&&(y.state=e[0]),e[1]!==void 0&&(y.debugMode=e[1]),s=new Ns({props:y}),rn.push(()=>ln(s,"state",C)),rn.push(()=>ln(s,"debugMode",O));function Z(A,K){return A[2]<600?li:ii}let X=Z(e),b=X(e);function V(A){e[30](A)}let B={};return e[0]!==void 0&&(B.state=e[0]),m=new ri({props:B}),rn.push(()=>ln(m,"state",V)),{c(){n=h("div"),t=h("div"),$e(o.$$.fragment),r=N(),$e(s.$$.fragment),a=N(),c=h("div"),g=h("div"),b.c(),f=N(),$e(m.$$.fragment),this.h()},l(A){n=p(A,"DIV",{class:!0});var K=E(n);t=p(K,"DIV",{class:!0});var D=E(t);Ke(o.$$.fragment,D),D.forEach(d),r=H(K),Ke(s.$$.fragment,K),K.forEach(d),a=H(A),c=p(A,"DIV",{class:!0,id:!0});var J=E(c);g=p(J,"DIV",{class:!0});var ee=E(g);b.l(ee),ee.forEach(d),f=H(J),Ke(m.$$.fragment,J),J.forEach(d),this.h()},h(){M(t,"class","characterSide svelte-fkewv5"),M(n,"class","container svelte-fkewv5"),M(g,"class","commands svelte-fkewv5"),M(c,"class","container svelte-fkewv5"),M(c,"id","footer")},m(A,K){I(A,n,K),u(n,t),Fe(o,t,null),u(n,r),Fe(s,n,null),I(A,a,K),I(A,c,K),u(c,g),b.m(g,null),u(c,f),Fe(m,c,null),R=!0,w||(k=te(si,"keydown",Fo(e[4])),w=!0)},p(A,[K]){const D={};K&1&&(D.state=A[0]),o.$set(D);const J={};!i&&K&1&&(i=!0,J.state=A[0],sn(()=>i=!1)),!l&&K&2&&(l=!0,J.debugMode=A[1],sn(()=>l=!1)),s.$set(J),X===(X=Z(A))&&b?b.p(A,K):(b.d(1),b=X(A),b&&(b.c(),b.m(g,null)));const ee={};!_&&K&1&&(_=!0,ee.state=A[0],sn(()=>_=!1)),m.$set(ee)},i(A){R||(re(o.$$.fragment,A),re(s.$$.fragment,A),re(m.$$.fragment,A),R=!0)},o(A){ue(o.$$.fragment,A),ue(s.$$.fragment,A),ue(m.$$.fragment,A),R=!1},d(A){A&&(d(n),d(a),d(c)),We(o),We(s),b.d(),We(m),w=!1,k()}}}function ci(e,n,t){let o=Vr(),r=o.settings.debug,s;s=window.innerWidth;const i=()=>{t(1,r=!r),t(0,o.settings.debug=r,o),t(0,o.reRender=!0,o)};function l(W){switch(W.key){case"6":case"d":ge("R",o);break;case"9":case"e":ge("UR",o);break;case"8":case"w":ge("U",o);break;case"7":case"q":ge("UL",o);break;case"4":case"a":ge("L",o);break;case"1":case"z":ge("DL",o);break;case"2":case"x":ge("D",o);break;case"3":case"c":ge("DR",o);break;case"0":case" ":t(0,o=Ln(o));break;case"-":case"r":Zn(o);break;case"+":case"f":Sn(o);break}}function a(W){o=W,t(0,o)}function c(W){r=W,t(1,r)}const g=()=>Ln(o),f=()=>Mt(o),m=()=>Ut(o),_=()=>t(0,o=Gt()),R=()=>i(),w=()=>{t(0,o.dungeon=lo,o),t(0,o.reRender=!0,o)},k=()=>ge("UL",o),C=()=>ge("U",o),O=()=>ge("UR",o),y=()=>t(0,o=Ln(o)),Z=()=>ge("L",o),X=()=>ge("R",o),b=()=>Sn(o),V=()=>ge("DL",o),B=()=>ge("D",o),A=()=>ge("DR",o),K=()=>Zn(o),D=()=>Ut(o),J=()=>t(0,o=Gt()),ee=()=>i(),se=()=>Mt(o),ne=()=>Qr(o),ke=()=>{t(0,o.dungeon=lo,o),t(0,o.reRender=!0,o)};function S(W){o=W,t(0,o)}return[o,r,s,i,l,a,c,g,f,m,_,R,w,k,C,O,y,Z,X,b,V,B,A,K,D,J,ee,se,ne,ke,S]}class fi extends Xe{constructor(n){super(),Je(this,n,ci,ai,be,{})}}export{fi as component};
