import{s as ve,n as Te,e as Je,o as gn,f as An,r as Gn,b as Oe,h as Ae,i as At}from"../chunks/scheduler.8ae2156d.js";import{S as we,i as Pe,e as de,a as b,f,g as N,m as D,h as L,j as w,n as M,k as I,x as g,o as q,s as $,c as z,y as Le,d as Z,p as Fe,t as ee,b as We,z as sn,A as be,r as Re,u as De,v as Me,w as Ce,B as Ho,l as dn,C as bt}from"../chunks/index.9c43906b.js";import{t as Ke,a as Tt,s as Ln}from"../chunks/index.d6e17401.js";function He(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var Y=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(Y||{}),U=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(U||{}),_e=(e=>(e.APPRENTICE="apprentice",e.KNIGHT="knight",e.HERO="hero",e.LORD="lord",e.MASTER="master",e))(_e||{}),ae=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(ae||{}),H=(e=>(e.INNER_BOTTOM_RIGHT="IBR",e.INNER_TOP_RIGHT="ITR",e.INNER_BOTTOM_LEFT="IBL",e.INNER_TOP_LEFT="ITL",e.OUTER_BOTTOM_RIGHT="OBR",e.OUTER_TOP_RIGHT="OTR",e.OUTER_BOTTOM_LEFT="OBL",e.OUTER_TOP_LEFT="OTL",e.BOTTOM_END="BE",e.TOP_END="TE",e.LEFT_END="LE",e.RIGHT_END="RE",e.FOUR_WAY_INTERSECTION="I",e.THREE_WAY_INTERSECTION_UP_CLOSED="TUC",e.THREE_WAY_INTERSECTION_UP="TUO",e.THREE_WAY_INTERSECTION_DOWN="TD",e.THREE_WAY_INTERSECTION_LEFT="TL",e.THREE_WAY_INTERSECTION_RIGHT="TR",e.NOT_CORNER="NC",e))(H||{}),ie=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(ie||{}),v=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(v||{}),j=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))(j||{});const mn=[{name:"items.weapons.sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:j.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.twoHandedSword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:j.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:j.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:j.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.doubleHeadedAxe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:j.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],an=[{name:"items.weapons.orchSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:j.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.orchBow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:j.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"items.weapons.trollClub",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:j.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.darkLordSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:3,type:j.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.greenDarkLordSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:j.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],kt=[{name:"items.armour.chainMail",type:j.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"items.armour.plateMail",type:j.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"items.armour.dragonSkinMail",type:j.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],Dn=[{name:"items.armour.orchMail",defense:0,magicProtection:!1,amountInDeck:4,type:j.ARMOUR,movementReduction:0,value:0},{name:"items.armour.trollSkin",defense:1,magicProtection:!1,amountInDeck:4,type:j.ARMOUR,movementReduction:0,value:0},{name:"items.armour.darkLordCape",defense:2,magicProtection:!1,amountInDeck:4,type:j.ARMOUR,movementReduction:0,value:0}],It=[{name:"items.shields.largeShield",type:j.SHIELD,amountInDeck:2,dice:2,value:2},{name:"items.shields.smallShield",type:j.SHIELD,amountInDeck:2,dice:1,value:1}],Rt=[{name:"items.shields.blueDarkLordShield",type:j.SHIELD,amountInDeck:1,dice:1,value:0}],qe="USED",Vn="ATTACK_BONUS",qn="SEARCH_BONUS",wo="BREAK_LOCK",Xn="RE_ROLL_ATTACK",Jn="DESCRIPTION",bn="ACTIVE",Tn="MOVEMENT_BONUS",Qn="ACTIONS_BONUS",Po="RESET_ON",Bo="NEXT_TURN",Dt="TRADE",Go="NEXT_SCENARIO",Un={movementBonusOnPickup:(e,n,o)=>{var t,s;o.maxMovement+=(t=n.properties)==null?void 0:t[Tn],o.actions>0&&(o.movement+=(s=n.properties)==null?void 0:s[Tn])}},Uo={movementBonusOnDrop:(e,n,o)=>{var t,s;o.maxMovement-1>0&&(o.maxMovement-=(t=n.properties)==null?void 0:t[Tn]),o.movement-1>=0&&(o.movement-=(s=n.properties)==null?void 0:s[Tn])}},Mt={magicHerbsOnUse:(e,n,o,t)=>{if(n.disabled){E(e,"logs.item.cannotUse",{item:h(n.name)});return}if(!t){E(e,"logs.item.noTarget");return}if(!nn(o)){E(e,"logs.heroAction.noActions",{hero:h(o.name)});return}if(n.properties){if(n.properties[qe]){E(e,"logs.item.noUsesLeft",{item:h(n.name)});return}n.properties[qe]=!0;const s=Math.min(tn(o.level,3),t.maxHealth-t.health);t.health+=s,E(e,"logs.item.magicHerbs",{user:h(o.name),item:h(n.name),target:h(t.name),addedHealth:`${s}`}),o.actions--,o.movement=o.maxMovement}},chaosSwordOnUse:(e,n,o,t)=>{if(n.disabled){E(e,"logs.item.cannotUse",{item:h(n.name)});return}},potionOfSpeedOnUse:(e,n,o)=>{var t,s,i;if(n.disabled){E(e,"logs.item.cannotUse",{item:h(n.name)});return}(t=n.properties)!=null&&t[qe]?E(e,"logs.item.consumed",{item:h(n.name)}):(o.actions+=(s=n.properties)==null?void 0:s[Qn],n.properties&&(n.properties[qe]=!0),E(e,"logs.item.potionOfSpeed",{user:h(o.name),item:h(n.name),actions:(i=n.properties)==null?void 0:i[Qn]}))},necklaceOfLightOnUse:(e,n,o,t)=>{var s;if(n.disabled){E(e,"logs.item.cannotUse",{item:h(n.name)});return}if(!t){E(e,"logs.item.noTarget");return}if(!nn(o)){E(e,"logs.heroAction.noActions",{hero:h(o.name)});return}n.properties&&!((s=n.properties)!=null&&s[qe])&&(n.properties[qe]=!0,t.ignoredByMonsters=!0,o.actions--)}},Fo={magicHerbsOnReset:(e,n)=>{n.properties&&(n.properties[qe]=!1)},necklaceOfLightOnUse:(e,n)=>{n.properties&&(n.properties[qe]=!1),e.heroes.forEach(o=>o.ignoredByMonsters=!1)}},Ct=(e,n)=>{if(n&&n.effect&&e.currentActor){const o=Mt[n.effect];o(e,n,e.currentActor,e.targetActor),e.targetActor=void 0}},Wo=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Lt(o)).forEach(o=>{if(o&&o.reset){const t=Fo[o.reset];t(e,o)}})})},Ko=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Nt(o)).forEach(o=>{if(o&&o.reset){const t=Fo[o.reset];t(e,o)}})})},Nt=e=>e&&e.properties?(e.properties[Po]??[]).some(o=>o===Bo):!1,Lt=e=>e&&e.properties?(e.properties[Po]??[]).some(o=>o===Go):!1,Ht=e=>{const n=e.currentActor;if(n.blinded){E(e,"logs.heroAction.blinded",{hero:h(n.name)});return}const o=n.inventory.filter(a=>{var u;return a&&((u=a.properties)==null?void 0:u[qn])}).map(a=>{var u;return E(e,"logs.heroAction.searchBonus",{hero:h(n.name),item:h(a.name)}),(u=a.properties)==null?void 0:u[qn]}).reduce((a,u)=>a+u,0),t=tn(n.level,1+o);let s,i,r,l;t>=1?(s=qt(e,n,t),s||(i=Ft(e,n,t)),!s&&!i&&(r=Wt(e,n,t)),!s&&!i&&!r&&(l=Kt(e,n,t)),!s&&!i&&!r&&!l&&E(e,"logs.heroAction.searchFoundNothing",{hero:h(n.name)})):E(e,"logs.heroAction.searchFoundNothing",{hero:h(n.name)})},Yo=e=>{const n=e.currentActor;if(!n)return!1;const o=e.dungeon.layout.secrets.filter(t=>t.type===ie.TRAP_DOOR).filter(t=>!t.found).find(t=>ye(t.position,n.position));return o?($e(e,wt(o),n,!1),E(e,"logs.heroAction.pitfall",{hero:h(n.name)}),n.movement=0,n.actions=0,n.incapacitated=!0,o.found=!0,!0):!1},Vo=(e,n)=>{const o=e.itemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.itemDeck.splice(o,1)},qo=(e,n)=>{const o=e.magicItemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.magicItemDeck.splice(o,1)},wt=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:Y.Red,maxHealth:0,name:"Trap Door",level:_e.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:j.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),Pt=(e,n)=>e.dungeon.layout.doors.filter(o=>o.hidden).find(o=>En({x:o.x,y:o.y},n.x,n.y)),Bt=(e,n)=>e.dungeon.layout.doors.filter(o=>o.trapped).find(o=>o.x===n.x&&o.y===n.y),Gt=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).find(o=>En(o.position,n.x,n.y)),Ut=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).filter(o=>o.type===ie.TRAP_DOOR).find(o=>En(o.position,n.x,n.y)),Ft=(e,n,o)=>{const t=Pt(e,n.position);return t?(t.hidden=!1,E(e,"logs.heroAction.foundDoor",{hero:h(n.name),result:`${o}`}),!0):!1},Wt=(e,n,o)=>{const t=Bt(e,n.position);return t?(E(e,"logs.heroAction.foundTrapInDoor",{hero:h(n.name),result:`${o}`}),t.trapped=!1,!0):!1},Kt=(e,n,o)=>{const t=Gt(e,n.position);if(t){switch(E(e,"logs.heroAction.foundSecret",{hero:h(n.name),result:`${o}`,secret:h(t.name)}),t.found=!0,t.type){case ie.EQUIPMENT:{const s=t.item??Yt(e);s.amountInDeck>0&&(Vo(e,s),E(e,"logs.heroAction.equipped",{hero:h(n.name),item:h(s.name)}),$o(e,s,n));break}case ie.MAGIC_ITEM:{const s=t.item??Vt(e);s.amountInDeck>0&&(qo(e,s),E(e,"logs.heroAction.found",{hero:h(n.name),item:h(s.name)}),n.inventory.push(s),s&&s.pickup&&Un[s.pickup](e,s,n));break}}return!0}return!1},Yt=e=>{const n=e.itemDeck.length,o=Math.floor(Math.random()*n);return e.itemDeck[o]},Vt=e=>{const n=e.magicItemDeck.length,o=Math.floor(Math.random()*n);return e.magicItemDeck[o]},qt=(e,n,o)=>{const t=Ut(e,n.position);return t?(E(e,"logs.heroAction.foundSecret",{hero:h(n.name),result:`${o}`,secret:h(t.name)}),t.found=!0,!0):!1},On=(e,n)=>(mn[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:_e.APPRENTICE,health:7,maxHealth:7,colour:n,experience:0,position:{x:-1,y:-1},weapon:mn[0],incapacitated:!1,inventory:[],isInventoryOpen:!1}),je=(e,n)=>{ce(n);const o=n.currentActor;if(!o||o.actions===0)return;const t={x:o.position.x,y:o.position.y};switch(e){case"UL":t.x=o.position.x-1,t.y=o.position.y-1;break;case"U":t.y=o.position.y-1;break;case"UR":t.x=o.position.x+1,t.y=o.position.y-1;break;case"L":t.x=o.position.x-1;break;case"R":t.x=o.position.x+1;break;case"DL":t.x=o.position.x-1,t.y=o.position.y+1;break;case"D":t.y=o.position.y+1;break;case"DR":t.x=o.position.x+1,t.y=o.position.y+1;break}const s=_n(n,t.x,t.y),i=!In(n.dungeon.layout,t.x,t.y),r=hn(n,t.x,t.y);if(!s&&!i){const l=ln(n.dungeon,t.x,t.y);l?l&&(r?Jo(o,n,t):zo(o,n,t.x,t.y,1)):Zt(n,o,t.x,t.y)&&un(o,n,t.x,t.y)}else E(n,"logs.heroAction.illegalMove",{hero:h(o.name)});Yo(n)||Fn(o)},Xo=e=>{ce(e);const n=e.currentActor;if(!n)return;if(n.blinded){E(e,"logs.heroAction.blinded",{hero:h(n.name)});return}if(!nn(n)){E(e,"logs.heroAction.noActions",{hero:h(n.name)});return}const o=e.dungeon.layout.doors.find(t=>t.x===n.position.x&&t.y===n.position.y);o&&o.locked&&(tn(n.level,1)>=1?(o.locked=!1,E(e,"logs.heroAction.pickedLock",{hero:h(n.name)})):E(e,"logs.heroAction.failedToPickLock",{hero:h(n.name)}),n.actions>1&&n.movement<3?n.actions-=2:n.actions--,n.movement=Xe(n),n.actions==0&&(n.movement=0))},kn=e=>{ce(e),e.heroes.forEach((n,o)=>{n.position=e.dungeon.startingPositions[o],n.movement=Xe(n),n.actions=2,n.health=n.maxHealth})},x=e=>e.heroes.filter(n=>n.health>0).map(n=>n),Xt=e=>{ce(e);const n=e.currentActor;n&&(n.actions--,n.movement=Xe(n),n.actions===0&&Pn(e))},nn=e=>e.movement<Xe(e)?e.actions>1:e.actions>0,un=(e,n,o,t)=>{ce(n);const s=fe(n.dungeon.layout.grid,o,t);s&&![Ge,vn,rn].includes(s)&&n.dungeon.discoveredRooms.push(s),zo(e,n,e.position.x,e.position.y,1),E(n,"logs.heroAction.openedDoor",{hero:h(e.name)})},Jo=(e,n,o)=>{if(ce(n),e.actions===1&&e.movement<e.maxMovement){E(n,"logs.heroAction.noActions",{hero:h(e.name)});return}if(!e.weapon.useHearHeroes&&$t(n,e)){E(n,"logs.heroAction.notNearFriend",{hero:h(e.name),weapon:h(e.weapon.name)});return}const t=St(n,o);t&&($e(n,e,t,!1),t.health<=0&&xt(n,t,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},Qo=e=>{ce(e);const n=e.currentActor;if(n){if(n.blinded){E(e,"logs.heroAction.blinded",{hero:h(n.name)});return}if(!nn(n)){E(e,"logs.heroAction.noActions",{hero:h(n.name)});return}Ht(e),n.actions>1&&n.movement<Xe(n)?n.actions-=2:n.actions--,n.actions==0&&(n.movement=0)}},hn=(e,n,o)=>e.dungeon.layout.monsters.some(t=>t.position.x===n&&t.position.y===o&&t.health>0),_n=(e,n,o)=>x(e).some(t=>t.position.x===n&&t.position.y===o),Fn=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=Xe(e))),e.actions==0&&(e.movement=0)},Jt=e=>{ce(e),x(e).forEach(n=>{const o=n.level;n.experience>=28?n.level=_e.MASTER:n.experience>=18?n.level=_e.LORD:n.experience>=10?n.level=_e.HERO:n.experience>=4&&(n.level=_e.KNIGHT),o!==n.level&&E(e,"logs.heroAction.leveledUp",{hero:h(n.name),level:h(`content.level.${n.level}`)})})},Qt=e=>{x(e).forEach(n=>n.experience+=1)},Zo=e=>{zt(e).forEach(n=>{n.experience=0,n.health=n.maxHealth,n.movement=n.maxMovement,n.actions=2})},jo=(e,n,o)=>!o.open&&!o.hidden&&(!o.locked||o.locked&&n)&&e.movement>0,xo=(e,n)=>{const o=e.dungeon.layout.notes.find(t=>ye(t.position,n.position));o&&(e.dungeon.layout.doors.some(s=>s.hidden&&ye(o.position,{x:s.x,y:s.y}))||(E(e,"logs.heroAction.reads",{hero:h(n.name),note:h(o.message)}),o.found=!0,o.foundOn=e.turnCount))},So=(e,n)=>{const o=e.dungeon.layout.monsters.some(t=>En(n.position,t.position.x,t.position.y));return o&&E(e,"logs.heroAction.walkedByMonster",{hero:h(n.name)}),o},Mn=(e,n,o)=>{E(e,"logs.heroAction.drop",{hero:h(o.name),item:h(n.name)}),e.dungeon.layout.items.push({item:n,position:o.position}),n&&n.drop&&Uo[n.drop](e,n,o)},$o=(e,n,o)=>{switch(n.type){case j.ARMOUR:o.armour&&Mn(e,o.armour,o),o.armour=n;break;case j.SHIELD:o.shield&&Mn(e,o.shield,o),o.shield=n;break;case j.WEAPON:o.weapon&&Mn(e,o.weapon,o),o.weapon=n;break;default:o.inventory.push(n);break}if(n&&n.pickup){const t=Un[n.pickup];t(e,n,o)}},zo=(e,n,o,t,s)=>{e.position.x=o,e.position.y=t,xo(n,e),So(n,e)?e.movement=0:e.movement-=s},Zt=(e,n,o,t)=>{const s=e.dungeon.layout.doors.find(r=>r.x===n.position.x&&r.y===n.position.y),i=n.inventory.some(r=>{var l;return r&&((l=r.properties)==null?void 0:l[wo])});if(s&&jo(n,i,s)){s.locked&&i&&E(e,"logs.heroAction.brokeLock",{hero:h(n.name)});const r=jt(n.position.x,n.position.y,o,t);if(s.side===r)return s.open=!0,s.trapped&&$e(e,mt(s),n,!1),!0}return s&&s.locked&&E(e,"logs.heroAction.locked"),!1},jt=(e,n,o,t)=>{if(e===o){if(n>t)return v.UP;if(n<t)return v.DOWN}if(n===t){if(e>o)return v.LEFT;if(e<o)return v.RIGHT}},xt=(e,n,o)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(t=>t!=n),e.dungeon.killCount++,o.experience+=n.experience},St=(e,n)=>e.dungeon.layout.monsters.find(o=>ye(o.position,n)),$t=(e,n)=>gt(e,n).filter(o=>o!==n).length>0,zt=e=>e.heroes.filter(n=>n.health<=0).map(n=>n),vn=" ",rn="?",Ge="#",es={hasNecklaceOfLight:(e,n)=>{const o=x(e).some(t=>t.inventory.some(s=>s&&s.name==="items.magicItems.necklaceOfLight.name"));return e.settings.debug&&E(e,"logs.debug.hasNecklaceOfLight",{hasNecklaceOfLight:o?"Y":"N"}),n.fulfilled&&o}},ns=(e,n,o)=>({item:o,position:{x:e,y:n}}),he=(e,n,o,t)=>({type:e,name:n,position:{x:o,y:t},found:!1}),pn=(e,n,o,t)=>({type:e,name:t.name,position:{x:n,y:o},found:!1,item:t}),Q=(e,n,o)=>({side:e,x:n,y:o,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),et=(e,n,o,t)=>({...Q(e,n,o),trapped:!0,trapAttacks:t}),Ue=(e,n,o)=>({...Q(e,n,o),hidden:!0}),on=(e,n,o)=>({...Q(e,n,o),locked:!0}),cn=(e,n,o,t)=>({...Q(e,n,o),locked:!0,trapped:!0,trapAttacks:t}),Hn=(e,n,o,t)=>({...Q(e,n,o),hidden:!0,trapped:!0,trapAttacks:t}),nt=(e,n,o,t,s)=>{const i=re(e,n,o,t);return i.inventory=s,i},re=(e,n,o,t)=>{const s=Object.values(Y).indexOf(n),i=Object.keys(Y)[s];let r=_e.MASTER,l=2,a=2,u=4,c=4,d=4,y=an[3],_=Dn[2],B,C;return e===U.ORCH?(r=_e.APPRENTICE,a=0,u=2,c=2,d=1,y=an[0],B=an[1],_=Dn[0]):e===U.TROLL?(r=_e.KNIGHT,a=1,u=3,c=3,d=2,y=an[2],_=Dn[1]):e===U.YELLOW_DARK_LORD?l=3:e===U.GREEN_DARK_LORD?y=an[4]:e===U.BLUE_DARK_LORD&&(C=Rt[0]),{type:e,level:r,colour:n,actions:l,defense:a,health:u,maxHealth:c,experience:d,weapon:y,armour:_,shield:C,rangedWeapon:B,name:e+" ("+i+")",movement:3,maxMovement:3,position:{x:o,y:t},incapacitated:!1,inventory:[]}},Ie=[{name:"items.magicItems.healingHerbs.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"items.magicItems.healingHerbs.description",RESET_ON:[Dt,Go]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"items.magicItems.boots.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.boots.description",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"items.magicItems.giantsGlove.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.giantsGlove.description",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"items.magicItems.ringOfPrecision.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.ringOfPrecision.description",RE_ROLL_ATTACK:!0}},{name:"items.magicItems.crownOfWisdom.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.crownOfWisdom.description",SEARCH_BONUS:1}},{name:"items.magicItems.swordOfChaos.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.swordOfChaos.description"},effect:"chaosSwordOnUse"},{name:"items.magicItems.potionOfSpeed.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.potionOfSpeed.description",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"items.magicItems.necklaceOfLight.name",type:j.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[Bo],ACTIVE:!0,DESCRIPTION:"items.magicItems.necklaceOfLight.description"},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],ot={name:"campaign.iceDragon.e1m4.name",beaten:!1,winConditions:[{type:ae.KILL_AT_LEAST,killMinCount:7,fulfilled:!1},{type:ae.KILL_ALL,fulfilled:!1},{type:ae.REACH_CELL,fulfilled:!1,targetCell:{x:16,y:11},checkFulfilled:"hasNecklaceOfLight",additionalDescription:"content.winConditions.additional.requiresNecklace"}],startingPositions:[{x:3,y:2},{x:2,y:1},{x:2,y:2},{x:2,y:3}],discoveredRooms:["A"],layout:{corners:[],grid:[" ##### ########   "," #AAA###CCCCCC#   "," #AAABBBCCCCCC#   "," #AAA###CCCCCC#   "," ##D## #####G##   ","  #D#  #####G##   ","###D## #####G##   ","#EEEE###HHHHHH#   ","#EEEEFFFHHHHHH#   ","##L#####HHHHHH####","##L#NNN#HHHHHHIII#","##L#NNN####K##III#","#MMMNNN####K##III#","#MMM#######K###J##","#MMM###PPPPPPPJJ##","#MMMPPPPPPPPPP####","#######PPPPPPP#   ","      #########   "],corridors:["B","D","G","F","L","K","J"],pits:[],doors:[Q(v.DOWN,3,3),on(v.RIGHT,4,2),Q(v.RIGHT,7,2),on(v.DOWN,12,3),Q(v.DOWN,3,6),Q(v.DOWN,12,6),Ue(v.DOWN,2,8),cn(v.RIGHT,4,8,2),Q(v.RIGHT,7,8),Q(v.DOWN,11,10),Q(v.DOWN,2,11),Ue(v.RIGHT,3,12),Q(v.DOWN,3,15),et(v.DOWN,11,13,2),Hn(v.RIGHT,13,10,2),Hn(v.RIGHT,13,14,2),Ue(v.UP,15,13)],monsters:[re(U.ORCH,Y.Blue,12,1),re(U.ORCH,Y.Red,12,6),re(U.ORCH,Y.Green,2,8),re(U.ORCH,Y.Yellow,2,14),re(U.TROLL,Y.Blue,10,9),nt(U.TROLL,Y.Yellow,9,15,[Ie[7]]),re(U.RED_DARK_LORD,Y.Red,16,10)],secrets:[he(ie.NOTE,"campaign.iceDragon.e1m4.secrets.note1",13,2),he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",4,10),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",5,15),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",14,10),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",15,11),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",14,12)],notes:[{position:{x:11,y:8},message:"campaign.iceDragon.e1m4.notes.liberVortex"},{position:{x:13,y:10},message:"campaign.iceDragon.e1m4.notes.ironDoor"}],items:[ns(3,8,mn[1])]},killCount:0},tt={name:"campaign.iceDragon.e1m3.name",nextDungeon:ot,beaten:!1,winConditions:[{type:ae.KILL_ALL,fulfilled:!1},{type:ae.OPEN_DOOR,targetCell:{x:18,y:4},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{corners:[],grid:["       ########     ","     ###DDDEEE#     ","     #CCC##EEE#     ","######CCC##EEE######","#AAA##CCC####F#IIII#","#AAABBB#J####F#IIII#","#AAA####J##G#F#IIII#","##### ##J##GGF#IIII#","   ####KKK###F#IIII#","   #LLLKKK# #FMIIII#","   ####KKK####M#####","      #KKKMMMMM#    ","      ####MMMM##    ","         ######     "],corridors:["B","D","F","L"],pits:[{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:15,y:8},{x:16,y:8},{x:17,y:8}],doors:[Q(v.RIGHT,3,5),cn(v.DOWN,6,5,1),Q(v.UP,6,5),Q(v.DOWN,8,4),Ue(v.UP,8,2),Q(v.DOWN,8,7),Q(v.LEFT,7,9),cn(v.LEFT,4,9,1),cn(v.RIGHT,9,11,1),Ue(v.RIGHT,14,9),Ue(v.UP,18,4),cn(v.LEFT,14,9,1),Q(v.LEFT,13,7),on(v.UP,11,6),Q(v.UP,13,4),Q(v.LEFT,11,1)],monsters:[re(U.ORCH,Y.Yellow,5,5),nt(U.TROLL,Y.Yellow,7,3,[Ie[3]]),re(U.ORCH,Y.Red,7,11),re(U.ORCH,Y.Blue,11,2),re(U.ORCH,Y.Blue,14,11),re(U.YELLOW_DARK_LORD,Y.Yellow,18,5)],secrets:[pn(ie.MAGIC_ITEM,8,10,Ie[2]),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",8,6),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,1),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,7),he(ie.TRAP_DOOR,"campaign.iceDragon.trapDoor",13,11)],notes:[{position:{x:6,y:5},message:"campaign.iceDragon.e1m3.notes.hint1"},{position:{x:8,y:3},message:"campaign.iceDragon.e1m3.notes.hint2"},{position:{x:8,y:8},message:"campaign.iceDragon.e1m3.notes.hint3"},{position:{x:14,y:10},message:"campaign.iceDragon.e1m3.notes.hint4"}],items:[]},killCount:0},st={name:"campaign.iceDragon.e1m2.name",nextDungeon:tt,beaten:!1,winConditions:[{type:ae.KILL_ALL,fulfilled:!1},{type:ae.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{corners:[],grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[Q(v.UP,2,13),Q(v.UP,2,10),Q(v.RIGHT,3,8),on(v.RIGHT,6,8),Q(v.UP,8,7),Q(v.UP,8,4),Ue(v.LEFT,7,2),Q(v.LEFT,4,2),on(v.RIGHT,12,2),Q(v.RIGHT,15,2),Q(v.DOWN,17,7),Q(v.DOWN,17,10),Ue(v.DOWN,17,14)],monsters:[re(U.TROLL,Y.Red,3,7),re(U.ORCH,Y.Red,12,8),re(U.ORCH,Y.Green,11,1),re(U.TROLL,Y.Green,2,2),re(U.ORCH,Y.Yellow,18,7),re(U.TROLL,Y.Yellow,17,10)],secrets:[he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,3),he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",3,3),he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",15,2),pn(ie.MAGIC_ITEM,2,3,Ie[1]),pn(ie.MAGIC_ITEM,16,11,Ie[6])],notes:[{message:"campaign.iceDragon.e1m2.notes.hint1",position:{x:2,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint2",position:{x:8,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint3",position:{x:2,y:3}},{message:"campaign.iceDragon.e1m2.notes.hint4",position:{x:17,y:11}}],items:[]},killCount:0},it={name:"campaign.iceDragon.e1m1.name",nextDungeon:st,beaten:!1,winConditions:[{type:ae.KILL_ALL,fulfilled:!1},{type:ae.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{corners:[],grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[Q(v.RIGHT,3,5),Q(v.RIGHT,6,5),Q(v.RIGHT,10,6),Q(v.RIGHT,13,6),Q(v.RIGHT,10,9),Q(v.RIGHT,13,9),Q(v.RIGHT,12,3),Ue(v.UP,10,4),Ue(v.RIGHT,15,2)],monsters:[re(U.ORCH,Y.Blue,10,8),re(U.ORCH,Y.Red,13,9),re(U.TROLL,Y.Red,16,2),re(U.TROLL,Y.Yellow,14,7)],secrets:[he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",10,5),he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",13,1),he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",16,10),pn(ie.MAGIC_ITEM,16,6,Ie[0])],notes:[{message:"campaign.iceDragon.e1m1.notes.hint1",position:{x:3,y:5}},{message:"campaign.iceDragon.e1m1.notes.hint2",position:{x:10,y:9}},{message:"campaign.iceDragon.e1m1.notes.hint3",position:{x:10,y:6}},{message:"campaign.iceDragon.e1m1.notes.hint4",position:{x:10,y:4}}],items:[]},killCount:0},rt={name:"campaign.iceDragon.e1mo.name",beaten:!1,winConditions:[{type:ae.KILL_ALL,fulfilled:!1}],nextDungeon:it,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{corners:[{position:{x:5,y:0},type:H.INNER_TOP_LEFT},{position:{x:100,y:0},type:H.INNER_BOTTOM_RIGHT},{position:{x:5,y:4},type:H.INNER_BOTTOM_LEFT},{position:{x:6,y:4},type:H.OUTER_TOP_RIGHT},{position:{x:8,y:4},type:H.OUTER_TOP_LEFT},{position:{x:10,y:4},type:H.INNER_BOTTOM_RIGHT},{position:{x:8,y:6},type:H.OUTER_BOTTOM_LEFT},{position:{x:9,y:6},type:H.INNER_TOP_RIGHT},{position:{x:0,y:7},type:H.INNER_TOP_LEFT},{position:{x:4,y:7},type:H.INNER_TOP_RIGHT},{position:{x:4,y:8},type:H.OUTER_BOTTOM_LEFT},{position:{x:6,y:8},type:H.OUTER_BOTTOM_RIGHT},{position:{x:4,y:10},type:H.OUTER_TOP_LEFT},{position:{x:6,y:10},type:H.OUTER_TOP_RIGHT},{position:{x:0,y:11},type:H.INNER_BOTTOM_LEFT},{position:{x:4,y:11},type:H.INNER_BOTTOM_RIGHT},{position:{x:6,y:11},type:H.INNER_BOTTOM_LEFT},{position:{x:9,y:11},type:H.INNER_BOTTOM_RIGHT}],grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[Q(v.RIGHT,3,9),Q(v.RIGHT,6,9),Q(v.UP,7,7),Q(v.UP,7,4)],monsters:[re(U.ORCH,Y.Green,6,9),re(U.ORCH,Y.Yellow,8,10),re(U.ORCH,Y.Red,7,5),re(U.ORCH,Y.Red,9,3),re(U.TROLL,Y.Green,6,1)],secrets:[],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},os=()=>{const e=[];return Ie.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},ts=()=>{const e=[];return mn.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),kt.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),It.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},ss={name:"campaign.iceDragon.name",dungeons:[rt,it,st,tt,ot],itemDeck:ts(),magicItemDeck:os(),heroes:[On("Fearik",Y.Yellow),On("Helbran",Y.Red),On("Siedel",Y.Green),On("Wulf",Y.Blue)]},Wn=(e,n)=>{const o=Math.abs(n.x-e.x),t=Math.abs(n.y-e.y),s=Math.min(o,t),i=Math.max(o,t),r=s,l=i-s;let a=Math.sqrt(2);return l===0&&(a=1),Math.floor(a*r+l)},is=(e,n)=>{ce(e);const o=e.currentActor,t=e.dungeon.layout.items.find(i=>ye(i.position,o.position));if(t){const i=t.item;i.type===j.MAGIC?qo(e,i):Vo(e,i);const r=e.dungeon.layout.items.indexOf(t);e.dungeon.layout.items.splice(r,1),E(e,"logs.heroAction.pickUp",{hero:h(o.name),item:h(i.name)}),$o(e,i,o);return}const s=e.dungeon.layout.doors.find(i=>i.x===o.position.x&&i.y===o.position.y&&!i.open);if(s&&!s.hidden){const i=o.inventory.some(r=>{var l;return r&&((l=r.properties)==null?void 0:l[wo])});if(jo(o,i,s)){switch(s.locked&&i&&E(e,"logs.heroAction.brokeLock",{hero:h(o.name)}),s.open=!0,s.trapped&&$e(e,mt(s),o,!1),s.side){case v.RIGHT:un(o,e,n.x+1,n.y);break;case v.LEFT:un(o,e,n.x-1,n.y);break;case v.DOWN:un(o,e,n.x,n.y+1);break;case v.UP:un(o,e,n.x,n.y-1);break}Fn(o)}else if(s.locked&&!s.hidden){if(!nn(o)){E(e,"logs.heroAction.noActions",{hero:h(o.name)});return}E(e,"logs.heroAction.locked"),Xo(e)}}else{if(!nn(o)){E(e,"logs.heroAction.noActions",{hero:h(o.name)});return}Qo(e)}},rs=(e,n)=>{ce(e);const o=e.currentActor;if(o.actions===0){o.movement=0,E(e,"logs.heroAction.noActions",{hero:h(o.name)});return}if(In(e.dungeon.layout,n.x,n.y)){const s=_n(e,n.x,n.y),i=hn(e,n.x,n.y),r=Wn(o.position,n),l=Kn(o.position,n,2,e,!0);if(!s&&!i&&r<=o.movement&&l){if(o.position=n,o.movement-=r,xo(e,o),So(e,o)&&(o.movement=0),Yo(e))return}else i&&(r<=o.weapon.range?Jo(o,e,n):E(e,"logs.heroAction.monsterOutOfRange"))}Fn(o)},ls=(e,n,o)=>{const t=document.getElementById("gameBoard");if(!t)return;const s=t.getBoundingClientRect(),i=Math.min(Math.floor((e.clientX-s.left)/n),o.dungeon.layout.grid[0].length-1),r=Math.min(Math.floor((e.clientY-s.top)/n),o.dungeon.layout.grid.length-1),l=o.dungeon.layout.grid[r][i],a=o.currentActor;i===a.position.x&&r===a.position.y?is(o,{x:i,y:r}):Se(o.dungeon,l)&&rs(o,{x:i,y:r})},Cn=e=>e.dungeon.layout.monsters.filter(n=>[U.ORCH,U.TROLL].includes(n.type)),as=e=>{const n=lt(e);n.length===0&&E(e,"logs.monsterAction.noMonsterAct"),n.forEach(o=>{const t=o.actions;for(E(e,"logs.monsterAction.acted",{monster:h(o.name)});o.actions>0;){ce(e);const s=gt(e,o).filter(c=>!c.ignoredByMonsters),i=ds(e,o),r=hs([...i,...Cn(e)],o),l=_s([...i,...Cn(e)],o),a=vs([...x(e),...Cn(e)],o,e);switch(us(e,o,s,i,r,l,a)){case"MELEE_ATTACK":{const c=fs(s);Zn(e,o,c,!1);break}case"RANGED_ATTACK":{const c=cs(i,o);Zn(e,o,c,!0);break}case"MOVE":{ps(e,o);break}case"DIAGONAL_FIRE_ATTACK":Nn(e,o,r);break;case"ORTHOGONAL_FIRE_ATTACK":Nn(e,o,l);break;case"SAME_ROOM_FIRE_ATTACK":Nn(e,o,a)}o.movement=Xe(o)}o.actions=t,o.movement=Xe(o)})},us=(e,n,o,t,s,i,r)=>o.length>0?"MELEE_ATTACK":!n.rangedWeapon&&s.length===0?"MOVE":t.length>0&&n.rangedWeapon?Math.random()<.1?(E(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"RANGED_ATTACK":r.length>0?Math.random()<.1?(E(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"SAME_ROOM_FIRE_ATTACK":t.length>0&&i.length>0?Math.random()<.1?(E(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"ORTHOGONAL_FIRE_ATTACK":t.length>0&&s.length>0?Math.random()<.1?(E(e,"logs.monsterAction.moveDespiteTarget",{monster:h(n.name)}),"MOVE"):"DIAGONAL_FIRE_ATTACK":"MOVE",cs=(e,n)=>e.filter(o=>!o.shield).sort(o=>fn(n.position,o.position)).sort((o,t)=>t.health-o.health||fn(n.position,o.position)-fn(n.position,t.position))[0],fs=e=>e.sort((n,o)=>o.health-n.health)[0],ds=(e,n)=>x(e).filter(o=>!o.ignoredByMonsters).filter(o=>Kn(n.position,o.position,48,e,!1)),lt=e=>e.dungeon.layout.monsters.filter(n=>{const o=fe(e.dungeon.layout.grid,n.position.x,n.position.y);return o&&Se(e.dungeon,o)&&n.health>0}),Zn=(e,n,o,t)=>{$e(e,n,o,t),(n==null?void 0:n.actions)>1&&(n==null?void 0:n.movement)<3?n.actions-=2:n.actions--},ms=(e,n)=>x(e).map(o=>({hero:o,dist:fn(o.position,n.position)})).sort((o,t)=>o.dist-t.dist)[0],ps=(e,n)=>{const o=ms(e,n);for(;n.movement>0;){if(o&&o.dist>1){const t=gs(e,n.position);if(t.length>0){const s=t.map(i=>({pos:i,dist:fn(i,o.hero.position)})).sort((i,r)=>i.dist-r.dist)[0].pos;n.position=s,E(e,"logs.monsterAction.movedTowards",{monster:h(n.name),hero:h(o.hero.name),x:`${s.x}`,y:`${s.y}`})}else E(e,"logs.monsterAction.couldNotMove",{monster:h(n.name)})}n.movement--}n.actions--},gs=(e,n)=>{const o=n.x,t=n.y,s=[];for(let i=o-1;i<=o+1;i++)for(let r=t-1;r<=t+1;r++)i===o&&r===t||In(e.dungeon.layout,i,r)&&ln(e.dungeon,i,r)&&s.push({x:i,y:r});return s.filter(i=>!x(e).find(r=>r.position.x===i.x&&r.position.y===i.y)).filter(i=>!e.dungeon.layout.monsters.some(r=>r.position.x===i.x&&r.position.y===i.y))},hs=(e,n)=>e.filter(o=>[U.YELLOW_DARK_LORD,U.BLUE_DARK_LORD].includes(n.type)&&Math.abs(n.position.x-o.position.x)===Math.abs(n.position.y-o.position.y)&&Wn(n.position,o.position)>1),_s=(e,n)=>e.filter(o=>[U.RED_DARK_LORD,U.BLUE_DARK_LORD].includes(n.type)&&(n.position.x===o.position.x||n.position.y===o.position.y)&&Wn(n.position,o.position)>1),vs=(e,n,o)=>e.filter(t=>[U.GREEN_DARK_LORD,U.BLUE_DARK_LORD].includes(n.type)&&fe(o.dungeon.layout.grid,n.position.x,n.position.y)===fe(o.dungeon.layout.grid,t.position.x,t.position.y)),Nn=(e,n,o)=>{o.forEach(t=>{var s,i;(s=t.armour)!=null&&s.magicProtection?E(e,"logs.monsterAction.fireAttackDeflected",{monster:h(n.name),target:h(t.name),armour:h((i=t.armour)==null?void 0:i.name)}):$e(e,n,t,!0)})},jn=[{name:"events.hungryTroll.name",number:1,description:"events.hungryTroll.description",effect:"theHungryTroll",used:!1},{name:"events.sunStone.name",number:2,description:"events.sunStone.description",effect:"sunStone",used:!1},{name:"events.timePortal.name",number:3,description:"events.timePortal.description",effect:"timePortal",used:!1},{name:"events.fountainOfYouth.name",number:4,description:"events.fountainOfYouth.description",effect:"fountainOfYouth",used:!1},{name:"events.sleepingGas.name",number:5,description:"events.sleepingGas.description",effect:"sleepingGasCloud",used:!1},{name:"events.lostOrch.name",number:6,description:"events.lostOrch.description",effect:"theLostOrch",used:!1},{name:"events.dragonsBreath.name",number:7,description:"events.dragonsBreath.description",effect:"theDragonsBreath",used:!1},{name:"events.landslide.name",number:8,description:"events.landslide.description",effect:"landslide",used:!1},{name:"events.magicNode.name",number:9,description:"events.magicNode.description",effect:"fountainOfYouth",used:!1},{name:"events.foresight.name",number:10,description:"events.foresight.description",effect:"foresight",used:!1},{name:"events.earthquake.name",number:11,description:"events.earthquake.description",effect:"earthquake",used:!1},{name:"events.magicStorm.name",number:12,description:"events.magicStorm.description",effect:"theMagicStorm",used:!1},{name:"events.elementalWeapon.name",number:13,description:"events.elementalWeapon.description",effect:"theElementalWeapon",used:!1},{name:"events.orchDrums.name",number:14,description:"events.orchDrums.description",effect:"theOrchDrums",used:!1},{name:"events.weakness.name",number:15,description:"events.weakness.description",effect:"theSymbolOfWeakness",used:!1}],at=e=>e.events?wn(jn.filter(n=>{var o;return(o=e==null?void 0:e.events)==null?void 0:o.includes(n.number)})):wn(jn),ut=e=>{const n=e.eventDeck.filter(o=>!o.used);return n.length>0?n[0]:(wn(e.eventDeck),ut(e))},ys={sunStone:(e,n)=>{ke(e,n);const o=x(e).length-1,t=Math.floor(Math.random()*o),s=x(e)[t],i=fe(e.dungeon.layout.grid,s.position.x,s.position.y);e.dungeon.layout.monsters.filter(r=>r.type===U.TROLL).filter(r=>fe(e.dungeon.layout.grid,r.position.x,r.position.y)===i).forEach(r=>{E(e,"logs.events.sunStone",{monster:h(r.name)}),r.health=0}),n.used=!0},theHungryTroll:(e,n)=>{ke(e,n),xn(e,U.TROLL),n.used=!0},timePortal:(e,n)=>{ke(e,n),e.heroes.forEach(o=>o.actions++),n.used=!0},fountainOfYouth:(e,n)=>{ke(e,n),x(e).forEach(o=>{if(o.health<o.maxHealth){const t=tn(o.level,3);o.health+=Math.min(t,o.maxHealth-o.health)}}),n.used=!0},sleepingGasCloud:(e,n)=>{ke(e,n),x(e).forEach(o=>{o.actions=Math.max(1,o.actions-1)}),n.used=!0},theLostOrch:(e,n)=>{ke(e,n),xn(e,U.ORCH),n.used=!0},theDragonsBreath:(e,n)=>{ke(e,n),x(e).forEach(o=>o.blinded=!0),n.used=!0},landslide:(e,n)=>{ke(e,n);const o=e.dungeon.layout.corridors.filter(r=>!Is(e,r)).filter(r=>Se(e.dungeon,r)),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];e.dungeon.collapsedCorridor=i,e.dungeon.layout.grid=e.dungeon.layout.grid.map(r=>r.replaceAll(i,rn)),n.used=!0},foreSight:(e,n)=>{if(ke(e,n),e.dungeon.layout.secrets.filter(t=>t.type===ie.EQUIPMENT||t.type===ie.MAGIC_ITEM).filter(t=>!t.found).filter(t=>t.item).filter(t=>{const s=fe(e.dungeon.layout.grid,t.position.x,t.position.y)??"";return!Se(e.dungeon,s)}).length>0){const t=e.dungeon.layout.secrets.pop();t&&t.item&&(E(e,"logs.events.foreSight",{x:`${t.position.x+2}`,y:`${t.position.y-1}`}),e.dungeon.layout.items.push({item:t.item,position:t.position}))}n.used=!0},earthquake:(e,n)=>{ke(e,n);const o=ct(e),t={name:"boulder",type:j.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},s={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:t,level:_e.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:Y.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(i=>i.type===U.TROLL).filter(i=>fe(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>$e(e,s,i,!1)),x(e).filter(i=>fe(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>$e(e,s,i,!1)),n.used=!0},theMagicStorm:(e,n)=>{var t;ke(e,n);const o=x(e).filter(s=>s.inventory.filter(i=>i&&!i.disabled).some(i=>i.type===j.MAGIC));if(o.length>0){const s=o.length-1,i=Math.floor(Math.random()*s),r=o[i],l=r.inventory.filter(a=>a&&a.type===j.MAGIC);if(l.length>0){const a=l.length-1,u=Math.floor(Math.random()*a),c=l[u];c.disabled=!0,c&&!((t=c.properties)!=null&&t[bn])&&c.pickup&&c.drop&&Uo[c.drop](e,c,r)}}n.used=!0},theElementalWeapon:(e,n)=>{ke(e,n);const o=x(e),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];i.weapon.elemental=!0,n.used=!0},theOrchDrums:(e,n)=>{ke(e,n),e.dungeon.layout.monsters.filter(o=>o.type===U.ORCH).forEach(o=>o.actions=3),n.used=!0},theSymbolOfWeakness:(e,n)=>{ke(e,n),x(e).forEach(o=>o.weakened=!0),n.used=!0}},Es=e=>{x(e).some(n=>n.weapon.elemental)&&(E(e,"logs.events.magicStormRestored"),x(e).forEach(n=>{n.inventory.forEach(o=>{var t;o&&!((t=o.properties)!=null&&t[bn])&&o.pickup&&Un[o.pickup](e,o,n),o&&(o.disabled=!1)})}))},Os=e=>{e.eventDeck.filter(o=>!o.used).length===0&&(Ts(e),As(e),Es(e)),ks(e),bs(e)},As=e=>{const n=e.dungeon.collapsedCorridor;n&&(E(e,"logs.events.landslideRestored"),e.dungeon.layout.grid=e.dungeon.layout.grid.map(o=>o.replaceAll(rn,n)),e.dungeon.collapsedCorridor=void 0)},bs=e=>{x(e).some(n=>n.blinded)&&(E(e,"logs.events.blindedRestored"),x(e).forEach(n=>n.blinded=!1))},Ts=e=>{x(e).some(n=>n.weapon.elemental)&&(E(e,"logs.events.elementalWeaponRestored"),x(e).forEach(n=>n.weapon.elemental=!1))},ks=e=>{x(e).some(n=>n.weakened)&&(E(e,"logs.events.weakenedRestored"),x(e).forEach(n=>n.weakened=!1))},ct=e=>{const n=e.dungeon.discoveredRooms.length-1,o=Math.floor(Math.random()*n);return e.dungeon.discoveredRooms[o]},xn=(e,n)=>{const o=lt(e).filter(l=>l.type===n);if(o.length===4)return;const s=ct(e),i=[Y.Red,Y.Green,Y.Yellow,Y.Blue];o.forEach(l=>{const a=i.indexOf(l.colour);a!==-1&&i.splice(a,1)});let r=!1;for(let l=0;l<e.dungeon.layout.grid.length;l++){const a=yn(e.dungeon.layout.grid[l]);for(let u=0;u<a.length;u++)if(a[u]===s&&!_n(e,u,l)&&!hn(e,u,l)){e.dungeon.layout.monsters.push(re(n,i[0],u,l)),r=!0;break}if(r)break}},ke=(e,n)=>{E(e,n.description),E(e,n.name)},wn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e.forEach(t=>t.used=!1),e},Is=(e,n)=>{const o=[];return e.dungeon.layout.grid.forEach((t,s)=>{yn(t).forEach((i,r)=>{i===n&&o.push(_n(e,r,s)||hn(e,r,s))})}),o.some(t=>t)},h=(e,n)=>Ke.get(e,n)??e,Rs=e=>{ce(e),localStorage.setItem("state",JSON.stringify(e)),E(e,"logs.gameSaved")},ce=e=>{e.reRender=!0,localStorage.setItem("reloadGuard",JSON.stringify(e))},ft=e=>(e.currentActor=e.heroes.find(n=>{var o;return n.name===((o=e.currentActor)==null?void 0:o.name)}),E(e,"logs.gameLoaded"),ce(e),e),dt=()=>{const e=structuredClone(ss),n={heroes:e.heroes,dungeon:e.dungeons[0],currentActor:e.heroes[0],actionLog:[{key:"logs.playingCampaign",properties:{name:h(e.name)},turn:0},{key:"logs.gameInitialized",turn:0},{key:"logs.initLogActions",turn:0},{key:"logs.initLogMoves",turn:0},{key:"logs.initLogMoveFinished",turn:0},{key:"logs.initLogUnfair",turn:0}],itemDeck:Sn(e.itemDeck),magicItemDeck:Sn(e.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:at(e.dungeons[0]),reRender:!0};return kn(n),localStorage.setItem("autosave",JSON.stringify(n)),n},Sn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e},yn=e=>{const n=[];for(let o=0;o<e.length;o++)n.push(e[o]);return n},tn=(e,n)=>{let o=[];for(let t=0;t<n;t++)o.push(Math.floor(Math.random()*6)+1);switch(e){case _e.APPRENTICE:o=o.filter(t=>t===5);break;case _e.KNIGHT:case _e.HERO:o=o.filter(t=>t>=4);break;case _e.LORD:case _e.MASTER:o=o.filter(t=>t>=3);break}return o.length},Xe=e=>{var n;return e.maxMovement-(((n=e.armour)==null?void 0:n.movementReduction)??0)},Ds=e=>e.dungeon.winConditions.filter(n=>n.type===ae.KILL_ALL).some(n=>n.fulfilled),Pn=e=>{if(e.settings.debug&&console.log(e),ce(e),Cs(e),e.currentActor===void 0)return e;{E(e,"logs.endedTurn",{name:h(e.currentActor.name)});let o=x(e).indexOf(e.currentActor)+1;if(o===x(e).length&&(as(e),o=0,Ko(e)),x(e).length===0)return Ms(e);x(e)[o].incapacitated&&(E(e,"logs.noLongerIncapacitated",{name:h(x(e)[o].name)}),x(e)[o].incapacitated=!1,o++),e.currentActor.actions=2,e.currentActor.movement=Xe(e.currentActor),e.currentActor=x(e)[o];const t=Ds(e);if(o===0&&!t){Os(e);const s=ut(e);e.currentEvent=s,ys[s.effect](e,s)}o===0&&(e.turnCount=(e.turnCount??0)+1),E(e,"logs.startedTurn",{name:h(e.currentActor.name)})}return e},Ms=e=>{const n=localStorage.getItem("autosave");if(n){const o=JSON.parse(n);return ce(o),Zo(o),kn(o),Wo(o),Ko(o),pt({x:o.dungeon.startingPositions[0].x,y:o.dungeon.startingPositions[0].y},o.settings.cellSize),o.currentActor=o.heroes.find(t=>{var s;return t.name===((s=o.currentActor)==null?void 0:s.name)}),E(o,"logs.allHeroesDead"),o}return E(e,"logs.failedToReset"),e},Cs=e=>{var n,o;e.dungeon.winConditions.forEach(t=>{var s;switch(t.type){case ae.KILL_ALL:{const i=e.dungeon.layout.monsters.map(r=>r.health).reduce((r,l)=>r+l,0);t.fulfilled=i<=0;break}case ae.REACH_CELL:{t.fulfilled=x(e).some(i=>{var r;return i.position.x===((r=t.targetCell)==null?void 0:r.x)&&i.position.y===t.targetCell.y});break}case ae.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(i=>i.type===t.targetMonsterType).some(i=>i.health>0);break}case ae.OPEN_DOOR:{t.fulfilled=((s=e.dungeon.layout.doors.find(i=>{var r,l;return i.x===((r=t.targetCell)==null?void 0:r.x)&&i.y===((l=t.targetCell)==null?void 0:l.y)}))==null?void 0:s.open)??!1;break}case ae.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}t.checkFulfilled&&(t.fulfilled=es[t.checkFulfilled](e,t))}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,s)=>t&&s,!0),e.dungeon.beaten&&(E(e,"logs.allConditionsFulfilled"),E(e,"logs.clearedDungeon",{name:h(e.dungeon.name)}),(n=e.dungeon.nextDungeon)!=null&&n.name&&E(e,"logs.moveToNext",{name:h((o=e.dungeon.nextDungeon)==null?void 0:o.name)}))},mt=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:Y.Red,maxHealth:0,name:"Door",level:_e.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:j.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),In=(e,n,o)=>{var s,i;let t=!0;if(n<0||n>=e.grid[0].length||o<0||o>=e.grid.length)t=!1;else{const r=(s=e.pits)==null?void 0:s.some(u=>ye(u,{x:n,y:o})),l=(i=e.pillars)==null?void 0:i.some(u=>ye(u,{x:n,y:o})),a=fe(e.grid,n,o);(r||l||a===vn||a===Ge)&&(t=!1)}return t},ln=(e,n,o)=>{const t=fe(e.layout.grid,n,o);return t?Se(e,t):!1},Se=(e,n)=>e.discoveredRooms.includes(n),fe=(e,n,o)=>{let t="";return e.forEach((s,i)=>{yn(s).forEach((r,l)=>{i===o&&l===n&&(t=r)})}),t},En=(e,n,o)=>e.x===n&&e.y===o||e.x===n-1&&e.y===o||e.x===n-1&&e.y===o-1||e.x===n&&e.y===o-1||e.x===n+1&&e.y===o-1||e.x===n+1&&e.y===o||e.x===n+1&&e.y===o+1||e.x===n&&e.y===o+1||e.x===n-1&&e.y===o+1,Ns=(e,n,o,t)=>{var i;const s=((i=t.armour)==null?void 0:i.defense)??t.defense;return`${e} damage (${n}-(${s}+${o})=${e})`},ye=(e,n)=>e.x===n.x&&e.y===n.y,E=(e,n,o)=>{e.actionLog=[{key:n,properties:o,turn:e.turnCount??0},...e.actionLog],ce(e)},$e=(e,n,o,t)=>{var A,O;let s=n.weapon;t&&n.rangedWeapon&&(s=n.rangedWeapon);let i=0,r=0;s.ignoresArmour?o.armour&&E(e,"logs.takeDamage.armourUseless",{actor:h(o.name),weapon:h(s.name)}):i=((A=o.armour)==null?void 0:A.defense)??o.defense,s.ignoresShield?o.shield&&E(e,"logs.takeDamage.shieldUseless",{actor:h(o.name),weapon:h(s.name)}):r=tn(o.level,((O=o.shield)==null?void 0:O.dice)??0);const l=n.inventory.filter(m=>{var p;return m&&((p=m==null?void 0:m.properties)==null?void 0:p[Xn])}).some(m=>{var p;return E(e,"logs.takeDamage.usedEffect",{actor:h(n.name),item:h(m.name)}),(p=m.properties)==null?void 0:p[Xn]}),a=n.inventory.filter(m=>{var p;return m&&((p=m==null?void 0:m.properties)==null?void 0:p[Vn])}).map(m=>{var p;return E(e,"logs.takeDamage.usedEffect",{actor:h(n.name),item:h(m.name)}),(p=m.properties)==null?void 0:p[Vn]}).reduce((m,p)=>m+p,0),u=n.blinded?1:0,c=n.weakened?1:0,d=n.weapon.elemental?1:0,y=a+d,_=u+c,B=tn(n.level,s.dice+y-_);let C=Math.max(B-(i+r),0);C===0&&l&&(E(e,"logs.takeDamage.reRoll",{actor:h(n.name)}),C=Math.max(B-(i+r),0)),o.health-=C,E(e,"logs.takeDamage.attackedWith",{actor:h(n.name),target:h(o.name),weapon:h(s.name),damage:Ns(C,B,r,o)}),o.health<=0&&(E(e,"logs.takeDamage.killed",{actor:h(n.name),target:h(o.name)}),o.health=0,o.level=_e.APPRENTICE)},pt=(e,n)=>{const o=document.getElementById("gameBoardContainer"),t=document.getElementById("gameBoard");if(o&&t){const s=e.x*n,i=e.y*n,r=t.offsetWidth,l=t.offsetHeight;o.scrollLeft=Math.round(s/r),o.scrollTop=Math.round(i/l)}},Ls=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=[{key:"logs.youHaveReached",properties:{name:h(e.dungeon.name)},turn:0}],e.eventDeck=at(e.dungeon),ce(e),Qt(e),Jt(e),Zo(e),kn(e),Wo(e),pt({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize),localStorage.setItem("autosave",JSON.stringify(e)))},fn=(e,n)=>Math.sqrt(Math.pow(e.x-(n==null?void 0:n.x),2)+Math.pow(e.y-(n==null?void 0:n.y),2)),Kn=(e,n,o,t,s)=>{const i={x:e.x*o-Math.floor(o/2),y:e.y*o-Math.floor(o/2)},r={x:n.x*o-Math.floor(o/2),y:n.y*o-Math.floor(o/2)};return Yn(i,e,r,n,o,t,s,[])},Yn=(e,n,o,t,s,i,r,l)=>{var C,A;if(isNaN(e.x)||isNaN(e.y))return!1;const a=Hs(e,o),u={x:Math.round((a.x+Math.floor(s/2))/s),y:Math.round((a.y+Math.floor(s/2))/s)};if(isNaN(u.x)||isNaN(u.y)||isNaN(a.x)||isNaN(a.y))return!1;const c=fe(i.dungeon.layout.grid,u.x,u.y),d=(C=i.dungeon.layout.pits)==null?void 0:C.some(O=>ye(O,u)),y=(A=i.dungeon.layout.pillars)==null?void 0:A.some(O=>ye(O,u)),_=i.dungeon.layout.monsters.some(O=>ye(O.position,u)),B=x(i).filter(O=>!ye(O.position,n)).some(O=>ye(O.position,u));return u.x===t.x&&u.y===t.y?(l.push(u),!0):y||_||!r&&B||c===Ge||c===rn||r&&(d||c===vn)?!1:(u.x===n.x&&u.y===n.y||l.some(O=>O.x===u.x&&O.y===u.y)||l.push(u),Yn(a,n,o,t,s,i,r,l))},Hs=(e,n)=>{const o=e.x,t=e.y,s=n.x-o,i=n.y-t,r=s/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),l=i/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),a=Math.round(r+o),u=Math.round(l+t);return{x:a,y:u}},gt=(e,n)=>x(e).filter(o=>En(n.position,o.position.x,o.position.y)),ws=""+new URL("../assets/DungeonTiles.f8e0e475.png",import.meta.url).href,Ps="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",Bs=(e,n,o,t,s)=>{x(t).forEach(r=>{Gs(e,r,n,o,s)}),Ks(e,t,o),Ys(e,t,o)},Gs=(e,n,o,t,s)=>{const i=n.position.x,r=n.position.y;if(e.drawImage(o,4*16,0,16,16,i*t,r*t,t,t),Us(e,n,i,r,t),Ws(e,n,i,r,t),Fs(e,n,i,r,t),s){const l=`(${i},${r})`;e.fillStyle="black",e.font="8px Arial",e.fillText(l,i*t+3,r*t+10)}},Us=(e,n,o,t,s)=>{const i=e.fillStyle,r=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let l=0;l<n.actions;l++)e.fillRect(o*s+4+6*l,t*s+s-12,5,5),e.rect(o*s+4+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle="blue";for(let l=0;l<n.movement;l++)e.fillRect(o*s+s-22+6*l,t*s+s-12,5,5),e.rect(o*s+s-22+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle=i,e.strokeStyle=r},Fs=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(o*s+4,t*s,s-8,4),e.fillStyle="green",e.fillRect(o*s+4,t*s,(s-8)*(n.health/n.maxHealth),4),e.rect(o*s+4,t*s,s-8,4),e.stroke()},Ws=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(o*s+4,t*s+(s-6),s-8,4),e.stroke()},Ks=(e,n,o)=>{const t=n.currentActor;if(t){for(let s=t.position.x-t.movement;s<=t.position.x+t.movement;s++)for(let i=t.position.y-t.movement;i<=t.position.y+t.movement;i++)if(ln(n.dungeon,s,i)&&!(s===(t==null?void 0:t.position.x)&&i===(t==null?void 0:t.position.y))){const l=hn(n,s,i),a=_n(n,s,i),u=In(n.dungeon.layout,s,i),c=Kn(t.position,{x:s,y:i},2,n,!0);!a&&!l&&u&&c&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(s*o,i*o,o,o),e.stroke())}}},Ys=(e,n,o)=>{const t=n.currentActor;t&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o+o/3,t.position.y*o),e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o,t.position.y*o+o/3),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3,t.position.y*o+o),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o+o),e.stroke(),e.lineWidth=1)},Vs=(e,n,o,t,s)=>{t.dungeon.layout.monsters.forEach(i=>{qs(e,n,t,i,o,s)})},qs=(e,n,o,t,s,i)=>{const r=o.dungeon.layout.grid[t.position.y][t.position.x];if(t&&t.health>0&&Se(o.dungeon,r)){switch(t.type){case U.ORCH:Xs(e,n,s,t);break;case U.TROLL:Js(e,n,s,t);break;default:Qs(e,n,s,t);break}Zs(e,t,s),js(e,t,s),xs(e,t,o.heroes,o,s,i)}},Xs=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},Js=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},Qs=(e,n,o,t)=>{e.drawImage(n,16,16,16,16,t.position.x*o,t.position.y*o,o,o)},Zs=(e,n,o)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(n.position.x*o+4,n.position.y*o+(o-6),o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},js=(e,n,o)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n.position.x*o+4,n.position.y*o,o-8,4),e.fillStyle="green",e.fillRect(n.position.x*o+4,n.position.y*o,(o-8)*(n.health/n.maxHealth),4),e.rect(n.position.x*o+4,n.position.y*o,o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},xs=(e,n,o,t,s,i)=>{i&&o.forEach(r=>{const l=[],a={x:n.position.x*48-24,y:n.position.y*48-24},u={x:r.position.x*48-24,y:r.position.y*48-24};if(Yn(a,n.position,u,r.position,48,t,!1,l)){const d=n.position.x,y=n.position.y,_=r.position.x,B=r.position.y;e.beginPath(),e.strokeStyle=n.colour,e.lineWidth=2,e.moveTo(d*s+s/2,y*s+s/2),e.lineTo(_*s+s/2,B*s+s/2),e.stroke(),e.lineWidth=1}})},Bn="#1E1C19",Ss=(e,n,o,t,s)=>{t.dungeon.layout.doors.forEach(i=>{fi(e,n,o,t,i,s)})},$s=(e,n,o,t,s)=>{t.dungeon.layout.grid.forEach((i,r)=>{yn(i).forEach((l,a)=>{si(e,n,t,l,a,r,o),ai(e,l,t,a,r,o,s)})}),ni(e,n,o,t,s)},zs=(e,n,o,t,s)=>{t.dungeon.layout.secrets.filter(i=>i.found).forEach(i=>{switch(i.type){case ie.TRAP_DOOR:ri(e,n,o,i);break;default:li(e,n,o,i);break}}),t.dungeon.layout.secrets.filter(i=>!i.found).forEach(i=>{if(e.globalAlpha=.6,J(e,n,9,0,o,i.position.x,i.position.y,t),e.globalAlpha=1,s){const r=`${i.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(i.position.x*o,i.position.y*o,o,o),e.fillStyle="black",e.font="12px Arial",e.fillText(r,i.position.x*o,i.position.y*o+10)}})},J=(e,n,o,t,s,i,r,l)=>{l.dungeon.discoveredRooms.some(a=>$n(i,r,a,l))||$n(i,r,rn,l)?e.drawImage(n,o*48,t*48,48,48,i*s,r*s,s,s):yt(e,i,r,s)},ei=(e,n,o,t,s,i,r)=>{switch(o){case H.INNER_BOTTOM_LEFT:{J(e,n,0,6,t,s,i,r);break}case H.INNER_BOTTOM_RIGHT:{J(e,n,4,6,t,s,i,r);break}case H.INNER_TOP_LEFT:{J(e,n,0,4,t,s,i,r);break}case H.INNER_TOP_RIGHT:{J(e,n,4,4,t,s,i,r);break}case H.OUTER_TOP_RIGHT:{J(e,n,4,0,t,s,i,r);break}case H.OUTER_TOP_LEFT:{J(e,n,0,0,t,s,i,r);break}case H.OUTER_BOTTOM_RIGHT:case H.RIGHT_END:{J(e,n,4,2,t,s,i,r);break}case H.OUTER_BOTTOM_LEFT:case H.LEFT_END:{J(e,n,0,2,t,s,i,r);break}case H.BOTTOM_END:{J(e,n,2,4,t,s,i,r);break}case H.TOP_END:{J(e,n,4,7,t,s,i,r);break}case H.THREE_WAY_INTERSECTION_UP:{J(e,n,4,8,t,s,i,r);break}default:J(e,n,15,0,t,s,i,r);break}},ni=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pits)==null?void 0:i.filter(l=>ln(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{J(e,n,13,0,o,l.x,l.y,t)})},oi=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pillars)==null?void 0:i.filter(l=>ln(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{J(e,n,7,2,o,l.x,l.y,t),e.globalAlpha=.4,J(e,n,7,1,o,l.x,l.y-1,t),e.globalAlpha=1})},ti=e=>{let n,o;return e/100>2?(n=1,o=5):e/100>1.8?(n=11,o=0):e/100>1?(n=10,o=0):e/100===1?(n=12,o=0):(n=8,o=0),{rndX:n,rndY:o}},si=(e,n,o,t,s,i,r)=>{if(ii(t,o))if(t===rn)J(e,n,0,0,r,s,i,o),J(e,n,2,0,r,s,i,o);else{const l=vt(s,i,o);if(l!==H.NOT_CORNER)ei(e,n,l,r,s,i,o);else{const a=_t(s,i,o),u=ht(s,i,o);u!=="none"&&a==="none"?u==="up"?J(e,n,1,0,r,s,i,o):u==="down"?J(e,n,2,4,r,s,i,o):J(e,n,0,2,r,s,i,o):a!=="none"&&(a==="left"?J(e,n,4,5,r,s,i,o):a==="right"?J(e,n,0,5,r,s,i,o):J(e,n,5,7,r,s,i,o))}}else if(ze(t,o))yt(e,s,i,r);else{const l=(s+i)*10,{rndX:a,rndY:u}=ti(l);J(e,n,a,u,r,s,i,o)}},ht=(e,n,o)=>{const t=o.dungeon.layout.grid;if(fe(t,e,n)!==Ge||e===0||e===t[0].length-1)return"none";const s=fe(t,e-1,n),i=fe(t,e+1,n);if(s===Ge||ze(s,o)||i===Ge||ze(i,o)){const l=fe(t,e,n-1),a=fe(t,e,n+1);return xe(l,o)&&xe(a,o)?"both":xe(l,o)?"up":xe(a,o)?"down":"none"}else return"none"},_t=(e,n,o)=>{const t=o.dungeon.layout.grid;if(fe(t,e,n)!==Ge||n===0||n===t.length-1)return"none";const s=fe(t,e,n-1),i=fe(t,e,n+1);if(s===Ge||ze(s,o)||i===Ge||ze(i,o)){const l=fe(t,e-1,n),a=fe(t,e+1,n);return xe(l,o)&&xe(a,o)?"both":xe(l,o)?"left":xe(a,o)?"right":"none"}else return"none"},vt=(e,n,o)=>{const t=o.dungeon.layout.corners.filter(s=>ye(s.position,{x:e,y:n}));return t.length===1?t[0].type:H.NOT_CORNER},ii=(e,n)=>di(e)||!Se(n.dungeon,e)&&e!==vn,xe=(e,n)=>n.dungeon.discoveredRooms.includes(e),yt=(e,n,o,t)=>{e.beginPath(),e.strokeStyle=Bn,e.fillStyle=Bn,e.fillRect(n*t,o*t,t,t),e.stroke()},ri=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,48*6,48*7,48,48,s*o,i*o,o,o)},li=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,4*48,0,48,48,s*o,i*o,o,o)},ai=(e,n,o,t,s,i,r)=>{if(!(!r&&(ze(n,o)||n===Ge))){if(e.beginPath(),e.strokeStyle="black",e.rect(t*i,s*i,i,i),r){const l=ht(t,s,o),a=_t(t,s,o),u=vt(t,s,o);let c=`${n}: ${t},${s}`;u!==H.NOT_CORNER?c+=` C ${u.valueOf()}`:l!="none"?c+=" H "+l[0]:a!=="none"&&(c+=" V "+a[0]),e.font="7px Arial",e.fillText(c,t*i+3,s*i+(i-3))}e.stroke()}},ui=(e,n,o,t,s)=>{switch(e.side){case v.RIGHT:{J(n,o,4,5,t,e.x+1,e.y,s),J(n,o,4,5,t,e.x+1,e.y-1,s),J(n,o,4,5,t,e.x+1,e.y+1,s);break}case v.LEFT:{J(n,o,0,5,t,e.x-1,e.y,s),J(n,o,0,5,t,e.x-1,e.y-1,s),J(n,o,0,5,t,e.x-1,e.y+1,s);break}case v.UP:{J(n,o,2,4,t,e.x,e.y-1,s),J(n,o,2,4,t,e.x+1,e.y-1,s),J(n,o,2,4,t,e.x-1,e.y-1,s);break}case v.DOWN:{J(n,o,2,6,t,e.x,e.y+1,s),J(n,o,2,6,t,e.x+1,e.y+1,s),J(n,o,2,6,t,e.x-1,e.y+1,s);break}}},ci=(e,n,o,t,s)=>{switch(e.side){case v.RIGHT:{J(n,o,4,5,t,e.x+1,e.y,s);break}case v.LEFT:{J(n,o,0,5,t,e.x-1,e.y,s);break}case v.UP:{J(n,o,2,4,t,e.x,e.y-1,s);break}case v.DOWN:{J(n,o,2,6,t,e.x,e.y+1,s);break}}},fi=(e,n,o,t,s,i)=>{const r=t.dungeon.layout.grid[s.y][s.x];if(s&&!s.open&&(s.hidden?ui(s,e,n,o,t):ci(s,e,n,o,t)),s&&!s.hidden&&!s.open&&!ze(r,t))switch(e.fillStyle="brown",s.side){case v.RIGHT:{e.fillRect(s.x*o+(o-2),s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o-4),s.y*o+(o/2-4),8,8));break}case v.LEFT:{e.fillRect(s.x*o-2,s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o-4,s.y*o+(o/2-4),8,8));break}case v.UP:{J(e,n,13,1,o,s.x,s.y-1,t),e.fillRect(s.x*o,s.y*o-2,o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o-4,8,8));break}case v.DOWN:{e.fillRect(s.x*o,s.y*o+(o-2),o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o+(o-4),8,8));break}}i&&!ze(r,t)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${s.hidden?"H":"-"}/${s.trapped?`T${s.trapAttacks}`:"-"}/${s.locked?"L":"-"}]`,s.x*o,s.y*o+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(s.x*o,s.y*o,o,o))},di=e=>e===Ge,ze=(e,n)=>e===vn||!Se(n.dungeon,e),$n=(e,n,o,t)=>{if(!t)return;const s=Math.max(e-1,0),i=Math.max(n-1,0),r=Math.min(n+1,t.dungeon.layout.grid.length-1),l=Math.min(e+1,t.dungeon.layout.grid[0].length-1);for(let a=s;a<=l;a++)for(let u=i;u<=r;u++){const c=t.dungeon.layout.grid[u];if(yn(c)[a]===o)return!0}return!1},Et=(e,n,o,t)=>{const s=n.match(/.{1,30}(?:\s|$)/g),i=o.x*t,r=o.y*t+t,l=Math.max((s==null?void 0:s.length)??0,1)*(t/2.5);e.fillStyle="rgba(82,11,159,0.8)",e.beginPath(),e.roundRect(i,r,t*4,l,[0,30,30,30]),e.stroke(),e.fill(),e.font="12px Arial",e.fillStyle="wheat",s==null||s.forEach((a,u)=>{e.fillText(a,i+10,r+14*(u+1))})},mi=(e,n,o,t,s)=>{if(s&&t.dungeon.layout.notes.forEach(l=>{e.font="7px Arial",e.fillStyle="black",e.fillText("N",l.position.x*o+o/2,l.position.y*o+o/2),e.fillStyle="rgba(120, 50, 5, 0.12)",e.fillRect(l.position.x*o,l.position.y*o,o,o)}),!t.currentActor)return;const i=t.currentActor,r=t.dungeon.layout.notes.find(l=>ye(l.position,i.position));if(r&&!t.dungeon.layout.doors.some(a=>a.hidden&&ye(r.position,{x:a.x,y:a.y}))){const a=h(r.message);Et(e,a,r.position,o)}},pi=(e,n,o,t,s)=>{t.dungeon.layout.items.forEach(i=>{if(!(!ln(t.dungeon,i.position.x,i.position.y)&&!s))switch(i.item.type){case j.MAGIC:zn(e,n,o,t,i);break;case j.WEAPON:zn(e,n,o,t,i)}})},zn=(e,n,o,t,s)=>{const i=s.position.x,r=s.position.y;if(e.drawImage(n,48*6,48*3,48,48,i*o,r*o,o,o),!t.currentActor)return;const l=t.currentActor;if(ye(l==null?void 0:l.position,s.position)){const a=h(s.item.name);Et(e,a,s.position,o)}};function eo(e){let n,o,t=e[2](e[0])+"",s,i;return{c(){n=N("p"),o=D(" "),s=D(t),this.h()},l(r){n=L(r,"P",{class:!0});var l=w(n);o=M(l," "),s=M(l,t),l.forEach(f),this.h()},h(){I(n,"class",i=An(e[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")},m(r,l){b(r,n,l),g(n,o),g(n,s)},p(r,l){l&1&&t!==(t=r[2](r[0])+"")&&q(s,t),l&1&&i!==(i=An(r[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")&&I(n,"class",i)},d(r){r&&f(n)}}}function gi(e){let n=e[1],o,t=eo(e);return{c(){t.c(),o=de()},l(s){t.l(s),o=de()},m(s,i){t.m(s,i),b(s,o,i)},p(s,[i]){i&2&&ve(n,n=s[1])?(t.d(1),t=eo(s),t.c(),t.m(o.parentNode,o)):t.p(s,i)},i:Te,o:Te,d(s){s&&f(o),t.d(s)}}}function hi(e,n,o){let t;Je(e,Ke,u=>o(4,t=u));let{condition:s}=n,{state:i}=n,r=!1;const l=u=>{let c="";switch(u.additionalDescription&&(c=` ${t(u.additionalDescription)}`),u.type){case ae.KILL_ALL:return t("content.winConditions.killAll")+c;case ae.KILL_ALL_OF_TYPE:return t("content.winConditions.killAll",{type:u.targetMonsterType})+c;case ae.KILL_AT_LEAST:return t("content.winConditions.killAtLeast",{minKills:u.killMinCount})+` (${i.dungeon.killCount}/${u.killMinCount})`+c;case ae.OPEN_DOOR:return t("content.winConditions.openDoor")+c;case ae.REACH_CELL:return t("content.winConditions.reachCell")+c}};gn(()=>{a(),setInterval(a,100)});const a=()=>{i.reRender&&o(1,r=!r)};return e.$$set=u=>{"condition"in u&&o(0,s=u.condition),"state"in u&&o(3,i=u.state)},[s,r,l,i]}class _i extends we{constructor(n){super(),Pe(this,n,hi,gi,ve,{condition:0,state:3})}}function no(e){let n,o,t,s,i,r,l=e[0].number+"",a,u,c=e[2](e[0].name)+"",d,y,_,B;function C(T,R){return T[1]?yi:vi}let A=C(e),O=A(e),m=e[1]&&oo(e),p=e[1]&&to(e);return{c(){n=N("div"),o=N("button"),O.c(),t=$(),m&&m.c(),s=$(),i=N("div"),r=N("span"),a=D(l),u=D(". "),d=D(c),y=$(),p&&p.c(),this.h()},l(T){n=L(T,"DIV",{});var R=w(n);o=L(R,"BUTTON",{class:!0});var P=w(o);O.l(P),P.forEach(f),t=z(R),m&&m.l(R),R.forEach(f),s=z(T),i=L(T,"DIV",{});var oe=w(i);r=L(oe,"SPAN",{class:!0});var ue=w(r);a=M(ue,l),u=M(ue,". "),d=M(ue,c),ue.forEach(f),y=z(oe),p&&p.l(oe),oe.forEach(f),this.h()},h(){I(o,"class","hideEventButton svelte-4rf9ww"),I(r,"class","svelte-4rf9ww")},m(T,R){b(T,n,R),g(n,o),O.m(o,null),g(n,t),m&&m.m(n,null),b(T,s,R),b(T,i,R),g(i,r),g(r,a),g(r,u),g(r,d),g(i,y),p&&p.m(i,null),_||(B=Le(o,"click",e[3]),_=!0)},p(T,R){A===(A=C(T))&&O?O.p(T,R):(O.d(1),O=A(T),O&&(O.c(),O.m(o,null))),T[1]?m?m.p(T,R):(m=oo(T),m.c(),m.m(n,null)):m&&(m.d(1),m=null),R&1&&l!==(l=T[0].number+"")&&q(a,l),R&5&&c!==(c=T[2](T[0].name)+"")&&q(d,c),T[1]?p?p.p(T,R):(p=to(T),p.c(),p.m(i,null)):p&&(p.d(1),p=null)},d(T){T&&(f(n),f(s),f(i)),O.d(),m&&m.d(),p&&p.d(),_=!1,B()}}}function vi(e){let n=e[2]("content.winConditions.buttonOpen")+"",o;return{c(){o=D(n)},l(t){o=M(t,n)},m(t,s){b(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonOpen")+"")&&q(o,n)},d(t){t&&f(o)}}}function yi(e){let n=e[2]("content.winConditions.buttonClose")+"",o;return{c(){o=D(n)},l(t){o=M(t,n)},m(t,s){b(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonClose")+"")&&q(o,n)},d(t){t&&f(o)}}}function oo(e){let n,o=e[2]("content.event.current")+"",t;return{c(){n=N("p"),t=D(o),this.h()},l(s){n=L(s,"P",{class:!0});var i=w(n);t=M(i,o),i.forEach(f),this.h()},h(){I(n,"class","svelte-4rf9ww")},m(s,i){b(s,n,i),g(n,t)},p(s,i){i&4&&o!==(o=s[2]("content.event.current")+"")&&q(t,o)},d(s){s&&f(n)}}}function to(e){let n,o=e[2](e[0].description)+"",t;return{c(){n=N("p"),t=D(o),this.h()},l(s){n=L(s,"P",{class:!0});var i=w(n);t=M(i,o),i.forEach(f),this.h()},h(){I(n,"class","svelte-4rf9ww")},m(s,i){b(s,n,i),g(n,t)},p(s,i){i&5&&o!==(o=s[2](s[0].description)+"")&&q(t,o)},d(s){s&&f(n)}}}function Ei(e){let n,o,t=e[0]&&no(e);return{c(){n=N("div"),t&&t.c(),this.h()},l(s){n=L(s,"DIV",{class:!0});var i=w(n);t&&t.l(i),i.forEach(f),this.h()},h(){I(n,"class",o="event "+(e[1]?"eventOpen":"")+" svelte-4rf9ww")},m(s,i){b(s,n,i),t&&t.m(n,null)},p(s,[i]){s[0]?t?t.p(s,i):(t=no(s),t.c(),t.m(n,null)):t&&(t.d(1),t=null),i&2&&o!==(o="event "+(s[1]?"eventOpen":"")+" svelte-4rf9ww")&&I(n,"class",o)},i:Te,o:Te,d(s){s&&f(n),t&&t.d()}}}function Oi(e,n,o){let t;Je(e,Ke,l=>o(2,t=l));let{event:s}=n,i=!0;const r=()=>o(1,i=!i);return e.$$set=l=>{"event"in l&&o(0,s=l.event)},[s,i,t,r]}class Ai extends we{constructor(n){super(),Pe(this,n,Oi,Ei,ve,{event:0})}}function so(e,n,o){const t=e.slice();return t[15]=n[o],t[16]=n,t[17]=o,t}function bi(e){let n=e[2]("content.winConditions.buttonOpen")+"",o;return{c(){o=D(n)},l(t){o=M(t,n)},m(t,s){b(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonOpen")+"")&&q(o,n)},d(t){t&&f(o)}}}function Ti(e){let n=e[2]("content.winConditions.buttonClose")+"",o;return{c(){o=D(n)},l(t){o=M(t,n)},m(t,s){b(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonClose")+"")&&q(o,n)},d(t){t&&f(o)}}}function io(e){let n,o,t=He(e[0].dungeon.winConditions.sort(uo)),s=[];for(let r=0;r<t.length;r+=1)s[r]=ro(so(e,t,r));const i=r=>ee(s[r],1,1,()=>{s[r]=null});return{c(){n=N("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){n=L(r,"DIV",{class:!0});var l=w(n);for(let a=0;a<s.length;a+=1)s[a].l(l);l.forEach(f),this.h()},h(){I(n,"class","conditionsDiv svelte-qsh3al")},m(r,l){b(r,n,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,null);o=!0},p(r,l){if(l&1){t=He(r[0].dungeon.winConditions.sort(uo));let a;for(a=0;a<t.length;a+=1){const u=so(r,t,a);s[a]?(s[a].p(u,l),Z(s[a],1)):(s[a]=ro(u),s[a].c(),Z(s[a],1),s[a].m(n,null))}for(Fe(),a=t.length;a<s.length;a+=1)i(a);We()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)Z(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)ee(s[l]);o=!1},d(r){r&&f(n),sn(s,r)}}}function ro(e){let n,o,t,s;function i(a){e[8](a,e[15],e[16],e[17])}function r(a){e[9](a)}let l={};return e[15]!==void 0&&(l.condition=e[15]),e[0]!==void 0&&(l.state=e[0]),n=new _i({props:l}),Oe.push(()=>be(n,"condition",i)),Oe.push(()=>be(n,"state",r)),{c(){Re(n.$$.fragment)},l(a){De(n.$$.fragment,a)},m(a,u){Me(n,a,u),s=!0},p(a,u){e=a;const c={};!o&&u&1&&(o=!0,c.condition=e[15],Ae(()=>o=!1)),!t&&u&1&&(t=!0,c.state=e[0],Ae(()=>t=!1)),n.$set(c)},i(a){s||(Z(n.$$.fragment,a),s=!0)},o(a){ee(n.$$.fragment,a),s=!1},d(a){Ce(n,a)}}}function lo(e){let n,o,t;return o=new Ai({props:{event:e[0].currentEvent}}),{c(){n=N("div"),Re(o.$$.fragment)},l(s){n=L(s,"DIV",{});var i=w(n);De(o.$$.fragment,i),i.forEach(f)},m(s,i){b(s,n,i),Me(o,n,null),t=!0},p(s,i){const r={};i&1&&(r.event=s[0].currentEvent),o.$set(r)},i(s){t||(Z(o.$$.fragment,s),t=!0)},o(s){ee(o.$$.fragment,s),t=!1},d(s){s&&f(n),Ce(o)}}}function ki(e){let n,o,t,s,i,r,l,a,u,c,d,y;function _(m,p){return m[1]?Ti:bi}let B=_(e),C=B(e),A=e[1]&&io(e),O=e[0].currentEvent&&lo(e);return{c(){n=N("div"),o=N("canvas"),t=$(),s=N("div"),i=N("div"),r=N("button"),C.c(),l=$(),A&&A.c(),u=$(),O&&O.c(),this.h()},l(m){n=L(m,"DIV",{style:!0,class:!0,id:!0});var p=w(n);o=L(p,"CANVAS",{width:!0,height:!0,id:!0}),w(o).forEach(f),t=z(p),s=L(p,"DIV",{class:!0});var T=w(s);i=L(T,"DIV",{class:!0});var R=w(i);r=L(R,"BUTTON",{class:!0});var P=w(r);C.l(P),P.forEach(f),R.forEach(f),l=z(T),A&&A.l(T),T.forEach(f),u=z(p),O&&O.l(p),p.forEach(f),this.h()},h(){I(o,"width",e[3]*40),I(o,"height",e[3]*30),I(o,"id","gameBoard"),I(r,"class","hideConditionsButton svelte-qsh3al"),I(i,"class","buttonDiv svelte-qsh3al"),I(s,"class",a="winConditions "+(e[1]?"":"conditionsHidden")+" svelte-qsh3al"),I(n,"style",e[5]()),I(n,"class","dungeon svelte-qsh3al"),I(n,"id","gameBoardContainer")},m(m,p){b(m,n,p),g(n,o),g(n,t),g(n,s),g(s,i),g(i,r),C.m(r,null),g(s,l),A&&A.m(s,null),g(n,u),O&&O.m(n,null),c=!0,d||(y=[Le(o,"click",e[4]),Le(r,"click",e[7])],d=!0)},p(m,[p]){B===(B=_(m))&&C?C.p(m,p):(C.d(1),C=B(m),C&&(C.c(),C.m(r,null))),m[1]?A?(A.p(m,p),p&2&&Z(A,1)):(A=io(m),A.c(),Z(A,1),A.m(s,null)):A&&(Fe(),ee(A,1,1,()=>{A=null}),We()),(!c||p&2&&a!==(a="winConditions "+(m[1]?"":"conditionsHidden")+" svelte-qsh3al"))&&I(s,"class",a),m[0].currentEvent?O?(O.p(m,p),p&1&&Z(O,1)):(O=lo(m),O.c(),Z(O,1),O.m(n,null)):O&&(Fe(),ee(O,1,1,()=>{O=null}),We())},i(m){c||(Z(A),Z(O),c=!0)},o(m){ee(A),ee(O),c=!1},d(m){m&&f(n),C.d(),A&&A.d(),O&&O.d(),d=!1,Gn(y)}}}const ao=10,uo=(e,n)=>e.fulfilled===n.fulfilled?0:e.fulfilled?1:-1;function Ii(e,n,o){var m;let t;Je(e,Ke,p=>o(2,t=p));let{state:s}=n,{debugMode:i}=n,r=!0,l,a;const u=(s==null?void 0:s.settings.cellSize)??48;let c=0,d=0;a=window.innerHeight,l=((m=document.getElementById("footer"))==null?void 0:m.offsetHeight)??0,gn(()=>{var oe;const p=new Image;p.src=ws;const T=new Image;T.src=Ps;const R=window.devicePixelRatio,P=document.getElementById("gameBoard");P.width=u*40*R,P.height=u*30*R,P.style.width=`${u*40}px`,P.style.height=`${u*30}px`,(oe=P.getContext("2d"))==null||oe.scale(R,R),setInterval(()=>y(p,T),10)});const y=(p,T)=>{if(!s||!document)return;const R=document.getElementById("gameBoard"),P=R.getContext("2d");s.reRender&&(d++,c++,P.clearRect(0,0,R.width,R.height),P.fillStyle=Bn,P.fillRect(0,0,R.width,R.height),$s(P,p,u,s,i),zs(P,p,u,s,i),pi(P,p,u,s,i),Ss(P,p,u,s,i),Vs(P,T,u,s,i),Bs(P,T,u,s,i),mi(P,T,u,s,i),oi(P,p,u,s,i),i&&(P.fillStyle="white",P.font="8px Arial",P.fillText(`Re-renders: ${c}`,2,10),P.fillText(`FPS: ${d/(ao/1e3)}`,2,20)),setTimeout(()=>{o(0,s.reRender=!1,s),d=0},ao))},_=p=>{ls(p,u,s)},B=()=>`max-height: ${a-l-20}px; max-width: ${u*40}`,C=()=>o(1,r=!r);function A(p,T,R,P){R[P]=p,o(0,s)}function O(p){s=p,o(0,s)}return e.$$set=p=>{"state"in p&&o(0,s=p.state),"debugMode"in p&&o(6,i=p.debugMode)},[s,r,t,u,_,B,i,C,A,O]}class Ri extends we{constructor(n){super(),Pe(this,n,Ii,ki,ve,{state:0,debugMode:6})}}function Di(e){let n,o=e[2]("content.inventory.uses")+"",t;return{c(){n=N("button"),t=D(o),this.h()},l(s){n=L(s,"BUTTON",{class:!0});var i=w(n);t=M(i,o),i.forEach(f),this.h()},h(){n.disabled=!0,I(n,"class","svelte-gca2x5")},m(s,i){b(s,n,i),g(n,t)},p(s,i){i&4&&o!==(o=s[2]("content.inventory.uses")+"")&&q(t,o)},d(s){s&&f(n)}}}function Mi(e){let n,o=e[2]("content.inventory.use")+"",t,s,i;return{c(){n=N("button"),t=D(o),this.h()},l(r){n=L(r,"BUTTON",{class:!0});var l=w(n);t=M(l,o),l.forEach(f),this.h()},h(){I(n,"class","svelte-gca2x5")},m(r,l){b(r,n,l),g(n,t),s||(i=Le(n,"click",e[3]),s=!0)},p(r,l){l&4&&o!==(o=r[2]("content.inventory.use")+"")&&q(t,o)},d(r){r&&f(n),s=!1,i()}}}function Ci(e){var O;let n,o="",t,s,i,r=e[2](e[0].name)+"",l,a,u,c=e[2]((O=e[0].properties)==null?void 0:O[Jn])+"",d,y,_;function B(m,p){var T,R,P;if((T=m[0].properties)!=null&&T[bn]&&!((R=m[0].properties)!=null&&R[qe]))return Mi;if((P=m[0].properties)!=null&&P[bn])return Di}let C=B(e),A=C&&C(e);return{c(){n=N("div"),n.innerHTML=o,t=$(),s=N("div"),i=N("b"),l=D(r),a=$(),u=N("span"),d=D(c),y=$(),_=N("div"),A&&A.c(),this.h()},l(m){n=L(m,"DIV",{class:!0,"data-svelte-h":!0}),Ho(n)!=="svelte-pn8o3r"&&(n.innerHTML=o),t=z(m),s=L(m,"DIV",{class:!0});var p=w(s);i=L(p,"B",{class:!0});var T=w(i);l=M(T,r),T.forEach(f),a=z(p),u=L(p,"SPAN",{class:!0});var R=w(u);d=M(R,c),R.forEach(f),p.forEach(f),y=z(m),_=L(m,"DIV",{class:!0});var P=w(_);A&&A.l(P),P.forEach(f),this.h()},h(){I(n,"class","item item-icon svelte-gca2x5"),I(i,"class","svelte-gca2x5"),I(u,"class","svelte-gca2x5"),I(s,"class","item item-description bottom-border svelte-gca2x5"),I(_,"class","item item-action svelte-gca2x5")},m(m,p){b(m,n,p),b(m,t,p),b(m,s,p),g(s,i),g(i,l),g(s,a),g(s,u),g(u,d),b(m,y,p),b(m,_,p),A&&A.m(_,null)},p(m,[p]){var T;p&5&&r!==(r=m[2](m[0].name)+"")&&q(l,r),p&5&&c!==(c=m[2]((T=m[0].properties)==null?void 0:T[Jn])+"")&&q(d,c),C===(C=B(m))&&A?A.p(m,p):(A&&A.d(1),A=C&&C(m),A&&(A.c(),A.m(_,null)))},i:Te,o:Te,d(m){m&&(f(n),f(t),f(s),f(y),f(_)),A&&A.d()}}}function Ni(e,n,o){let t;Je(e,Ke,l=>o(2,t=l));let{item:s}=n,{state:i}=n;const r=()=>Ct(i,s);return e.$$set=l=>{"item"in l&&o(0,s=l.item),"state"in l&&o(1,i=l.state)},[s,i,t,r]}class Li extends we{constructor(n){super(),Pe(this,n,Ni,Ci,ve,{item:0,state:1})}}function co(e,n,o){const t=e.slice();return t[6]=n[o],t[7]=n,t[8]=o,t}function fo(e){let n,o,t;function s(r){e[4](r,e[6],e[7],e[8])}let i={state:e[1]};return e[6]!==void 0&&(i.item=e[6]),n=new Li({props:i}),Oe.push(()=>be(n,"item",s)),{c(){Re(n.$$.fragment)},l(r){De(n.$$.fragment,r)},m(r,l){Me(n,r,l),t=!0},p(r,l){e=r;const a={};l&2&&(a.state=e[1]),!o&&l&1&&(o=!0,a.item=e[6],Ae(()=>o=!1)),n.$set(a)},i(r){t||(Z(n.$$.fragment,r),t=!0)},o(r){ee(n.$$.fragment,r),t=!1},d(r){Ce(n,r)}}}function mo(e){let n,o,t=e[6]&&fo(e);return{c(){t&&t.c(),n=de()},l(s){t&&t.l(s),n=de()},m(s,i){t&&t.m(s,i),b(s,n,i),o=!0},p(s,i){s[6]?t?(t.p(s,i),i&1&&Z(t,1)):(t=fo(s),t.c(),Z(t,1),t.m(n.parentNode,n)):t&&(Fe(),ee(t,1,1,()=>{t=null}),We())},i(s){o||(Z(t),o=!0)},o(s){ee(t),o=!1},d(s){s&&f(n),t&&t.d(s)}}}function po(e){let n,o,t=He(e[0]),s=[];for(let r=0;r<t.length;r+=1)s[r]=mo(co(e,t,r));const i=r=>ee(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);n=de()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);b(r,n,l),o=!0},p(r,l){if(l&3){t=He(r[0]);let a;for(a=0;a<t.length;a+=1){const u=co(r,t,a);s[a]?(s[a].p(u,l),Z(s[a],1)):(s[a]=mo(u),s[a].c(),Z(s[a],1),s[a].m(n.parentNode,n))}for(Fe(),a=t.length;a<s.length;a+=1)i(a);We()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)Z(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)ee(s[l]);o=!1},d(r){r&&f(n),sn(s,r)}}}function Hi(e){var u;let n,o=e[3]("content.inventory.label",{hero:e[3]((u=e[1].currentActor)==null?void 0:u.name)})+"",t,s,i,r=e[2],l,a=po(e);return{c(){n=N("h4"),t=D(o),s=$(),i=N("div"),a.c(),this.h()},l(c){n=L(c,"H4",{class:!0});var d=w(n);t=M(d,o),d.forEach(f),s=z(c),i=L(c,"DIV",{class:!0});var y=w(i);a.l(y),y.forEach(f),this.h()},h(){I(n,"class","svelte-1sdwrze"),I(i,"class","inventory svelte-1sdwrze")},m(c,d){b(c,n,d),g(n,t),b(c,s,d),b(c,i,d),a.m(i,null),l=!0},p(c,[d]){var y;(!l||d&10)&&o!==(o=c[3]("content.inventory.label",{hero:c[3]((y=c[1].currentActor)==null?void 0:y.name)})+"")&&q(t,o),d&4&&ve(r,r=c[2])?(Fe(),ee(a,1,1,Te),We(),a=po(c),a.c(),Z(a,1),a.m(i,null)):a.p(c,d)},i(c){l||(Z(a),l=!0)},o(c){ee(a),l=!1},d(c){c&&(f(n),f(s),f(i)),a.d(c)}}}function wi(e,n,o){let t;Je(e,Ke,u=>o(3,t=u));let{inventory:s}=n,{state:i}=n,r=!1;gn(()=>{l(),setInterval(l,100)});const l=()=>{o(2,r=!r)};function a(u,c,d,y){d[y]=u,o(0,s)}return e.$$set=u=>{"inventory"in u&&o(0,s=u.inventory),"state"in u&&o(1,i=u.state)},[s,i,r,t,a]}class Pi extends we{constructor(n){super(),Pe(this,n,wi,Hi,ve,{inventory:0,state:1})}}function go(e){let n;return{c(){n=D("*")},l(o){n=M(o,"*")},m(o,t){b(o,n,t)},d(o){o&&f(n)}}}function Bi(e){let n;return{c(){n=D("")},l(o){n=M(o,"")},m(o,t){b(o,n,t)},d(o){o&&f(n)}}}function Gi(e){let n;return{c(){n=D("")},l(o){n=M(o,"")},m(o,t){b(o,n,t)},d(o){o&&f(n)}}}function ho(e){let n,o,t,s,i;function r(a){e[8](a)}let l={state:e[1]};return e[0].inventory!==void 0&&(l.inventory=e[0].inventory),o=new Pi({props:l}),Oe.push(()=>be(o,"inventory",r)),{c(){n=N("div"),Re(o.$$.fragment),this.h()},l(a){n=L(a,"DIV",{class:!0,id:!0,style:!0});var u=w(n);De(o.$$.fragment,u),u.forEach(f),this.h()},h(){I(n,"class","hero-inventory svelte-11gs3s7"),I(n,"id",s=e[0].name+"s-inventory"),dn(n,"display",e[2])},m(a,u){b(a,n,u),Me(o,n,null),i=!0},p(a,u){const c={};u&2&&(c.state=a[1]),!t&&u&1&&(t=!0,c.inventory=a[0].inventory,Ae(()=>t=!1)),o.$set(c),(!i||u&1&&s!==(s=a[0].name+"s-inventory"))&&I(n,"id",s),(!i||u&4)&&dn(n,"display",a[2])},i(a){i||(Z(o.$$.fragment,a),i=!0)},o(a){ee(o.$$.fragment,a),i=!1},d(a){a&&f(n),Ce(o)}}}function _o(e){let n,o=e[3]("content.hero.actions")+"",t,s,i=e[0].actions+"",r,l,a,u=e[3]("content.hero.moves")+"",c,d,y=e[0].movement+"",_,B,C,A=e[3]("content.hero.equipment")+"",O,m,p,T,R,P,oe=e[3](e[0].weapon.name)+"",ue,me,ge=e[0].weapon.dice+"",G,le,pe,te,F,Ee,ne,Qe;function Ne(X,S){return X[0].armour?Fi:Ui}let se=Ne(e),k=se(e);function W(X,S){return X[0].shield?Ki:Wi}let K=W(e),V=K(e);return{c(){n=N("span"),t=D(o),s=D(": "),r=D(i),l=$(),a=N("span"),c=D(u),d=D(": "),_=D(y),B=$(),C=N("span"),O=D(A),m=D(":"),p=$(),T=N("div"),R=N("span"),P=D(" "),ue=D(oe),me=D(" ("),G=D(ge),le=D(")"),pe=$(),te=N("span"),F=D(`
        `),k.c(),Ee=$(),ne=N("span"),Qe=D(`
        `),V.c(),this.h()},l(X){n=L(X,"SPAN",{class:!0});var S=w(n);t=M(S,o),s=M(S,": "),r=M(S,i),S.forEach(f),l=z(X),a=L(X,"SPAN",{class:!0});var Ye=w(a);c=M(Ye,u),d=M(Ye,": "),_=M(Ye,y),Ye.forEach(f),B=z(X),C=L(X,"SPAN",{class:!0});var en=w(C);O=M(en,A),m=M(en,":"),en.forEach(f),p=z(X),T=L(X,"DIV",{class:!0});var Ve=w(T);R=L(Ve,"SPAN",{class:!0});var Be=w(R);P=M(Be," "),ue=M(Be,oe),me=M(Be," ("),G=M(Be,ge),le=M(Be,")"),Be.forEach(f),pe=z(Ve),te=L(Ve,"SPAN",{class:!0});var Ze=w(te);F=M(Ze,`
        `),k.l(Ze),Ze.forEach(f),Ee=z(Ve),ne=L(Ve,"SPAN",{class:!0});var Rn=w(ne);Qe=M(Rn,`
        `),V.l(Rn),Rn.forEach(f),Ve.forEach(f),this.h()},h(){I(n,"class","svelte-11gs3s7"),I(a,"class","svelte-11gs3s7"),I(C,"class","svelte-11gs3s7"),I(R,"class","svelte-11gs3s7"),I(te,"class","svelte-11gs3s7"),I(ne,"class","svelte-11gs3s7"),I(T,"class","equipment svelte-11gs3s7")},m(X,S){b(X,n,S),g(n,t),g(n,s),g(n,r),b(X,l,S),b(X,a,S),g(a,c),g(a,d),g(a,_),b(X,B,S),b(X,C,S),g(C,O),g(C,m),b(X,p,S),b(X,T,S),g(T,R),g(R,P),g(R,ue),g(R,me),g(R,G),g(R,le),g(T,pe),g(T,te),g(te,F),k.m(te,null),g(T,Ee),g(T,ne),g(ne,Qe),V.m(ne,null)},p(X,S){S&8&&o!==(o=X[3]("content.hero.actions")+"")&&q(t,o),S&1&&i!==(i=X[0].actions+"")&&q(r,i),S&8&&u!==(u=X[3]("content.hero.moves")+"")&&q(c,u),S&1&&y!==(y=X[0].movement+"")&&q(_,y),S&8&&A!==(A=X[3]("content.hero.equipment")+"")&&q(O,A),S&9&&oe!==(oe=X[3](X[0].weapon.name)+"")&&q(ue,oe),S&1&&ge!==(ge=X[0].weapon.dice+"")&&q(G,ge),se===(se=Ne(X))&&k?k.p(X,S):(k.d(1),k=se(X),k&&(k.c(),k.m(te,null))),K===(K=W(X))&&V?V.p(X,S):(V.d(1),V=K(X),V&&(V.c(),V.m(ne,null)))},d(X){X&&(f(n),f(l),f(a),f(B),f(C),f(p),f(T)),k.d(),V.d()}}}function Ui(e){let n=e[3]("content.hero.none")+"",o,t;return{c(){o=D(n),t=D(" (0)")},l(s){o=M(s,n),t=M(s," (0)")},m(s,i){b(s,o,i),b(s,t,i)},p(s,i){i&8&&n!==(n=s[3]("content.hero.none")+"")&&q(o,n)},d(s){s&&(f(o),f(t))}}}function Fi(e){let n=e[3](e[0].armour.name)+"",o,t,s=e[0].armour.defense+"",i,r;return{c(){o=D(n),t=D(" ("),i=D(s),r=D(")")},l(l){o=M(l,n),t=M(l," ("),i=M(l,s),r=M(l,")")},m(l,a){b(l,o,a),b(l,t,a),b(l,i,a),b(l,r,a)},p(l,a){a&9&&n!==(n=l[3](l[0].armour.name)+"")&&q(o,n),a&1&&s!==(s=l[0].armour.defense+"")&&q(i,s)},d(l){l&&(f(o),f(t),f(i),f(r))}}}function Wi(e){let n=e[3]("content.hero.none")+"",o,t;return{c(){o=D(n),t=D(" (0)")},l(s){o=M(s,n),t=M(s," (0)")},m(s,i){b(s,o,i),b(s,t,i)},p(s,i){i&8&&n!==(n=s[3]("content.hero.none")+"")&&q(o,n)},d(s){s&&(f(o),f(t))}}}function Ki(e){let n=e[3](e[0].shield.name)+"",o,t,s=e[0].shield.dice+"",i,r;return{c(){o=D(n),t=D(" ("),i=D(s),r=D(")")},l(l){o=M(l,n),t=M(l," ("),i=M(l,s),r=M(l,")")},m(l,a){b(l,o,a),b(l,t,a),b(l,i,a),b(l,r,a)},p(l,a){a&9&&n!==(n=l[3](l[0].shield.name)+"")&&q(o,n),a&1&&s!==(s=l[0].shield.dice+"")&&q(i,s)},d(l){l&&(f(o),f(t),f(i),f(r))}}}function vo(e){let n,o,t,s=e[3](e[0].name)+"",i,r,l=e[3]("content.level."+e[0].level)+"",a,u,c=e[0].experience+"",d,y,_,B,C,A,O,m="",p,T,R,P,oe,ue=e[3]("content.hero.hp")+"",me,ge,G=e[0].health+"",le,pe,te,F,Ee,ne=e[1].targetActor===e[0]&&go();function Qe(K,V){return K[1].targetActor!==K[0]?Gi:Bi}let Ne=Qe(e),se=Ne(e),k=e[1].currentActor===e[0]&&ho(e),W=e[1].currentActor===e[0]&&_o(e);return{c(){n=N("div"),o=N("div"),t=N("b"),ne&&ne.c(),i=D(s),r=D(` -
    `),a=D(l),u=D(" ("),d=D(c),y=D(")"),_=$(),B=N("div"),C=N("button"),se.c(),A=$(),O=N("button"),O.textContent=m,p=$(),T=N("div"),k&&k.c(),R=$(),P=N("div"),oe=N("span"),me=D(ue),ge=D(": "),le=D(G),pe=$(),W&&W.c(),this.h()},l(K){n=L(K,"DIV",{class:!0,style:!0});var V=w(n);o=L(V,"DIV",{class:!0});var X=w(o);t=L(X,"B",{class:!0});var S=w(t);ne&&ne.l(S),i=M(S,s),r=M(S,` -
    `),a=M(S,l),u=M(S," ("),d=M(S,c),y=M(S,")"),S.forEach(f),X.forEach(f),_=z(V),B=L(V,"DIV",{});var Ye=w(B);C=L(Ye,"BUTTON",{title:!0});var en=w(C);se.l(en),en.forEach(f),A=z(Ye),O=L(Ye,"BUTTON",{title:!0,"data-svelte-h":!0}),Ho(O)!=="svelte-qrm7uk"&&(O.textContent=m),Ye.forEach(f),p=z(V),T=L(V,"DIV",{class:!0});var Ve=w(T);k&&k.l(Ve),Ve.forEach(f),R=z(V),P=L(V,"DIV",{});var Be=w(P);oe=L(Be,"SPAN",{class:!0});var Ze=w(oe);me=M(Ze,ue),ge=M(Ze,": "),le=M(Ze,G),Ze.forEach(f),pe=z(Be),W&&W.l(Be),Be.forEach(f),V.forEach(f),this.h()},h(){I(t,"class","svelte-11gs3s7"),I(o,"class","hero-title svelte-11gs3s7"),I(C,"title","select target hero"),I(O,"title","Open inventory"),I(T,"class","hero-information svelte-11gs3s7"),I(oe,"class","svelte-11gs3s7"),I(n,"class","hero-card svelte-11gs3s7"),dn(n,"background-color",e[0].colour)},m(K,V){b(K,n,V),g(n,o),g(o,t),ne&&ne.m(t,null),g(t,i),g(t,r),g(t,a),g(t,u),g(t,d),g(t,y),g(n,_),g(n,B),g(B,C),se.m(C,null),g(B,A),g(B,O),g(n,p),g(n,T),k&&k.m(T,null),g(n,R),g(n,P),g(P,oe),g(oe,me),g(oe,ge),g(oe,le),g(P,pe),W&&W.m(P,null),te=!0,F||(Ee=[Le(C,"click",e[6]),Le(O,"click",e[7])],F=!0)},p(K,V){K[1].targetActor===K[0]?ne||(ne=go(),ne.c(),ne.m(t,i)):ne&&(ne.d(1),ne=null),(!te||V&9)&&s!==(s=K[3](K[0].name)+"")&&q(i,s),(!te||V&9)&&l!==(l=K[3]("content.level."+K[0].level)+"")&&q(a,l),(!te||V&1)&&c!==(c=K[0].experience+"")&&q(d,c),Ne!==(Ne=Qe(K))&&(se.d(1),se=Ne(K),se&&(se.c(),se.m(C,null))),K[1].currentActor===K[0]?k?(k.p(K,V),V&3&&Z(k,1)):(k=ho(K),k.c(),Z(k,1),k.m(T,null)):k&&(Fe(),ee(k,1,1,()=>{k=null}),We()),(!te||V&8)&&ue!==(ue=K[3]("content.hero.hp")+"")&&q(me,ue),(!te||V&1)&&G!==(G=K[0].health+"")&&q(le,G),K[1].currentActor===K[0]?W?W.p(K,V):(W=_o(K),W.c(),W.m(P,null)):W&&(W.d(1),W=null),(!te||V&1)&&dn(n,"background-color",K[0].colour)},i(K){te||(Z(k),te=!0)},o(K){ee(k),te=!1},d(K){K&&f(n),ne&&ne.d(),se.d(),k&&k.d(),W&&W.d(),F=!1,Gn(Ee)}}}function Yi(e){let n=e[1].targetActor,o,t,s=vo(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),b(i,o,r),t=!0},p(i,[r]){r&2&&ve(n,n=i[1].targetActor)?(Fe(),ee(s,1,1,Te),We(),s=vo(i),s.c(),Z(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(Z(s),t=!0)},o(i){ee(s),t=!1},d(i){i&&f(o),s.d(i)}}}function Vi(e,n,o){let t;Je(e,Ke,_=>o(3,t=_));let{hero:s}=n,{state:i}=n,r="none";const l=_=>{i.targetActor&&_===i.targetActor?o(1,i.targetActor=void 0,i):o(1,i.targetActor=_,i)},a=_=>{const B=document.getElementById(_.name+"s-inventory");B&&(_.isInventoryOpen=!_.isInventoryOpen,u(),B.style.display=r)},u=()=>{s.isInventoryOpen?o(2,r="inline-block"):o(2,r="none")};u();const c=()=>l(s),d=()=>a(s);function y(_){e.$$.not_equal(s.inventory,_)&&(s.inventory=_,o(0,s))}return e.$$set=_=>{"hero"in _&&o(0,s=_.hero),"state"in _&&o(1,i=_.state)},[s,i,r,t,l,a,c,d,y]}class Ot extends we{constructor(n){super(),Pe(this,n,Vi,Yi,ve,{hero:0,state:1})}}function yo(e,n,o){const t=e.slice();return t[3]=n[o],t[5]=o,t}function qi(e){let n,o,t,s;return o=new Ot({props:{hero:e[3],state:e[0]}}),{c(){n=N("div"),Re(o.$$.fragment),t=$(),this.h()},l(i){n=L(i,"DIV",{class:!0});var r=w(n);De(o.$$.fragment,r),t=z(r),r.forEach(f),this.h()},h(){I(n,"class","not-current-actor svelte-gyascg")},m(i,r){b(i,n,r),Me(o,n,null),g(n,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),o.$set(l)},i(i){s||(Z(o.$$.fragment,i),s=!0)},o(i){ee(o.$$.fragment,i),s=!1},d(i){i&&f(n),Ce(o)}}}function Xi(e){let n,o,t,s;return o=new Ot({props:{hero:e[3],state:e[0]}}),{c(){n=N("div"),Re(o.$$.fragment),t=$(),this.h()},l(i){n=L(i,"DIV",{class:!0});var r=w(n);De(o.$$.fragment,r),t=z(r),r.forEach(f),this.h()},h(){I(n,"class","is-current-actor svelte-gyascg")},m(i,r){b(i,n,r),Me(o,n,null),g(n,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),o.$set(l)},i(i){s||(Z(o.$$.fragment,i),s=!0)},o(i){ee(o.$$.fragment,i),s=!1},d(i){i&&f(n),Ce(o)}}}function Eo(e){let n,o,t,s;const i=[Xi,qi],r=[];function l(a,u){return a[3]===a[0].currentActor?0:1}return n=l(e),o=r[n]=i[n](e),{c(){o.c(),t=de()},l(a){o.l(a),t=de()},m(a,u){r[n].m(a,u),b(a,t,u),s=!0},p(a,u){let c=n;n=l(a),n===c?r[n].p(a,u):(Fe(),ee(r[c],1,1,()=>{r[c]=null}),We(),o=r[n],o?o.p(a,u):(o=r[n]=i[n](a),o.c()),Z(o,1),o.m(t.parentNode,t))},i(a){s||(Z(o),s=!0)},o(a){ee(o),s=!1},d(a){a&&f(t),r[n].d(a)}}}function Oo(e){let n=e[1],o,t,s=Eo(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),b(i,o,r),t=!0},p(i,r){r&2&&ve(n,n=i[1])?(Fe(),ee(s,1,1,Te),We(),s=Eo(i),s.c(),Z(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(Z(s),t=!0)},o(i){ee(s),t=!1},d(i){i&&f(o),s.d(i)}}}function Ji(e){let n,o,t=He(x(e[0])),s=[];for(let r=0;r<t.length;r+=1)s[r]=Oo(yo(e,t,r));const i=r=>ee(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);n=de()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);b(r,n,l),o=!0},p(r,[l]){if(l&3){t=He(x(r[0]));let a;for(a=0;a<t.length;a+=1){const u=yo(r,t,a);s[a]?(s[a].p(u,l),Z(s[a],1)):(s[a]=Oo(u),s[a].c(),Z(s[a],1),s[a].m(n.parentNode,n))}for(Fe(),a=t.length;a<s.length;a+=1)i(a);We()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)Z(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)ee(s[l]);o=!1},d(r){r&&f(n),sn(s,r)}}}function Qi(e,n,o){let{state:t}=n,s=!1;gn(()=>{i(),setInterval(i,100)});const i=()=>{t.reRender&&o(1,s=!s)};return e.$$set=r=>{"state"in r&&o(0,t=r.state)},[t,s]}class Zi extends we{constructor(n){super(),Pe(this,n,Qi,Ji,ve,{state:0})}}function Ao(e,n,o){const t=e.slice();return t[5]=n[o],t[7]=o,t}function ji(e){let n,o,t=e[2](e[5])+"",s;return{c(){n=N("p"),o=D(">"),s=D(t),this.h()},l(i){n=L(i,"P",{class:!0});var r=w(n);o=M(r,">"),s=M(r,t),r.forEach(f),this.h()},h(){I(n,"class","svelte-grgnnk")},m(i,r){b(i,n,r),g(n,o),g(n,s)},p(i,r){r&1&&t!==(t=i[2](i[5])+"")&&q(s,t)},d(i){i&&f(n)}}}function bo(e){let n,o=e[7]<25&&ji(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),b(t,n,s)},p(t,s){t[7]<25&&o.p(t,s)},d(t){t&&f(n),o&&o.d(t)}}}function To(e){let n,o=He(e[0].actionLog),t=[];for(let s=0;s<o.length;s+=1)t[s]=bo(Ao(e,o,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=de()},l(s){for(let i=0;i<t.length;i+=1)t[i].l(s);n=de()},m(s,i){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(s,i);b(s,n,i)},p(s,i){if(i&5){o=He(s[0].actionLog);let r;for(r=0;r<o.length;r+=1){const l=Ao(s,o,r);t[r]?t[r].p(l,i):(t[r]=bo(l),t[r].c(),t[r].m(n.parentNode,n))}for(;r<t.length;r+=1)t[r].d(1);t.length=o.length}},d(s){s&&f(n),sn(t,s)}}}function xi(e){let n,o=e[1],t=To(e);return{c(){n=N("div"),t.c(),this.h()},l(s){n=L(s,"DIV",{class:!0});var i=w(n);t.l(i),i.forEach(f),this.h()},h(){I(n,"class","log svelte-grgnnk")},m(s,i){b(s,n,i),t.m(n,null)},p(s,[i]){i&2&&ve(o,o=s[1])?(t.d(1),t=To(s),t.c(),t.m(n,null)):t.p(s,i)},i:Te,o:Te,d(s){s&&f(n),t.d(s)}}}function Si(e,n,o){let t;Je(e,Ke,a=>o(3,t=a));let{state:s}=n,i=!1;gn(()=>{r(),setInterval(r,500)});const r=()=>{s.reRender&&o(1,i=!i)},l=a=>`(${a.turn}) ${t(a.key,a.properties)}`;return e.$$set=a=>{"state"in a&&o(0,s=a.state)},[s,i,l]}class $i extends we{constructor(n){super(),Pe(this,n,Si,xi,ve,{state:0})}}const zi={name:"campaign.iceDragon.testingGrounds.name",beaten:!0,winConditions:[{type:ae.KILL_ALL,fulfilled:!0},{type:ae.OPEN_DOOR,targetCell:{x:2,y:10},fulfilled:!1},{type:ae.KILL_ALL_OF_TYPE,targetMonsterType:U.ORCH,fulfilled:!1},{type:ae.REACH_CELL,targetCell:{x:2,y:10},fulfilled:!1},{type:ae.KILL_AT_LEAST,killMinCount:5,fulfilled:!1}],nextDungeon:rt,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A","D","I"],layout:{corners:[{position:{x:0,y:0},type:H.INNER_TOP_LEFT},{position:{x:10,y:0},type:H.INNER_TOP_RIGHT},{position:{x:0,y:4},type:H.INNER_BOTTOM_LEFT},{position:{x:6,y:4},type:H.OUTER_TOP_RIGHT},{position:{x:8,y:4},type:H.OUTER_TOP_LEFT},{position:{x:10,y:4},type:H.INNER_BOTTOM_RIGHT},{position:{x:2,y:5},type:H.INNER_TOP_LEFT},{position:{x:6,y:5},type:H.OUTER_BOTTOM_RIGHT},{position:{x:8,y:6},type:H.OUTER_BOTTOM_LEFT},{position:{x:9,y:6},type:H.INNER_TOP_RIGHT},{position:{x:0,y:7},type:H.INNER_TOP_LEFT},{position:{x:2,y:7},type:H.OUTER_BOTTOM_RIGHT},{position:{x:4,y:7},type:H.LEFT_END},{position:{x:6,y:7},type:H.RIGHT_END},{position:{x:0,y:11},type:H.INNER_BOTTOM_LEFT},{position:{x:1,y:11},type:H.OUTER_TOP_RIGHT},{position:{x:3,y:11},type:H.TOP_END},{position:{x:9,y:11},type:H.BOTTOM_END},{position:{x:10,y:11},type:H.INNER_TOP_RIGHT},{position:{x:3,y:12},type:H.BOTTOM_END},{position:{x:3,y:13},type:H.INNER_BOTTOM_RIGHT},{position:{x:8,y:13},type:H.TOP_END},{position:{x:1,y:14},type:H.INNER_BOTTOM_LEFT},{position:{x:8,y:14},type:H.THREE_WAY_INTERSECTION_UP},{position:{x:10,y:14},type:H.INNER_BOTTOM_RIGHT}],grid:["###########","#CCCCCCCCC#","#CCCCCCCCC#","#CCCCCCCCC#","#######E###","  #####E#  ","  #FFFFE## ","###F###AA# ","#AAAAAAAA#D","#AAAAAAAA#D","#AAAAAAAA#D","##G########"," #G#IIIIII#"," #GIIIII#I#"," ##########"],pillars:[{x:8,y:3},{x:7,y:9}],pits:[{x:6,y:3},{x:6,y:2}],corridors:["G","E","F"],doors:[Hn(v.UP,3,8,1),on(v.LEFT,7,6),et(v.UP,7,7,1),Q(v.UP,7,4),Ue(v.DOWN,2,10)],monsters:[re(U.ORCH,Y.Green,1,1),re(U.ORCH,Y.Red,4,9),re(U.TROLL,Y.Green,5,1)],secrets:[he(ie.TRAP_DOOR,"campaign.iceDragon.testingGrounds.secrets.trapDoor",3,9),he(ie.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,10),pn(ie.EQUIPMENT,5,10,mn[2])],notes:[{position:{x:2,y:10},message:`Some note
to test rendering
 on game board. 
The note is pretty long, so we g
et several lines of text. I wonder how it handles a linebreak?
Like this apparently.`}],items:[{item:Ie[0],position:{x:3,y:10}},{item:Ie[1],position:{x:4,y:10}},{item:Ie[6],position:{x:5,y:10}},{item:Ie[2],position:{x:6,y:10}},{item:Ie[3],position:{x:7,y:10}},{item:Ie[4],position:{x:8,y:10}}]},killCount:0};function ko(e,n,o){const t=e.slice();return t[5]=n[o],t}function Io(e){let n,o=e[5].label+"",t,s,i;return{c(){n=N("button"),t=D(o),this.h()},l(r){n=L(r,"BUTTON",{class:!0});var l=w(n);t=M(l,o),l.forEach(f),this.h()},h(){I(n,"class","menuButton svelte-12a9xod")},m(r,l){b(r,n,l),g(n,t),s||(i=Le(n,"click",function(){At(e[5].onClick)&&e[5].onClick.apply(this,arguments)}),s=!0)},p(r,l){e=r,l&4&&o!==(o=e[5].label+"")&&q(t,o)},d(r){r&&f(n),s=!1,i()}}}function Ro(e){let n,o=(e[5].debugModeOnly&&e[1]||!e[5].debugModeOnly)&&Io(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),b(t,n,s)},p(t,s){t[5].debugModeOnly&&t[1]||!t[5].debugModeOnly?o?o.p(t,s):(o=Io(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(t){t&&f(n),o&&o.d(t)}}}function er(e){let n,o,t,s,i,r,l,a,u=He(e[2]),c=[];for(let d=0;d<u.length;d+=1)c[d]=Ro(ko(e,u,d));return{c(){n=N("div"),o=N("span"),t=D(e[0]),s=$();for(let d=0;d<c.length;d+=1)c[d].c();i=$(),r=N("span"),l=D(e[3]),this.h()},l(d){n=L(d,"DIV",{class:!0});var y=w(n);o=L(y,"SPAN",{class:!0});var _=w(o);t=M(_,e[0]),_.forEach(f),s=z(y);for(let C=0;C<c.length;C+=1)c[C].l(y);i=z(y),r=L(y,"SPAN",{class:!0});var B=w(r);l=M(B,e[3]),B.forEach(f),y.forEach(f),this.h()},h(){I(o,"class","header svelte-12a9xod"),I(r,"class","footer svelte-12a9xod"),I(n,"class",a=An(e[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")},m(d,y){b(d,n,y),g(n,o),g(o,t),g(n,s);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(n,null);g(n,i),g(n,r),g(r,l)},p(d,[y]){if(y&1&&q(t,d[0]),y&6){u=He(d[2]);let _;for(_=0;_<u.length;_+=1){const B=ko(d,u,_);c[_]?c[_].p(B,y):(c[_]=Ro(B),c[_].c(),c[_].m(n,i))}for(;_<c.length;_+=1)c[_].d(1);c.length=u.length}y&8&&q(l,d[3]),y&16&&a!==(a=An(d[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")&&I(n,"class",a)},i:Te,o:Te,d(d){d&&f(n),sn(c,d)}}}function nr(e,n,o){let{header:t}=n,{debugMode:s}=n,{buttons:i}=n,{footer:r}=n,{showMenu:l}=n;return e.$$set=a=>{"header"in a&&o(0,t=a.header),"debugMode"in a&&o(1,s=a.debugMode),"buttons"in a&&o(2,i=a.buttons),"footer"in a&&o(3,r=a.footer),"showMenu"in a&&o(4,l=a.showMenu)},[t,s,i,r,l]}class Do extends we{constructor(n){super(),Pe(this,n,nr,er,ve,{header:0,debugMode:1,buttons:2,footer:3,showMenu:4})}}function Mo(e){let n,o=e[7]("content.actions.nextLevel")+"",t,s,i;return{c(){n=N("button"),t=D(o),this.h()},l(r){n=L(r,"BUTTON",{class:!0});var l=w(n);t=M(l,o),l.forEach(f),this.h()},h(){I(n,"class","menuButton svelte-1v33x5s")},m(r,l){b(r,n,l),g(n,t),s||(i=Le(n,"click",e[18]),s=!0)},p(r,l){l&128&&o!==(o=r[7]("content.actions.nextLevel")+"")&&q(t,o)},d(r){r&&f(n),s=!1,i()}}}function or(e){let n,o,t,s,i,r,l,a,u,c,d,y,_=e[7]("content.menu.menuButton")+"",B,C,A,O,m=e[7]("content.actions.next")+"",p,T,R,P=e[7]("content.actions.action")+"",oe,ue,me,ge,G;function le(k){e[10](k)}function pe(k){e[11](k)}function te(k){e[12](k)}let F={header:e[7]("content.menu.mainMenu.header"),footer:`${e[2].date} - ${e[2].hash}`};e[1]!==void 0&&(F.debugMode=e[1]),e[3]!==void 0&&(F.showMenu=e[3]),e[6]!==void 0&&(F.buttons=e[6]),o=new Do({props:F}),Oe.push(()=>be(o,"debugMode",le)),Oe.push(()=>be(o,"showMenu",pe)),Oe.push(()=>be(o,"buttons",te));function Ee(k){e[13](k)}function ne(k){e[14](k)}function Qe(k){e[15](k)}let Ne={header:e[7]("content.menu.loadGame.header"),footer:""};e[1]!==void 0&&(Ne.debugMode=e[1]),e[4]!==void 0&&(Ne.showMenu=e[4]),e[5]!==void 0&&(Ne.buttons=e[5]),l=new Do({props:Ne}),Oe.push(()=>be(l,"debugMode",Ee)),Oe.push(()=>be(l,"showMenu",ne)),Oe.push(()=>be(l,"buttons",Qe));let se=e[0].dungeon.beaten&&Mo(e);return{c(){n=N("div"),Re(o.$$.fragment),r=$(),Re(l.$$.fragment),d=$(),y=N("button"),B=D(_),C=$(),A=N("div"),O=N("button"),p=D(m),T=$(),R=N("button"),oe=D(P),ue=$(),se&&se.c(),this.h()},l(k){n=L(k,"DIV",{class:!0});var W=w(n);De(o.$$.fragment,W),r=z(W),De(l.$$.fragment,W),d=z(W),y=L(W,"BUTTON",{class:!0});var K=w(y);B=M(K,_),K.forEach(f),C=z(W),A=L(W,"DIV",{});var V=w(A);O=L(V,"BUTTON",{class:!0});var X=w(O);p=M(X,m),X.forEach(f),T=z(V),R=L(V,"BUTTON",{class:!0,style:!0});var S=w(R);oe=M(S,P),S.forEach(f),V.forEach(f),ue=z(W),se&&se.l(W),W.forEach(f),this.h()},h(){I(y,"class","menuButton svelte-1v33x5s"),I(O,"class","menuButton twoColButton svelte-1v33x5s"),I(R,"class","menuButton twoColButton svelte-1v33x5s"),dn(R,"float","right"),I(n,"class","commands svelte-1v33x5s")},m(k,W){b(k,n,W),Me(o,n,null),g(n,r),Me(l,n,null),g(n,d),g(n,y),g(y,B),g(n,C),g(n,A),g(A,O),g(O,p),g(A,T),g(A,R),g(R,oe),g(n,ue),se&&se.m(n,null),me=!0,ge||(G=[Le(window,"keydown",bt(e[8])),Le(y,"click",e[9]),Le(O,"click",e[16]),Le(R,"click",e[17])],ge=!0)},p(k,[W]){const K={};W&128&&(K.header=k[7]("content.menu.mainMenu.header")),W&4&&(K.footer=`${k[2].date} - ${k[2].hash}`),!t&&W&2&&(t=!0,K.debugMode=k[1],Ae(()=>t=!1)),!s&&W&8&&(s=!0,K.showMenu=k[3],Ae(()=>s=!1)),!i&&W&64&&(i=!0,K.buttons=k[6],Ae(()=>i=!1)),o.$set(K);const V={};W&128&&(V.header=k[7]("content.menu.loadGame.header")),!a&&W&2&&(a=!0,V.debugMode=k[1],Ae(()=>a=!1)),!u&&W&16&&(u=!0,V.showMenu=k[4],Ae(()=>u=!1)),!c&&W&32&&(c=!0,V.buttons=k[5],Ae(()=>c=!1)),l.$set(V),(!me||W&128)&&_!==(_=k[7]("content.menu.menuButton")+"")&&q(B,_),(!me||W&128)&&m!==(m=k[7]("content.actions.next")+"")&&q(p,m),(!me||W&128)&&P!==(P=k[7]("content.actions.action")+"")&&q(oe,P),k[0].dungeon.beaten?se?se.p(k,W):(se=Mo(k),se.c(),se.m(n,null)):se&&(se.d(1),se=null)},i(k){me||(Z(o.$$.fragment,k),Z(l.$$.fragment,k),me=!0)},o(k){ee(o.$$.fragment,k),ee(l.$$.fragment,k),me=!1},d(k){k&&f(n),Ce(o),Ce(l),se&&se.d(),ge=!1,Gn(G)}}}function tr(e,n,o){let t;Je(e,Ke,F=>o(7,t=F));let{state:s}=n,{debugMode:i}=n,{buildInfo:r}=n,l=!1,a=!1,u=[],c=[];const d=()=>{o(1,i=!i),o(0,s.settings.debug=i,s),ce(s)},y=F=>{switch(F.key){case"6":case"d":je("R",s);break;case"9":case"e":je("UR",s);break;case"8":case"w":je("U",s);break;case"7":case"q":je("UL",s);break;case"4":case"a":je("L",s);break;case"1":case"z":je("DL",s);break;case"2":case"x":je("D",s);break;case"3":case"c":je("DR",s);break;case"0":case" ":o(0,s=Pn(s));break;case"-":case"r":Xo(s);break;case"+":case"f":Qo(s);break}},_=()=>{o(0,s=dt()),ce(s),o(3,l=!1)},B=()=>{Rs(s),o(3,l=!1)},C=()=>{o(0,s.dungeon=zi,s),kn(s),ce(s),o(3,l=!1)},A=()=>{o(3,l=!1),o(4,a=!0),o(5,u=O())},O=()=>{const F=[],Ee=localStorage.getItem("autosave");Ee&&F.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.autoSave"),onClick:()=>p(Ee)});const ne=localStorage.getItem("state");return ne&&F.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.manualSave"),onClick:()=>p(ne)}),F.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.back"),onClick:()=>{o(3,l=!0),o(4,a=!1)}}),F},m=()=>[{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.newGame"),onClick:_},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.saveGame"),onClick:B},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.loadGame"),onClick:A},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.debug"),onClick:d},{debugModeOnly:!0,label:t("content.menu.mainMenu.buttons.testingGrounds"),onClick:C},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.language"),onClick:R}],p=F=>{o(0,s=ft(JSON.parse(F))),o(3,l=!1),o(4,a=!1)},T=()=>{o(6,c=m()),a?o(3,l=!1):o(3,l=!l),o(4,a=!1)},R=()=>{Tt.get()==="en"?(Ln("sv"),o(0,s.settings.locale="sv",s)):(Ln("en"),o(0,s.settings.locale="en",s)),o(6,c=m()),ce(s)};c=m();function P(F){i=F,o(1,i)}function oe(F){l=F,o(3,l)}function ue(F){c=F,o(6,c)}function me(F){i=F,o(1,i)}function ge(F){a=F,o(4,a)}function G(F){u=F,o(5,u)}const le=()=>o(0,s=Pn(s)),pe=()=>Xt(s),te=()=>Ls(s);return e.$$set=F=>{"state"in F&&o(0,s=F.state),"debugMode"in F&&o(1,i=F.debugMode),"buildInfo"in F&&o(2,r=F.buildInfo)},[s,i,r,l,a,u,c,t,y,T,P,oe,ue,me,ge,G,le,pe,te]}class sr extends we{constructor(n){super(),Pe(this,n,tr,or,ve,{state:0,debugMode:1,buildInfo:2})}}const ir="2024-03-16",rr="b441750",lr={date:ir,hash:rr};function Co(e,n,o){const t=e.slice();return t[2]=n[o],t}function No(e){let n,o,t,s=e[1]("content.diary.foundOn",{round:e[2].foundOn})+"",i,r,l,a=e[1](e[2].message)+"",u;return{c(){n=N("hr"),o=$(),t=N("p"),i=D(s),r=$(),l=N("p"),u=D(a),this.h()},l(c){n=L(c,"HR",{class:!0}),o=z(c),t=L(c,"P",{class:!0});var d=w(t);i=M(d,s),d.forEach(f),r=z(c),l=L(c,"P",{class:!0});var y=w(l);u=M(y,a),y.forEach(f),this.h()},h(){I(n,"class","svelte-4r9yed"),I(t,"class","header svelte-4r9yed"),I(l,"class","note svelte-4r9yed")},m(c,d){b(c,n,d),b(c,o,d),b(c,t,d),g(t,i),b(c,r,d),b(c,l,d),g(l,u)},p(c,d){d&3&&s!==(s=c[1]("content.diary.foundOn",{round:c[2].foundOn})+"")&&q(i,s),d&3&&a!==(a=c[1](c[2].message)+"")&&q(u,a)},d(c){c&&(f(n),f(o),f(t),f(r),f(l))}}}function Lo(e){let n,o=e[2].found&&No(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),b(t,n,s)},p(t,s){t[2].found?o?o.p(t,s):(o=No(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(t){t&&f(n),o&&o.d(t)}}}function ar(e){let n,o,t=e[1]("content.diary.label",{turn:e[0].turnCount})+"",s,i,r=He(e[0].dungeon.layout.notes),l=[];for(let a=0;a<r.length;a+=1)l[a]=Lo(Co(e,r,a));return{c(){n=N("div"),o=N("span"),s=D(t),i=$();for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){n=L(a,"DIV",{class:!0});var u=w(n);o=L(u,"SPAN",{class:!0});var c=w(o);s=M(c,t),c.forEach(f),i=z(u);for(let d=0;d<l.length;d+=1)l[d].l(u);u.forEach(f),this.h()},h(){I(o,"class","svelte-4r9yed"),I(n,"class","svelte-4r9yed")},m(a,u){b(a,n,u),g(n,o),g(o,s),g(n,i);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(n,null)},p(a,[u]){if(u&3&&t!==(t=a[1]("content.diary.label",{turn:a[0].turnCount})+"")&&q(s,t),u&3){r=He(a[0].dungeon.layout.notes);let c;for(c=0;c<r.length;c+=1){const d=Co(a,r,c);l[c]?l[c].p(d,u):(l[c]=Lo(d),l[c].c(),l[c].m(n,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=r.length}},i:Te,o:Te,d(a){a&&f(n),sn(l,a)}}}function ur(e,n,o){let t;Je(e,Ke,i=>o(1,t=i));let{state:s}=n;return e.$$set=i=>{"state"in i&&o(0,s=i.state)},[s,t]}class cr extends we{constructor(n){super(),Pe(this,n,ur,ar,ve,{state:0})}}function fr(e){let n,o,t,s,i,r,l,a,u,c,d,y,_,B,C,A,O,m;t=new Zi({props:{state:e[0]}}),i=new cr({props:{state:e[0]}});function p(G){e[2](G)}function T(G){e[3](G)}let R={};e[0]!==void 0&&(R.state=e[0]),e[1]!==void 0&&(R.debugMode=e[1]),l=new Ri({props:R}),Oe.push(()=>be(l,"state",p)),Oe.push(()=>be(l,"debugMode",T));function P(G){e[4](G)}function oe(G){e[5](G)}let ue={buildInfo:lr};e[0]!==void 0&&(ue.state=e[0]),e[1]!==void 0&&(ue.debugMode=e[1]),y=new sr({props:ue}),Oe.push(()=>be(y,"state",P)),Oe.push(()=>be(y,"debugMode",oe));function me(G){e[6](G)}let ge={};return e[0]!==void 0&&(ge.state=e[0]),A=new $i({props:ge}),Oe.push(()=>be(A,"state",me)),{c(){n=N("div"),o=N("div"),Re(t.$$.fragment),s=$(),Re(i.$$.fragment),r=$(),Re(l.$$.fragment),c=$(),d=N("div"),Re(y.$$.fragment),C=$(),Re(A.$$.fragment),this.h()},l(G){n=L(G,"DIV",{class:!0});var le=w(n);o=L(le,"DIV",{class:!0});var pe=w(o);De(t.$$.fragment,pe),s=z(pe),De(i.$$.fragment,pe),pe.forEach(f),r=z(le),De(l.$$.fragment,le),le.forEach(f),c=z(G),d=L(G,"DIV",{class:!0,id:!0});var te=w(d);De(y.$$.fragment,te),C=z(te),De(A.$$.fragment,te),te.forEach(f),this.h()},h(){I(o,"class","characterSide svelte-3spdd7"),I(n,"class","container svelte-3spdd7"),I(d,"class","container svelte-3spdd7"),I(d,"id","footer")},m(G,le){b(G,n,le),g(n,o),Me(t,o,null),g(o,s),Me(i,o,null),g(n,r),Me(l,n,null),b(G,c,le),b(G,d,le),Me(y,d,null),g(d,C),Me(A,d,null),m=!0},p(G,[le]){const pe={};le&1&&(pe.state=G[0]),t.$set(pe);const te={};le&1&&(te.state=G[0]),i.$set(te);const F={};!a&&le&1&&(a=!0,F.state=G[0],Ae(()=>a=!1)),!u&&le&2&&(u=!0,F.debugMode=G[1],Ae(()=>u=!1)),l.$set(F);const Ee={};!_&&le&1&&(_=!0,Ee.state=G[0],Ae(()=>_=!1)),!B&&le&2&&(B=!0,Ee.debugMode=G[1],Ae(()=>B=!1)),y.$set(Ee);const ne={};!O&&le&1&&(O=!0,ne.state=G[0],Ae(()=>O=!1)),A.$set(ne)},i(G){m||(Z(t.$$.fragment,G),Z(i.$$.fragment,G),Z(l.$$.fragment,G),Z(y.$$.fragment,G),Z(A.$$.fragment,G),m=!0)},o(G){ee(t.$$.fragment,G),ee(i.$$.fragment,G),ee(l.$$.fragment,G),ee(y.$$.fragment,G),ee(A.$$.fragment,G),m=!1},d(G){G&&(f(n),f(c),f(d)),Ce(t),Ce(i),Ce(l),Ce(y),Ce(A)}}}function dr(e,n,o){let t,s=null;s=localStorage.getItem("reloadGuard"),s?(t=ft(JSON.parse(s)),ce(t)):(t=dt(),ce(t)),Ln(t.settings.locale);let i=t.settings.debug;function r(d){t=d,o(0,t)}function l(d){i=d,o(1,i)}function a(d){t=d,o(0,t)}function u(d){i=d,o(1,i)}function c(d){t=d,o(0,t)}return[t,i,r,l,a,u,c]}class hr extends we{constructor(n){super(),Pe(this,n,dr,fr,ve,{})}}export{hr as component};
