import{s as ge,n as be,e as Ye,o as fn,f as yn,r as Nn,b as _e,h as ve,i as gt}from"../chunks/scheduler.8ae2156d.js";import{S as we,i as He,e as ce,a as E,f,g as L,m as M,h as w,j as H,n as C,k as O,x as g,o as Y,s as Z,c as j,y as Te,d as S,p as Be,t as $,b as Ge,z as en,A as ye,r as De,u as Ie,v as Oe,w as Re,B as Co,l as an,C as ht}from"../chunks/index.9c43906b.js";import{t as Ue,a as _t,s as Tn}from"../chunks/index.d6e17401.js";function Le(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var W=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(W||{}),G=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(G||{}),pe=(e=>(e.APPRENTICE="apprentice",e.KNIGHT="knight",e.HERO="hero",e.LORD="lord",e.MASTER="master",e))(pe||{}),re=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(re||{}),te=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(te||{}),k=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(k||{}),J=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))(J||{});const un=[{name:"items.weapons.sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:J.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.twoHandedSword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:J.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:J.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:J.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.doubleHeadedAxe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:J.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],tn=[{name:"items.weapons.orchSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:J.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.orchBow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:J.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"items.weapons.trollClub",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:J.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.darkLordSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:3,type:J.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.greenDarkLordSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:J.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],vt=[{name:"items.armour.chainMail",type:J.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"items.armour.plateMail",type:J.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"items.armour.dragonSkinMail",type:J.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],On=[{name:"items.armour.orchMail",defense:0,magicProtection:!1,amountInDeck:4,type:J.ARMOUR,movementReduction:0,value:0},{name:"items.armour.trollSkin",defense:1,magicProtection:!1,amountInDeck:4,type:J.ARMOUR,movementReduction:0,value:0},{name:"items.armour.darkLordCape",defense:2,magicProtection:!1,amountInDeck:4,type:J.ARMOUR,movementReduction:0,value:0}],yt=[{name:"items.shields.largeShield",type:J.SHIELD,amountInDeck:2,dice:2,value:2},{name:"items.shields.smallShield",type:J.SHIELD,amountInDeck:2,dice:1,value:1}],At=[{name:"items.shields.blueDarkLordShield",type:J.SHIELD,amountInDeck:1,dice:1,value:0}],We="USED",Fn="ATTACK_BONUS",Wn="SEARCH_BONUS",To="BREAK_LOCK",Vn="RE_ROLL_ATTACK",Yn="DESCRIPTION",An="ACTIVE",bn="MOVEMENT_BONUS",qn="ACTIONS_BONUS",Lo="RESET_ON",wo="NEXT_TURN",bt="TRADE",Ho="NEXT_SCENARIO",Pn={movementBonusOnPickup:(e,o,n)=>{var t,s;n.maxMovement+=(t=o.properties)==null?void 0:t[bn],n.actions>0&&(n.movement+=(s=o.properties)==null?void 0:s[bn])}},No={movementBonusOnDrop:(e,o,n)=>{var t,s;n.maxMovement-1>0&&(n.maxMovement-=(t=o.properties)==null?void 0:t[bn]),n.movement-1>=0&&(n.movement-=(s=o.properties)==null?void 0:s[bn])}},kt={magicHerbsOnUse:(e,o,n,t)=>{if(o.disabled){y(e,"logs.item.cannotUse",{item:h(o.name)});return}if(!t){y(e,"logs.item.noTarget");return}if(!je(n)){y(e,"logs.heroAction.noActions",{hero:h(n.name)});return}if(o.properties){if(o.properties[We]){y(e,"logs.item.noUsesLeft",{item:h(o.name)});return}o.properties[We]=!0;const s=Math.min(ze(n.level,3),t.maxHealth-t.health);t.health+=s,y(e,"logs.item.magicHerbs",{user:h(n.name),item:h(o.name),target:h(t.name),addedHealth:`${s}`}),n.actions--,n.movement=n.maxMovement}},chaosSwordOnUse:(e,o,n,t)=>{if(o.disabled){y(e,"logs.item.cannotUse",{item:h(o.name)});return}},potionOfSpeedOnUse:(e,o,n)=>{var t,s,i;if(o.disabled){y(e,"logs.item.cannotUse",{item:h(o.name)});return}(t=o.properties)!=null&&t[We]?y(e,"logs.item.consumed",{item:h(o.name)}):(n.actions+=(s=o.properties)==null?void 0:s[qn],o.properties&&(o.properties[We]=!0),y(e,"logs.item.potionOfSpeed",{user:h(n.name),item:h(o.name),actions:(i=o.properties)==null?void 0:i[qn]}))},necklaceOfLightOnUse:(e,o,n,t)=>{var s;if(o.disabled){y(e,"logs.item.cannotUse",{item:h(o.name)});return}if(!t){y(e,"logs.item.noTarget");return}if(!je(n)){y(e,"logs.heroAction.noActions",{hero:h(n.name)});return}o.properties&&!((s=o.properties)!=null&&s[We])&&(o.properties[We]=!0,t.ignoredByMonsters=!0,n.actions--)}},Po={magicHerbsOnReset:(e,o)=>{o.properties&&(o.properties[We]=!1)},necklaceOfLightOnUse:(e,o)=>{o.properties&&(o.properties[We]=!1),e.heroes.forEach(n=>n.ignoredByMonsters=!1)}},Et=(e,o)=>{if(o.effect&&e.currentActor){const n=kt[o.effect];n(e,o,e.currentActor,e.targetActor),e.targetActor=void 0}},Bo=e=>{e.heroes.forEach(o=>{o.inventory.filter(n=>It(n)).forEach(n=>{if(n.reset){const t=Po[n.reset];t(e,n)}})})},Go=e=>{e.heroes.forEach(o=>{o.inventory.filter(n=>Dt(n)).forEach(n=>{if(n.reset){const t=Po[n.reset];t(e,n)}})})},Dt=e=>e.properties?(e.properties[Lo]??[]).some(n=>n===wo):!1,It=e=>e.properties?(e.properties[Lo]??[]).some(n=>n===Ho):!1,Ot=e=>{const o=e.currentActor;if(o.blinded){y(e,"logs.heroAction.blinded",{hero:h(o.name)});return}const n=o.inventory.filter(a=>{var u;return(u=a.properties)==null?void 0:u[Wn]}).map(a=>{var u;return y(e,"logs.heroAction.searchBonus",{hero:h(o.name),item:h(a.name)}),(u=a.properties)==null?void 0:u[Wn]}).reduce((a,u)=>a+u,0),t=ze(o.level,1+n);let s,i,r,l;t>=1?(s=Gt(e,o,t),s||(i=wt(e,o,t)),!s&&!i&&(r=Ht(e,o,t)),!s&&!i&&!r&&(l=Nt(e,o,t)),!s&&!i&&!r&&!l&&y(e,"logs.heroAction.searchFoundNothing",{hero:h(o.name)})):y(e,"logs.heroAction.searchFoundNothing",{hero:h(o.name)})},Uo=e=>{const o=e.currentActor;if(!o)return!1;const n=e.dungeon.layout.secrets.filter(t=>t.type===te.TRAP_DOOR).filter(t=>!t.found).find(t=>Ae(t.position,o.position));return n?(xe(e,Rt(n),o,!1),y(e,"logs.heroAction.pitfall",{hero:h(o.name)}),o.movement=0,o.actions=0,o.incapacitated=!0,n.found=!0,!0):!1},Ko=(e,o)=>{const n=e.itemDeck.findIndex(t=>t.type===o.type&&t.name===o.name);e.itemDeck.splice(n,1)},Fo=(e,o)=>{const n=e.magicItemDeck.findIndex(t=>t.type===o.type&&t.name===o.name);e.magicItemDeck.splice(n,1)},Rt=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:W.Red,maxHealth:0,name:"Trap Door",level:pe.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:J.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),Mt=(e,o)=>e.dungeon.layout.doors.filter(n=>n.hidden).find(n=>_n({x:n.x,y:n.y},o.x,o.y)),Ct=(e,o)=>e.dungeon.layout.doors.filter(n=>n.trapped).find(n=>n.x===o.x&&n.y===o.y),Tt=(e,o)=>e.dungeon.layout.secrets.filter(n=>!n.found).find(n=>_n(n.position,o.x,o.y)),Lt=(e,o)=>e.dungeon.layout.secrets.filter(n=>!n.found).filter(n=>n.type===te.TRAP_DOOR).find(n=>_n(n.position,o.x,o.y)),wt=(e,o,n)=>{const t=Mt(e,o.position);return t?(t.hidden=!1,y(e,"logs.heroAction.foundDoor",{hero:h(o.name),result:`${n}`}),!0):!1},Ht=(e,o,n)=>{const t=Ct(e,o.position);return t?(y(e,"logs.heroAction.foundTrapInDoor",{hero:h(o.name),result:`${n}`}),t.trapped=!1,!0):!1},Nt=(e,o,n)=>{const t=Tt(e,o.position);if(t){switch(y(e,"logs.heroAction.foundSecret",{hero:h(o.name),result:`${n}`,secret:h(t.name)}),t.found=!0,t.type){case te.EQUIPMENT:{const s=t.item??Pt(e);s.amountInDeck>0&&(Ko(e,s),y(e,"logs.heroAction.equipped",{hero:h(o.name),item:h(s.name)}),xo(e,s,o));break}case te.MAGIC_ITEM:{const s=t.item??Bt(e);s.amountInDeck>0&&(Fo(e,s),y(e,"logs.heroAction.found",{hero:h(o.name),item:h(s.name)}),o.inventory.push(s),s.pickup&&Pn[s.pickup](e,s,o));break}}return!0}return!1},Pt=e=>{const o=e.itemDeck.length,n=Math.floor(Math.random()*o);return e.itemDeck[n]},Bt=e=>{const o=e.magicItemDeck.length,n=Math.floor(Math.random()*o);return e.magicItemDeck[n]},Gt=(e,o,n)=>{const t=Lt(e,o.position);return t?(y(e,"logs.heroAction.foundSecret",{hero:h(o.name),result:`${n}`,secret:h(t.name)}),t.found=!0,!0):!1},vn=(e,o)=>(un[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:pe.APPRENTICE,health:7,maxHealth:7,colour:o,experience:0,position:{x:-1,y:-1},weapon:un[0],incapacitated:!1,inventory:[],isInventoryOpen:!1}),Je=(e,o)=>{ae(o);const n=o.currentActor;if(!n||n.actions===0)return;const t={x:n.position.x,y:n.position.y};switch(e){case"UL":t.x=n.position.x-1,t.y=n.position.y-1;break;case"U":t.y=n.position.y-1;break;case"UR":t.x=n.position.x+1,t.y=n.position.y-1;break;case"L":t.x=n.position.x-1;break;case"R":t.x=n.position.x+1;break;case"DL":t.x=n.position.x-1,t.y=n.position.y+1;break;case"D":t.y=n.position.y+1;break;case"DR":t.x=n.position.x+1,t.y=n.position.y+1;break}const s=mn(o,t.x,t.y),i=!Dn(o.dungeon.layout,t.x,t.y),r=dn(o,t.x,t.y);if(!s&&!i){const l=on(o.dungeon,t.x,t.y);l?l&&(r?Vo(n,o,t):Qo(n,o,t.x,t.y,1)):Wt(o,n,t.x,t.y)&&sn(n,o,t.x,t.y)}else y(o,"logs.heroAction.illegalMove",{hero:h(n.name)});Uo(o)||Bn(n)},Wo=e=>{ae(e);const o=e.currentActor;if(!o)return;if(o.blinded){y(e,"logs.heroAction.blinded",{hero:h(o.name)});return}if(!je(o)){y(e,"logs.heroAction.noActions",{hero:h(o.name)});return}const n=e.dungeon.layout.doors.find(t=>t.x===o.position.x&&t.y===o.position.y);n&&n.locked&&(ze(o.level,1)>=1?(n.locked=!1,y(e,"logs.heroAction.pickedLock",{hero:h(o.name)})):y(e,"logs.heroAction.failedToPickLock",{hero:h(o.name)}),o.actions>1&&o.movement<3?o.actions-=2:o.actions--,o.movement=Ve(o),o.actions==0&&(o.movement=0))},En=e=>{ae(e),e.heroes.forEach((o,n)=>{o.position=e.dungeon.startingPositions[n],o.movement=Ve(o),o.actions=2,o.health=o.maxHealth})},x=e=>e.heroes.filter(o=>o.health>0).map(o=>o),Ut=e=>{ae(e);const o=e.currentActor;o&&(o.actions--,o.movement=Ve(o),o.actions===0&&Hn(e))},je=e=>e.movement<Ve(e)?e.actions>1:e.actions>0,sn=(e,o,n,t)=>{ae(o);const s=Ce(o.dungeon.layout.grid,n,t);s&&![gn,pn,nn].includes(s)&&o.dungeon.discoveredRooms.push(s),Qo(e,o,e.position.x,e.position.y,1),y(o,"logs.heroAction.openedDoor",{hero:h(e.name)})},Vo=(e,o,n)=>{if(ae(o),e.actions===1&&e.movement<e.maxMovement){y(o,"logs.heroAction.noActions",{hero:h(e.name)});return}if(!e.weapon.useHearHeroes&&Xt(o,e)){y(o,"logs.heroAction.notNearFriend",{hero:h(e.name),weapon:h(e.weapon.name)});return}const t=qt(o,n);t&&(xe(o,e,t,!1),t.health<=0&&Yt(o,t,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},Yo=e=>{ae(e);const o=e.currentActor;if(o){if(o.blinded){y(e,"logs.heroAction.blinded",{hero:h(o.name)});return}if(!je(o)){y(e,"logs.heroAction.noActions",{hero:h(o.name)});return}Ot(e),o.actions>1&&o.movement<Ve(o)?o.actions-=2:o.actions--,o.actions==0&&(o.movement=0)}},dn=(e,o,n)=>e.dungeon.layout.monsters.some(t=>t.position.x===o&&t.position.y===n&&t.health>0),mn=(e,o,n)=>x(e).some(t=>t.position.x===o&&t.position.y===n),Bn=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=Ve(e))),e.actions==0&&(e.movement=0)},Kt=e=>{ae(e),x(e).forEach(o=>{const n=o.level;o.experience>=28?o.level=pe.MASTER:o.experience>=18?o.level=pe.LORD:o.experience>=10?o.level=pe.HERO:o.experience>=4&&(o.level=pe.KNIGHT),n!==o.level&&y(e,"logs.heroAction.leveledUp",{hero:h(o.name),level:h(`content.level.${o.level}`)})})},Ft=e=>{x(e).forEach(o=>o.experience+=1)},qo=e=>{Jt(e).forEach(o=>{o.experience=0,o.health=o.maxHealth,o.movement=o.maxMovement,o.actions=2})},Xo=(e,o,n)=>!n.open&&!n.hidden&&(!n.locked||n.locked&&o)&&e.movement>0,Jo=(e,o)=>{const n=e.dungeon.layout.notes.find(t=>Ae(t.position,o.position));n&&(e.dungeon.layout.doors.some(s=>s.hidden&&Ae(n.position,{x:s.x,y:s.y}))||(y(e,"logs.heroAction.reads",{hero:h(o.name),note:h(n.message)}),n.found=!0,n.foundOn=e.turnCount))},So=(e,o)=>{const n=e.dungeon.layout.monsters.some(t=>_n(o.position,t.position.x,t.position.y));return n&&y(e,"logs.heroAction.walkedByMonster",{hero:h(o.name)}),n},Rn=(e,o,n)=>{y(e,"logs.heroAction.drop",{hero:h(n.name),item:h(o.name)}),e.dungeon.layout.items.push({item:o,position:n.position}),o.drop&&No[o.drop](e,o,n)},xo=(e,o,n)=>{switch(o.type){case J.ARMOUR:n.armour&&Rn(e,n.armour,n),n.armour=o;break;case J.SHIELD:n.shield&&Rn(e,n.shield,n),n.shield=o;break;case J.WEAPON:n.weapon&&Rn(e,n.weapon,n),n.weapon=o;break;default:n.inventory.push(o);break}if(o.pickup){const t=Pn[o.pickup];t(e,o,n)}},Qo=(e,o,n,t,s)=>{e.position.x=n,e.position.y=t,Jo(o,e),So(o,e)?e.movement=0:e.movement-=s},Wt=(e,o,n,t)=>{const s=e.dungeon.layout.doors.find(r=>r.x===o.position.x&&r.y===o.position.y),i=o.inventory.some(r=>{var l;return(l=r.properties)==null?void 0:l[To]});if(s&&Xo(o,i,s)){s.locked&&i&&y(e,"logs.heroAction.brokeLock",{hero:h(o.name)});const r=Vt(o.position.x,o.position.y,n,t);if(s.side===r)return s.open=!0,s.trapped&&xe(e,ut(s),o,!1),!0}return s&&s.locked&&y(e,"logs.heroAction.locked"),!1},Vt=(e,o,n,t)=>{if(e===n){if(o>t)return k.UP;if(o<t)return k.DOWN}if(o===t){if(e>n)return k.LEFT;if(e<n)return k.RIGHT}},Yt=(e,o,n)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(t=>t!=o),e.dungeon.killCount++,n.experience+=o.experience},qt=(e,o)=>e.dungeon.layout.monsters.find(n=>Ae(n.position,o)),Xt=(e,o)=>ft(e,o).filter(n=>n!==o).length>0,Jt=e=>e.heroes.filter(o=>o.health<=0).map(o=>o),pn=" ",nn="?",gn="#",St={hasNecklaceOfLight:(e,o)=>{const n=x(e).some(t=>t.inventory.some(s=>s.name==="items.magicItems.necklaceOfLight.name"));return e.settings.debug&&y(e,"logs.debug.hasNecklaceOfLight",{hasNecklaceOfLight:n?"Y":"N"}),o.fulfilled&&n}},xt=(e,o,n)=>({item:n,position:{x:e,y:o}}),me=(e,o,n,t)=>({type:e,name:o,position:{x:n,y:t},found:!1}),cn=(e,o,n,t)=>({type:e,name:t.name,position:{x:o,y:n},found:!1,item:t}),X=(e,o,n)=>({side:e,x:o,y:n,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),Zo=(e,o,n,t)=>({...X(e,o,n),trapped:!0,trapAttacks:t}),Pe=(e,o,n)=>({...X(e,o,n),hidden:!0}),$e=(e,o,n)=>({...X(e,o,n),locked:!0}),rn=(e,o,n,t)=>({...X(e,o,n),locked:!0,trapped:!0,trapAttacks:t}),Ln=(e,o,n,t)=>({...X(e,o,n),hidden:!0,trapped:!0,trapAttacks:t}),jo=(e,o,n,t,s)=>{const i=se(e,o,n,t);return i.inventory=s,i},se=(e,o,n,t)=>{const s=Object.values(W).indexOf(o),i=Object.keys(W)[s];let r=pe.MASTER,l=2,a=2,u=4,c=4,d=4,v=tn[3],_=On[2],P,T;return e===G.ORCH?(r=pe.APPRENTICE,a=0,u=2,c=2,d=1,v=tn[0],P=tn[1],_=On[0]):e===G.TROLL?(r=pe.KNIGHT,a=1,u=3,c=3,d=2,v=tn[2],_=On[1]):e===G.YELLOW_DARK_LORD?l=3:e===G.GREEN_DARK_LORD?v=tn[4]:e===G.BLUE_DARK_LORD&&(T=At[0]),{type:e,level:r,colour:o,actions:l,defense:a,health:u,maxHealth:c,experience:d,weapon:v,armour:_,shield:T,rangedWeapon:P,name:e+" ("+i+")",movement:3,maxMovement:3,position:{x:n,y:t},incapacitated:!1,inventory:[]}},Ee=[{name:"items.magicItems.healingHerbs.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"items.magicItems.healingHerbs.description",RESET_ON:[bt,Ho]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"items.magicItems.boots.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.boots.description",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"items.magicItems.giantsGlove.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.giantsGlove.description",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"items.magicItems.ringOfPrecision.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.ringOfPrecision.description",RE_ROLL_ATTACK:!0}},{name:"items.magicItems.crownOfWisdom.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.crownOfWisdom.description",SEARCH_BONUS:1}},{name:"items.magicItems.swordOfChaos.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.swordOfChaos.description"},effect:"chaosSwordOnUse"},{name:"items.magicItems.potionOfSpeed.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.potionOfSpeed.description",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"items.magicItems.necklaceOfLight.name",type:J.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[wo],ACTIVE:!0,DESCRIPTION:"items.magicItems.necklaceOfLight.description"},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],$o={name:"campaign.iceDragon.e1m4.name",beaten:!1,winConditions:[{type:re.KILL_AT_LEAST,killMinCount:7,fulfilled:!1},{type:re.KILL_ALL,fulfilled:!1},{type:re.REACH_CELL,fulfilled:!1,targetCell:{x:16,y:11},checkFulfilled:"hasNecklaceOfLight",additionalDescription:"content.winConditions.additional.requiresNecklace"}],startingPositions:[{x:3,y:2},{x:2,y:1},{x:2,y:2},{x:2,y:3}],discoveredRooms:["A"],layout:{grid:[" ##### ########   "," #AAA###CCCCCC#   "," #AAABBBCCCCCC#   "," #AAA###CCCCCC#   "," ##D## #####G##   ","  #D#  #####G##   ","###D## #####G##   ","#EEEE###HHHHHH#   ","#EEEEFFFHHHHHH#   ","##L#####HHHHHH####","##L#NNN#HHHHHHIII#","##L#NNN####K##III#","#MMMNNN####K##III#","#MMM#######K###J##","#MMM###PPPPPPPJJ##","#MMMPPPPPPPPPP####","#######PPPPPPP#   ","      #########   "],corridors:["B","D","G","F","L","K","J"],pits:[],doors:[X(k.DOWN,3,3),$e(k.RIGHT,4,2),X(k.RIGHT,7,2),$e(k.DOWN,12,3),X(k.DOWN,3,6),X(k.DOWN,12,6),Pe(k.DOWN,2,8),rn(k.RIGHT,4,8,2),X(k.RIGHT,7,8),X(k.DOWN,11,10),X(k.DOWN,2,11),Pe(k.RIGHT,3,12),X(k.DOWN,3,15),Zo(k.DOWN,11,13,2),Ln(k.RIGHT,13,10,2),Ln(k.RIGHT,13,14,2),Pe(k.UP,15,13)],monsters:[se(G.ORCH,W.Blue,12,1),se(G.ORCH,W.Red,12,6),se(G.ORCH,W.Green,2,8),se(G.ORCH,W.Yellow,2,14),se(G.TROLL,W.Blue,10,9),jo(G.TROLL,W.Yellow,9,15,[Ee[7]]),se(G.RED_DARK_LORD,W.Red,16,10)],secrets:[me(te.NOTE,"campaign.iceDragon.e1m4.secrets.note1",13,2),me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",4,10),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",5,15),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",14,10),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",15,11),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",14,12)],notes:[{position:{x:11,y:8},message:"campaign.iceDragon.e1m4.notes.liberVortex"},{position:{x:13,y:10},message:"campaign.iceDragon.e1m4.notes.ironDoor"}],items:[xt(3,8,un[1])]},killCount:0},zo={name:"campaign.iceDragon.e1m3.name",nextDungeon:$o,beaten:!1,winConditions:[{type:re.KILL_ALL,fulfilled:!1},{type:re.OPEN_DOOR,targetCell:{x:18,y:4},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["       ########     ","     ###DDDEEE#     ","     #CCC##EEE#     ","######CCC##EEE######","#AAA##CCC####F#IIII#","#AAABBB#J####F#IIII#","#AAA####J##G#F#IIII#","##### ##J##GGF#IIII#","   ####KKK###F#IIII#","   #LLLKKK# #FMIIII#","   ####KKK####M#####","      #KKKMMMMM#    ","      ####MMMM##    ","         ######     "],corridors:["B","D","F","L"],pits:[{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:15,y:8},{x:16,y:8},{x:17,y:8}],doors:[X(k.RIGHT,3,5),rn(k.DOWN,6,5,1),X(k.UP,6,5),X(k.DOWN,8,4),Pe(k.UP,8,2),X(k.DOWN,8,7),X(k.LEFT,7,9),rn(k.LEFT,4,9,1),rn(k.RIGHT,9,11,1),Pe(k.RIGHT,14,9),Pe(k.UP,18,4),rn(k.LEFT,14,9,1),X(k.LEFT,13,7),$e(k.UP,11,6),X(k.UP,13,4),X(k.LEFT,11,1)],monsters:[se(G.ORCH,W.Yellow,5,5),jo(G.TROLL,W.Yellow,7,3,[Ee[3]]),se(G.ORCH,W.Red,7,11),se(G.ORCH,W.Blue,11,2),se(G.ORCH,W.Blue,14,11),se(G.YELLOW_DARK_LORD,W.Yellow,18,5)],secrets:[cn(te.MAGIC_ITEM,8,10,Ee[2]),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",8,6),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,1),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,7),me(te.TRAP_DOOR,"campaign.iceDragon.trapDoor",13,11)],notes:[{position:{x:6,y:5},message:"campaign.iceDragon.e1m3.notes.hint1"},{position:{x:8,y:3},message:"campaign.iceDragon.e1m3.notes.hint2"},{position:{x:8,y:8},message:"campaign.iceDragon.e1m3.notes.hint3"},{position:{x:14,y:10},message:"campaign.iceDragon.e1m3.notes.hint4"}],items:[]},killCount:0},et={name:"campaign.iceDragon.e1m2.name",nextDungeon:zo,beaten:!1,winConditions:[{type:re.KILL_ALL,fulfilled:!1},{type:re.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[X(k.UP,2,13),X(k.UP,2,10),X(k.RIGHT,3,8),$e(k.RIGHT,6,8),X(k.UP,8,7),X(k.UP,8,4),Pe(k.LEFT,7,2),X(k.LEFT,4,2),$e(k.RIGHT,12,2),X(k.RIGHT,15,2),X(k.DOWN,17,7),X(k.DOWN,17,10),Pe(k.DOWN,17,14)],monsters:[se(G.TROLL,W.Red,3,7),se(G.ORCH,W.Red,12,8),se(G.ORCH,W.Green,11,1),se(G.TROLL,W.Green,2,2),se(G.ORCH,W.Yellow,18,7),se(G.TROLL,W.Yellow,17,10)],secrets:[me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,3),me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",3,3),me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",15,2),cn(te.MAGIC_ITEM,2,3,Ee[1]),cn(te.MAGIC_ITEM,16,11,Ee[6])],notes:[{message:"campaign.iceDragon.e1m2.notes.hint1",position:{x:2,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint2",position:{x:8,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint3",position:{x:2,y:3}},{message:"campaign.iceDragon.e1m2.notes.hint4",position:{x:17,y:11}}],items:[]},killCount:0},nt={name:"campaign.iceDragon.e1m1.name",nextDungeon:et,beaten:!1,winConditions:[{type:re.KILL_ALL,fulfilled:!1},{type:re.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[X(k.RIGHT,3,5),X(k.RIGHT,6,5),X(k.RIGHT,10,6),X(k.RIGHT,13,6),X(k.RIGHT,10,9),X(k.RIGHT,13,9),X(k.RIGHT,12,3),Pe(k.UP,10,4),Pe(k.RIGHT,15,2)],monsters:[se(G.ORCH,W.Blue,10,8),se(G.ORCH,W.Red,13,9),se(G.TROLL,W.Red,16,2),se(G.TROLL,W.Yellow,14,7)],secrets:[me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",10,5),me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",13,1),me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",16,10),cn(te.MAGIC_ITEM,16,6,Ee[0])],notes:[{message:"campaign.iceDragon.e1m1.notes.hint1",position:{x:3,y:5}},{message:"campaign.iceDragon.e1m1.notes.hint2",position:{x:10,y:9}},{message:"campaign.iceDragon.e1m1.notes.hint3",position:{x:10,y:6}},{message:"campaign.iceDragon.e1m1.notes.hint4",position:{x:10,y:4}}],items:[]},killCount:0},ot={name:"campaign.iceDragon.e1mo.name",beaten:!1,winConditions:[{type:re.KILL_ALL,fulfilled:!1}],nextDungeon:nt,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[X(k.RIGHT,3,9),X(k.RIGHT,6,9),X(k.UP,7,7),X(k.UP,7,4)],monsters:[se(G.ORCH,W.Green,6,9),se(G.ORCH,W.Yellow,8,10),se(G.ORCH,W.Red,7,5),se(G.ORCH,W.Red,9,3),se(G.TROLL,W.Green,6,1)],secrets:[],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},Qt=()=>{const e=[];return Ee.forEach(o=>{for(let n=0;n<o.amountInDeck;n++)e.push(o)}),e},Zt=()=>{const e=[];return un.forEach(o=>{for(let n=0;n<o.amountInDeck;n++)e.push(o)}),vt.forEach(o=>{for(let n=0;n<o.amountInDeck;n++)e.push(o)}),yt.forEach(o=>{for(let n=0;n<o.amountInDeck;n++)e.push(o)}),e},jt={name:"campaign.iceDragon.name",dungeons:[ot,nt,et,zo,$o],itemDeck:Zt(),magicItemDeck:Qt(),heroes:[vn("Fearik",W.Yellow),vn("Helbran",W.Red),vn("Siedel",W.Green),vn("Wulf",W.Blue)]},Gn=(e,o)=>{const n=Math.abs(o.x-e.x),t=Math.abs(o.y-e.y),s=Math.min(n,t),i=Math.max(n,t),r=s,l=i-s;let a=Math.sqrt(2);return l===0&&(a=1),Math.floor(a*r+l)},$t=(e,o)=>{ae(e);const n=e.currentActor,t=e.dungeon.layout.items.find(i=>Ae(i.position,n.position));if(t){const i=t.item;i.type===J.MAGIC?Fo(e,i):Ko(e,i);const r=e.dungeon.layout.items.indexOf(t);e.dungeon.layout.items.splice(r,1),y(e,"logs.heroAction.pickUp",{hero:h(n.name),item:h(i.name)}),xo(e,i,n);return}const s=e.dungeon.layout.doors.find(i=>i.x===n.position.x&&i.y===n.position.y&&!i.open);if(s&&!s.hidden){const i=n.inventory.some(r=>{var l;return(l=r.properties)==null?void 0:l[To]});if(Xo(n,i,s)){switch(s.locked&&i&&y(e,"logs.heroAction.brokeLock",{hero:h(n.name)}),s.open=!0,s.trapped&&xe(e,ut(s),n,!1),s.side){case k.RIGHT:sn(n,e,o.x+1,o.y);break;case k.LEFT:sn(n,e,o.x-1,o.y);break;case k.DOWN:sn(n,e,o.x,o.y+1);break;case k.UP:sn(n,e,o.x,o.y-1);break}Bn(n)}else if(s.locked&&!s.hidden){if(!je(n)){y(e,"logs.heroAction.noActions",{hero:h(n.name)});return}y(e,"logs.heroAction.locked"),Wo(e)}}else{if(!je(n)){y(e,"logs.heroAction.noActions",{hero:h(n.name)});return}Yo(e)}},zt=(e,o)=>{ae(e);const n=e.currentActor;if(n.actions===0){n.movement=0,y(e,"logs.heroAction.noActions",{hero:h(n.name)});return}if(Dn(e.dungeon.layout,o.x,o.y)){const s=mn(e,o.x,o.y),i=dn(e,o.x,o.y),r=Gn(n.position,o),l=Un(n.position,o,2,e,!0);if(!s&&!i&&r<=n.movement&&l){if(n.position=o,n.movement-=r,Jo(e,n),So(e,n)&&(n.movement=0),Uo(e))return}else i&&(r<=n.weapon.range?Vo(n,e,o):y(e,"logs.heroAction.monsterOutOfRange"))}Bn(n)},es=(e,o,n)=>{const t=document.getElementById("gameBoard");if(!t)return;const s=t.getBoundingClientRect(),i=Math.min(Math.floor((e.clientX-s.left)/o),n.dungeon.layout.grid[0].length-1),r=Math.min(Math.floor((e.clientY-s.top)/o),n.dungeon.layout.grid.length-1),l=n.dungeon.layout.grid[r][i],a=n.currentActor;i===a.position.x&&r===a.position.y?$t(n,{x:i,y:r}):Se(n.dungeon,l)&&zt(n,{x:i,y:r})},Mn=e=>e.dungeon.layout.monsters.filter(o=>[G.ORCH,G.TROLL].includes(o.type)),ns=e=>{const o=tt(e);o.length===0&&y(e,"logs.monsterAction.noMonsterAct"),o.forEach(n=>{const t=n.actions;for(y(e,"logs.monsterAction.acted",{monster:h(n.name)});n.actions>0;){ae(e);const s=ft(e,n).filter(c=>!c.ignoredByMonsters),i=is(e,n),r=us([...i,...Mn(e)],n),l=cs([...i,...Mn(e)],n),a=fs([...x(e),...Mn(e)],n,e);switch(os(e,n,s,i,r,l,a)){case"MELEE_ATTACK":{const c=ss(s);Xn(e,n,c,!1);break}case"RANGED_ATTACK":{const c=ts(i,n);Xn(e,n,c,!0);break}case"MOVE":{ls(e,n);break}case"DIAGONAL_FIRE_ATTACK":Cn(e,n,r);break;case"ORTHOGONAL_FIRE_ATTACK":Cn(e,n,l);break;case"SAME_ROOM_FIRE_ATTACK":Cn(e,n,a)}n.movement=Ve(n)}n.actions=t,n.movement=Ve(n)})},os=(e,o,n,t,s,i,r)=>n.length>0?"MELEE_ATTACK":!o.rangedWeapon&&s.length===0?"MOVE":t.length>0&&o.rangedWeapon?Math.random()<.1?(y(e,"logs.monsterAction.moveDespiteTarget",{monster:h(o.name)}),"MOVE"):"RANGED_ATTACK":r.length>0?Math.random()<.1?(y(e,"logs.monsterAction.moveDespiteTarget",{monster:h(o.name)}),"MOVE"):"SAME_ROOM_FIRE_ATTACK":t.length>0&&i.length>0?Math.random()<.1?(y(e,"logs.monsterAction.moveDespiteTarget",{monster:h(o.name)}),"MOVE"):"ORTHOGONAL_FIRE_ATTACK":t.length>0&&s.length>0?Math.random()<.1?(y(e,"logs.monsterAction.moveDespiteTarget",{monster:h(o.name)}),"MOVE"):"DIAGONAL_FIRE_ATTACK":"MOVE",ts=(e,o)=>e.filter(n=>!n.shield).sort(n=>ln(o.position,n.position)).sort((n,t)=>t.health-n.health||ln(o.position,n.position)-ln(o.position,t.position))[0],ss=e=>e.sort((o,n)=>n.health-o.health)[0],is=(e,o)=>x(e).filter(n=>!n.ignoredByMonsters).filter(n=>Un(o.position,n.position,48,e,!1)),tt=e=>e.dungeon.layout.monsters.filter(o=>{const n=Ce(e.dungeon.layout.grid,o.position.x,o.position.y);return n&&Se(e.dungeon,n)&&o.health>0}),Xn=(e,o,n,t)=>{xe(e,o,n,t),(o==null?void 0:o.actions)>1&&(o==null?void 0:o.movement)<3?o.actions-=2:o.actions--},rs=(e,o)=>x(e).map(n=>({hero:n,dist:ln(n.position,o.position)})).sort((n,t)=>n.dist-t.dist)[0],ls=(e,o)=>{const n=rs(e,o);for(;o.movement>0;){if(n&&n.dist>1){const t=as(e,o.position);if(t.length>0){const s=t.map(i=>({pos:i,dist:ln(i,n.hero.position)})).sort((i,r)=>i.dist-r.dist)[0].pos;o.position=s,y(e,"logs.monsterAction.movedTowards",{monster:h(o.name),hero:h(n.hero.name),x:`${s.x}`,y:`${s.y}`})}else y(e,"logs.monsterAction.couldNotMove",{monster:h(o.name)})}o.movement--}o.actions--},as=(e,o)=>{const n=o.x,t=o.y,s=[];for(let i=n-1;i<=n+1;i++)for(let r=t-1;r<=t+1;r++)i===n&&r===t||Dn(e.dungeon.layout,i,r)&&on(e.dungeon,i,r)&&s.push({x:i,y:r});return s.filter(i=>!x(e).find(r=>r.position.x===i.x&&r.position.y===i.y)).filter(i=>!e.dungeon.layout.monsters.some(r=>r.position.x===i.x&&r.position.y===i.y))},us=(e,o)=>e.filter(n=>[G.YELLOW_DARK_LORD,G.BLUE_DARK_LORD].includes(o.type)&&Math.abs(o.position.x-n.position.x)===Math.abs(o.position.y-n.position.y)&&Gn(o.position,n.position)>1),cs=(e,o)=>e.filter(n=>[G.RED_DARK_LORD,G.BLUE_DARK_LORD].includes(o.type)&&(o.position.x===n.position.x||o.position.y===n.position.y)&&Gn(o.position,n.position)>1),fs=(e,o,n)=>e.filter(t=>[G.GREEN_DARK_LORD,G.BLUE_DARK_LORD].includes(o.type)&&Ce(n.dungeon.layout.grid,o.position.x,o.position.y)===Ce(n.dungeon.layout.grid,t.position.x,t.position.y)),Cn=(e,o,n)=>{n.forEach(t=>{var s,i;(s=t.armour)!=null&&s.magicProtection?y(e,"logs.monsterAction.fireAttackDeflected",{monster:h(o.name),target:h(t.name),armour:h((i=t.armour)==null?void 0:i.name)}):xe(e,o,t,!0)})},Jn=[{name:"events.hungryTroll.name",number:1,description:"events.hungryTroll.description",effect:"theHungryTroll",used:!1},{name:"events.sunStone.name",number:2,description:"events.sunStone.description",effect:"sunStone",used:!1},{name:"events.timePortal.name",number:3,description:"events.timePortal.description",effect:"timePortal",used:!1},{name:"events.fountainOfYouth.name",number:4,description:"events.fountainOfYouth.description",effect:"fountainOfYouth",used:!1},{name:"events.sleepingGas.name",number:5,description:"events.sleepingGas.description",effect:"sleepingGasCloud",used:!1},{name:"events.lostOrch.name",number:6,description:"events.lostOrch.description",effect:"theLostOrch",used:!1},{name:"events.dragonsBreath.name",number:7,description:"events.dragonsBreath.description",effect:"theDragonsBreath",used:!1},{name:"events.landslide.name",number:8,description:"events.landslide.description",effect:"landslide",used:!1},{name:"events.magicNode.name",number:9,description:"events.magicNode.description",effect:"fountainOfYouth",used:!1},{name:"events.foresight.name",number:10,description:"events.foresight.description",effect:"foresight",used:!1},{name:"events.earthquake.name",number:11,description:"events.earthquake.description",effect:"earthquake",used:!1},{name:"events.magicStorm.name",number:12,description:"events.magicStorm.description",effect:"theMagicStorm",used:!1},{name:"events.elementalWeapon.name",number:13,description:"events.elementalWeapon.description",effect:"theElementalWeapon",used:!1},{name:"events.orchDrums.name",number:14,description:"events.orchDrums.description",effect:"theOrchDrums",used:!1},{name:"events.weakness.name",number:15,description:"events.weakness.description",effect:"theSymbolOfWeakness",used:!1}],st=e=>e.events?wn(Jn.filter(o=>{var n;return(n=e==null?void 0:e.events)==null?void 0:n.includes(o.number)})):wn(Jn),it=e=>{const o=e.eventDeck.filter(n=>!n.used);return o.length>0?o[0]:(wn(e.eventDeck),it(e))},ds={sunStone:(e,o)=>{ke(e,o);const n=x(e).length-1,t=Math.floor(Math.random()*n),s=x(e)[t],i=Ce(e.dungeon.layout.grid,s.position.x,s.position.y);e.dungeon.layout.monsters.filter(r=>r.type===G.TROLL).filter(r=>Ce(e.dungeon.layout.grid,r.position.x,r.position.y)===i).forEach(r=>{y(e,"logs.events.sunStone",{monster:h(r.name)}),r.health=0}),o.used=!0},theHungryTroll:(e,o)=>{ke(e,o),Sn(e,G.TROLL),o.used=!0},timePortal:(e,o)=>{ke(e,o),e.heroes.forEach(n=>n.actions++),o.used=!0},fountainOfYouth:(e,o)=>{ke(e,o),x(e).forEach(n=>{if(n.health<n.maxHealth){const t=ze(n.level,3);n.health+=Math.min(t,n.maxHealth-n.health)}}),o.used=!0},sleepingGasCloud:(e,o)=>{ke(e,o),x(e).forEach(n=>{n.actions=Math.max(1,n.actions-1)}),o.used=!0},theLostOrch:(e,o)=>{ke(e,o),Sn(e,G.ORCH),o.used=!0},theDragonsBreath:(e,o)=>{ke(e,o),x(e).forEach(n=>n.blinded=!0),o.used=!0},landslide:(e,o)=>{ke(e,o);const n=e.dungeon.layout.corridors.filter(r=>!ys(e,r)).filter(r=>Se(e.dungeon,r)),t=n.length-1,s=Math.floor(Math.random()*t),i=n[s];e.dungeon.collapsedCorridor=i,e.dungeon.layout.grid=e.dungeon.layout.grid.map(r=>r.replaceAll(i,nn)),o.used=!0},foreSight:(e,o)=>{if(ke(e,o),e.dungeon.layout.secrets.filter(t=>t.type===te.EQUIPMENT||t.type===te.MAGIC_ITEM).filter(t=>!t.found).filter(t=>t.item).filter(t=>{const s=Ce(e.dungeon.layout.grid,t.position.x,t.position.y)??"";return!Se(e.dungeon,s)}).length>0){const t=e.dungeon.layout.secrets.pop();t&&t.item&&(y(e,"logs.events.foreSight",{x:`${t.position.x+2}`,y:`${t.position.y-1}`}),e.dungeon.layout.items.push({item:t.item,position:t.position}))}o.used=!0},earthquake:(e,o)=>{ke(e,o);const n=rt(e),t={name:"boulder",type:J.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},s={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:t,level:pe.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:W.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(i=>i.type===G.TROLL).filter(i=>Ce(e.dungeon.layout.grid,i.position.x,i.position.y)===n).forEach(i=>xe(e,s,i,!1)),x(e).filter(i=>Ce(e.dungeon.layout.grid,i.position.x,i.position.y)===n).forEach(i=>xe(e,s,i,!1)),o.used=!0},theMagicStorm:(e,o)=>{var t;ke(e,o);const n=x(e).filter(s=>s.inventory.filter(i=>!i.disabled).some(i=>i.type===J.MAGIC));if(n.length>0){const s=n.length-1,i=Math.floor(Math.random()*s),r=n[i],l=r.inventory.filter(a=>a.type===J.MAGIC);if(l.length>0){const a=l.length-1,u=Math.floor(Math.random()*a),c=l[u];c.disabled=!0,!((t=c.properties)!=null&&t[An])&&c.pickup&&c.drop&&No[c.drop](e,c,r)}}o.used=!0},theElementalWeapon:(e,o)=>{ke(e,o);const n=x(e),t=n.length-1,s=Math.floor(Math.random()*t),i=n[s];i.weapon.elemental=!0,o.used=!0},theOrchDrums:(e,o)=>{ke(e,o),e.dungeon.layout.monsters.filter(n=>n.type===G.ORCH).forEach(n=>n.actions=3),o.used=!0},theSymbolOfWeakness:(e,o)=>{ke(e,o),x(e).forEach(n=>n.weakened=!0),o.used=!0}},ms=e=>{x(e).some(o=>o.weapon.elemental)&&(y(e,"logs.events.magicStormRestored"),x(e).forEach(o=>{o.inventory.forEach(n=>{var t;!((t=n.properties)!=null&&t[An])&&n.pickup&&Pn[n.pickup](e,n,o),n.disabled=!1})}))},ps=e=>{e.eventDeck.filter(n=>!n.used).length===0&&(_s(e),gs(e),ms(e)),vs(e),hs(e)},gs=e=>{const o=e.dungeon.collapsedCorridor;o&&(y(e,"logs.events.landslideRestored"),e.dungeon.layout.grid=e.dungeon.layout.grid.map(n=>n.replaceAll(nn,o)),e.dungeon.collapsedCorridor=void 0)},hs=e=>{x(e).some(o=>o.blinded)&&(y(e,"logs.events.blindedRestored"),x(e).forEach(o=>o.blinded=!1))},_s=e=>{x(e).some(o=>o.weapon.elemental)&&(y(e,"logs.events.elementalWeaponRestored"),x(e).forEach(o=>o.weapon.elemental=!1))},vs=e=>{x(e).some(o=>o.weakened)&&(y(e,"logs.events.weakenedRestored"),x(e).forEach(o=>o.weakened=!1))},rt=e=>{const o=e.dungeon.discoveredRooms.length-1,n=Math.floor(Math.random()*o);return e.dungeon.discoveredRooms[n]},Sn=(e,o)=>{const n=tt(e).filter(l=>l.type===o);if(n.length===4)return;const s=rt(e),i=[W.Red,W.Green,W.Yellow,W.Blue];n.forEach(l=>{const a=i.indexOf(l.colour);a!==-1&&i.splice(a,1)});let r=!1;for(let l=0;l<e.dungeon.layout.grid.length;l++){const a=hn(e.dungeon.layout.grid[l]);for(let u=0;u<a.length;u++)if(a[u]===s&&!mn(e,u,l)&&!dn(e,u,l)){e.dungeon.layout.monsters.push(se(o,i[0],u,l)),r=!0;break}if(r)break}},ke=(e,o)=>{y(e,o.description),y(e,o.name)},wn=e=>{let o=e.length,n;for(;o>0;)n=Math.floor(Math.random()*o),o--,[e[o],e[n]]=[e[n],e[o]];return e.forEach(t=>t.used=!1),e},ys=(e,o)=>{const n=[];return e.dungeon.layout.grid.forEach((t,s)=>{hn(t).forEach((i,r)=>{i===o&&n.push(mn(e,r,s)||dn(e,r,s))})}),n.some(t=>t)},h=(e,o)=>Ue.get(e,o)??e,As=e=>{ae(e),localStorage.setItem("state",JSON.stringify(e)),y(e,"logs.gameSaved")},ae=e=>{e.reRender=!0,localStorage.setItem("reloadGuard",JSON.stringify(e))},lt=e=>(e.currentActor=e.heroes.find(o=>{var n;return o.name===((n=e.currentActor)==null?void 0:n.name)}),y(e,"logs.gameLoaded"),ae(e),e),at=()=>{const e=structuredClone(jt),o={heroes:e.heroes,dungeon:e.dungeons[0],currentActor:e.heroes[0],actionLog:[{key:"logs.playingCampaign",properties:{name:h(e.name)},turn:0},{key:"logs.gameInitialized",turn:0},{key:"logs.initLogActions",turn:0},{key:"logs.initLogMoves",turn:0},{key:"logs.initLogMoveFinished",turn:0},{key:"logs.initLogUnfair",turn:0}],itemDeck:xn(e.itemDeck),magicItemDeck:xn(e.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:st(e.dungeons[0]),reRender:!0};return En(o),localStorage.setItem("autosave",JSON.stringify(o)),o},xn=e=>{let o=e.length,n;for(;o>0;)n=Math.floor(Math.random()*o),o--,[e[o],e[n]]=[e[n],e[o]];return e},hn=e=>{const o=[];for(let n=0;n<e.length;n++)o.push(e[n]);return o},ze=(e,o)=>{let n=[];for(let t=0;t<o;t++)n.push(Math.floor(Math.random()*6)+1);switch(e){case pe.APPRENTICE:n=n.filter(t=>t===5);break;case pe.KNIGHT:case pe.HERO:n=n.filter(t=>t>=4);break;case pe.LORD:case pe.MASTER:n=n.filter(t=>t>=3);break}return n.length},Ve=e=>{var o;return e.maxMovement-(((o=e.armour)==null?void 0:o.movementReduction)??0)},bs=e=>e.dungeon.winConditions.filter(o=>o.type===re.KILL_ALL).some(o=>o.fulfilled),Hn=e=>{if(e.settings.debug&&console.log(e),ae(e),Es(e),e.currentActor===void 0)return e;{y(e,"logs.endedTurn",{name:h(e.currentActor.name)});let n=x(e).indexOf(e.currentActor)+1;if(n===x(e).length&&(ns(e),n=0,Go(e)),x(e).length===0)return ks(e);x(e)[n].incapacitated&&(y(e,"logs.noLongerIncapacitated",{name:h(x(e)[n].name)}),x(e)[n].incapacitated=!1,n++),e.currentActor.actions=2,e.currentActor.movement=Ve(e.currentActor),e.currentActor=x(e)[n];const t=bs(e);if(n===0&&!t){ps(e);const s=it(e);e.currentEvent=s,ds[s.effect](e,s)}n===0&&(e.turnCount=(e.turnCount??0)+1),y(e,"logs.startedTurn",{name:h(e.currentActor.name)})}return e},ks=e=>{const o=localStorage.getItem("autosave");if(o){const n=JSON.parse(o);return ae(n),qo(n),En(n),Bo(n),Go(n),ct({x:n.dungeon.startingPositions[0].x,y:n.dungeon.startingPositions[0].y},n.settings.cellSize),n.currentActor=n.heroes.find(t=>{var s;return t.name===((s=n.currentActor)==null?void 0:s.name)}),y(n,"logs.allHeroesDead"),n}return y(e,"logs.failedToReset"),e},Es=e=>{var o,n;e.dungeon.winConditions.forEach(t=>{var s;switch(t.type){case re.KILL_ALL:{const i=e.dungeon.layout.monsters.map(r=>r.health).reduce((r,l)=>r+l,0);t.fulfilled=i<=0;break}case re.REACH_CELL:{t.fulfilled=x(e).some(i=>{var r;return i.position.x===((r=t.targetCell)==null?void 0:r.x)&&i.position.y===t.targetCell.y});break}case re.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(i=>i.type===t.targetMonsterType).some(i=>i.health>0);break}case re.OPEN_DOOR:{t.fulfilled=((s=e.dungeon.layout.doors.find(i=>{var r,l;return i.x===((r=t.targetCell)==null?void 0:r.x)&&i.y===((l=t.targetCell)==null?void 0:l.y)}))==null?void 0:s.open)??!1;break}case re.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}t.checkFulfilled&&(t.fulfilled=St[t.checkFulfilled](e,t))}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,s)=>t&&s,!0),e.dungeon.beaten&&(y(e,"logs.allConditionsFulfilled"),y(e,"logs.clearedDungeon",{name:h(e.dungeon.name)}),(o=e.dungeon.nextDungeon)!=null&&o.name&&y(e,"logs.moveToNext",{name:h((n=e.dungeon.nextDungeon)==null?void 0:n.name)}))},ut=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:W.Red,maxHealth:0,name:"Door",level:pe.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:J.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),Dn=(e,o,n)=>{var s,i;let t=!0;if(o<0||o>=e.grid[0].length||n<0||n>=e.grid.length)t=!1;else{const r=(s=e.pits)==null?void 0:s.some(u=>Ae(u,{x:o,y:n})),l=(i=e.pillars)==null?void 0:i.some(u=>Ae(u,{x:o,y:n})),a=Ce(e.grid,o,n);(r||l||a===pn||a===gn)&&(t=!1)}return t},on=(e,o,n)=>{const t=Ce(e.layout.grid,o,n);return t?Se(e,t):!1},Se=(e,o)=>e.discoveredRooms.includes(o),Ce=(e,o,n)=>{let t="";return e.forEach((s,i)=>{hn(s).forEach((r,l)=>{i===n&&l===o&&(t=r)})}),t},_n=(e,o,n)=>e.x===o&&e.y===n||e.x===o-1&&e.y===n||e.x===o-1&&e.y===n-1||e.x===o&&e.y===n-1||e.x===o+1&&e.y===n-1||e.x===o+1&&e.y===n||e.x===o+1&&e.y===n+1||e.x===o&&e.y===n+1||e.x===o-1&&e.y===n+1,Ds=(e,o,n,t)=>{var i;const s=((i=t.armour)==null?void 0:i.defense)??t.defense;return`${e} damage (${o}-(${s}+${n})=${e})`},Ae=(e,o)=>e.x===o.x&&e.y===o.y,y=(e,o,n)=>{e.actionLog=[{key:o,properties:n,turn:e.turnCount??0},...e.actionLog],ae(e)},xe=(e,o,n,t)=>{var b,A;let s=o.weapon;t&&o.rangedWeapon&&(s=o.rangedWeapon);let i=0,r=0;s.ignoresArmour?n.armour&&y(e,"logs.takeDamage.armourUseless",{actor:h(n.name),weapon:h(s.name)}):i=((b=n.armour)==null?void 0:b.defense)??n.defense,s.ignoresShield?n.shield&&y(e,"logs.takeDamage.shieldUseless",{actor:h(n.name),weapon:h(s.name)}):r=ze(n.level,((A=n.shield)==null?void 0:A.dice)??0);const l=o.inventory.filter(m=>{var p;return(p=m==null?void 0:m.properties)==null?void 0:p[Vn]}).some(m=>{var p;return y(e,"logs.takeDamage.usedEffect",{actor:h(o.name),item:h(m.name)}),(p=m.properties)==null?void 0:p[Vn]}),a=o.inventory.filter(m=>{var p;return(p=m==null?void 0:m.properties)==null?void 0:p[Fn]}).map(m=>{var p;return y(e,"logs.takeDamage.usedEffect",{actor:h(o.name),item:h(m.name)}),(p=m.properties)==null?void 0:p[Fn]}).reduce((m,p)=>m+p,0),u=o.blinded?1:0,c=o.weakened?1:0,d=o.weapon.elemental?1:0,v=a+d,_=u+c,P=ze(o.level,s.dice+v-_);let T=Math.max(P-(i+r),0);T===0&&l&&(y(e,"logs.takeDamage.reRoll",{actor:h(o.name)}),T=Math.max(P-(i+r),0)),n.health-=T,y(e,"logs.takeDamage.attackedWith",{actor:h(o.name),target:h(n.name),weapon:h(s.name),damage:Ds(T,P,r,n)}),n.health<=0&&(y(e,"logs.takeDamage.killed",{actor:h(o.name),target:h(n.name)}),n.health=0,n.level=pe.APPRENTICE)},ct=(e,o)=>{const n=document.getElementById("gameBoardContainer"),t=document.getElementById("gameBoard");if(n&&t){const s=e.x*o,i=e.y*o,r=t.offsetWidth,l=t.offsetHeight;n.scrollLeft=Math.round(s/r),n.scrollTop=Math.round(i/l)}},Is=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=[{key:"logs.youHaveReached",properties:{name:h(e.dungeon.name)},turn:0}],e.eventDeck=st(e.dungeon),ae(e),Ft(e),Kt(e),qo(e),En(e),Bo(e),ct({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize),localStorage.setItem("autosave",JSON.stringify(e)))},ln=(e,o)=>Math.sqrt(Math.pow(e.x-(o==null?void 0:o.x),2)+Math.pow(e.y-(o==null?void 0:o.y),2)),Un=(e,o,n,t,s)=>{const i={x:e.x*n-Math.floor(n/2),y:e.y*n-Math.floor(n/2)},r={x:o.x*n-Math.floor(n/2),y:o.y*n-Math.floor(n/2)};return Kn(i,e,r,o,n,t,s,[])},Kn=(e,o,n,t,s,i,r,l)=>{var T,b;if(isNaN(e.x)||isNaN(e.y))return!1;const a=Os(e,n),u={x:Math.round((a.x+Math.floor(s/2))/s),y:Math.round((a.y+Math.floor(s/2))/s)};if(isNaN(u.x)||isNaN(u.y)||isNaN(a.x)||isNaN(a.y))return!1;const c=Ce(i.dungeon.layout.grid,u.x,u.y),d=(T=i.dungeon.layout.pits)==null?void 0:T.some(A=>Ae(A,u)),v=(b=i.dungeon.layout.pillars)==null?void 0:b.some(A=>Ae(A,u)),_=i.dungeon.layout.monsters.some(A=>Ae(A.position,u)),P=x(i).filter(A=>!Ae(A.position,o)).some(A=>Ae(A.position,u));return u.x===t.x&&u.y===t.y?(l.push(u),!0):v||_||!r&&P||c===gn||c===nn||r&&(d||c===pn)?!1:(u.x===o.x&&u.y===o.y||l.some(A=>A.x===u.x&&A.y===u.y)||l.push(u),Kn(a,o,n,t,s,i,r,l))},Os=(e,o)=>{const n=e.x,t=e.y,s=o.x-n,i=o.y-t,r=s/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),l=i/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),a=Math.round(r+n),u=Math.round(l+t);return{x:a,y:u}},ft=(e,o)=>x(e).filter(n=>_n(o.position,n.position.x,n.position.y)),Rs=""+new URL("../assets/Dungeon_Tileset.e372bb4f.png",import.meta.url).href,Ms="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",Cs=(e,o,n,t,s)=>{x(t).forEach(r=>{Ts(e,r,o,n,s)}),Ns(e,t,n),Ps(e,t,n)},Ts=(e,o,n,t,s)=>{const i=o.position.x,r=o.position.y;if(e.drawImage(n,4*16,0,16,16,i*t,r*t,t,t),Ls(e,o,i,r,t),Hs(e,o,i,r,t),ws(e,o,i,r,t),s){const l=`(${i},${r})`;e.fillStyle="black",e.font="8px Arial",e.fillText(l,i*t+3,r*t+10)}},Ls=(e,o,n,t,s)=>{const i=e.fillStyle,r=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let l=0;l<o.actions;l++)e.fillRect(n*s+4+6*l,t*s+s-12,5,5),e.rect(n*s+4+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle="blue";for(let l=0;l<o.movement;l++)e.fillRect(n*s+s-22+6*l,t*s+s-12,5,5),e.rect(n*s+s-22+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle=i,e.strokeStyle=r},ws=(e,o,n,t,s)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n*s+4,t*s,s-8,4),e.fillStyle="green",e.fillRect(n*s+4,t*s,(s-8)*(o.health/o.maxHealth),4),e.rect(n*s+4,t*s,s-8,4),e.stroke()},Hs=(e,o,n,t,s)=>{e.beginPath(),e.strokeStyle=o.colour,e.fillStyle=o.colour,e.fillRect(n*s+4,t*s+(s-6),s-8,4),e.stroke()},Ns=(e,o,n)=>{const t=o.currentActor;if(t){for(let s=t.position.x-t.movement;s<=t.position.x+t.movement;s++)for(let i=t.position.y-t.movement;i<=t.position.y+t.movement;i++)if(on(o.dungeon,s,i)&&!(s===(t==null?void 0:t.position.x)&&i===(t==null?void 0:t.position.y))){const l=dn(o,s,i),a=mn(o,s,i),u=Dn(o.dungeon.layout,s,i),c=Un(t.position,{x:s,y:i},2,o,!0);!a&&!l&&u&&c&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(s*n,i*n,n,n),e.stroke())}}},Ps=(e,o,n)=>{const t=o.currentActor;t&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(t.position.x*n,t.position.y*n),e.lineTo(t.position.x*n+n/3,t.position.y*n),e.moveTo(t.position.x*n,t.position.y*n),e.lineTo(t.position.x*n,t.position.y*n+n/3),e.moveTo(t.position.x*n+n,t.position.y*n),e.lineTo(t.position.x*n+n/3*2,t.position.y*n),e.moveTo(t.position.x*n+n,t.position.y*n),e.lineTo(t.position.x*n+n,t.position.y*n+n/3),e.moveTo(t.position.x*n,t.position.y*n+n),e.lineTo(t.position.x*n,t.position.y*n+n/3*2),e.moveTo(t.position.x*n,t.position.y*n+n),e.lineTo(t.position.x*n+n/3,t.position.y*n+n),e.moveTo(t.position.x*n+n,t.position.y*n+n),e.lineTo(t.position.x*n+n,t.position.y*n+n/3*2),e.moveTo(t.position.x*n+n,t.position.y*n+n),e.lineTo(t.position.x*n+n/3*2,t.position.y*n+n),e.stroke(),e.lineWidth=1)},Bs=(e,o,n,t,s)=>{t.dungeon.layout.monsters.forEach(i=>{Gs(e,o,t,i,n,s)})},Gs=(e,o,n,t,s,i)=>{const r=n.dungeon.layout.grid[t.position.y][t.position.x];if(t&&t.health>0&&Se(n.dungeon,r)){switch(t.type){case G.ORCH:Us(e,o,s,t);break;case G.TROLL:Ks(e,o,s,t);break;default:Fs(e,o,s,t);break}Ws(e,t,s),Vs(e,t,s),Ys(e,t,n.heroes,n,s,i)}},Us=(e,o,n,t)=>{e.drawImage(o,n,16,16,16,t.position.x*n,t.position.y*n,n,n)},Ks=(e,o,n,t)=>{e.drawImage(o,n,16,16,16,t.position.x*n,t.position.y*n,n,n)},Fs=(e,o,n,t)=>{e.drawImage(o,16,16,16,16,t.position.x*n,t.position.y*n,n,n)},Ws=(e,o,n)=>{e.beginPath(),e.strokeStyle=o.colour,e.fillStyle=o.colour,e.fillRect(o.position.x*n+4,o.position.y*n+(n-6),n-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Vs=(e,o,n)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(o.position.x*n+4,o.position.y*n,n-8,4),e.fillStyle="green",e.fillRect(o.position.x*n+4,o.position.y*n,(n-8)*(o.health/o.maxHealth),4),e.rect(o.position.x*n+4,o.position.y*n,n-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Ys=(e,o,n,t,s,i)=>{i&&n.forEach(r=>{const l=[],a={x:o.position.x*48-24,y:o.position.y*48-24},u={x:r.position.x*48-24,y:r.position.y*48-24};if(Kn(a,o.position,u,r.position,48,t,!1,l)){const d=o.position.x,v=o.position.y,_=r.position.x,P=r.position.y;e.beginPath(),e.strokeStyle=o.colour,e.lineWidth=2,e.moveTo(d*s+s/2,v*s+s/2),e.lineTo(_*s+s/2,P*s+s/2),e.stroke(),e.lineWidth=1}})},qs=(e,o,n,t,s)=>{t.dungeon.layout.doors.forEach(i=>{ei(e,o,n,t,i,s)})},Xs=(e,o,n,t,s)=>{t.dungeon.layout.grid.forEach((i,r)=>{hn(i).forEach((l,a)=>{Qs(e,o,t,l,a,r,n),zs(e,l,t,a,r,n,s)})}),Ss(e,o,n,t,s),xs(e,o,n,t,s)},Js=(e,o,n,t,s)=>{t.dungeon.layout.secrets.filter(i=>i.found).forEach(i=>{switch(i.type){case te.TRAP_DOOR:js(e,o,n,i);break;default:$s(e,o,n,i);break}}),t.dungeon.layout.secrets.filter(i=>!i.found).forEach(i=>{if(e.globalAlpha=.6,Qe(e,o,8,0,n,i.position.x,i.position.y,t),e.globalAlpha=1,s){const r=`${i.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(i.position.x*n,i.position.y*n,n,n),e.fillStyle="black",e.font="12px Arial",e.fillText(r,i.position.x*n,i.position.y*n+10)}})},Qe=(e,o,n,t,s,i,r,l)=>{l.dungeon.discoveredRooms.some(a=>Qn(i,r,a,l))||Qn(i,r,nn,l)?e.drawImage(o,n*48,t,48,48,i*s,r*s,s,s):dt(e,i,r,s)},Ss=(e,o,n,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pits)==null?void 0:i.filter(l=>on(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{Qe(e,o,7,0,n,l.x,l.y,t)})},xs=(e,o,n,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pillars)==null?void 0:i.filter(l=>on(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{Qe(e,o,6,0,n,l.x,l.y,t)})},Qs=(e,o,n,t,s,i,r)=>{Zs(t,n)?t===nn?(Qe(e,o,0,0,r,s,i,n),Qe(e,o,5,0,r,s,i,n)):Qe(e,o,1,0,r,s,i,n):kn(t,n)?dt(e,s,i,r):Qe(e,o,0,0,r,s,i,n)},Zs=(e,o)=>ni(e)||!Se(o.dungeon,e)&&e!==pn,dt=(e,o,n,t)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="black",e.fillRect(o*t,n*t,t,t),e.stroke()},js=(e,o,n,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(o,3*48,0,48,48,s*n,i*n,n,n)},$s=(e,o,n,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(o,4*48,0,48,48,s*n,i*n,n,n)},zs=(e,o,n,t,s,i,r)=>{!r&&(kn(o,n)||o===gn)||(e.beginPath(),e.strokeStyle="black",e.rect(t*i,s*i,i,i),r&&(e.font="7px Arial",e.fillText(`${o}: ${t},${s}`,t*i+3,s*i+(i-3))),e.stroke())},ei=(e,o,n,t,s,i)=>{const r=t.dungeon.layout.grid[s.y][s.x];if(s&&!s.hidden&&!s.open&&!kn(r,t))switch(e.fillStyle="brown",s.side){case k.RIGHT:{e.fillRect(s.x*n+(n-2),s.y*n,4,n),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*n+(n-4),s.y*n+(n/2-4),8,8));break}case k.LEFT:{e.fillRect(s.x*n-2,s.y*n,4,n),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*n-4,s.y*n+(n/2-4),8,8));break}case k.UP:{e.fillRect(s.x*n,s.y*n-2,n,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*n+(n/2-4),s.y*n-4,8,8));break}case k.DOWN:{e.fillRect(s.x*n,s.y*n+(n-2),n,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*n+(n/2-4),s.y*n+(n-4),8,8));break}}i&&!kn(r,t)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${s.hidden?"H":"-"}/${s.trapped?`T${s.trapAttacks}`:"-"}/${s.locked?"L":"-"}]`,s.x*n,s.y*n+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(s.x*n,s.y*n,n,n))},ni=e=>e===gn,kn=(e,o)=>e===pn||!Se(o.dungeon,e),Qn=(e,o,n,t)=>{if(!t)return;const s=Math.max(e-1,0),i=Math.max(o-1,0),r=Math.min(o+1,t.dungeon.layout.grid.length-1),l=Math.min(e+1,t.dungeon.layout.grid[0].length-1);for(let a=s;a<=l;a++)for(let u=i;u<=r;u++){const c=t.dungeon.layout.grid[u];if(hn(c)[a]===n)return!0}return!1},mt=(e,o,n,t)=>{const s=o.match(/.{1,30}(?:\s|$)/g),i=n.x*t,r=n.y*t+t,l=Math.max((s==null?void 0:s.length)??0,1)*(t/2.5);e.fillStyle="rgba(82,11,159,0.8)",e.beginPath(),e.roundRect(i,r,t*4,l,[0,30,30,30]),e.stroke(),e.fill(),e.font="12px Arial",e.fillStyle="wheat",s==null||s.forEach((a,u)=>{e.fillText(a,i+10,r+14*(u+1))})},oi=(e,o,n,t,s)=>{if(s&&t.dungeon.layout.notes.forEach(l=>{e.font="7px Arial",e.fillStyle="black",e.fillText("N",l.position.x*n+n/2,l.position.y*n+n/2),e.fillStyle="rgba(120, 50, 5, 0.12)",e.fillRect(l.position.x*n,l.position.y*n,n,n)}),!t.currentActor)return;const i=t.currentActor,r=t.dungeon.layout.notes.find(l=>Ae(l.position,i.position));if(r&&!t.dungeon.layout.doors.some(a=>a.hidden&&Ae(r.position,{x:a.x,y:a.y}))){const a=h(r.message);mt(e,a,r.position,n)}},ti=(e,o,n,t,s)=>{t.dungeon.layout.items.forEach(i=>{if(!(!on(t.dungeon,i.position.x,i.position.y)&&!s))switch(i.item.type){case J.MAGIC:Zn(e,o,n,t,i);break;case J.WEAPON:Zn(e,o,n,t,i)}})},Zn=(e,o,n,t,s)=>{const i=s.position.x,r=s.position.y;if(e.drawImage(o,0,48,48,48,i*n,r*n,n,n),!t.currentActor)return;const l=t.currentActor;if(Ae(l==null?void 0:l.position,s.position)){const a=h(s.item.name);mt(e,a,s.position,n)}};function jn(e){let o,n,t=e[2](e[0])+"",s,i;return{c(){o=L("p"),n=M(" "),s=M(t),this.h()},l(r){o=w(r,"P",{class:!0});var l=H(o);n=C(l," "),s=C(l,t),l.forEach(f),this.h()},h(){O(o,"class",i=yn(e[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")},m(r,l){E(r,o,l),g(o,n),g(o,s)},p(r,l){l&1&&t!==(t=r[2](r[0])+"")&&Y(s,t),l&1&&i!==(i=yn(r[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")&&O(o,"class",i)},d(r){r&&f(o)}}}function si(e){let o=e[1],n,t=jn(e);return{c(){t.c(),n=ce()},l(s){t.l(s),n=ce()},m(s,i){t.m(s,i),E(s,n,i)},p(s,[i]){i&2&&ge(o,o=s[1])?(t.d(1),t=jn(s),t.c(),t.m(n.parentNode,n)):t.p(s,i)},i:be,o:be,d(s){s&&f(n),t.d(s)}}}function ii(e,o,n){let t;Ye(e,Ue,u=>n(4,t=u));let{condition:s}=o,{state:i}=o,r=!1;const l=u=>{let c="";switch(u.additionalDescription&&(c=` ${t(u.additionalDescription)}`),u.type){case re.KILL_ALL:return t("content.winConditions.killAll")+c;case re.KILL_ALL_OF_TYPE:return t("content.winConditions.killAll",{type:u.targetMonsterType})+c;case re.KILL_AT_LEAST:return t("content.winConditions.killAtLeast",{minKills:u.killMinCount})+` (${i.dungeon.killCount}/${u.killMinCount})`+c;case re.OPEN_DOOR:return t("content.winConditions.openDoor")+c;case re.REACH_CELL:return t("content.winConditions.reachCell")+c}};fn(()=>{a(),setInterval(a,100)});const a=()=>{i.reRender&&n(1,r=!r)};return e.$$set=u=>{"condition"in u&&n(0,s=u.condition),"state"in u&&n(3,i=u.state)},[s,r,l,i]}class ri extends we{constructor(o){super(),He(this,o,ii,si,ge,{condition:0,state:3})}}function $n(e){let o,n,t,s,i,r,l=e[0].number+"",a,u,c=e[2](e[0].name)+"",d,v,_,P;function T(D,R){return D[1]?ai:li}let b=T(e),A=b(e),m=e[1]&&zn(e),p=e[1]&&eo(e);return{c(){o=L("div"),n=L("button"),A.c(),t=Z(),m&&m.c(),s=Z(),i=L("div"),r=L("span"),a=M(l),u=M(". "),d=M(c),v=Z(),p&&p.c(),this.h()},l(D){o=w(D,"DIV",{});var R=H(o);n=w(R,"BUTTON",{class:!0});var N=H(n);A.l(N),N.forEach(f),t=j(R),m&&m.l(R),R.forEach(f),s=j(D),i=w(D,"DIV",{});var ee=H(i);r=w(ee,"SPAN",{class:!0});var le=H(r);a=C(le,l),u=C(le,". "),d=C(le,c),le.forEach(f),v=j(ee),p&&p.l(ee),ee.forEach(f),this.h()},h(){O(n,"class","hideEventButton svelte-4rf9ww"),O(r,"class","svelte-4rf9ww")},m(D,R){E(D,o,R),g(o,n),A.m(n,null),g(o,t),m&&m.m(o,null),E(D,s,R),E(D,i,R),g(i,r),g(r,a),g(r,u),g(r,d),g(i,v),p&&p.m(i,null),_||(P=Te(n,"click",e[3]),_=!0)},p(D,R){b===(b=T(D))&&A?A.p(D,R):(A.d(1),A=b(D),A&&(A.c(),A.m(n,null))),D[1]?m?m.p(D,R):(m=zn(D),m.c(),m.m(o,null)):m&&(m.d(1),m=null),R&1&&l!==(l=D[0].number+"")&&Y(a,l),R&5&&c!==(c=D[2](D[0].name)+"")&&Y(d,c),D[1]?p?p.p(D,R):(p=eo(D),p.c(),p.m(i,null)):p&&(p.d(1),p=null)},d(D){D&&(f(o),f(s),f(i)),A.d(),m&&m.d(),p&&p.d(),_=!1,P()}}}function li(e){let o=e[2]("content.winConditions.buttonOpen")+"",n;return{c(){n=M(o)},l(t){n=C(t,o)},m(t,s){E(t,n,s)},p(t,s){s&4&&o!==(o=t[2]("content.winConditions.buttonOpen")+"")&&Y(n,o)},d(t){t&&f(n)}}}function ai(e){let o=e[2]("content.winConditions.buttonClose")+"",n;return{c(){n=M(o)},l(t){n=C(t,o)},m(t,s){E(t,n,s)},p(t,s){s&4&&o!==(o=t[2]("content.winConditions.buttonClose")+"")&&Y(n,o)},d(t){t&&f(n)}}}function zn(e){let o,n=e[2]("content.event.current")+"",t;return{c(){o=L("p"),t=M(n),this.h()},l(s){o=w(s,"P",{class:!0});var i=H(o);t=C(i,n),i.forEach(f),this.h()},h(){O(o,"class","svelte-4rf9ww")},m(s,i){E(s,o,i),g(o,t)},p(s,i){i&4&&n!==(n=s[2]("content.event.current")+"")&&Y(t,n)},d(s){s&&f(o)}}}function eo(e){let o,n=e[2](e[0].description)+"",t;return{c(){o=L("p"),t=M(n),this.h()},l(s){o=w(s,"P",{class:!0});var i=H(o);t=C(i,n),i.forEach(f),this.h()},h(){O(o,"class","svelte-4rf9ww")},m(s,i){E(s,o,i),g(o,t)},p(s,i){i&5&&n!==(n=s[2](s[0].description)+"")&&Y(t,n)},d(s){s&&f(o)}}}function ui(e){let o,n,t=e[0]&&$n(e);return{c(){o=L("div"),t&&t.c(),this.h()},l(s){o=w(s,"DIV",{class:!0});var i=H(o);t&&t.l(i),i.forEach(f),this.h()},h(){O(o,"class",n="event "+(e[1]?"eventOpen":"")+" svelte-4rf9ww")},m(s,i){E(s,o,i),t&&t.m(o,null)},p(s,[i]){s[0]?t?t.p(s,i):(t=$n(s),t.c(),t.m(o,null)):t&&(t.d(1),t=null),i&2&&n!==(n="event "+(s[1]?"eventOpen":"")+" svelte-4rf9ww")&&O(o,"class",n)},i:be,o:be,d(s){s&&f(o),t&&t.d()}}}function ci(e,o,n){let t;Ye(e,Ue,l=>n(2,t=l));let{event:s}=o,i=!0;const r=()=>n(1,i=!i);return e.$$set=l=>{"event"in l&&n(0,s=l.event)},[s,i,t,r]}class fi extends we{constructor(o){super(),He(this,o,ci,ui,ge,{event:0})}}function no(e,o,n){const t=e.slice();return t[15]=o[n],t[16]=o,t[17]=n,t}function di(e){let o=e[2]("content.winConditions.buttonOpen")+"",n;return{c(){n=M(o)},l(t){n=C(t,o)},m(t,s){E(t,n,s)},p(t,s){s&4&&o!==(o=t[2]("content.winConditions.buttonOpen")+"")&&Y(n,o)},d(t){t&&f(n)}}}function mi(e){let o=e[2]("content.winConditions.buttonClose")+"",n;return{c(){n=M(o)},l(t){n=C(t,o)},m(t,s){E(t,n,s)},p(t,s){s&4&&o!==(o=t[2]("content.winConditions.buttonClose")+"")&&Y(n,o)},d(t){t&&f(n)}}}function oo(e){let o,n,t=Le(e[0].dungeon.winConditions.sort(ro)),s=[];for(let r=0;r<t.length;r+=1)s[r]=to(no(e,t,r));const i=r=>$(s[r],1,1,()=>{s[r]=null});return{c(){o=L("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){o=w(r,"DIV",{class:!0});var l=H(o);for(let a=0;a<s.length;a+=1)s[a].l(l);l.forEach(f),this.h()},h(){O(o,"class","conditionsDiv svelte-qsh3al")},m(r,l){E(r,o,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(o,null);n=!0},p(r,l){if(l&1){t=Le(r[0].dungeon.winConditions.sort(ro));let a;for(a=0;a<t.length;a+=1){const u=no(r,t,a);s[a]?(s[a].p(u,l),S(s[a],1)):(s[a]=to(u),s[a].c(),S(s[a],1),s[a].m(o,null))}for(Be(),a=t.length;a<s.length;a+=1)i(a);Ge()}},i(r){if(!n){for(let l=0;l<t.length;l+=1)S(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)$(s[l]);n=!1},d(r){r&&f(o),en(s,r)}}}function to(e){let o,n,t,s;function i(a){e[8](a,e[15],e[16],e[17])}function r(a){e[9](a)}let l={};return e[15]!==void 0&&(l.condition=e[15]),e[0]!==void 0&&(l.state=e[0]),o=new ri({props:l}),_e.push(()=>ye(o,"condition",i)),_e.push(()=>ye(o,"state",r)),{c(){De(o.$$.fragment)},l(a){Ie(o.$$.fragment,a)},m(a,u){Oe(o,a,u),s=!0},p(a,u){e=a;const c={};!n&&u&1&&(n=!0,c.condition=e[15],ve(()=>n=!1)),!t&&u&1&&(t=!0,c.state=e[0],ve(()=>t=!1)),o.$set(c)},i(a){s||(S(o.$$.fragment,a),s=!0)},o(a){$(o.$$.fragment,a),s=!1},d(a){Re(o,a)}}}function so(e){let o,n,t;return n=new fi({props:{event:e[0].currentEvent}}),{c(){o=L("div"),De(n.$$.fragment)},l(s){o=w(s,"DIV",{});var i=H(o);Ie(n.$$.fragment,i),i.forEach(f)},m(s,i){E(s,o,i),Oe(n,o,null),t=!0},p(s,i){const r={};i&1&&(r.event=s[0].currentEvent),n.$set(r)},i(s){t||(S(n.$$.fragment,s),t=!0)},o(s){$(n.$$.fragment,s),t=!1},d(s){s&&f(o),Re(n)}}}function pi(e){let o,n,t,s,i,r,l,a,u,c,d,v;function _(m,p){return m[1]?mi:di}let P=_(e),T=P(e),b=e[1]&&oo(e),A=e[0].currentEvent&&so(e);return{c(){o=L("div"),n=L("canvas"),t=Z(),s=L("div"),i=L("div"),r=L("button"),T.c(),l=Z(),b&&b.c(),u=Z(),A&&A.c(),this.h()},l(m){o=w(m,"DIV",{style:!0,class:!0,id:!0});var p=H(o);n=w(p,"CANVAS",{width:!0,height:!0,id:!0}),H(n).forEach(f),t=j(p),s=w(p,"DIV",{class:!0});var D=H(s);i=w(D,"DIV",{class:!0});var R=H(i);r=w(R,"BUTTON",{class:!0});var N=H(r);T.l(N),N.forEach(f),R.forEach(f),l=j(D),b&&b.l(D),D.forEach(f),u=j(p),A&&A.l(p),p.forEach(f),this.h()},h(){O(n,"width",e[3]*40),O(n,"height",e[3]*30),O(n,"id","gameBoard"),O(r,"class","hideConditionsButton svelte-qsh3al"),O(i,"class","buttonDiv svelte-qsh3al"),O(s,"class",a="winConditions "+(e[1]?"":"conditionsHidden")+" svelte-qsh3al"),O(o,"style",e[5]()),O(o,"class","dungeon svelte-qsh3al"),O(o,"id","gameBoardContainer")},m(m,p){E(m,o,p),g(o,n),g(o,t),g(o,s),g(s,i),g(i,r),T.m(r,null),g(s,l),b&&b.m(s,null),g(o,u),A&&A.m(o,null),c=!0,d||(v=[Te(n,"click",e[4]),Te(r,"click",e[7])],d=!0)},p(m,[p]){P===(P=_(m))&&T?T.p(m,p):(T.d(1),T=P(m),T&&(T.c(),T.m(r,null))),m[1]?b?(b.p(m,p),p&2&&S(b,1)):(b=oo(m),b.c(),S(b,1),b.m(s,null)):b&&(Be(),$(b,1,1,()=>{b=null}),Ge()),(!c||p&2&&a!==(a="winConditions "+(m[1]?"":"conditionsHidden")+" svelte-qsh3al"))&&O(s,"class",a),m[0].currentEvent?A?(A.p(m,p),p&1&&S(A,1)):(A=so(m),A.c(),S(A,1),A.m(o,null)):A&&(Be(),$(A,1,1,()=>{A=null}),Ge())},i(m){c||(S(b),S(A),c=!0)},o(m){$(b),$(A),c=!1},d(m){m&&f(o),T.d(),b&&b.d(),A&&A.d(),d=!1,Nn(v)}}}const io=10,ro=(e,o)=>e.fulfilled===o.fulfilled?0:e.fulfilled?1:-1;function gi(e,o,n){var m;let t;Ye(e,Ue,p=>n(2,t=p));let{state:s}=o,{debugMode:i}=o,r=!0,l,a;const u=(s==null?void 0:s.settings.cellSize)??48;let c=0,d=0;a=window.innerHeight,l=((m=document.getElementById("footer"))==null?void 0:m.offsetHeight)??0,fn(()=>{var ee;const p=new Image;p.src=Rs;const D=new Image;D.src=Ms;const R=window.devicePixelRatio,N=document.getElementById("gameBoard");N.width=u*40*R,N.height=u*30*R,N.style.width=`${u*40}px`,N.style.height=`${u*30}px`,(ee=N.getContext("2d"))==null||ee.scale(R,R),setInterval(()=>v(p,D),10)});const v=(p,D)=>{if(!s||!document)return;const R=document.getElementById("gameBoard"),N=R.getContext("2d");s.reRender&&(d++,c++,N.clearRect(0,0,R.width,R.height),N.fillStyle="black",N.fillRect(0,0,R.width,R.height),Xs(N,p,u,s,i),Js(N,p,u,s,i),ti(N,p,u,s,i),qs(N,p,u,s,i),Bs(N,D,u,s,i),Cs(N,D,u,s,i),oi(N,D,u,s,i),i&&(N.fillStyle="white",N.font="8px Arial",N.fillText(`Re-renders: ${c}`,2,10),N.fillText(`FPS: ${d/(io/1e3)}`,2,20)),setTimeout(()=>{n(0,s.reRender=!1,s),d=0},io))},_=p=>{es(p,u,s)},P=()=>`max-height: ${a-l-20}px; max-width: ${u*40}`,T=()=>n(1,r=!r);function b(p,D,R,N){R[N]=p,n(0,s)}function A(p){s=p,n(0,s)}return e.$$set=p=>{"state"in p&&n(0,s=p.state),"debugMode"in p&&n(6,i=p.debugMode)},[s,r,t,u,_,P,i,T,b,A]}class hi extends we{constructor(o){super(),He(this,o,gi,pi,ge,{state:0,debugMode:6})}}function _i(e){let o,n=e[2]("content.inventory.uses")+"",t;return{c(){o=L("button"),t=M(n),this.h()},l(s){o=w(s,"BUTTON",{class:!0});var i=H(o);t=C(i,n),i.forEach(f),this.h()},h(){o.disabled=!0,O(o,"class","svelte-gca2x5")},m(s,i){E(s,o,i),g(o,t)},p(s,i){i&4&&n!==(n=s[2]("content.inventory.uses")+"")&&Y(t,n)},d(s){s&&f(o)}}}function vi(e){let o,n=e[2]("content.inventory.use")+"",t,s,i;return{c(){o=L("button"),t=M(n),this.h()},l(r){o=w(r,"BUTTON",{class:!0});var l=H(o);t=C(l,n),l.forEach(f),this.h()},h(){O(o,"class","svelte-gca2x5")},m(r,l){E(r,o,l),g(o,t),s||(i=Te(o,"click",e[3]),s=!0)},p(r,l){l&4&&n!==(n=r[2]("content.inventory.use")+"")&&Y(t,n)},d(r){r&&f(o),s=!1,i()}}}function yi(e){var A;let o,n="",t,s,i,r=e[2](e[0].name)+"",l,a,u,c=e[2]((A=e[0].properties)==null?void 0:A[Yn])+"",d,v,_;function P(m,p){var D,R,N;if((D=m[0].properties)!=null&&D[An]&&!((R=m[0].properties)!=null&&R[We]))return vi;if((N=m[0].properties)!=null&&N[An])return _i}let T=P(e),b=T&&T(e);return{c(){o=L("div"),o.innerHTML=n,t=Z(),s=L("div"),i=L("b"),l=M(r),a=Z(),u=L("span"),d=M(c),v=Z(),_=L("div"),b&&b.c(),this.h()},l(m){o=w(m,"DIV",{class:!0,"data-svelte-h":!0}),Co(o)!=="svelte-pn8o3r"&&(o.innerHTML=n),t=j(m),s=w(m,"DIV",{class:!0});var p=H(s);i=w(p,"B",{class:!0});var D=H(i);l=C(D,r),D.forEach(f),a=j(p),u=w(p,"SPAN",{class:!0});var R=H(u);d=C(R,c),R.forEach(f),p.forEach(f),v=j(m),_=w(m,"DIV",{class:!0});var N=H(_);b&&b.l(N),N.forEach(f),this.h()},h(){O(o,"class","item item-icon svelte-gca2x5"),O(i,"class","svelte-gca2x5"),O(u,"class","svelte-gca2x5"),O(s,"class","item item-description bottom-border svelte-gca2x5"),O(_,"class","item item-action svelte-gca2x5")},m(m,p){E(m,o,p),E(m,t,p),E(m,s,p),g(s,i),g(i,l),g(s,a),g(s,u),g(u,d),E(m,v,p),E(m,_,p),b&&b.m(_,null)},p(m,[p]){var D;p&5&&r!==(r=m[2](m[0].name)+"")&&Y(l,r),p&5&&c!==(c=m[2]((D=m[0].properties)==null?void 0:D[Yn])+"")&&Y(d,c),T===(T=P(m))&&b?b.p(m,p):(b&&b.d(1),b=T&&T(m),b&&(b.c(),b.m(_,null)))},i:be,o:be,d(m){m&&(f(o),f(t),f(s),f(v),f(_)),b&&b.d()}}}function Ai(e,o,n){let t;Ye(e,Ue,l=>n(2,t=l));let{item:s}=o,{state:i}=o;const r=()=>Et(i,s);return e.$$set=l=>{"item"in l&&n(0,s=l.item),"state"in l&&n(1,i=l.state)},[s,i,t,r]}class bi extends we{constructor(o){super(),He(this,o,Ai,yi,ge,{item:0,state:1})}}function lo(e,o,n){const t=e.slice();return t[6]=o[n],t[7]=o,t[8]=n,t}function ao(e){let o,n,t;function s(r){e[4](r,e[6],e[7],e[8])}let i={state:e[1]};return e[6]!==void 0&&(i.item=e[6]),o=new bi({props:i}),_e.push(()=>ye(o,"item",s)),{c(){De(o.$$.fragment)},l(r){Ie(o.$$.fragment,r)},m(r,l){Oe(o,r,l),t=!0},p(r,l){e=r;const a={};l&2&&(a.state=e[1]),!n&&l&1&&(n=!0,a.item=e[6],ve(()=>n=!1)),o.$set(a)},i(r){t||(S(o.$$.fragment,r),t=!0)},o(r){$(o.$$.fragment,r),t=!1},d(r){Re(o,r)}}}function uo(e){let o,n,t=Le(e[0]),s=[];for(let r=0;r<t.length;r+=1)s[r]=ao(lo(e,t,r));const i=r=>$(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();o=ce()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);o=ce()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);E(r,o,l),n=!0},p(r,l){if(l&3){t=Le(r[0]);let a;for(a=0;a<t.length;a+=1){const u=lo(r,t,a);s[a]?(s[a].p(u,l),S(s[a],1)):(s[a]=ao(u),s[a].c(),S(s[a],1),s[a].m(o.parentNode,o))}for(Be(),a=t.length;a<s.length;a+=1)i(a);Ge()}},i(r){if(!n){for(let l=0;l<t.length;l+=1)S(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)$(s[l]);n=!1},d(r){r&&f(o),en(s,r)}}}function ki(e){var u;let o,n=e[3]("content.inventory.label",{hero:e[3]((u=e[1].currentActor)==null?void 0:u.name)})+"",t,s,i,r=e[2],l,a=uo(e);return{c(){o=L("h4"),t=M(n),s=Z(),i=L("div"),a.c(),this.h()},l(c){o=w(c,"H4",{class:!0});var d=H(o);t=C(d,n),d.forEach(f),s=j(c),i=w(c,"DIV",{class:!0});var v=H(i);a.l(v),v.forEach(f),this.h()},h(){O(o,"class","svelte-1sdwrze"),O(i,"class","inventory svelte-1sdwrze")},m(c,d){E(c,o,d),g(o,t),E(c,s,d),E(c,i,d),a.m(i,null),l=!0},p(c,[d]){var v;(!l||d&10)&&n!==(n=c[3]("content.inventory.label",{hero:c[3]((v=c[1].currentActor)==null?void 0:v.name)})+"")&&Y(t,n),d&4&&ge(r,r=c[2])?(Be(),$(a,1,1,be),Ge(),a=uo(c),a.c(),S(a,1),a.m(i,null)):a.p(c,d)},i(c){l||(S(a),l=!0)},o(c){$(a),l=!1},d(c){c&&(f(o),f(s),f(i)),a.d(c)}}}function Ei(e,o,n){let t;Ye(e,Ue,u=>n(3,t=u));let{inventory:s}=o,{state:i}=o,r=!1;fn(()=>{l(),setInterval(l,100)});const l=()=>{n(2,r=!r)};function a(u,c,d,v){d[v]=u,n(0,s)}return e.$$set=u=>{"inventory"in u&&n(0,s=u.inventory),"state"in u&&n(1,i=u.state)},[s,i,r,t,a]}class Di extends we{constructor(o){super(),He(this,o,Ei,ki,ge,{inventory:0,state:1})}}function co(e){let o;return{c(){o=M("*")},l(n){o=C(n,"*")},m(n,t){E(n,o,t)},d(n){n&&f(o)}}}function Ii(e){let o;return{c(){o=M("")},l(n){o=C(n,"")},m(n,t){E(n,o,t)},d(n){n&&f(o)}}}function Oi(e){let o;return{c(){o=M("")},l(n){o=C(n,"")},m(n,t){E(n,o,t)},d(n){n&&f(o)}}}function fo(e){let o,n,t,s,i;function r(a){e[8](a)}let l={state:e[1]};return e[0].inventory!==void 0&&(l.inventory=e[0].inventory),n=new Di({props:l}),_e.push(()=>ye(n,"inventory",r)),{c(){o=L("div"),De(n.$$.fragment),this.h()},l(a){o=w(a,"DIV",{class:!0,id:!0,style:!0});var u=H(o);Ie(n.$$.fragment,u),u.forEach(f),this.h()},h(){O(o,"class","hero-inventory svelte-11gs3s7"),O(o,"id",s=e[0].name+"s-inventory"),an(o,"display",e[2])},m(a,u){E(a,o,u),Oe(n,o,null),i=!0},p(a,u){const c={};u&2&&(c.state=a[1]),!t&&u&1&&(t=!0,c.inventory=a[0].inventory,ve(()=>t=!1)),n.$set(c),(!i||u&1&&s!==(s=a[0].name+"s-inventory"))&&O(o,"id",s),(!i||u&4)&&an(o,"display",a[2])},i(a){i||(S(n.$$.fragment,a),i=!0)},o(a){$(n.$$.fragment,a),i=!1},d(a){a&&f(o),Re(n)}}}function mo(e){let o,n=e[3]("content.hero.actions")+"",t,s,i=e[0].actions+"",r,l,a,u=e[3]("content.hero.moves")+"",c,d,v=e[0].movement+"",_,P,T,b=e[3]("content.hero.equipment")+"",A,m,p,D,R,N,ee=e[3](e[0].weapon.name)+"",le,ue,de=e[0].weapon.dice+"",B,ie,fe,ne,U,he,z,qe;function Me(q,Q){return q[0].armour?Mi:Ri}let oe=Me(e),I=oe(e);function K(q,Q){return q[0].shield?Ti:Ci}let F=K(e),V=F(e);return{c(){o=L("span"),t=M(n),s=M(": "),r=M(i),l=Z(),a=L("span"),c=M(u),d=M(": "),_=M(v),P=Z(),T=L("span"),A=M(b),m=M(":"),p=Z(),D=L("div"),R=L("span"),N=M(" "),le=M(ee),ue=M(" ("),B=M(de),ie=M(")"),fe=Z(),ne=L("span"),U=M(`
        `),I.c(),he=Z(),z=L("span"),qe=M(`
        `),V.c(),this.h()},l(q){o=w(q,"SPAN",{class:!0});var Q=H(o);t=C(Q,n),s=C(Q,": "),r=C(Q,i),Q.forEach(f),l=j(q),a=w(q,"SPAN",{class:!0});var Ke=H(a);c=C(Ke,u),d=C(Ke,": "),_=C(Ke,v),Ke.forEach(f),P=j(q),T=w(q,"SPAN",{class:!0});var Ze=H(T);A=C(Ze,b),m=C(Ze,":"),Ze.forEach(f),p=j(q),D=w(q,"DIV",{class:!0});var Fe=H(D);R=w(Fe,"SPAN",{class:!0});var Ne=H(R);N=C(Ne," "),le=C(Ne,ee),ue=C(Ne," ("),B=C(Ne,de),ie=C(Ne,")"),Ne.forEach(f),fe=j(Fe),ne=w(Fe,"SPAN",{class:!0});var Xe=H(ne);U=C(Xe,`
        `),I.l(Xe),Xe.forEach(f),he=j(Fe),z=w(Fe,"SPAN",{class:!0});var In=H(z);qe=C(In,`
        `),V.l(In),In.forEach(f),Fe.forEach(f),this.h()},h(){O(o,"class","svelte-11gs3s7"),O(a,"class","svelte-11gs3s7"),O(T,"class","svelte-11gs3s7"),O(R,"class","svelte-11gs3s7"),O(ne,"class","svelte-11gs3s7"),O(z,"class","svelte-11gs3s7"),O(D,"class","equipment svelte-11gs3s7")},m(q,Q){E(q,o,Q),g(o,t),g(o,s),g(o,r),E(q,l,Q),E(q,a,Q),g(a,c),g(a,d),g(a,_),E(q,P,Q),E(q,T,Q),g(T,A),g(T,m),E(q,p,Q),E(q,D,Q),g(D,R),g(R,N),g(R,le),g(R,ue),g(R,B),g(R,ie),g(D,fe),g(D,ne),g(ne,U),I.m(ne,null),g(D,he),g(D,z),g(z,qe),V.m(z,null)},p(q,Q){Q&8&&n!==(n=q[3]("content.hero.actions")+"")&&Y(t,n),Q&1&&i!==(i=q[0].actions+"")&&Y(r,i),Q&8&&u!==(u=q[3]("content.hero.moves")+"")&&Y(c,u),Q&1&&v!==(v=q[0].movement+"")&&Y(_,v),Q&8&&b!==(b=q[3]("content.hero.equipment")+"")&&Y(A,b),Q&9&&ee!==(ee=q[3](q[0].weapon.name)+"")&&Y(le,ee),Q&1&&de!==(de=q[0].weapon.dice+"")&&Y(B,de),oe===(oe=Me(q))&&I?I.p(q,Q):(I.d(1),I=oe(q),I&&(I.c(),I.m(ne,null))),F===(F=K(q))&&V?V.p(q,Q):(V.d(1),V=F(q),V&&(V.c(),V.m(z,null)))},d(q){q&&(f(o),f(l),f(a),f(P),f(T),f(p),f(D)),I.d(),V.d()}}}function Ri(e){let o=e[3]("content.hero.none")+"",n,t;return{c(){n=M(o),t=M(" (0)")},l(s){n=C(s,o),t=C(s," (0)")},m(s,i){E(s,n,i),E(s,t,i)},p(s,i){i&8&&o!==(o=s[3]("content.hero.none")+"")&&Y(n,o)},d(s){s&&(f(n),f(t))}}}function Mi(e){let o=e[3](e[0].armour.name)+"",n,t,s=e[0].armour.defense+"",i,r;return{c(){n=M(o),t=M(" ("),i=M(s),r=M(")")},l(l){n=C(l,o),t=C(l," ("),i=C(l,s),r=C(l,")")},m(l,a){E(l,n,a),E(l,t,a),E(l,i,a),E(l,r,a)},p(l,a){a&9&&o!==(o=l[3](l[0].armour.name)+"")&&Y(n,o),a&1&&s!==(s=l[0].armour.defense+"")&&Y(i,s)},d(l){l&&(f(n),f(t),f(i),f(r))}}}function Ci(e){let o=e[3]("content.hero.none")+"",n,t;return{c(){n=M(o),t=M(" (0)")},l(s){n=C(s,o),t=C(s," (0)")},m(s,i){E(s,n,i),E(s,t,i)},p(s,i){i&8&&o!==(o=s[3]("content.hero.none")+"")&&Y(n,o)},d(s){s&&(f(n),f(t))}}}function Ti(e){let o=e[3](e[0].shield.name)+"",n,t,s=e[0].shield.dice+"",i,r;return{c(){n=M(o),t=M(" ("),i=M(s),r=M(")")},l(l){n=C(l,o),t=C(l," ("),i=C(l,s),r=C(l,")")},m(l,a){E(l,n,a),E(l,t,a),E(l,i,a),E(l,r,a)},p(l,a){a&9&&o!==(o=l[3](l[0].shield.name)+"")&&Y(n,o),a&1&&s!==(s=l[0].shield.dice+"")&&Y(i,s)},d(l){l&&(f(n),f(t),f(i),f(r))}}}function po(e){let o,n,t,s=e[3](e[0].name)+"",i,r,l=e[3]("content.level."+e[0].level)+"",a,u,c=e[0].experience+"",d,v,_,P,T,b,A,m="",p,D,R,N,ee,le=e[3]("content.hero.hp")+"",ue,de,B=e[0].health+"",ie,fe,ne,U,he,z=e[1].targetActor===e[0]&&co();function qe(F,V){return F[1].targetActor!==F[0]?Oi:Ii}let Me=qe(e),oe=Me(e),I=e[1].currentActor===e[0]&&fo(e),K=e[1].currentActor===e[0]&&mo(e);return{c(){o=L("div"),n=L("div"),t=L("b"),z&&z.c(),i=M(s),r=M(` -
    `),a=M(l),u=M(" ("),d=M(c),v=M(")"),_=Z(),P=L("div"),T=L("button"),oe.c(),b=Z(),A=L("button"),A.textContent=m,p=Z(),D=L("div"),I&&I.c(),R=Z(),N=L("div"),ee=L("span"),ue=M(le),de=M(": "),ie=M(B),fe=Z(),K&&K.c(),this.h()},l(F){o=w(F,"DIV",{class:!0,style:!0});var V=H(o);n=w(V,"DIV",{class:!0});var q=H(n);t=w(q,"B",{class:!0});var Q=H(t);z&&z.l(Q),i=C(Q,s),r=C(Q,` -
    `),a=C(Q,l),u=C(Q," ("),d=C(Q,c),v=C(Q,")"),Q.forEach(f),q.forEach(f),_=j(V),P=w(V,"DIV",{});var Ke=H(P);T=w(Ke,"BUTTON",{title:!0});var Ze=H(T);oe.l(Ze),Ze.forEach(f),b=j(Ke),A=w(Ke,"BUTTON",{title:!0,"data-svelte-h":!0}),Co(A)!=="svelte-qrm7uk"&&(A.textContent=m),Ke.forEach(f),p=j(V),D=w(V,"DIV",{class:!0});var Fe=H(D);I&&I.l(Fe),Fe.forEach(f),R=j(V),N=w(V,"DIV",{});var Ne=H(N);ee=w(Ne,"SPAN",{class:!0});var Xe=H(ee);ue=C(Xe,le),de=C(Xe,": "),ie=C(Xe,B),Xe.forEach(f),fe=j(Ne),K&&K.l(Ne),Ne.forEach(f),V.forEach(f),this.h()},h(){O(t,"class","svelte-11gs3s7"),O(n,"class","hero-title svelte-11gs3s7"),O(T,"title","select target hero"),O(A,"title","Open inventory"),O(D,"class","hero-information svelte-11gs3s7"),O(ee,"class","svelte-11gs3s7"),O(o,"class","hero-card svelte-11gs3s7"),an(o,"background-color",e[0].colour)},m(F,V){E(F,o,V),g(o,n),g(n,t),z&&z.m(t,null),g(t,i),g(t,r),g(t,a),g(t,u),g(t,d),g(t,v),g(o,_),g(o,P),g(P,T),oe.m(T,null),g(P,b),g(P,A),g(o,p),g(o,D),I&&I.m(D,null),g(o,R),g(o,N),g(N,ee),g(ee,ue),g(ee,de),g(ee,ie),g(N,fe),K&&K.m(N,null),ne=!0,U||(he=[Te(T,"click",e[6]),Te(A,"click",e[7])],U=!0)},p(F,V){F[1].targetActor===F[0]?z||(z=co(),z.c(),z.m(t,i)):z&&(z.d(1),z=null),(!ne||V&9)&&s!==(s=F[3](F[0].name)+"")&&Y(i,s),(!ne||V&9)&&l!==(l=F[3]("content.level."+F[0].level)+"")&&Y(a,l),(!ne||V&1)&&c!==(c=F[0].experience+"")&&Y(d,c),Me!==(Me=qe(F))&&(oe.d(1),oe=Me(F),oe&&(oe.c(),oe.m(T,null))),F[1].currentActor===F[0]?I?(I.p(F,V),V&3&&S(I,1)):(I=fo(F),I.c(),S(I,1),I.m(D,null)):I&&(Be(),$(I,1,1,()=>{I=null}),Ge()),(!ne||V&8)&&le!==(le=F[3]("content.hero.hp")+"")&&Y(ue,le),(!ne||V&1)&&B!==(B=F[0].health+"")&&Y(ie,B),F[1].currentActor===F[0]?K?K.p(F,V):(K=mo(F),K.c(),K.m(N,null)):K&&(K.d(1),K=null),(!ne||V&1)&&an(o,"background-color",F[0].colour)},i(F){ne||(S(I),ne=!0)},o(F){$(I),ne=!1},d(F){F&&f(o),z&&z.d(),oe.d(),I&&I.d(),K&&K.d(),U=!1,Nn(he)}}}function Li(e){let o=e[1].targetActor,n,t,s=po(e);return{c(){s.c(),n=ce()},l(i){s.l(i),n=ce()},m(i,r){s.m(i,r),E(i,n,r),t=!0},p(i,[r]){r&2&&ge(o,o=i[1].targetActor)?(Be(),$(s,1,1,be),Ge(),s=po(i),s.c(),S(s,1),s.m(n.parentNode,n)):s.p(i,r)},i(i){t||(S(s),t=!0)},o(i){$(s),t=!1},d(i){i&&f(n),s.d(i)}}}function wi(e,o,n){let t;Ye(e,Ue,_=>n(3,t=_));let{hero:s}=o,{state:i}=o,r="none";const l=_=>{i.targetActor&&_===i.targetActor?n(1,i.targetActor=void 0,i):n(1,i.targetActor=_,i)},a=_=>{const P=document.getElementById(_.name+"s-inventory");P&&(_.isInventoryOpen=!_.isInventoryOpen,u(),P.style.display=r)},u=()=>{s.isInventoryOpen?n(2,r="inline-block"):n(2,r="none")};u();const c=()=>l(s),d=()=>a(s);function v(_){e.$$.not_equal(s.inventory,_)&&(s.inventory=_,n(0,s))}return e.$$set=_=>{"hero"in _&&n(0,s=_.hero),"state"in _&&n(1,i=_.state)},[s,i,r,t,l,a,c,d,v]}class pt extends we{constructor(o){super(),He(this,o,wi,Li,ge,{hero:0,state:1})}}function go(e,o,n){const t=e.slice();return t[3]=o[n],t[5]=n,t}function Hi(e){let o,n,t,s;return n=new pt({props:{hero:e[3],state:e[0]}}),{c(){o=L("div"),De(n.$$.fragment),t=Z(),this.h()},l(i){o=w(i,"DIV",{class:!0});var r=H(o);Ie(n.$$.fragment,r),t=j(r),r.forEach(f),this.h()},h(){O(o,"class","not-current-actor svelte-gyascg")},m(i,r){E(i,o,r),Oe(n,o,null),g(o,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),n.$set(l)},i(i){s||(S(n.$$.fragment,i),s=!0)},o(i){$(n.$$.fragment,i),s=!1},d(i){i&&f(o),Re(n)}}}function Ni(e){let o,n,t,s;return n=new pt({props:{hero:e[3],state:e[0]}}),{c(){o=L("div"),De(n.$$.fragment),t=Z(),this.h()},l(i){o=w(i,"DIV",{class:!0});var r=H(o);Ie(n.$$.fragment,r),t=j(r),r.forEach(f),this.h()},h(){O(o,"class","is-current-actor svelte-gyascg")},m(i,r){E(i,o,r),Oe(n,o,null),g(o,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),n.$set(l)},i(i){s||(S(n.$$.fragment,i),s=!0)},o(i){$(n.$$.fragment,i),s=!1},d(i){i&&f(o),Re(n)}}}function ho(e){let o,n,t,s;const i=[Ni,Hi],r=[];function l(a,u){return a[3]===a[0].currentActor?0:1}return o=l(e),n=r[o]=i[o](e),{c(){n.c(),t=ce()},l(a){n.l(a),t=ce()},m(a,u){r[o].m(a,u),E(a,t,u),s=!0},p(a,u){let c=o;o=l(a),o===c?r[o].p(a,u):(Be(),$(r[c],1,1,()=>{r[c]=null}),Ge(),n=r[o],n?n.p(a,u):(n=r[o]=i[o](a),n.c()),S(n,1),n.m(t.parentNode,t))},i(a){s||(S(n),s=!0)},o(a){$(n),s=!1},d(a){a&&f(t),r[o].d(a)}}}function _o(e){let o=e[1],n,t,s=ho(e);return{c(){s.c(),n=ce()},l(i){s.l(i),n=ce()},m(i,r){s.m(i,r),E(i,n,r),t=!0},p(i,r){r&2&&ge(o,o=i[1])?(Be(),$(s,1,1,be),Ge(),s=ho(i),s.c(),S(s,1),s.m(n.parentNode,n)):s.p(i,r)},i(i){t||(S(s),t=!0)},o(i){$(s),t=!1},d(i){i&&f(n),s.d(i)}}}function Pi(e){let o,n,t=Le(x(e[0])),s=[];for(let r=0;r<t.length;r+=1)s[r]=_o(go(e,t,r));const i=r=>$(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();o=ce()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);o=ce()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);E(r,o,l),n=!0},p(r,[l]){if(l&3){t=Le(x(r[0]));let a;for(a=0;a<t.length;a+=1){const u=go(r,t,a);s[a]?(s[a].p(u,l),S(s[a],1)):(s[a]=_o(u),s[a].c(),S(s[a],1),s[a].m(o.parentNode,o))}for(Be(),a=t.length;a<s.length;a+=1)i(a);Ge()}},i(r){if(!n){for(let l=0;l<t.length;l+=1)S(s[l]);n=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)$(s[l]);n=!1},d(r){r&&f(o),en(s,r)}}}function Bi(e,o,n){let{state:t}=o,s=!1;fn(()=>{i(),setInterval(i,100)});const i=()=>{t.reRender&&n(1,s=!s)};return e.$$set=r=>{"state"in r&&n(0,t=r.state)},[t,s]}class Gi extends we{constructor(o){super(),He(this,o,Bi,Pi,ge,{state:0})}}function vo(e,o,n){const t=e.slice();return t[5]=o[n],t[7]=n,t}function Ui(e){let o,n,t=e[2](e[5])+"",s;return{c(){o=L("p"),n=M(">"),s=M(t),this.h()},l(i){o=w(i,"P",{class:!0});var r=H(o);n=C(r,">"),s=C(r,t),r.forEach(f),this.h()},h(){O(o,"class","svelte-grgnnk")},m(i,r){E(i,o,r),g(o,n),g(o,s)},p(i,r){r&1&&t!==(t=i[2](i[5])+"")&&Y(s,t)},d(i){i&&f(o)}}}function yo(e){let o,n=e[7]<25&&Ui(e);return{c(){n&&n.c(),o=ce()},l(t){n&&n.l(t),o=ce()},m(t,s){n&&n.m(t,s),E(t,o,s)},p(t,s){t[7]<25&&n.p(t,s)},d(t){t&&f(o),n&&n.d(t)}}}function Ao(e){let o,n=Le(e[0].actionLog),t=[];for(let s=0;s<n.length;s+=1)t[s]=yo(vo(e,n,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();o=ce()},l(s){for(let i=0;i<t.length;i+=1)t[i].l(s);o=ce()},m(s,i){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(s,i);E(s,o,i)},p(s,i){if(i&5){n=Le(s[0].actionLog);let r;for(r=0;r<n.length;r+=1){const l=vo(s,n,r);t[r]?t[r].p(l,i):(t[r]=yo(l),t[r].c(),t[r].m(o.parentNode,o))}for(;r<t.length;r+=1)t[r].d(1);t.length=n.length}},d(s){s&&f(o),en(t,s)}}}function Ki(e){let o,n=e[1],t=Ao(e);return{c(){o=L("div"),t.c(),this.h()},l(s){o=w(s,"DIV",{class:!0});var i=H(o);t.l(i),i.forEach(f),this.h()},h(){O(o,"class","log svelte-grgnnk")},m(s,i){E(s,o,i),t.m(o,null)},p(s,[i]){i&2&&ge(n,n=s[1])?(t.d(1),t=Ao(s),t.c(),t.m(o,null)):t.p(s,i)},i:be,o:be,d(s){s&&f(o),t.d(s)}}}function Fi(e,o,n){let t;Ye(e,Ue,a=>n(3,t=a));let{state:s}=o,i=!1;fn(()=>{r(),setInterval(r,500)});const r=()=>{s.reRender&&n(1,i=!i)},l=a=>`(${a.turn}) ${t(a.key,a.properties)}`;return e.$$set=a=>{"state"in a&&n(0,s=a.state)},[s,i,l]}class Wi extends we{constructor(o){super(),He(this,o,Fi,Ki,ge,{state:0})}}const Vi={name:"campaign.iceDragon.testingGrounds.name",beaten:!0,winConditions:[{type:re.KILL_ALL,fulfilled:!0},{type:re.OPEN_DOOR,targetCell:{x:2,y:10},fulfilled:!1},{type:re.KILL_ALL_OF_TYPE,targetMonsterType:G.ORCH,fulfilled:!1},{type:re.REACH_CELL,targetCell:{x:2,y:10},fulfilled:!1},{type:re.KILL_AT_LEAST,killMinCount:5,fulfilled:!1}],nextDungeon:ot,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A","D"],layout:{grid:["###########","#CCCCCCCCC#","#CCCCCCCCC#","#CCCCCCCCC#","#######E###","  #####E#  ","  #FFFFE## ","###F###AA# ","#AAAAAAAA#D","#AAAAAAAA#D","#AAAAAAAA#D","##G####### "," #G#       "," #G#       "," ###       "],pillars:[{x:8,y:3},{x:7,y:9}],pits:[{x:6,y:3},{x:6,y:2}],corridors:["G","E","F"],doors:[Ln(k.UP,3,8,1),$e(k.LEFT,7,6),Zo(k.UP,7,7,1),X(k.UP,7,4),Pe(k.DOWN,2,10)],monsters:[se(G.ORCH,W.Green,1,1),se(G.ORCH,W.Red,4,9),se(G.TROLL,W.Green,5,1)],secrets:[me(te.TRAP_DOOR,"campaign.iceDragon.testingGrounds.secrets.trapDoor",3,9),me(te.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,10),cn(te.EQUIPMENT,5,10,un[2])],notes:[{position:{x:2,y:10},message:`Some note
to test rendering
 on game board. 
The note is pretty long, so we g
et several lines of text. I wonder how it handles a linebreak?
Like this apparently.`}],items:[{item:Ee[0],position:{x:3,y:10}},{item:Ee[1],position:{x:4,y:10}},{item:Ee[6],position:{x:5,y:10}},{item:Ee[2],position:{x:6,y:10}},{item:Ee[3],position:{x:7,y:10}},{item:Ee[4],position:{x:8,y:10}}]},killCount:0};function bo(e,o,n){const t=e.slice();return t[5]=o[n],t}function ko(e){let o,n=e[5].label+"",t,s,i;return{c(){o=L("button"),t=M(n),this.h()},l(r){o=w(r,"BUTTON",{class:!0});var l=H(o);t=C(l,n),l.forEach(f),this.h()},h(){O(o,"class","menuButton svelte-12a9xod")},m(r,l){E(r,o,l),g(o,t),s||(i=Te(o,"click",function(){gt(e[5].onClick)&&e[5].onClick.apply(this,arguments)}),s=!0)},p(r,l){e=r,l&4&&n!==(n=e[5].label+"")&&Y(t,n)},d(r){r&&f(o),s=!1,i()}}}function Eo(e){let o,n=(e[5].debugModeOnly&&e[1]||!e[5].debugModeOnly)&&ko(e);return{c(){n&&n.c(),o=ce()},l(t){n&&n.l(t),o=ce()},m(t,s){n&&n.m(t,s),E(t,o,s)},p(t,s){t[5].debugModeOnly&&t[1]||!t[5].debugModeOnly?n?n.p(t,s):(n=ko(t),n.c(),n.m(o.parentNode,o)):n&&(n.d(1),n=null)},d(t){t&&f(o),n&&n.d(t)}}}function Yi(e){let o,n,t,s,i,r,l,a,u=Le(e[2]),c=[];for(let d=0;d<u.length;d+=1)c[d]=Eo(bo(e,u,d));return{c(){o=L("div"),n=L("span"),t=M(e[0]),s=Z();for(let d=0;d<c.length;d+=1)c[d].c();i=Z(),r=L("span"),l=M(e[3]),this.h()},l(d){o=w(d,"DIV",{class:!0});var v=H(o);n=w(v,"SPAN",{class:!0});var _=H(n);t=C(_,e[0]),_.forEach(f),s=j(v);for(let T=0;T<c.length;T+=1)c[T].l(v);i=j(v),r=w(v,"SPAN",{class:!0});var P=H(r);l=C(P,e[3]),P.forEach(f),v.forEach(f),this.h()},h(){O(n,"class","header svelte-12a9xod"),O(r,"class","footer svelte-12a9xod"),O(o,"class",a=yn(e[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")},m(d,v){E(d,o,v),g(o,n),g(n,t),g(o,s);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(o,null);g(o,i),g(o,r),g(r,l)},p(d,[v]){if(v&1&&Y(t,d[0]),v&6){u=Le(d[2]);let _;for(_=0;_<u.length;_+=1){const P=bo(d,u,_);c[_]?c[_].p(P,v):(c[_]=Eo(P),c[_].c(),c[_].m(o,i))}for(;_<c.length;_+=1)c[_].d(1);c.length=u.length}v&8&&Y(l,d[3]),v&16&&a!==(a=yn(d[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")&&O(o,"class",a)},i:be,o:be,d(d){d&&f(o),en(c,d)}}}function qi(e,o,n){let{header:t}=o,{debugMode:s}=o,{buttons:i}=o,{footer:r}=o,{showMenu:l}=o;return e.$$set=a=>{"header"in a&&n(0,t=a.header),"debugMode"in a&&n(1,s=a.debugMode),"buttons"in a&&n(2,i=a.buttons),"footer"in a&&n(3,r=a.footer),"showMenu"in a&&n(4,l=a.showMenu)},[t,s,i,r,l]}class Do extends we{constructor(o){super(),He(this,o,qi,Yi,ge,{header:0,debugMode:1,buttons:2,footer:3,showMenu:4})}}function Io(e){let o,n=e[7]("content.actions.nextLevel")+"",t,s,i;return{c(){o=L("button"),t=M(n),this.h()},l(r){o=w(r,"BUTTON",{class:!0});var l=H(o);t=C(l,n),l.forEach(f),this.h()},h(){O(o,"class","menuButton svelte-1v33x5s")},m(r,l){E(r,o,l),g(o,t),s||(i=Te(o,"click",e[18]),s=!0)},p(r,l){l&128&&n!==(n=r[7]("content.actions.nextLevel")+"")&&Y(t,n)},d(r){r&&f(o),s=!1,i()}}}function Xi(e){let o,n,t,s,i,r,l,a,u,c,d,v,_=e[7]("content.menu.menuButton")+"",P,T,b,A,m=e[7]("content.actions.next")+"",p,D,R,N=e[7]("content.actions.action")+"",ee,le,ue,de,B;function ie(I){e[10](I)}function fe(I){e[11](I)}function ne(I){e[12](I)}let U={header:e[7]("content.menu.mainMenu.header"),footer:`${e[2].date} - ${e[2].hash}`};e[1]!==void 0&&(U.debugMode=e[1]),e[3]!==void 0&&(U.showMenu=e[3]),e[6]!==void 0&&(U.buttons=e[6]),n=new Do({props:U}),_e.push(()=>ye(n,"debugMode",ie)),_e.push(()=>ye(n,"showMenu",fe)),_e.push(()=>ye(n,"buttons",ne));function he(I){e[13](I)}function z(I){e[14](I)}function qe(I){e[15](I)}let Me={header:e[7]("content.menu.loadGame.header"),footer:""};e[1]!==void 0&&(Me.debugMode=e[1]),e[4]!==void 0&&(Me.showMenu=e[4]),e[5]!==void 0&&(Me.buttons=e[5]),l=new Do({props:Me}),_e.push(()=>ye(l,"debugMode",he)),_e.push(()=>ye(l,"showMenu",z)),_e.push(()=>ye(l,"buttons",qe));let oe=e[0].dungeon.beaten&&Io(e);return{c(){o=L("div"),De(n.$$.fragment),r=Z(),De(l.$$.fragment),d=Z(),v=L("button"),P=M(_),T=Z(),b=L("div"),A=L("button"),p=M(m),D=Z(),R=L("button"),ee=M(N),le=Z(),oe&&oe.c(),this.h()},l(I){o=w(I,"DIV",{class:!0});var K=H(o);Ie(n.$$.fragment,K),r=j(K),Ie(l.$$.fragment,K),d=j(K),v=w(K,"BUTTON",{class:!0});var F=H(v);P=C(F,_),F.forEach(f),T=j(K),b=w(K,"DIV",{});var V=H(b);A=w(V,"BUTTON",{class:!0});var q=H(A);p=C(q,m),q.forEach(f),D=j(V),R=w(V,"BUTTON",{class:!0,style:!0});var Q=H(R);ee=C(Q,N),Q.forEach(f),V.forEach(f),le=j(K),oe&&oe.l(K),K.forEach(f),this.h()},h(){O(v,"class","menuButton svelte-1v33x5s"),O(A,"class","menuButton twoColButton svelte-1v33x5s"),O(R,"class","menuButton twoColButton svelte-1v33x5s"),an(R,"float","right"),O(o,"class","commands svelte-1v33x5s")},m(I,K){E(I,o,K),Oe(n,o,null),g(o,r),Oe(l,o,null),g(o,d),g(o,v),g(v,P),g(o,T),g(o,b),g(b,A),g(A,p),g(b,D),g(b,R),g(R,ee),g(o,le),oe&&oe.m(o,null),ue=!0,de||(B=[Te(window,"keydown",ht(e[8])),Te(v,"click",e[9]),Te(A,"click",e[16]),Te(R,"click",e[17])],de=!0)},p(I,[K]){const F={};K&128&&(F.header=I[7]("content.menu.mainMenu.header")),K&4&&(F.footer=`${I[2].date} - ${I[2].hash}`),!t&&K&2&&(t=!0,F.debugMode=I[1],ve(()=>t=!1)),!s&&K&8&&(s=!0,F.showMenu=I[3],ve(()=>s=!1)),!i&&K&64&&(i=!0,F.buttons=I[6],ve(()=>i=!1)),n.$set(F);const V={};K&128&&(V.header=I[7]("content.menu.loadGame.header")),!a&&K&2&&(a=!0,V.debugMode=I[1],ve(()=>a=!1)),!u&&K&16&&(u=!0,V.showMenu=I[4],ve(()=>u=!1)),!c&&K&32&&(c=!0,V.buttons=I[5],ve(()=>c=!1)),l.$set(V),(!ue||K&128)&&_!==(_=I[7]("content.menu.menuButton")+"")&&Y(P,_),(!ue||K&128)&&m!==(m=I[7]("content.actions.next")+"")&&Y(p,m),(!ue||K&128)&&N!==(N=I[7]("content.actions.action")+"")&&Y(ee,N),I[0].dungeon.beaten?oe?oe.p(I,K):(oe=Io(I),oe.c(),oe.m(o,null)):oe&&(oe.d(1),oe=null)},i(I){ue||(S(n.$$.fragment,I),S(l.$$.fragment,I),ue=!0)},o(I){$(n.$$.fragment,I),$(l.$$.fragment,I),ue=!1},d(I){I&&f(o),Re(n),Re(l),oe&&oe.d(),de=!1,Nn(B)}}}function Ji(e,o,n){let t;Ye(e,Ue,U=>n(7,t=U));let{state:s}=o,{debugMode:i}=o,{buildInfo:r}=o,l=!1,a=!1,u=[],c=[];const d=()=>{n(1,i=!i),n(0,s.settings.debug=i,s),ae(s)},v=U=>{switch(U.key){case"6":case"d":Je("R",s);break;case"9":case"e":Je("UR",s);break;case"8":case"w":Je("U",s);break;case"7":case"q":Je("UL",s);break;case"4":case"a":Je("L",s);break;case"1":case"z":Je("DL",s);break;case"2":case"x":Je("D",s);break;case"3":case"c":Je("DR",s);break;case"0":case" ":n(0,s=Hn(s));break;case"-":case"r":Wo(s);break;case"+":case"f":Yo(s);break}},_=()=>{n(0,s=at()),ae(s),n(3,l=!1)},P=()=>{As(s),n(3,l=!1)},T=()=>{n(0,s.dungeon=Vi,s),En(s),ae(s),n(3,l=!1)},b=()=>{n(3,l=!1),n(4,a=!0),n(5,u=A())},A=()=>{const U=[],he=localStorage.getItem("autosave");he&&U.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.autoSave"),onClick:()=>p(he)});const z=localStorage.getItem("state");return z&&U.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.manualSave"),onClick:()=>p(z)}),U.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.back"),onClick:()=>{n(3,l=!0),n(4,a=!1)}}),U},m=()=>[{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.newGame"),onClick:_},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.saveGame"),onClick:P},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.loadGame"),onClick:b},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.debug"),onClick:d},{debugModeOnly:!0,label:t("content.menu.mainMenu.buttons.testingGrounds"),onClick:T},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.language"),onClick:R}],p=U=>{n(0,s=lt(JSON.parse(U))),n(3,l=!1),n(4,a=!1)},D=()=>{n(6,c=m()),a?n(3,l=!1):n(3,l=!l),n(4,a=!1)},R=()=>{_t.get()==="en"?(Tn("sv"),n(0,s.settings.locale="sv",s)):(Tn("en"),n(0,s.settings.locale="en",s)),n(6,c=m()),ae(s)};c=m();function N(U){i=U,n(1,i)}function ee(U){l=U,n(3,l)}function le(U){c=U,n(6,c)}function ue(U){i=U,n(1,i)}function de(U){a=U,n(4,a)}function B(U){u=U,n(5,u)}const ie=()=>n(0,s=Hn(s)),fe=()=>Ut(s),ne=()=>Is(s);return e.$$set=U=>{"state"in U&&n(0,s=U.state),"debugMode"in U&&n(1,i=U.debugMode),"buildInfo"in U&&n(2,r=U.buildInfo)},[s,i,r,l,a,u,c,t,v,D,N,ee,le,ue,de,B,ie,fe,ne]}class Si extends we{constructor(o){super(),He(this,o,Ji,Xi,ge,{state:0,debugMode:1,buildInfo:2})}}const xi="2023-10-17",Qi="25d489e",Zi={date:xi,hash:Qi};function Oo(e,o,n){const t=e.slice();return t[2]=o[n],t}function Ro(e){let o,n,t,s=e[1]("content.diary.foundOn",{round:e[2].foundOn})+"",i,r,l,a=e[1](e[2].message)+"",u;return{c(){o=L("hr"),n=Z(),t=L("p"),i=M(s),r=Z(),l=L("p"),u=M(a),this.h()},l(c){o=w(c,"HR",{class:!0}),n=j(c),t=w(c,"P",{class:!0});var d=H(t);i=C(d,s),d.forEach(f),r=j(c),l=w(c,"P",{class:!0});var v=H(l);u=C(v,a),v.forEach(f),this.h()},h(){O(o,"class","svelte-4r9yed"),O(t,"class","header svelte-4r9yed"),O(l,"class","note svelte-4r9yed")},m(c,d){E(c,o,d),E(c,n,d),E(c,t,d),g(t,i),E(c,r,d),E(c,l,d),g(l,u)},p(c,d){d&3&&s!==(s=c[1]("content.diary.foundOn",{round:c[2].foundOn})+"")&&Y(i,s),d&3&&a!==(a=c[1](c[2].message)+"")&&Y(u,a)},d(c){c&&(f(o),f(n),f(t),f(r),f(l))}}}function Mo(e){let o,n=e[2].found&&Ro(e);return{c(){n&&n.c(),o=ce()},l(t){n&&n.l(t),o=ce()},m(t,s){n&&n.m(t,s),E(t,o,s)},p(t,s){t[2].found?n?n.p(t,s):(n=Ro(t),n.c(),n.m(o.parentNode,o)):n&&(n.d(1),n=null)},d(t){t&&f(o),n&&n.d(t)}}}function ji(e){let o,n,t=e[1]("content.diary.label",{turn:e[0].turnCount})+"",s,i,r=Le(e[0].dungeon.layout.notes),l=[];for(let a=0;a<r.length;a+=1)l[a]=Mo(Oo(e,r,a));return{c(){o=L("div"),n=L("span"),s=M(t),i=Z();for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){o=w(a,"DIV",{class:!0});var u=H(o);n=w(u,"SPAN",{class:!0});var c=H(n);s=C(c,t),c.forEach(f),i=j(u);for(let d=0;d<l.length;d+=1)l[d].l(u);u.forEach(f),this.h()},h(){O(n,"class","svelte-4r9yed"),O(o,"class","svelte-4r9yed")},m(a,u){E(a,o,u),g(o,n),g(n,s),g(o,i);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(o,null)},p(a,[u]){if(u&3&&t!==(t=a[1]("content.diary.label",{turn:a[0].turnCount})+"")&&Y(s,t),u&3){r=Le(a[0].dungeon.layout.notes);let c;for(c=0;c<r.length;c+=1){const d=Oo(a,r,c);l[c]?l[c].p(d,u):(l[c]=Mo(d),l[c].c(),l[c].m(o,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=r.length}},i:be,o:be,d(a){a&&f(o),en(l,a)}}}function $i(e,o,n){let t;Ye(e,Ue,i=>n(1,t=i));let{state:s}=o;return e.$$set=i=>{"state"in i&&n(0,s=i.state)},[s,t]}class zi extends we{constructor(o){super(),He(this,o,$i,ji,ge,{state:0})}}function er(e){let o,n,t,s,i,r,l,a,u,c,d,v,_,P,T,b,A,m;t=new Gi({props:{state:e[0]}}),i=new zi({props:{state:e[0]}});function p(B){e[2](B)}function D(B){e[3](B)}let R={};e[0]!==void 0&&(R.state=e[0]),e[1]!==void 0&&(R.debugMode=e[1]),l=new hi({props:R}),_e.push(()=>ye(l,"state",p)),_e.push(()=>ye(l,"debugMode",D));function N(B){e[4](B)}function ee(B){e[5](B)}let le={buildInfo:Zi};e[0]!==void 0&&(le.state=e[0]),e[1]!==void 0&&(le.debugMode=e[1]),v=new Si({props:le}),_e.push(()=>ye(v,"state",N)),_e.push(()=>ye(v,"debugMode",ee));function ue(B){e[6](B)}let de={};return e[0]!==void 0&&(de.state=e[0]),b=new Wi({props:de}),_e.push(()=>ye(b,"state",ue)),{c(){o=L("div"),n=L("div"),De(t.$$.fragment),s=Z(),De(i.$$.fragment),r=Z(),De(l.$$.fragment),c=Z(),d=L("div"),De(v.$$.fragment),T=Z(),De(b.$$.fragment),this.h()},l(B){o=w(B,"DIV",{class:!0});var ie=H(o);n=w(ie,"DIV",{class:!0});var fe=H(n);Ie(t.$$.fragment,fe),s=j(fe),Ie(i.$$.fragment,fe),fe.forEach(f),r=j(ie),Ie(l.$$.fragment,ie),ie.forEach(f),c=j(B),d=w(B,"DIV",{class:!0,id:!0});var ne=H(d);Ie(v.$$.fragment,ne),T=j(ne),Ie(b.$$.fragment,ne),ne.forEach(f),this.h()},h(){O(n,"class","characterSide svelte-3spdd7"),O(o,"class","container svelte-3spdd7"),O(d,"class","container svelte-3spdd7"),O(d,"id","footer")},m(B,ie){E(B,o,ie),g(o,n),Oe(t,n,null),g(n,s),Oe(i,n,null),g(o,r),Oe(l,o,null),E(B,c,ie),E(B,d,ie),Oe(v,d,null),g(d,T),Oe(b,d,null),m=!0},p(B,[ie]){const fe={};ie&1&&(fe.state=B[0]),t.$set(fe);const ne={};ie&1&&(ne.state=B[0]),i.$set(ne);const U={};!a&&ie&1&&(a=!0,U.state=B[0],ve(()=>a=!1)),!u&&ie&2&&(u=!0,U.debugMode=B[1],ve(()=>u=!1)),l.$set(U);const he={};!_&&ie&1&&(_=!0,he.state=B[0],ve(()=>_=!1)),!P&&ie&2&&(P=!0,he.debugMode=B[1],ve(()=>P=!1)),v.$set(he);const z={};!A&&ie&1&&(A=!0,z.state=B[0],ve(()=>A=!1)),b.$set(z)},i(B){m||(S(t.$$.fragment,B),S(i.$$.fragment,B),S(l.$$.fragment,B),S(v.$$.fragment,B),S(b.$$.fragment,B),m=!0)},o(B){$(t.$$.fragment,B),$(i.$$.fragment,B),$(l.$$.fragment,B),$(v.$$.fragment,B),$(b.$$.fragment,B),m=!1},d(B){B&&(f(o),f(c),f(d)),Re(t),Re(i),Re(l),Re(v),Re(b)}}}function nr(e,o,n){let t,s=null;s=localStorage.getItem("reloadGuard"),s?(t=lt(JSON.parse(s)),ae(t)):(t=at(),ae(t)),Tn(t.settings.locale);let i=t.settings.debug;function r(d){t=d,n(0,t)}function l(d){i=d,n(1,i)}function a(d){t=d,n(0,t)}function u(d){i=d,n(1,i)}function c(d){t=d,n(0,t)}return[t,i,r,l,a,u,c]}class ir extends we{constructor(o){super(),He(this,o,nr,er,ge,{})}}export{ir as component};
