import{s as Ne,n as le,o as Je,b as jn,f as Jn,r as Et,i as W}from"../chunks/scheduler.ba2ce6c0.js";import{S as en,i as nn,g as I,h as v,j as y,f as Q,k as x,a as te,x as f,y as N,e as Xe,z as Qt,m as et,n as nt,o as Ct,A as tt,r as gn,s as P,u as pn,c as S,B as Y,v as In,C as yt,d as vn,t as hn,w as En}from"../chunks/index.92acf144.js";function ot(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var O=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(O||{}),U=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(U||{}),w=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(w||{}),ee=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(ee||{}),$=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))($||{}),B=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(B||{}),H=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e))(H||{});const Qn=[{name:"Sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:H.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Two-handed Sword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:H.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"Halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:H.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"Flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:H.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"Double Headed Axe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:H.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],it=[{name:"Orch Sword",range:99,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:H.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"Troll Club",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:H.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],kt=[{name:"Chain mail",type:H.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"Plate mail",type:H.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"Dragon Skin mail",type:H.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],st=[{name:"Orch Mail",defense:0,magicProtection:!1,amountInDeck:4,type:H.ARMOUR,movementReduction:0,value:0},{name:"Troll Skin",defense:1,magicProtection:!1,amountInDeck:4,type:H.ARMOUR,movementReduction:0,value:0}],Bt="0",Rt="@",qe=" ",Cn="#",Dt=(e,n,t,o)=>({type:e,name:n,position:{x:t,y:o},found:!1}),K=(e,n,t)=>({side:e,x:n,y:t,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),at=(e,n,t)=>({...K(e,n,t),hidden:!0}),ne=(e,n,t,o)=>{const i=Object.values(O).indexOf(n),r=Object.keys(O)[i];let c=w.LORD,m=2,u=2,h=4,C=4,k=4,_=it[0],G=st[0];switch(e){case U.ORCH:{c=w.APPRENTICE,u=0,h=2,C=2,k=1;break}case U.TROLL:{c=w.KNIGHT,u=1,h=3,C=3,k=2,_=it[1],G=st[1];break}}return e===U.YELLOW_DARK_LORD&&(m=3),{type:e,level:c,colour:n,actions:m,defense:u,health:h,maxHealth:C,experience:k,name:e+" ("+r+")",movement:3,maxMovement:3,position:{x:t,y:o},weapon:_,armour:G,incapacitated:!1,inventory:[]}},Tt=e=>{const n=e.currentActor,t=Ve(n.level,1);let o,i,r,c;t>=1?(o=xt(e,n,t),o||(i=Pt(e,n,t)),!o&&!i&&(r=St(e,n,t)),!o&&!i&&!r&&(c=Mt(e,n,t)),!o&&!i&&!r&&!c&&g(e,`${n.name} searched but found nothing`)):g(e,`${n.name} searched but found nothing`)},ut=e=>{const n=e.currentActor;if(!n)return!1;const t=e.dungeon.layout.secrets.filter(o=>o.type===$.TRAP_DOOR).filter(o=>!o.found).find(o=>kn(o.position,n.position));return t?(xe(e,bt(t),n),g(e,`${n.name} fell into a pit and is incapacitated for one turn.`),n.movement=0,n.actions=0,n.incapacitated=!0,t.found=!0,!0):!1},bt=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:O.Red,maxHealth:0,name:"Trap Door",level:w.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:H.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),Ht=(e,n)=>e.dungeon.layout.doors.filter(t=>t.hidden).find(t=>ke({x:t.x,y:t.y},n.x,n.y)),Ot=(e,n)=>e.dungeon.layout.doors.filter(t=>t.trapped).find(t=>t.x===n.x&&t.y===n.y),Lt=(e,n)=>e.dungeon.layout.secrets.filter(t=>!t.found).find(t=>ke(t.position,n.x,n.y)),wt=(e,n)=>e.dungeon.layout.secrets.filter(t=>!t.found).filter(t=>t.type===$.TRAP_DOOR).find(t=>ke(t.position,n.x,n.y)),Pt=(e,n,t)=>Ht(e,n.position)?(g(e,`${n.name} searched (${t}) and found a hidden door`),!0):!1,St=(e,n,t)=>{const o=Ot(e,n.position);return o?(g(e,`${n.name} searched (${t}) and found a trap in a door`),o.trapped=!1,!0):!1},Mt=(e,n,t)=>{const o=Lt(e,n.position);if(o){switch(g(e,`${n.name} searched (${t}) and found ${o.name}`),o.found=!0,o.type){case $.EQUIPMENT:{let i=o.item??_t(e);switch(Nt(e,i),g(e,`${n.name} equipped (${i.name})`),i.type){case H.ARMOUR:n.armour&&n.inventory.push(n.armour),n.armour=i;break;case H.SHIELD:n.shield&&n.inventory.push(n.shield),n.shield=i;break;case H.WEAPON:n.weapon&&n.inventory.push(n.weapon),n.weapon=i;break}}}return!0}return!1},_t=e=>{const n=e.itemDeck.length,t=Math.floor(Math.random()*n);return e.itemDeck[t]},Nt=(e,n)=>{const t=e.itemDeck.findIndex(o=>o.type===n.type&&o.name===n.name);e.itemDeck.splice(t,1)},xt=(e,n,t)=>{const o=wt(e,n.position);return o?(g(e,`${n.name} searched (${t}) and found ${o.name}`),o.found=!0,!0):!1},ft={name:"The Three Gates of Power",beaten:!1,winConditions:[{type:ee.KILL_ALL,fulfilled:!1},{type:ee.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:1,y:4},{x:0,y:3},{x:0,y:4},{x:0,y:5}],discoveredRooms:["A"],layout:{grid:["            EEEE","            EEEE","         DDDEEEE","AAA   CCCC","AAABBBCCCC   GGG","AAA   CCCCFFFGGG","      CCCC   GGG","      CCCC","      CCCCHHHIII","             III","             III"],doors:[K(B.RIGHT,2,4),K(B.RIGHT,5,4),K(B.RIGHT,9,5),K(B.RIGHT,12,5),K(B.RIGHT,9,8),K(B.RIGHT,12,8),K(B.RIGHT,11,2),at(B.UP,9,3),at(B.RIGHT,15,1)],monsters:[ne(U.ORCH,O.Blue,9,7),ne(U.ORCH,O.Red,12,8),ne(U.TROLL,O.Red,15,1),ne(U.TROLL,O.Yellow,13,6)],secrets:[{type:$.EQUIPMENT,position:{x:9,y:4},found:!1,name:"Random Equipment"},{type:$.EQUIPMENT,position:{x:12,y:0},found:!1,name:"Random Equipment"},{type:$.MAGIC_ITEM,position:{x:15,y:5},found:!1,name:"Random Magic Item"},{type:$.EQUIPMENT,position:{x:15,y:9},found:!1,name:"Random Equipment"}],notes:[{message:"Beyond stone and fire you shall find the Dread tunnel, the road to the Ice Dragons treasure.",position:{x:2,y:4}},{message:"The Gate of Water. <There is an image of a sea dragon under the text>",position:{x:9,y:8}},{message:"The Gate of Air. <There is an image of a pegasus under the text>",position:{x:9,y:5}},{message:"The Gate of Fire. <There is an image of a hippogriph under the text>",position:{x:9,y:3}}]},killCount:0},Ut={name:"Troll cave",beaten:!1,winConditions:[{type:ee.KILL_ALL,fulfilled:!1}],nextDungeon:ft,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[K(B.RIGHT,3,9),K(B.RIGHT,6,9),K(B.UP,7,7),K(B.UP,7,4)],monsters:[ne(U.ORCH,O.Green,6,9),ne(U.ORCH,O.Yellow,8,10),ne(U.ORCH,O.Red,7,5),ne(U.ORCH,O.Red,9,3),ne(U.TROLL,O.Green,6,1)],secrets:[Dt($.TRAP_DOOR,"Welcome to Drakriddarna",3,9)],notes:[]},killCount:0},Gt=[{name:"Large shield",type:H.SHIELD,amountInDeck:2,dice:2,value:2},{name:"Small shield",type:H.SHIELD,amountInDeck:2,dice:1,value:1}],Ke=(e,n)=>(Qn[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:w.APPRENTICE,health:7,maxHealth:7,colour:n,experience:0,position:{x:-1,y:-1},weapon:Qn[0],incapacitated:!1,inventory:[]}),Yt=()=>{const e=[];return Qn.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),kt.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),Gt.forEach(n=>{for(let t=0;t<n.amountInDeck;t++)e.push(n)}),e},Me={name:"Treasure of the Ice Dragon",dungeons:[Ut,ft],itemDeck:Yt(),heroes:[Ke("Fearik",O.Yellow),Ke("Helbran",O.Red),Ke("Siedel",O.Green),Ke("Wulf",O.Blue)]},rt=e=>{g(e,"Game saved."),localStorage.setItem("state",JSON.stringify(e))},Ft=()=>{const e=localStorage.getItem("state");if(e){const n=JSON.parse(e);return n.currentActor=n.heroes.find(t=>{var o;return t.name===((o=n.currentActor)==null?void 0:o.name)}),g(n,"Game loaded."),n}},Wt=()=>{const e={heroes:Me.heroes,dungeon:Me.dungeons[0],currentActor:Me.heroes[0],actionLog:[`Playing '${Me.name}'`,"Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."],itemDeck:Kt(Me.itemDeck)};return mt(e),e},Kt=e=>{let n=e.length,t;for(;n>0;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e},mt=e=>{e.heroes.forEach((n,t)=>{n.position=e.dungeon.startingPositions[t],n.movement=ce(n),n.actions=2,n.health=n.maxHealth})},ye=e=>{let n=[];for(let t=0;t<e.length;t++)n.push(e[t]);return n},Bn=(e,n,t)=>e.dungeon.layout.monsters.some(o=>o.position.x===n&&o.position.y===t&&o.health>0),Rn=(e,n,t)=>M(e).some(o=>o.position.x===n&&o.position.y===t),$e=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=ce(e))),e.actions==0&&(e.movement=0)},R=(e,n)=>{const t=n.currentActor;if(!t||t.actions===0)return;let o=t.position.x,i=t.position.y;switch(e){case"UL":o=t.position.x-1,i=t.position.y-1;break;case"U":i=t.position.y-1;break;case"UR":o=t.position.x+1,i=t.position.y-1;break;case"L":o=t.position.x-1;break;case"R":o=t.position.x+1;break;case"DL":o=t.position.x-1,i=t.position.y+1;break;case"D":i=t.position.y+1;break;case"DR":o=t.position.x+1,i=t.position.y+1;break}const r=Rn(n,o,i),c=!tn(n.dungeon.layout,o,i),m=Bn(n,o,i);if(!r&&!c){const u=Dn(n.dungeon,o,i);u?u&&(m?pt(t,n,o,i):gt(t,n,o,i,1)):Xt(n,t,o,i)&&_e(t,n,o,i)}else g(n,`${t.name} could not make that move`);ut(n)||$e(t)},gt=(e,n,t,o,i)=>{e.position.x=t,e.position.y=o;const r=n.dungeon.layout.notes.find(m=>kn(m.position,e.position));r&&(n.dungeon.layout.doors.some(u=>u.hidden&&kn(r.position,{x:u.x,y:u.y}))||g(n,`${e.name} reads: ${r.message}`)),n.dungeon.layout.monsters.some(m=>ke(e.position,m.position.x,m.position.y))?(g(n,`${e.name} walked by a monster and lost the momentum`),e.movement=0):e.movement-=i},_e=(e,n,t,o)=>{const i=on(n.dungeon.layout.grid,t,o);i&&n.dungeon.discoveredRooms.push(i),gt(e,n,e.position.x,e.position.y,1),g(n,`${e.name} opened a door`)},pt=(e,n,t,o)=>{if(e.actions===1&&e.movement!==3){g(n,`${e.name} has no actions left to attack`);return}if(!e.weapon.useHearHeroes&&M(n).filter(c=>c!==e).filter(c=>ke(e.position,c.position.x,c.position.y)).length>0){g(n,`${e.name} could not use ${e.weapon.name} near a friend.`);return}const i=n.dungeon.layout.monsters.find(r=>r.position.x===t&&r.position.y===o);i&&(xe(n,e,i),i.health<=0&&(n.dungeon.layout.monsters=n.dungeon.layout.monsters.filter(r=>r!=i),g(n,`${e.name} killed ${i.name}`),n.dungeon.killCount++,e.experience+=i.experience),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},Ve=(e,n)=>{let t=[];for(let o=0;o<n;o++)t.push(Math.floor(Math.random()*6)+1);switch(e){case w.APPRENTICE:t=t.filter(o=>o===5);break;case w.KNIGHT:case w.HERO:t=t.filter(o=>o>=4);break;case w.LORD:case w.MASTER:t=t.filter(o=>o>=3);break}return t.length},ze=e=>{const n=e.currentActor;if(!n)return;if(!je(n)){g(e,`${n.name} has no actions left to pick lock`);return}const t=e.dungeon.layout.doors.find(o=>o.x===n.position.x&&o.y===n.position.y);t&&t.locked&&(Ve(n.level,1)>=1?(t.locked=!1,g(e,`${n.name} managed to pick the lock`)):g(e,`${n.name} failed to pick the lock`),n.actions>1&&n.movement<3?n.actions-=2:n.actions--,n.movement=ce(n),n.actions==0&&(n.movement=0))},ce=e=>{var n;return e.maxMovement-(((n=e.armour)==null?void 0:n.movementReduction)??0)},Ze=e=>{const n=e.currentActor;if(n){if(!je(n)){g(e,`${n.name} has no actions left to search`);return}Tt(e),n.actions>1&&n.movement<ce(n)?n.actions-=2:n.actions--,n.actions==0&&(n.movement=0)}},yn=e=>{if(qt(e),e.currentActor!==void 0){g(e,`${e.currentActor.name} ended their turn`);let t=M(e).indexOf(e.currentActor)+1;t===M(e).length&&(Vt(e),t=0),M(e)[t].incapacitated&&(g(e,`${M(e)[t].name} is no longer incapacitated.`),M(e)[t].incapacitated=!1,t++),e.currentActor.actions=2,e.currentActor.movement=ce(e.currentActor),e.currentActor=M(e)[t],g(e,`${e.currentActor.name} started their turn`)}},qt=e=>{var n;e.dungeon.winConditions.forEach(t=>{var o;switch(t.type){case ee.KILL_ALL:{const i=e.dungeon.layout.monsters.map(r=>r.health).reduce((r,c)=>r+c,0);t.fulfilled=i<=0;break}case ee.REACH_CELL:{t.fulfilled=M(e).some(i=>{var r;return i.position.x===((r=t.targetCell)==null?void 0:r.x)&&i.position.y===t.targetCell.y});break}case ee.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(i=>i.type===t.targetMonsterType).some(i=>i.health>0);break}case ee.OPEN_DOOR:{t.fulfilled=((o=e.dungeon.layout.doors.find(i=>{var r,c;return i.x===((r=t.targetCell)==null?void 0:r.x)&&i.y===((c=t.targetCell)==null?void 0:c.y)}))==null?void 0:o.open)??!1;break}case ee.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,o)=>t&&o,!0),e.dungeon.beaten&&(g(e,"All win conditions have been fulfilled"),g(e,`You have cleared ${e.dungeon.name}`),g(e,`Press 'Next' to move on to the next level: ${(n=e.dungeon.nextDungeon)==null?void 0:n.name}`))},It=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:O.Red,maxHealth:0,name:"Door",level:w.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:H.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),Xt=(e,n,t,o)=>{const i=e.dungeon.layout.doors.find(r=>r.x===n.position.x&&r.y===n.position.y);if(i&&!i.locked){const r=$t(n.position.x,n.position.y,t,o);if(i.side===r)return i.open=!0,i.trapped&&xe(e,It(i),n),!0}return i&&i.locked&&g(e,"Door is locked"),!1},$t=(e,n,t,o)=>{if(e===t){if(n>o)return B.UP;if(n<o)return B.DOWN}if(n===o){if(e>t)return B.LEFT;if(e<t)return B.RIGHT}},tn=(e,n,t)=>{let o=!0;if(n<0||n>=e.grid[0].length||t<0||t>=e.grid.length)o=!1;else{const i=on(e.grid,n,t);(i===Bt||i===Rt||i===qe||i===Cn)&&(o=!1)}return o},Dn=(e,n,t)=>{const o=on(e.layout.grid,n,t);return o?e.discoveredRooms.includes(o):!1},on=(e,n,t)=>{let o;return e.forEach((i,r)=>{ye(i).forEach((c,m)=>{r===t&&m===n&&(o=c)})}),o},ke=(e,n,t)=>e.x===n&&e.y===t||e.x===n-1&&e.y===t||e.x===n-1&&e.y===t-1||e.x===n&&e.y===t-1||e.x===n+1&&e.y===t-1||e.x===n+1&&e.y===t||e.x===n+1&&e.y===t+1||e.x===n&&e.y===t+1||e.x===n-1&&e.y===t+1,Vt=e=>{const n=e.dungeon.layout.monsters.filter(t=>{const o=on(e.dungeon.layout.grid,t.position.x,t.position.y);return o&&e.dungeon.discoveredRooms.includes(o)&&t.health>0});n.length===0&&g(e,"No monsters can act"),n.forEach(t=>{const o=t.actions;for(g(e,`${t.name} acted `);t.actions>0;){const i=M(e).filter(r=>ke(t.position,r.position.x,r.position.y));if(i.length>0){const r=Math.floor(Math.random()*i.length);Jt(e,t,i[r])}else{for(;t.movement>0;)zt(e,t);t.actions--,t.movement=ce(t)}}t.actions=o,t.movement=ce(t)})},lt=(e,n)=>Math.sqrt(Math.pow(e.x-(n==null?void 0:n.x),2)+Math.pow(e.y-(n==null?void 0:n.y),2)),zt=(e,n)=>{const t=M(e).map(o=>({hero:o,dist:lt(o.position,n.position)})).sort((o,i)=>o.dist-i.dist)[0];if(t.dist>1){const o=Zt(e,n.position);if(o.length>0){const i=o.map(r=>({pos:r,dist:lt(r,t.hero.position)})).sort((r,c)=>r.dist-c.dist)[0].pos;n.position=i,g(e,`${n.name} moved towards ${t.hero.name} (${i.x},${i.y})`)}else g(e,`${n.name} could not move`)}n.movement--};let Zt=(e,n)=>{const t=n.x,o=n.y,i=[];for(let r=t-1;r<=t+1;r++)for(let c=o-1;c<=o+1;c++)r===t&&c===o||tn(e.dungeon.layout,r,c)&&Dn(e.dungeon,r,c)&&i.push({x:r,y:c});return i.filter(r=>!M(e).find(c=>c.position.x===r.x&&c.position.y===r.y)).filter(r=>!e.dungeon.layout.monsters.find(m=>m.position.x===r.x&&m.position.y===r.y))};const jt=(e,n,t,o)=>{var r;const i=((r=o.armour)==null?void 0:r.defense)??o.defense;return`${e} damage (${n}-(${i}+${t})=${e})`},Jt=(e,n,t)=>{if(n.actions===1&&n.movement!==3){g(e,`${t.name} has no actions left to attack`);return}t&&(xe(e,n,t),(n==null?void 0:n.actions)>1&&(n==null?void 0:n.movement)<3?n.actions-=2:n.actions--)},je=e=>e.movement<ce(e)?e.actions>1:e.actions>0,kn=(e,n)=>e.x===n.x&&e.y===n.y,g=(e,n)=>{e.actionLog=[n,...e.actionLog]},M=e=>e.heroes.filter(n=>n.health>0),eo=e=>e.heroes.filter(n=>n.health<=0),xe=(e,n,t)=>{var m,u;let o=0,i=0;n.weapon.ignoresArmour?t.armour&&g(e,`${t.name}'s armour was useless against ${n.weapon.name} `):o=((m=t.armour)==null?void 0:m.defense)??t.defense,n.weapon.ignoresShield?t.shield&&g(e,`${t.name}'s shield was useless against ${n.weapon.name} `):i=Ve(t.level,((u=t.shield)==null?void 0:u.dice)??0);const r=Ve(n.level,n.weapon.dice),c=Math.max(r-(o+i),0);t.health-=c,g(e,`${n.name} attacked ${t.name} with ${n.weapon.name} for ${jt(c,r,i,t)}`),t.health<=0&&(g(e,`${n.name} killed ${t.name}`),t.health=0,t.level=w.APPRENTICE)},no=e=>{M(e).forEach(n=>{const t=n.level;n.experience>=28?n.level=w.MASTER:n.experience>=18?n.level=w.LORD:n.experience>=10?n.level=w.HERO:n.experience>=4&&(n.level=w.KNIGHT),t!==n.level&&g(e,`${n.name} leveled up to ${n.level}`)})},to=e=>{M(e).forEach(n=>n.experience+=4)},oo=e=>{eo(e).forEach(n=>{n.experience=0,n.health=n.maxHealth,n.movement=n.maxMovement,n.actions=2})},io=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=["You have reached "+e.dungeon.name],to(e),no(e),oo(e),mt(e))},so="data:image/png;base64,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av8Y5Sy9/WMYKIMAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAAQIECBAgQIAAgZsC/wFnqYWZIdKtqQAAAABJRU5ErkJggg==",ao="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",ro=(e,n)=>{const t=Math.abs(n.x-e.x),o=Math.abs(n.y-e.y),i=Math.min(t,o),r=Math.max(t,o),c=i,m=r-i;let u=Math.sqrt(2);return m===0&&(u=1),Math.floor(u*c+m)},lo=(e,n,t)=>{const o=e.currentActor,i=e.dungeon.layout.doors.find(r=>r.x===o.position.x&&r.y===o.position.y);if(i){if(!i.open&&!i.hidden&&!i.locked){switch(i.open=!0,i.trapped&&xe(e,It(i),o),i.side){case B.RIGHT:_e(o,e,n+1,t);break;case B.LEFT:_e(o,e,n-1,t);break;case B.DOWN:_e(o,e,n,t+1);break;case B.UP:_e(o,e,n,t-1);break}$e(o)}else if(i.locked&&!i.hidden){if(!je(o)){g(e,`${o.name} has no actions left`);return}g(e,"Door is locked"),ze(e),$e(o)}}else{if(!je(o)){g(e,`${o.name} has no actions left`);return}Ze(e)}},co=(e,n,t)=>{const o=e.currentActor;if(o.actions===0){g(e,`${o.name} has no actions left`);return}const i=tn(e.dungeon.layout,n,t),r=ro(o.position,{x:n,y:t});if(console.log("distance: "+r),i){const c=Rn(e,n,t),m=Bn(e,n,t);if(!c&&!m&&r<=o.movement){if(o.position={x:n,y:t},o.movement-=r,ut(e))return}else m&&(r<=o.weapon.range?pt(o,e,n,t):g(e,"Monster is out of range"))}$e(o)},Ao=(e,n,t)=>{const o=t.currentActor,i=document.getElementById("gameBoard");if(!i)return;const r=i.getBoundingClientRect(),c=Math.min(Math.floor((e.clientX-r.left)/n),t.dungeon.layout.grid[0].length-1),m=Math.min(Math.floor((e.clientY-r.top)/n),t.dungeon.layout.grid.length-1),u=t.dungeon.layout.grid[m][c];c===o.position.x&&m===o.position.y?lo(t,c,m):t.dungeon.discoveredRooms.includes(u)&&co(t,c,m)},uo=(e,n,t,o)=>{o.dungeon.layout.secrets.filter(i=>i.found).forEach(i=>{switch(i.type){case $.TRAP_DOOR:fo(e,n,t,i);break;default:mo(e,n,t,i);break}})},fo=(e,n,t,o)=>{const i=o.position.x,r=o.position.y;e.drawImage(n,3*48,0,48,48,i*t,r*t,t,t)},mo=(e,n,t,o)=>{const i=o.position.x,r=o.position.y;e.drawImage(n,4*48,0,48,48,i*t,r*t,t,t)};function go(e){let n,t,o,i;return{c(){n=I("div"),t=I("canvas"),this.h()},l(r){n=v(r,"DIV",{style:!0,class:!0});var c=y(n);t=v(c,"CANVAS",{width:!0,height:!0,id:!0}),y(t).forEach(Q),c.forEach(Q),this.h()},h(){x(t,"width",s*40),x(t,"height",s*30),x(t,"id","gameBoard"),x(n,"style",e[1]()),x(n,"class","dungeon svelte-a4uhtl")},m(r,c){te(r,n,c),f(n,t),o||(i=N(t,"click",e[0]),o=!0)},p:le,i:le,o:le,d(r){r&&Q(n),o=!1,i()}}}const s=48;function po(e,n,t){let{state:o}=n,{debugMode:i=!0}=n,r,c;c=window.innerHeight,r=document.getElementById("footer").offsetHeight,Je(()=>{const a=new Image;a.src=so;const l=new Image;l.src=ao,u(a,l),setInterval(()=>u(a,l),10)});const m=(a,l,A)=>{const d=l.position.x,p=l.position.y;a.drawImage(A,4*16,0,16,16,d*s,p*s,s,s),Ae(a,l,d,p),G(a,l,d,p),Ce(a,l,d,p)},u=(a,l)=>{if(!o||!document)return;const A=document.getElementById("gameBoard"),d=A.getContext("2d");d.clearRect(0,0,A.width,A.height),d.fillStyle="black",d.fillRect(0,0,A.width,A.height),o.dungeon.layout.grid.forEach((D,E)=>{ye(D).forEach((T,L)=>C(d,T,L,E,a))}),uo(d,a,s,o),o.dungeon.layout.grid.forEach((D,E)=>{ye(D).forEach((T,L)=>k(d,T,L,E))}),o.dungeon.layout.grid.forEach((D,E)=>{ye(D).forEach((T,L)=>_(d,T,L,E))}),o.dungeon.layout.grid.forEach((D,E)=>{ye(D).forEach((T,L)=>Be(d,T,L,E,l))}),M(o).forEach(D=>{m(d,D,l)}),Ge(d,o.currentActor),V(d,o.currentActor)},h=(a,l,A)=>{a.beginPath(),a.strokeStyle="black",a.fillStyle="black",a.fillRect(l*s,A*s,s,s),a.stroke()},C=(a,l,A,d,p)=>{Z(l)||!o.dungeon.discoveredRooms.includes(l)&&l!==qe?o.dungeon.discoveredRooms.some(D=>Re(A,d,D))?a.drawImage(p,48,0,48,48,A*s,d*s,s,s):h(a,A,d):z(l)?h(a,A,d):a.drawImage(p,0,0,48,48,A*s,d*s,s,s)},k=(a,l,A,d)=>{l===qe||l===Cn||(a.beginPath(),a.strokeStyle="black",a.rect(A*s,d*s,s,s),i&&(a.font="7px Arial",a.fillText(A+","+d,A*s+3,d*s+(s-3))),a.stroke())},_=(a,l,A,d)=>{const p=Ye(A,d);if(p&&!p.hidden&&!p.open&&!z(l))switch(a.fillStyle="brown",p.side){case B.RIGHT:{a.fillRect(A*s+(s-2),d*s,4,s),p.locked&&i&&(a.fillStyle="grey",a.fillRect(A*s+(s-4),d*s+(s/2-4),8,8)),p.trapped&&i&&(a.fillStyle="red",a.fillRect(A*s+(s-4),d*s+(s/2-4),4,4));break}case B.LEFT:{a.fillRect(A*s-2,d*s,4,s),p.locked&&i&&(a.fillStyle="grey",a.fillRect(A*s-4,d*s+(s/2-4),8,8)),p.trapped&&i&&(a.fillStyle="red",a.fillRect(A*s-4,d*s+(s/2-4),4,4));break}case B.UP:{a.fillRect(A*s,d*s-2,s,4),p.locked&&i&&(a.fillStyle="grey",a.fillRect(A*s+(s/2-4),d*s-4,8,8)),p.trapped&&i&&(a.fillStyle="red",a.fillRect(A*s+(s/2-4),d*s-4,4,4));break}case B.DOWN:{a.fillRect(A*s,d*s+(s-2),s,4),p.locked&&i&&(a.fillStyle="grey",a.fillRect(A*s+(s/2-4),d*s+(s-4),8,8)),p.trapped&&i&&(a.fillStyle="red",a.fillRect(A*s+(s/2-4),d*s+(s-4),4,4));break}}},G=(a,l,A,d)=>{a.beginPath(),a.strokeStyle=l.colour,a.fillStyle=l.colour,a.fillRect(A*s+4,d*s+(s-6),s-8,4),a.stroke()},Ue=(a,l,A,d)=>{i&&A.forEach(p=>{const D=l.position.x,E=l.position.y,T=p.position.x,L=p.position.y;a.strokeStyle=l.colour,a.beginPath(),a.moveTo(D*s+s/2,E*s+s/2),a.lineTo(T*s+s/2,L*s+s/2),a.stroke()})},Ce=(a,l,A,d)=>{a.beginPath(),a.strokeStyle="black",a.fillStyle="red",a.fillRect(A*s+4,d*s,s-8,4),a.fillStyle="green",a.fillRect(A*s+4,d*s,(s-8)*(l.health/l.maxHealth),4),a.rect(A*s+4,d*s,s-8,4),a.stroke()},Ae=(a,l,A,d)=>{var p=a.fillStyle,D=a.strokeStyle;a.strokeStyle="#080808",a.fillStyle="darkred";for(let E=0;E<l.actions;E++)a.fillRect(A*s+4+6*E,d*s+s-12,5,5),a.rect(A*s+4+6*E,d*s+s-12,5,5),a.stroke();a.fillStyle="blue";for(let E=0;E<l.movement;E++)a.fillRect(A*s+s-22+6*E,d*s+s-12,5,5),a.rect(A*s+s-22+6*E,d*s+s-12,5,5),a.stroke();a.fillStyle=p,a.strokeStyle=D},V=(a,l)=>{l===o.currentActor&&(a.beginPath(),a.strokeStyle="lightblue",a.lineWidth=2,a.moveTo(l.position.x*s,l.position.y*s),a.lineTo(l.position.x*s+s/3,l.position.y*s),a.moveTo(l.position.x*s,l.position.y*s),a.lineTo(l.position.x*s,l.position.y*s+s/3),a.moveTo(l.position.x*s+s,l.position.y*s),a.lineTo(l.position.x*s+s/3*2,l.position.y*s),a.moveTo(l.position.x*s+s,l.position.y*s),a.lineTo(l.position.x*s+s,l.position.y*s+s/3),a.moveTo(l.position.x*s,l.position.y*s+s),a.lineTo(l.position.x*s,l.position.y*s+s/3*2),a.moveTo(l.position.x*s,l.position.y*s+s),a.lineTo(l.position.x*s+s/3,l.position.y*s+s),a.moveTo(l.position.x*s+s,l.position.y*s+s),a.lineTo(l.position.x*s+s,l.position.y*s+s/3*2),a.moveTo(l.position.x*s+s,l.position.y*s+s),a.lineTo(l.position.x*s+s/3*2,l.position.y*s+s),a.stroke(),a.lineWidth=1)},Ge=(a,l)=>{if(l===o.currentActor&&i){for(let A=l.position.x-l.movement;A<=l.position.x+l.movement;A++)for(let d=l.position.y-l.movement;d<=l.position.y+l.movement;d++)if(Dn(o.dungeon,A,d)){const D=Bn(o,A,d),E=Rn(o,A,d),T=tn(o.dungeon.layout,A,d);!E&&!D&&T&&(a.fillStyle="rgba(50, 50, 255, 0.08)",a.fillRect(A*s,d*s,s,s),a.stroke())}}},Be=(a,l,A,d,p)=>{if(a.beginPath(),!o.heroes.find(E=>E.position.x===A&&E.position.y===d)){const E=o.dungeon.layout.monsters.find(T=>T.position.x===A&&T.position.y===d);if(E&&E.health>0&&!z(l)){switch(E.type){case U.ORCH:a.drawImage(p,s,16,16,16,A*s,d*s,s,s);break;case U.TROLL:a.drawImage(p,s,16,16,16,A*s,d*s,s,s);break;default:a.drawImage(p,16,16,16,16,A*s,d*s,s,s);break}G(a,E,A,d),Ce(a,E,A,d),Ue(a,E,o.heroes)}}},z=a=>a===qe||!o.dungeon.discoveredRooms.includes(a),Z=a=>a===Cn,Ye=(a,l)=>o.dungeon.layout.doors.find(A=>A.x===a&&A.y===l),Re=(a,l,A)=>{if(!o)return;const d=Math.max(a-1,0),p=Math.max(l-1,0),D=Math.min(a+1,o.dungeon.layout.grid.length),E=Math.min(l+1,o.dungeon.layout.grid[0].length);for(let T=d;T<=D;T++)for(let L=p;L<=E;L++){const ue=o.dungeon.layout.grid[L];if(ye(ue)[T]===A)return!0}return!1},de=a=>{Ao(a,s,o)},j=()=>`max-height: ${c-r-20}px; max-width: ${s*40}`;return e.$$set=a=>{"state"in a&&t(2,o=a.state),"debugMode"in a&&t(3,i=a.debugMode)},[de,j,o,i]}class Io extends en{constructor(n){super(),nn(this,n,po,go,Ne,{state:2,debugMode:3})}}function vo(e){let n;return{c(){n=I("canvas"),this.h()},l(t){n=v(t,"CANVAS",{id:!0,height:!0,width:!0}),y(n).forEach(Q),this.h()},h(){x(n,"id","characterBoard"),x(n,"height","720"),x(n,"width","260")},m(t,o){te(t,n,o)},p:le,i:le,o:le,d(t){t&&Q(n)}}}const X=180;function ho(e,n,t){let{state:o}=n;Je(()=>{i(),setInterval(i,100)});const i=()=>{if(!o||!document)return;const u=document.getElementById("characterBoard"),h=u.getContext("2d");h.clearRect(0,0,u.width,u.height),h.stroke(),M(o).forEach((C,k)=>{r(h,u,C,k),c(h,C,k),m(h,C,k)})},r=(u,h,C,k)=>{u.fillStyle=C.colour,u.fillRect(12,k*X+12,h.width,X-12),u.stroke(),u.fillStyle="black"},c=(u,h,C)=>{const _=(h===o.currentActor?"> "+h.name:h.name)+" - "+h.level+" ("+h.experience+")";u.strokeStyle="black",u.font="18px Arial",u.fillText(_,16,C*X+30),u.fillText("HP: "+h.health,16,C*X+50),u.fillText("Actions: "+h.actions,16,C*X+70),u.fillText("Moves: "+h.movement,16,C*X+90),u.stroke()},m=(u,h,C)=>{u.fillText("Equipment",16,C*X+110),u.font="12px Arial",u.fillText("🗡️ "+h.weapon.name+" ("+h.weapon.dice+")",16,C*X+125);let k="None (0)",_="None (0)";h.armour&&(k=h.armour.name+" ("+h.armour.defense+")"),h.shield&&(_=h.shield.name+" ("+h.armour.dice+")"),u.fillText("🧱 "+k,16,C*X+142),u.fillText("🛡️ "+_,16,C*X+159)};return e.$$set=u=>{"state"in u&&t(0,o=u.state)},[o]}class Eo extends en{constructor(n){super(),nn(this,n,ho,vo,Ne,{state:0})}}function ct(e,n,t){const o=e.slice();return o[2]=n[t],o[4]=t,o}function Qo(e){let n,t,o=e[2]+"",i;return{c(){n=I("p"),t=et(">"),i=et(o),this.h()},l(r){n=v(r,"P",{class:!0});var c=y(n);t=nt(c,">"),i=nt(c,o),c.forEach(Q),this.h()},h(){x(n,"class","svelte-1xp6uq")},m(r,c){te(r,n,c),f(n,t),f(n,i)},p(r,c){c&1&&o!==(o=r[2]+"")&&Ct(i,o)},d(r){r&&Q(n)}}}function At(e){let n,t=e[4]<25&&Qo(e);return{c(){t&&t.c(),n=Xe()},l(o){t&&t.l(o),n=Xe()},m(o,i){t&&t.m(o,i),te(o,n,i)},p(o,i){o[4]<25&&t.p(o,i)},d(o){o&&Q(n),t&&t.d(o)}}}function dt(e){let n,t=ot(e[0]),o=[];for(let i=0;i<t.length;i+=1)o[i]=At(ct(e,t,i));return{c(){for(let i=0;i<o.length;i+=1)o[i].c();n=Xe()},l(i){for(let r=0;r<o.length;r+=1)o[r].l(i);n=Xe()},m(i,r){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(i,r);te(i,n,r)},p(i,r){if(r&1){t=ot(i[0]);let c;for(c=0;c<t.length;c+=1){const m=ct(i,t,c);o[c]?o[c].p(m,r):(o[c]=At(m),o[c].c(),o[c].m(n.parentNode,n))}for(;c<o.length;c+=1)o[c].d(1);o.length=t.length}},d(i){i&&Q(n),Qt(o,i)}}}function Co(e){let n,t=e[0],o=dt(e);return{c(){n=I("div"),o.c(),this.h()},l(i){n=v(i,"DIV",{class:!0});var r=y(n);o.l(r),r.forEach(Q),this.h()},h(){x(n,"class","log svelte-1xp6uq")},m(i,r){te(i,n,r),o.m(n,null)},p(i,[r]){r&1&&Ne(t,t=i[0])?(o.d(1),o=dt(i),o.c(),o.m(n,null)):o.p(i,r)},i:le,o:le,d(i){i&&Q(n),o.d(i)}}}function yo(e,n,t){let o=[],{state:i}=n;return Je(()=>{setInterval(()=>{t(0,o=i.actionLog)},1e3)}),e.$$set=r=>{"state"in r&&t(1,i=r.state)},[o,i]}class ko extends en{constructor(n){super(),nn(this,n,yo,Co,Ne,{state:1})}}function Bo(e){let n,t,o,i,r,c,m,u,h,C,k,_,G,Ue="UL",Ce,Ae,V,Ge="U",Be,z,Z,Ye="UR",Re,de,j,a="Next",l,A,d,p,D="L",E,T,L,ue,oe,Tn="R",sn,De,fe,bn="Search",an,q,Te,me,Hn="DL",rn,be,ge,On="D",ln,He,pe,Ln="DR",cn,Oe,Ie,wn="Pick lock",An,ve,Le,he,Pn="Save",dn,we,Ee,Sn="Load",un,J,fn,Fe,mn,Mn;o=new Eo({props:{state:e[0]}});function vt(b){e[2](b)}let _n={};e[0]!==void 0&&(_n.state=e[0]),r=new Io({props:_n}),jn.push(()=>tt(r,"state",vt));function ht(b){e[4](b)}let Nn={};return e[0]!==void 0&&(Nn.state=e[0]),J=new ko({props:Nn}),jn.push(()=>tt(J,"state",ht)),{c(){n=I("div"),t=I("div"),gn(o.$$.fragment),i=P(),gn(r.$$.fragment),m=P(),u=I("div"),h=I("div"),C=I("table"),k=I("tr"),_=I("td"),G=I("button"),G.textContent=Ue,Ce=P(),Ae=I("td"),V=I("button"),V.textContent=Ge,Be=P(),z=I("td"),Z=I("button"),Z.textContent=Ye,Re=P(),de=I("td"),j=I("button"),j.textContent=a,l=P(),A=I("tr"),d=I("td"),p=I("button"),p.textContent=D,E=P(),T=I("td"),L=P(),ue=I("td"),oe=I("button"),oe.textContent=Tn,sn=P(),De=I("td"),fe=I("button"),fe.textContent=bn,an=P(),q=I("tr"),Te=I("td"),me=I("button"),me.textContent=Hn,rn=P(),be=I("td"),ge=I("button"),ge.textContent=On,ln=P(),He=I("td"),pe=I("button"),pe.textContent=Ln,cn=P(),Oe=I("td"),Ie=I("button"),Ie.textContent=wn,An=P(),ve=I("tr"),Le=I("td"),he=I("button"),he.textContent=Pn,dn=P(),we=I("td"),Ee=I("button"),Ee.textContent=Sn,un=P(),gn(J.$$.fragment),this.h()},l(b){n=v(b,"DIV",{class:!0});var F=y(n);t=v(F,"DIV",{class:!0});var Pe=y(t);pn(o.$$.fragment,Pe),Pe.forEach(Q),i=S(F),pn(r.$$.fragment,F),F.forEach(Q),m=S(b),u=v(b,"DIV",{class:!0,id:!0});var Qe=y(u);h=v(Qe,"DIV",{class:!0});var Se=y(h);C=v(Se,"TABLE",{});var ie=y(C);k=v(ie,"TR",{});var se=y(k);_=v(se,"TD",{});var xn=y(_);G=v(xn,"BUTTON",{"data-svelte-h":!0}),Y(G)!=="svelte-fw3uxo"&&(G.textContent=Ue),xn.forEach(Q),Ce=S(se),Ae=v(se,"TD",{});var Un=y(Ae);V=v(Un,"BUTTON",{"data-svelte-h":!0}),Y(V)!=="svelte-1jeoia6"&&(V.textContent=Ge),Un.forEach(Q),Be=S(se),z=v(se,"TD",{});var Gn=y(z);Z=v(Gn,"BUTTON",{"data-svelte-h":!0}),Y(Z)!=="svelte-1p8c8vc"&&(Z.textContent=Ye),Gn.forEach(Q),Re=S(se),de=v(se,"TD",{});var Yn=y(de);j=v(Yn,"BUTTON",{"data-svelte-h":!0}),Y(j)!=="svelte-1rtxc14"&&(j.textContent=a),Yn.forEach(Q),se.forEach(Q),l=S(ie),A=v(ie,"TR",{});var ae=y(A);d=v(ae,"TD",{});var Fn=y(d);p=v(Fn,"BUTTON",{"data-svelte-h":!0}),Y(p)!=="svelte-10dnpu6"&&(p.textContent=D),Fn.forEach(Q),E=S(ae),T=v(ae,"TD",{}),y(T).forEach(Q),L=S(ae),ue=v(ae,"TD",{});var Wn=y(ue);oe=v(Wn,"BUTTON",{"data-svelte-h":!0}),Y(oe)!=="svelte-12287ni"&&(oe.textContent=Tn),Wn.forEach(Q),sn=S(ae),De=v(ae,"TD",{});var Kn=y(De);fe=v(Kn,"BUTTON",{"data-svelte-h":!0}),Y(fe)!=="svelte-cps1bu"&&(fe.textContent=bn),Kn.forEach(Q),ae.forEach(Q),an=S(ie),q=v(ie,"TR",{});var re=y(q);Te=v(re,"TD",{});var qn=y(Te);me=v(qn,"BUTTON",{"data-svelte-h":!0}),Y(me)!=="svelte-1ji074i"&&(me.textContent=Hn),qn.forEach(Q),rn=S(re),be=v(re,"TD",{});var Xn=y(be);ge=v(Xn,"BUTTON",{"data-svelte-h":!0}),Y(ge)!=="svelte-li5tq6"&&(ge.textContent=On),Xn.forEach(Q),ln=S(re),He=v(re,"TD",{});var $n=y(He);pe=v($n,"BUTTON",{"data-svelte-h":!0}),Y(pe)!=="svelte-3esmwe"&&(pe.textContent=Ln),$n.forEach(Q),cn=S(re),Oe=v(re,"TD",{});var Vn=y(Oe);Ie=v(Vn,"BUTTON",{"data-svelte-h":!0}),Y(Ie)!=="svelte-sacog4"&&(Ie.textContent=wn),Vn.forEach(Q),re.forEach(Q),An=S(ie),ve=v(ie,"TR",{});var We=y(ve);Le=v(We,"TD",{});var zn=y(Le);he=v(zn,"BUTTON",{"data-svelte-h":!0}),Y(he)!=="svelte-1vr5zyk"&&(he.textContent=Pn),zn.forEach(Q),dn=S(We),we=v(We,"TD",{});var Zn=y(we);Ee=v(Zn,"BUTTON",{"data-svelte-h":!0}),Y(Ee)!=="svelte-1m2jkw7"&&(Ee.textContent=Sn),Zn.forEach(Q),We.forEach(Q),ie.forEach(Q),Se.forEach(Q),un=S(Qe),pn(J.$$.fragment,Qe),Qe.forEach(Q),this.h()},h(){x(t,"class","characterSide svelte-13uybsp"),x(n,"class","container svelte-13uybsp"),x(h,"class","commands svelte-13uybsp"),x(u,"class","container svelte-13uybsp"),x(u,"id","footer")},m(b,F){te(b,n,F),f(n,t),In(o,t,null),f(n,i),In(r,n,null),te(b,m,F),te(b,u,F),f(u,h),f(h,C),f(C,k),f(k,_),f(_,G),f(k,Ce),f(k,Ae),f(Ae,V),f(k,Be),f(k,z),f(z,Z),f(k,Re),f(k,de),f(de,j),f(C,l),f(C,A),f(A,d),f(d,p),f(A,E),f(A,T),f(A,L),f(A,ue),f(ue,oe),f(A,sn),f(A,De),f(De,fe),f(C,an),f(C,q),f(q,Te),f(Te,me),f(q,rn),f(q,be),f(be,ge),f(q,ln),f(q,He),f(He,pe),f(q,cn),f(q,Oe),f(Oe,Ie),f(C,An),f(C,ve),f(ve,Le),f(Le,he),f(ve,dn),f(ve,we),f(we,Ee),f(u,un),In(J,u,null),Fe=!0,mn||(Mn=[N(window,"keydown",yt(e[1])),N(G,"click",function(){W(R("UL",e[0]))&&R("UL",e[0]).apply(this,arguments)}),N(V,"click",function(){W(R("U",e[0]))&&R("U",e[0]).apply(this,arguments)}),N(Z,"click",function(){W(R("UR",e[0]))&&R("UR",e[0]).apply(this,arguments)}),N(j,"click",function(){W(yn(e[0]))&&yn(e[0]).apply(this,arguments)}),N(p,"click",function(){W(R("L",e[0]))&&R("L",e[0]).apply(this,arguments)}),N(oe,"click",function(){W(R("R",e[0]))&&R("R",e[0]).apply(this,arguments)}),N(fe,"click",function(){W(Ze(e[0]))&&Ze(e[0]).apply(this,arguments)}),N(me,"click",function(){W(R("DL",e[0]))&&R("DL",e[0]).apply(this,arguments)}),N(ge,"click",function(){W(R("D",e[0]))&&R("D",e[0]).apply(this,arguments)}),N(pe,"click",function(){W(R("DR",e[0]))&&R("DR",e[0]).apply(this,arguments)}),N(Ie,"click",function(){W(ze(e[0]))&&ze(e[0]).apply(this,arguments)}),N(he,"click",function(){W(rt(e[0]))&&rt(e[0]).apply(this,arguments)}),N(Ee,"click",e[3])],mn=!0)},p(b,[F]){e=b;const Pe={};F&1&&(Pe.state=e[0]),o.$set(Pe);const Qe={};!c&&F&1&&(c=!0,Qe.state=e[0],Jn(()=>c=!1)),r.$set(Qe);const Se={};!fn&&F&1&&(fn=!0,Se.state=e[0],Jn(()=>fn=!1)),J.$set(Se)},i(b){Fe||(vn(o.$$.fragment,b),vn(r.$$.fragment,b),vn(J.$$.fragment,b),Fe=!0)},o(b){hn(o.$$.fragment,b),hn(r.$$.fragment,b),hn(J.$$.fragment,b),Fe=!1},d(b){b&&(Q(n),Q(m),Q(u)),En(o),En(r),En(J),mn=!1,Et(Mn)}}}function Ro(e,n,t){let o=Wt();Je(()=>{setInterval(()=>io(o),1e3)});function i(u){switch(u.key){case"6":case"d":R("R",o);break;case"9":case"e":R("UR",o);break;case"8":case"w":R("U",o);break;case"7":case"q":R("UL",o);break;case"4":case"a":R("L",o);break;case"1":case"z":R("DL",o);break;case"2":case"x":R("D",o);break;case"3":case"c":R("DR",o);break;case"0":case" ":yn(o);break;case"-":case"r":ze(o);break;case"+":case"f":Ze(o);break}}function r(u){o=u,t(0,o)}const c=()=>t(0,o=Ft());function m(u){o=u,t(0,o)}return[o,i,r,c,m]}class bo extends en{constructor(n){super(),nn(this,n,Ro,Bo,Ne,{})}}export{bo as component};
