import{s as we,n as ce,o as Xe,b as Zt,f as jt,r as Qt,i as M}from"../chunks/scheduler.ba2ce6c0.js";import{S as Ve,i as Ze,g,h as m,j as L,f as y,k as G,a as fe,y as Jt,r as Ot,s as O,u as _t,c as _,z as S,x as u,v as It,A as N,d as Ht,t as Bt,w as St}from"../chunks/index.8040907f.js";var H=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(H||{}),B=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(B||{}),F=(e=>(e.APPRENTICE="Apprentice",e.KNIGHT="Knight",e.HERO="Hero",e.LORD="Lord",e.MASTER="Master",e))(F||{}),W=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(W||{}),ue=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.DOOR="Door",e.NOTE="Note",e))(ue||{}),b=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(b||{});const en="0",tn="#",nn=" ",on=(e,t,n,o)=>({type:e,name:t,position:{x:n,y:o},found:!1}),x=(e,t,n)=>({side:e,x:t,y:n,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),wt=(e,t,n)=>({...x(e,t,n),hidden:!0}),q=(e,t,n,o)=>{const s=Object.values(H).indexOf(t),r=Object.keys(H)[s];let d=F.LORD,f=2,h=2,p=4,k=4,R=4;switch(e){case B.ORCH:{d=F.APPRENTICE,h=0,p=2,k=2,R=1;break}case B.TROLL:{d=F.KNIGHT,h=1,p=3,k=3,R=2;break}}return e===B.YELLOW_DARK_LORD&&(f=3),{type:e,level:d,colour:t,actions:f,defense:h,health:p,maxHealth:k,experience:R,name:e+" ("+r+")",movement:3,position:{x:n,y:o}}},sn={name:"The Three Gates of Power",beaten:!1,winConditions:[{type:W.KILL_ALL,fulfilled:!1},{type:W.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:1,y:4},{x:0,y:3},{x:0,y:4},{x:0,y:5}],discoveredRooms:["A"],layout:{grid:["            EEEE","            EEEE","         DDDEEEE","AAA   CCCC","AAABBBCCCC   GGG","AAA   CCCCFFFGGG","      CCCC   GGG","      CCCC","      CCCCHHHIII","             III","             III"],doors:[x(b.RIGHT,2,4),x(b.RIGHT,5,4),x(b.RIGHT,9,5),x(b.RIGHT,12,5),x(b.RIGHT,9,8),x(b.RIGHT,12,8),x(b.RIGHT,11,2),wt(b.UP,9,3),wt(b.RIGHT,15,1)],monsters:[q(B.ORCH,H.Blue,9,7),q(B.ORCH,H.Red,12,8),q(B.TROLL,H.Red,15,1),q(B.TROLL,H.Yellow,13,6)],secrets:[{type:ue.EQUIPMENT,position:{x:9,y:4},found:!1,name:"Random Equipment"},{type:ue.EQUIPMENT,position:{x:12,y:0},found:!1,name:"Random Equipment"},{type:ue.MAGIC_ITEM,position:{x:15,y:5},found:!1,name:"Random Magic Item",item:{name:"Healing Herbs"}},{type:ue.EQUIPMENT,position:{x:15,y:9},found:!1,name:"Random Equipment"}],notes:[{message:"Beyond stone and fire you shall find the Dread tunnel, the road to the Ice Dragons treasure.",position:{x:2,y:4}},{message:"The Gate of Water. <There is an image of a sea dragon under the text>",position:{x:9,y:8}},{message:"The Gate of Air. <There is an image of a pegasus under the text>",position:{x:9,y:5}},{message:"The Gate of Fire. <There is an image of a hippogriph under the text>",position:{x:9,y:3}}]},killCount:0},Pt={name:"Troll cave",beaten:!1,winConditions:[{type:W.KILL_ALL,fulfilled:!1}],nextDungeon:sn,startingPositions:[{x:1,y:8},{x:0,y:7},{x:0,y:8},{x:0,y:9}],discoveredRooms:["A"],layout:{grid:["     CCCC","     CCCC","     CCCC","      E  ","      E  ","      E  ","      BB ","AAA   BB ","AAADDDBB ","AAA   BB "],doors:[x(b.RIGHT,2,8),x(b.RIGHT,5,8),x(b.UP,6,6),x(b.UP,6,3)],monsters:[q(B.ORCH,H.Green,5,8),q(B.ORCH,H.Yellow,7,9),q(B.ORCH,H.Red,6,4),q(B.ORCH,H.Red,8,2),q(B.TROLL,H.Green,5,0)],secrets:[on(ue.NOTE,"Welcome to Drakriddarna",1,8)],notes:[]},killCount:0},Nt=e=>{e.actionLog.push("Game saved."),localStorage.setItem("state",JSON.stringify(e))},an=()=>{const e=localStorage.getItem("state");if(e){const t=JSON.parse(e);return t.currentActor=t.heroes.find(n=>{var o;return n.name===((o=t.currentActor)==null?void 0:o.name)}),t.actionLog.push("Game loaded."),t}},rn=()=>{const e=Ft;return $t(e,Pt),{heroes:e,dungeon:Pt,currentActor:e[0],actionLog:["Game Initialised","Each character has 2 actions. Move, Attack, Search or Pick Lock.","Each character can move 3 steps per action.","If another action is performed before moving 3 steps, the move is finished and both actions are consumed.","The rules of this game are harsh and unfair."]}},Se=(e,t)=>({name:e,actions:2,movement:3,defense:0,level:F.APPRENTICE,health:7,maxHealth:7,colour:t,experience:0,position:{x:-1,y:-1}}),Ft=[Se("Fearik",H.Yellow),Se("Helbran",H.Red),Se("Siedel",H.Green),Se("Wulf",H.Blue)],$t=(e,t)=>{e.forEach((n,o)=>n.position=t.startingPositions[o])},Ce=e=>{let t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t},Wt=(e,t,n)=>e.dungeon.layout.monsters.some(o=>o.position.x===t&&o.position.y===n&&o.health>0),qt=(e,t,n)=>e.heroes.some(o=>o.position.x===t&&o.position.y===n),I=(e,t)=>{const n=t.currentActor;if(!n||n.actions===0)return;let o=n.position.x,s=n.position.y;switch(e){case"UL":o=n.position.x-1,s=n.position.y-1;break;case"U":s=n.position.y-1;break;case"UR":o=n.position.x+1,s=n.position.y-1;break;case"L":o=n.position.x-1;break;case"R":o=n.position.x+1;break;case"DL":o=n.position.x-1,s=n.position.y+1;break;case"D":s=n.position.y+1;break;case"DR":o=n.position.x+1,s=n.position.y+1;break}const r=qt(t,o,s),d=!je(t.dungeon.layout,o,s),f=Wt(t,o,s);if(!r&&!d){const h=Qe(t.dungeon,o,s);h?h&&(f?cn(n,t,o,s):zt(n,t,o,s,1)):un(t,n,o,s)&&ln(n,t,o,s)}else t.actionLog.push(`${n.name} could not make that move`);n.movement===0&&(n.actions--,n.movement=3)},zt=(e,t,n,o,s)=>{e.position.x=n,e.position.y=o;const r=t.dungeon.layout.notes.find(f=>Kt(f.position,e.position));r&&(t.dungeon.layout.doors.some(h=>h.hidden&&Kt(r.position,{x:h.x,y:h.y}))||t.actionLog.push(`${e.name} reads: ${r.message}`)),t.dungeon.layout.monsters.some(f=>Je(e.position,f.position.x,f.position.y))?(t.actionLog.push(`${e.name} walked by a monster and lost the momentum`),e.movement=0):e.movement-=s},ln=(e,t,n,o)=>{const s=Pe(t.dungeon.layout.grid,n,o);s&&t.dungeon.discoveredRooms.push(s),zt(e,t,e.position.x,e.position.y,1),t.actionLog.push(`${e.name} opened a door`)},cn=(e,t,n,o)=>{if(e.actions===1&&e.movement!==3){t.actionLog.push(`${e.name} has no actions left to attack`);return}const s=t.dungeon.layout.monsters.find(r=>r.position.x===n&&r.position.y===o);if(s){const r=De(e.level,3),d=Math.max(r-s.defense,0);t.actionLog.push(`${e.name} attacked ${s.name} for ${et(d,r,s)}`),s.health-=d,s.health<=0&&(t.dungeon.layout.monsters=t.dungeon.layout.monsters.filter(f=>f!=s),t.actionLog.push(`${e.name} killed ${s.name}`),t.dungeon.killCount++,e.experience+=s.experience),e.actions>1&&e.movement<3?e.actions-=2:e.actions--}},De=(e,t)=>{let n=[];for(let o=0;o<t;o++)n.push(Math.floor(Math.random()*6)+1);switch(e){case F.APPRENTICE:n=n.filter(o=>o===5);break;case F.KNIGHT:case F.HERO:n=n.filter(o=>o>=4);break;case F.LORD:case F.MASTER:n=n.filter(o=>o>=3);break}return n.length},Mt=e=>{const t=e.currentActor;if(!t)return;if(!Xt(t)){e.actionLog.push(`${t.name} has no actions left to pick lock`);return}const n=e.dungeon.layout.doors.find(o=>o.x===t.position.x&&o.y===t.position.y);n&&n.locked&&(De(t.level,1)>=1?(n.locked=!1,e.actionLog.push(`${t.name} managed to pick the lock`)):e.actionLog.push(`${t.name} failed to pick the lock`),t.actions>1&&t.movement<3?t.actions-=2:t.actions--,t.movement=3)},xt=e=>{const t=e.currentActor;if(!t)return;if(!Xt(t)){e.actionLog.push(`${t.name} has no actions left to search`);return}const n=De(t.level,1);if(n>=1){const o=e.dungeon.layout.doors.find(d=>d.hidden&&d.x===t.position.x&&d.y===t.position.y);o&&(e.actionLog.push(`${t.name} searched (${n}) and found a hidden door`),o.hidden=!1);const s=e.dungeon.layout.doors.find(d=>d.trapped&&d.x===t.position.x&&t.position.y);s&&!o&&(e.actionLog.push(`${t.name} searched (${n}) and found a trap in a door`),s.trapped=!1);const r=e.dungeon.layout.secrets.find(d=>Je(d.position,t.position.x,t.position.y));r&&!s&&!o&&e.actionLog.push(`${t.name} searched (${n}) and found ${r.name}`),!o&&!s&&!r&&e.actionLog.push(`${t.name} searched (${n}) but found nothing`)}else e.actionLog.push(`${t.name} searched (${n}) but found nothing`);t.actions>1&&t.movement<3?t.actions-=2:t.actions--,t.movement=3},Gt=e=>{if(dn(e),e.currentActor!==void 0){e.actionLog.push(`${e.currentActor.name} ended their turn`);let n=e.heroes.indexOf(e.currentActor)+1;n===e.heroes.length&&(hn(e),n=0),e.currentActor.actions=2,e.currentActor.movement=3,e.currentActor=e.heroes[n],e.actionLog.push(`${e.currentActor.name} started their turn`)}},dn=e=>{e.dungeon.winConditions.forEach(t=>{var n;switch(t.type){case W.KILL_ALL:{const o=e.dungeon.layout.monsters.map(s=>s.health).reduce((s,r)=>s+r,0);t.fulfilled=o<=0;break}case W.REACH_CELL:{t.fulfilled=e.heroes.some(o=>{var s;return o.position.x===((s=t.targetCell)==null?void 0:s.x)&&o.position.y===t.targetCell.y});break}case W.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(o=>o.type===t.targetMonsterType).some(o=>o.health>0);break}case W.OPEN_DOOR:{t.fulfilled=((n=e.dungeon.layout.doors.find(o=>{var s,r;return o.x===((s=t.targetCell)==null?void 0:s.x)&&o.y===((r=t.targetCell)==null?void 0:r.y)}))==null?void 0:n.open)??!1;break}case W.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,n)=>t&&n,!0),e.dungeon.beaten&&(e.actionLog.push("All win conditions have been fulfilled"),e.actionLog.push(`You have cleared ${e.dungeon.name}`))},un=(e,t,n,o)=>{const s=e.dungeon.layout.doors.find(r=>r.x===t.position.x&&r.y===t.position.y);if(s&&!s.locked){const r=fn(t.position.x,t.position.y,n,o);if(s.side===r){if(s.open=!0,s.trapped){const d=De(F.APPRENTICE,s.trapAttacks),f=Math.max(d-t.defense,0);e.actionLog.push(`Door was trapped. ${t.name} took ${et(f,d,t)}`),t.health-=f}return!0}}return s&&s.locked&&e.actionLog.push("Door is locked"),!1},fn=(e,t,n,o)=>{if(e===n){if(t>o)return b.UP;if(t<o)return b.DOWN}if(t===o){if(e>n)return b.LEFT;if(e<n)return b.RIGHT}},je=(e,t,n)=>{let o=!0;if(t<0||t>=e.grid[0].length||n<0||n>=e.grid.length)o=!1;else{const s=Pe(e.grid,t,n);(s===en||s===tn||s===nn)&&(o=!1)}return o},Qe=(e,t,n)=>{const o=Pe(e.layout.grid,t,n);return o?e.discoveredRooms.includes(o):!1},Pe=(e,t,n)=>{let o;return e.forEach((s,r)=>{Ce(s).forEach((d,f)=>{r===n&&f===t&&(o=d)})}),o},Je=(e,t,n)=>e.x===t&&e.y===n||e.x===t-1&&e.y===n||e.x===t-1&&e.y===n-1||e.x===t&&e.y===n-1||e.x===t+1&&e.y===n-1||e.x===t+1&&e.y===n||e.x===t+1&&e.y===n+1||e.x===t&&e.y===n+1||e.x===t-1&&e.y===n+1,hn=e=>{const t=e.dungeon.layout.monsters.filter(n=>{const o=Pe(e.dungeon.layout.grid,n.position.x,n.position.y);return o&&e.dungeon.discoveredRooms.includes(o)&&n.health>0});t.length===0&&e.actionLog.push("No monsters can act"),t.forEach(n=>{const o=n.actions;for(;n.actions>0;){e.actionLog.push(`${n.name} acted `);const s=e.heroes.filter(r=>Je(n.position,r.position.x,r.position.y));if(s.length>0){const r=Math.floor(Math.random()*s.length);pn(e,n,s[r])}else gn(e,n)}n.actions=o})};function Ut(e,t){return Math.sqrt(Math.pow(e.x-(t==null?void 0:t.x),2)+Math.pow(e.y-(t==null?void 0:t.y),2))}const gn=(e,t)=>{const n=e.heroes.map(s=>({hero:s,dist:Ut(s.position,t.position)})).sort((s,r)=>s.dist-r.dist)[0],o=mn(e,t.position);if(o.length>0){const s=o.map(r=>({pos:r,dist:Ut(r,n.hero.position)})).sort((r,d)=>r.dist-d.dist)[0].pos;t.position=s,e.actionLog.push(`${t.name} moved towards ${n.hero.name} (${s.x},${s.y})`)}else e.actionLog.push(`${t.name} could not move`);t.actions--};let mn=(e,t)=>{const n=t.x,o=t.y,s=[];for(let r=n-1;r<=n+1;r++)for(let d=o-1;d<=o+1;d++)r===n&&d===o||je(e.dungeon.layout,r,d)&&Qe(e.dungeon,r,d)&&s.push({x:r,y:d});return s.filter(r=>!e.heroes.find(d=>d.position.x===r.x&&d.position.y===r.y)).filter(r=>!e.dungeon.layout.monsters.find(f=>f.position.x===r.x&&f.position.y===r.y))};const et=(e,t,n)=>`${e} damage (${t}-${n.defense}=${e})`,pn=(e,t,n)=>{if(t.actions===1&&t.movement!==3){e.actionLog.push(`${n.name} has no actions left to attack`);return}if(n){const o=De(t.level,3),s=Math.max(o-n.defense,0);e.actionLog.push(`${t.name} attacked ${n.name} for ${et(s,o,n)}`),n.health-=s,n.health<=0&&(e.actionLog.push(`${t.name} killed ${n.name}`),e.heroes=e.heroes.filter(r=>r!==n)),(t==null?void 0:t.actions)>1&&(t==null?void 0:t.movement)<3?t.actions-=2:t.actions--}},Xt=e=>e.movement<3?e.actions>1:e.actions>0,Kt=(e,t)=>e.x===t.x&&e.y===t.y,vn=""+new URL("../assets/Dungeon_Tileset.b0da342a.png",import.meta.url).href,An="data:image/png;base64,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";function yn(e){let t;return{c(){t=g("canvas"),this.h()},l(n){t=m(n,"CANVAS",{width:!0,height:!0,id:!0}),L(t).forEach(y),this.h()},h(){G(t,"width","860"),G(t,"height","750"),G(t,"id","gameBoard")},m(n,o){fe(n,t,o)},p:ce,i:ce,o:ce,d(n){n&&y(t)}}}const i=48;function En(e,t,n){let{state:o}=t,{debugMode:s=!0}=t;Xe(()=>{const a=new Image;a.src=vn;const A=new Image;A.src=An,r(a,A),setInterval(()=>r(a,A),10)});const r=(a,A)=>{if(!o||!document)return;const l=document.getElementById("gameBoard"),c=l.getContext("2d");c.clearRect(0,0,l.width,l.height),o.dungeon.layout.grid.forEach((v,T)=>{Ce(v).forEach((E,D)=>d(c,E,D,T,a))}),o.dungeon.layout.grid.forEach((v,T)=>{Ce(v).forEach((E,D)=>f(c,E,D,T))}),o.dungeon.layout.grid.forEach((v,T)=>{Ce(v).forEach((E,D)=>h(c,E,D,T))}),o.dungeon.layout.grid.forEach((v,T)=>{Ce(v).forEach((E,D)=>j(c,E,D,T,A))})},d=(a,A,l,c,v)=>{U(A)?(a.beginPath(),a.strokeStyle="black",a.fillStyle="black",a.fillRect(l*i,c*i,i,i),a.stroke()):a.drawImage(v,0,7*16,16,16,l*i,c*i,i,i)},f=(a,A,l,c)=>{a.beginPath(),a.strokeStyle="black",a.rect(l*i,c*i,i,i),s&&(a.font="7px Arial",a.fillText(l+","+c,l*i+3,c*i+(i-3))),a.stroke()},h=(a,A,l,c)=>{const v=Oe(l,c);if(v&&!v.hidden&&!v.open&&!U(A))switch(a.fillStyle="brown",v.side){case b.RIGHT:{a.fillRect(l*i+(i-2),c*i,4,i),v.locked&&s&&(a.fillStyle="grey",a.fillRect(l*i+(i-4),c*i+(i/2-4),8,8)),v.trapped&&s&&(a.fillStyle="red",a.fillRect(l*i+(i-4),c*i+(i/2-4),4,4));break}case b.LEFT:{a.fillRect(l*i-2,c*i,4,i),v.locked&&s&&(a.fillStyle="grey",a.fillRect(l*i-4,c*i+(i/2-4),8,8)),v.trapped&&s&&(a.fillStyle="red",a.fillRect(l*i-4,c*i+(i/2-4),4,4));break}case b.UP:{a.fillRect(l*i,c*i-2,i,4),v.locked&&s&&(a.fillStyle="grey",a.fillRect(l*i+(i/2-4),c*i-4,8,8)),v.trapped&&s&&(a.fillStyle="red",a.fillRect(l*i+(i/2-4),c*i-4,4,4));break}case b.DOWN:{a.fillRect(l*i,c*i+(i-2),i,4),v.locked&&s&&(a.fillStyle="grey",a.fillRect(l*i+(i/2-4),c*i+(i-4),8,8)),v.trapped&&s&&(a.fillStyle="red",a.fillRect(l*i+(i/2-4),c*i+(i-4),4,4));break}}},p=(a,A,l,c)=>{a.beginPath(),a.strokeStyle=A.colour,a.fillStyle=A.colour,a.fillRect(l*i+4,c*i+(i-6),i-8,4),a.stroke()},k=(a,A,l,c)=>{s&&l.forEach(v=>{const T=A.position.x,E=A.position.y,D=v.position.x,he=v.position.y;a.strokeStyle=A.colour,a.beginPath(),a.moveTo(T*i+i/2,E*i+i/2),a.lineTo(D*i+i/2,he*i+i/2),a.stroke()})},R=(a,A,l,c)=>{a.beginPath(),a.strokeStyle="black",a.fillStyle="red",a.fillRect(l*i+4,c*i,i-8,4),a.fillStyle="green",a.fillRect(l*i+4,c*i,(i-8)*(A.health/A.maxHealth),4),a.rect(l*i+4,c*i,i-8,4),a.stroke()},w=(a,A)=>{if(a===o.currentActor&&s){for(let l=a.position.x-a.movement;l<=a.position.x+a.movement;l++)for(let c=a.position.y-a.movement;c<=a.position.y+a.movement;c++)if(Qe(o.dungeon,l,c)){const T=Wt(o,l,c),E=qt(o,l,c),D=je(o.dungeon.layout,l,c);!E&&!T&&D&&(A.fillStyle="rgba(50, 50, 255, 0.08)",A.fillRect(l*i,c*i,i,i),A.stroke())}}},j=(a,A,l,c,v)=>{a.beginPath();const T=o.heroes.find(E=>E.position.x===l&&E.position.y===c);if(T)w(T,a),a.drawImage(v,4*16,0,16,16,l*i,c*i,i,i),p(a,T,l,c),R(a,T,l,c);else{const E=o.dungeon.layout.monsters.find(D=>D.position.x===l&&D.position.y===c);if(E&&E.health>0&&!U(A)){switch(E.type){case B.ORCH:a.drawImage(v,i,16,16,16,l*i,c*i,i,i);break;case B.TROLL:a.drawImage(v,i,16,16,16,l*i,c*i,i,i);break;default:a.drawImage(v,16,16,16,16,l*i,c*i,i,i);break}p(a,E,l,c),R(a,E,l,c),k(a,E,o.heroes)}}},U=a=>a===" "||!o.dungeon.discoveredRooms.includes(a),Oe=(a,A)=>o.dungeon.layout.doors.find(l=>l.x===a&&l.y===A);return e.$$set=a=>{"state"in a&&n(0,o=a.state),"debugMode"in a&&n(1,s=a.debugMode)},[o,s]}class Ln extends Ve{constructor(t){super(),Ze(this,t,En,yn,we,{state:0,debugMode:1})}}function kn(e){let t;return{c(){t=g("canvas"),this.h()},l(n){t=m(n,"CANVAS",{id:!0,height:!0,width:!0}),L(t).forEach(y),this.h()},h(){G(t,"id","characterBoard"),G(t,"height","750"),G(t,"width","260")},m(n,o){fe(n,t,o)},p:ce,i:ce,o:ce,d(n){n&&y(t)}}}const de=180;function Rn(e,t,n){let{state:o}=t;Xe(()=>{s(),setInterval(s,100)});const s=()=>{if(!o||!document)return;const f=document.getElementById("characterBoard"),h=f.getContext("2d");h.clearRect(0,0,f.width,f.height),h.stroke(),o.heroes.forEach((p,k)=>r(h,f,p,k)),o.heroes.forEach((p,k)=>d(h,p,k))},r=(f,h,p,k)=>{f.fillStyle=p.colour,f.fillRect(12,k*de+12,h.width,de-12),f.stroke(),f.fillStyle="black"},d=(f,h,p)=>{const R=(h===o.currentActor?"> "+h.name:h.name)+" - "+h.level+" ("+h.experience+")";f.strokeStyle="black",f.font="18px Arial",f.fillText(R,16,p*de+30),f.fillText("HP: "+h.health,16,p*de+50),f.fillText("Actions: "+h.actions,16,p*de+70),f.fillText("Moves: "+h.movement,16,p*de+90),f.stroke()};return e.$$set=f=>{"state"in f&&n(0,o=f.state)},[o]}class Tn extends Ve{constructor(t){super(),Ze(this,t,Rn,kn,we,{state:0})}}function Yt(e){let t,n='<canvas width="860" height="100" id="logs"></canvas>';return{c(){t=g("div"),t.innerHTML=n,this.h()},l(o){t=m(o,"DIV",{class:!0,"data-svelte-h":!0}),S(t)!=="svelte-xcon9n"&&(t.innerHTML=n),this.h()},h(){G(t,"class","log svelte-60nygp")},m(o,s){fe(o,t,s)},p:ce,d(o){o&&y(t)}}}function bn(e){let t,n,o,s,r,d,f,h,p,k,R,w,j,U,Oe="UL",a,A,l,c="U",v,T,E,D="UR",he,ge,Q,tt="Next",Ne,K,me,J,nt="L",Me,_e,xe,pe,ee,ot="R",Ge,ve,te,st="Search",Ue,Y,Ae,ne,it="DL",Ke,ye,oe,at="D",Ye,Ee,se,rt="DR",Fe,Le,ie,lt="Pick lock",$e,ae,ke,re,ct="Save",We,Re,le,dt="Load",qe,ut=e[0].actionLog,Ie,ze,ft;o=new Tn({props:{state:e[0]}});function Vt(C){e[1](C)}let ht={};e[0]!==void 0&&(ht.state=e[0]),d=new Ln({props:ht}),Zt.push(()=>Jt(d,"state",Vt));let $=Yt();return{c(){t=g("div"),n=g("div"),Ot(o.$$.fragment),s=O(),r=g("div"),Ot(d.$$.fragment),h=O(),p=g("div"),k=g("div"),R=g("table"),w=g("tr"),j=g("td"),U=g("button"),U.textContent=Oe,a=O(),A=g("td"),l=g("button"),l.textContent=c,v=O(),T=g("td"),E=g("button"),E.textContent=D,he=O(),ge=g("td"),Q=g("button"),Q.textContent=tt,Ne=O(),K=g("tr"),me=g("td"),J=g("button"),J.textContent=nt,Me=O(),_e=g("td"),xe=O(),pe=g("td"),ee=g("button"),ee.textContent=ot,Ge=O(),ve=g("td"),te=g("button"),te.textContent=st,Ue=O(),Y=g("tr"),Ae=g("td"),ne=g("button"),ne.textContent=it,Ke=O(),ye=g("td"),oe=g("button"),oe.textContent=at,Ye=O(),Ee=g("td"),se=g("button"),se.textContent=rt,Fe=O(),Le=g("td"),ie=g("button"),ie.textContent=lt,$e=O(),ae=g("tr"),ke=g("td"),re=g("button"),re.textContent=ct,We=O(),Re=g("td"),le=g("button"),le.textContent=dt,qe=O(),$.c(),this.h()},l(C){t=m(C,"DIV",{class:!0});var P=L(t);n=m(P,"DIV",{class:!0});var Te=L(n);_t(o.$$.fragment,Te),Te.forEach(y),s=_(P),r=m(P,"DIV",{class:!0});var be=L(r);_t(d.$$.fragment,be),be.forEach(y),P.forEach(y),h=_(C),p=m(C,"DIV",{class:!0});var He=L(p);k=m(He,"DIV",{class:!0});var gt=L(k);R=m(gt,"TABLE",{});var z=L(R);w=m(z,"TR",{});var X=L(w);j=m(X,"TD",{});var mt=L(j);U=m(mt,"BUTTON",{"data-svelte-h":!0}),S(U)!=="svelte-fw3uxo"&&(U.textContent=Oe),mt.forEach(y),a=_(X),A=m(X,"TD",{});var pt=L(A);l=m(pt,"BUTTON",{"data-svelte-h":!0}),S(l)!=="svelte-1jeoia6"&&(l.textContent=c),pt.forEach(y),v=_(X),T=m(X,"TD",{});var vt=L(T);E=m(vt,"BUTTON",{"data-svelte-h":!0}),S(E)!=="svelte-1p8c8vc"&&(E.textContent=D),vt.forEach(y),he=_(X),ge=m(X,"TD",{});var At=L(ge);Q=m(At,"BUTTON",{"data-svelte-h":!0}),S(Q)!=="svelte-1rtxc14"&&(Q.textContent=tt),At.forEach(y),X.forEach(y),Ne=_(z),K=m(z,"TR",{});var V=L(K);me=m(V,"TD",{});var yt=L(me);J=m(yt,"BUTTON",{"data-svelte-h":!0}),S(J)!=="svelte-10dnpu6"&&(J.textContent=nt),yt.forEach(y),Me=_(V),_e=m(V,"TD",{}),L(_e).forEach(y),xe=_(V),pe=m(V,"TD",{});var Et=L(pe);ee=m(Et,"BUTTON",{"data-svelte-h":!0}),S(ee)!=="svelte-12287ni"&&(ee.textContent=ot),Et.forEach(y),Ge=_(V),ve=m(V,"TD",{});var Lt=L(ve);te=m(Lt,"BUTTON",{"data-svelte-h":!0}),S(te)!=="svelte-cps1bu"&&(te.textContent=st),Lt.forEach(y),V.forEach(y),Ue=_(z),Y=m(z,"TR",{});var Z=L(Y);Ae=m(Z,"TD",{});var kt=L(Ae);ne=m(kt,"BUTTON",{"data-svelte-h":!0}),S(ne)!=="svelte-1ji074i"&&(ne.textContent=it),kt.forEach(y),Ke=_(Z),ye=m(Z,"TD",{});var Rt=L(ye);oe=m(Rt,"BUTTON",{"data-svelte-h":!0}),S(oe)!=="svelte-li5tq6"&&(oe.textContent=at),Rt.forEach(y),Ye=_(Z),Ee=m(Z,"TD",{});var Tt=L(Ee);se=m(Tt,"BUTTON",{"data-svelte-h":!0}),S(se)!=="svelte-3esmwe"&&(se.textContent=rt),Tt.forEach(y),Fe=_(Z),Le=m(Z,"TD",{});var bt=L(Le);ie=m(bt,"BUTTON",{"data-svelte-h":!0}),S(ie)!=="svelte-sacog4"&&(ie.textContent=lt),bt.forEach(y),Z.forEach(y),$e=_(z),ae=m(z,"TR",{});var Be=L(ae);ke=m(Be,"TD",{});var Ct=L(ke);re=m(Ct,"BUTTON",{"data-svelte-h":!0}),S(re)!=="svelte-1vr5zyk"&&(re.textContent=ct),Ct.forEach(y),We=_(Be),Re=m(Be,"TD",{});var Dt=L(Re);le=m(Dt,"BUTTON",{"data-svelte-h":!0}),S(le)!=="svelte-1m2jkw7"&&(le.textContent=dt),Dt.forEach(y),Be.forEach(y),z.forEach(y),gt.forEach(y),qe=_(He),$.l(He),He.forEach(y),this.h()},h(){G(n,"class","characterSide svelte-60nygp"),G(r,"class","boardSide svelte-60nygp"),G(t,"class","container svelte-60nygp"),G(k,"class","commands svelte-60nygp"),G(p,"class","container svelte-60nygp")},m(C,P){fe(C,t,P),u(t,n),It(o,n,null),u(t,s),u(t,r),It(d,r,null),fe(C,h,P),fe(C,p,P),u(p,k),u(k,R),u(R,w),u(w,j),u(j,U),u(w,a),u(w,A),u(A,l),u(w,v),u(w,T),u(T,E),u(w,he),u(w,ge),u(ge,Q),u(R,Ne),u(R,K),u(K,me),u(me,J),u(K,Me),u(K,_e),u(K,xe),u(K,pe),u(pe,ee),u(K,Ge),u(K,ve),u(ve,te),u(R,Ue),u(R,Y),u(Y,Ae),u(Ae,ne),u(Y,Ke),u(Y,ye),u(ye,oe),u(Y,Ye),u(Y,Ee),u(Ee,se),u(Y,Fe),u(Y,Le),u(Le,ie),u(R,$e),u(R,ae),u(ae,ke),u(ke,re),u(ae,We),u(ae,Re),u(Re,le),u(p,qe),$.m(p,null),Ie=!0,ze||(ft=[N(U,"click",function(){M(I("UL",e[0]))&&I("UL",e[0]).apply(this,arguments)}),N(l,"click",function(){M(I("U",e[0]))&&I("U",e[0]).apply(this,arguments)}),N(E,"click",function(){M(I("UR",e[0]))&&I("UR",e[0]).apply(this,arguments)}),N(Q,"click",function(){M(Gt(e[0]))&&Gt(e[0]).apply(this,arguments)}),N(J,"click",function(){M(I("L",e[0]))&&I("L",e[0]).apply(this,arguments)}),N(ee,"click",function(){M(I("R",e[0]))&&I("R",e[0]).apply(this,arguments)}),N(te,"click",function(){M(xt(e[0]))&&xt(e[0]).apply(this,arguments)}),N(ne,"click",function(){M(I("DL",e[0]))&&I("DL",e[0]).apply(this,arguments)}),N(oe,"click",function(){M(I("D",e[0]))&&I("D",e[0]).apply(this,arguments)}),N(se,"click",function(){M(I("DR",e[0]))&&I("DR",e[0]).apply(this,arguments)}),N(ie,"click",function(){M(Mt(e[0]))&&Mt(e[0]).apply(this,arguments)}),N(re,"click",function(){M(Nt(e[0]))&&Nt(e[0]).apply(this,arguments)}),N(le,"click",e[2])],ze=!0)},p(C,[P]){e=C;const Te={};P&1&&(Te.state=e[0]),o.$set(Te);const be={};!f&&P&1&&(f=!0,be.state=e[0],jt(()=>f=!1)),d.$set(be),P&1&&we(ut,ut=e[0].actionLog)?($.d(1),$=Yt(),$.c(),$.m(p,null)):$.p(e,P)},i(C){Ie||(Ht(o.$$.fragment,C),Ht(d.$$.fragment,C),Ie=!0)},o(C){Bt(o.$$.fragment,C),Bt(d.$$.fragment,C),Ie=!1},d(C){C&&(y(t),y(h),y(p)),St(o),St(d),$.d(C),ze=!1,Qt(ft)}}}function Cn(e,t,n){let o=rn();Xe(()=>{r(),setInterval(r,500),setInterval(s,1e3)});const s=()=>{if(o.dungeon.beaten&&o.dungeon.nextDungeon){n(0,o.dungeon=o.dungeon.nextDungeon,o);const h=Ft.filter(p=>!o.heroes.find(k=>p.name===k.name));o.heroes.push(...h),$t(o.heroes,o.dungeon),n(0,o.actionLog=[],o),o.actionLog.push("You have reached "+o.dungeon.name)}},r=()=>{if(!o||!document)return;const h=document.getElementById("logs"),p=h.getContext("2d");p.clearRect(0,0,h.width,h.height),o.actionLog.slice(-10).reverse().forEach((k,R)=>{p.font="12px Arial",p.fillStyle="black",p.fillText("> "+k,2,(R+1)*12+2),p.stroke()})};function d(h){o=h,n(0,o)}return[o,d,()=>n(0,o=an())]}class _n extends Ve{constructor(t){super(),Ze(this,t,Cn,bn,we,{})}}export{_n as component};
