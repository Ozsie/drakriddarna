import{s as _e,n as Le,e as Ze,o as rn,f as _n,r as wn,b as ge,h as pe,i as tt}from"../chunks/scheduler.8ae2156d.js";import{S as He,i as Ne,e as de,a as O,f,g as L,m as M,h as w,j as H,n as R,k as C,x as g,o as S,s as ee,c as ne,y as Oe,d as Q,p as Ke,t as z,b as Fe,z as ln,A as he,r as Me,u as Re,v as Ce,w as Te,B as ko,l as tn,C as st}from"../chunks/index.9c43906b.js";import{t as Je,a as it,s as Cn}from"../chunks/index.bb9579da.js";function we(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var Y=(e=>(e.Red="#CD5C5C",e.Blue="#1E90FF",e.Green="#90EE90",e.Yellow="#FCFF4F",e))(Y||{}),K=(e=>(e.ORCH="Orch",e.TROLL="Troll",e.GREEN_DARK_LORD="Green Dark Lord",e.BLUE_DARK_LORD="Blue Dark Lord",e.RED_DARK_LORD="Red Dark Lord",e.YELLOW_DARK_LORD="Yellow Dark Lord",e))(K||{}),fe=(e=>(e.APPRENTICE="apprentice",e.KNIGHT="knight",e.HERO="hero",e.LORD="lord",e.MASTER="master",e))(fe||{}),ie=(e=>(e[e.KILL_ALL=0]="KILL_ALL",e[e.KILL_ALL_OF_TYPE=1]="KILL_ALL_OF_TYPE",e[e.REACH_CELL=2]="REACH_CELL",e[e.OPEN_DOOR=3]="OPEN_DOOR",e[e.KILL_AT_LEAST=4]="KILL_AT_LEAST",e))(ie||{}),se=(e=>(e.EQUIPMENT="Equipment",e.MAGIC_ITEM="Magic Item",e.TRAP_DOOR="Trap Door",e.NOTE="Note",e))(se||{}),I=(e=>(e.LEFT="Left",e.RIGHT="Right",e.UP="Up",e.DOWN="Down",e))(I||{}),X=(e=>(e[e.WEAPON=0]="WEAPON",e[e.ARMOUR=1]="ARMOUR",e[e.SHIELD=2]="SHIELD",e[e.MAGIC=3]="MAGIC",e))(X||{});const vn=[{name:"items.weapons.sword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:0,type:X.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.twoHandedSword",range:1,dice:4,twoHanded:!0,useHearHeroes:!1,amountInDeck:1,type:X.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.halberd",range:2,dice:3,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:X.WEAPON,value:2,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.flail",range:1,dice:4,twoHanded:!1,useHearHeroes:!0,amountInDeck:1,type:X.WEAPON,value:4,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.doubleHeadedAxe",range:1,dice:4,twoHanded:!0,useHearHeroes:!0,amountInDeck:1,type:X.WEAPON,value:3,ignoresShield:!1,ignoresArmour:!1}],Dn=[{name:"items.weapons.orchSword",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:X.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1},{name:"items.weapons.orchBow",range:999,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:X.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},{name:"items.weapons.trollClub",range:1,dice:3,twoHanded:!1,useHearHeroes:!0,amountInDeck:4,type:X.WEAPON,value:0,ignoresShield:!1,ignoresArmour:!1}],rt=[{name:"items.armour.chainMail",type:X.ARMOUR,amountInDeck:2,defense:1,magicProtection:!1,movementReduction:0,value:2},{name:"items.armour.plateMail",type:X.ARMOUR,amountInDeck:1,defense:2,magicProtection:!1,movementReduction:1,value:3},{name:"items.armour.dragonSkinMail",type:X.ARMOUR,amountInDeck:1,defense:2,magicProtection:!0,movementReduction:0,value:4}],Kn=[{name:"items.armour.orchMail",defense:0,magicProtection:!1,amountInDeck:4,type:X.ARMOUR,movementReduction:0,value:0},{name:"items.armour.trollSkin",defense:1,magicProtection:!1,amountInDeck:4,type:X.ARMOUR,movementReduction:0,value:0}],an=" ",en="?",cn="#",Ee=(e,n,o,t)=>({type:e,name:n,position:{x:o,y:t},found:!1}),sn=(e,n,o,t)=>({type:e,name:t.name,position:{x:n,y:o},found:!1,item:t}),J=(e,n,o)=>({side:e,x:n,y:o,locked:!1,trapped:!1,open:!1,hidden:!1,trapAttacks:0}),lt=(e,n,o,t)=>({...J(e,n,o),trapped:!0,trapAttacks:t}),qe=(e,n,o)=>({...J(e,n,o),hidden:!0}),yn=(e,n,o)=>({...J(e,n,o),locked:!0}),pn=(e,n,o,t)=>({...J(e,n,o),locked:!0,trapped:!0,trapAttacks:t}),at=(e,n,o,t)=>({...J(e,n,o),hidden:!0,trapped:!0,trapAttacks:t}),ct=(e,n,o,t,s)=>{const i=te(e,n,o,t);return i.inventory=s,i},te=(e,n,o,t)=>{const s=Object.values(Y).indexOf(n),i=Object.keys(Y)[s];let r=fe.LORD,l=2,a=2,c=4,u=4,d=4,b=Dn[0],p,E=Kn[0];switch(e){case K.ORCH:{r=fe.APPRENTICE,a=0,c=2,u=2,d=1,p=Dn[1];break}case K.TROLL:{r=fe.KNIGHT,a=1,c=3,u=3,d=2,b=Dn[2],E=Kn[1];break}}return e===K.YELLOW_DARK_LORD&&(l=3),{type:e,level:r,colour:n,actions:l,defense:a,health:c,maxHealth:u,experience:d,name:e+" ("+i+")",movement:3,maxMovement:3,position:{x:o,y:t},weapon:b,armour:E,incapacitated:!1,inventory:[],rangedWeapon:p}},ut=e=>{const n=e.currentActor;if(n.blinded){h(e,"logs.heroAction.blinded",{hero:m(n.name)});return}const o=n.inventory.filter(a=>{var c;return(c=a.properties)==null?void 0:c[Wn]}).map(a=>{var c;return h(e,"logs.heroAction.searchBonus",{hero:m(n.name),item:m(a.name)}),(c=a.properties)==null?void 0:c[Wn]}).reduce((a,c)=>a+c,0),t=ze(n.level,1+o);let s,i,r,l;t>=1?(s=bt(e,n,t),s||(i=ht(e,n,t)),!s&&!i&&(r=_t(e,n,t)),!s&&!i&&!r&&(l=vt(e,n,t)),!s&&!i&&!r&&!l&&h(e,"logs.heroAction.searchFoundNothing",{hero:m(n.name)})):h(e,"logs.heroAction.searchFoundNothing",{hero:m(n.name)})},Eo=e=>{const n=e.currentActor;if(!n)return!1;const o=e.dungeon.layout.secrets.filter(t=>t.type===se.TRAP_DOOR).filter(t=>!t.found).find(t=>ke(t.position,n.position));return o?(Xe(e,ft(o),n,!1),h(e,"logs.heroAction.pitfall",{hero:m(n.name)}),n.movement=0,n.actions=0,n.incapacitated=!0,o.found=!0,!0):!1},Io=(e,n)=>{const o=e.itemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.itemDeck.splice(o,1)},Do=(e,n)=>{const o=e.magicItemDeck.findIndex(t=>t.type===n.type&&t.name===n.name);e.magicItemDeck.splice(o,1)},ft=e=>({health:0,position:e.position,defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:Y.Red,maxHealth:0,name:"Trap Door",level:fe.APPRENTICE,incapacitated:!1,weapon:{name:"Falling",amountInDeck:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,type:X.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!0},inventory:[]}),dt=(e,n)=>e.dungeon.layout.doors.filter(o=>o.hidden).find(o=>gn({x:o.x,y:o.y},n.x,n.y)),mt=(e,n)=>e.dungeon.layout.doors.filter(o=>o.trapped).find(o=>o.x===n.x&&o.y===n.y),gt=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).find(o=>gn(o.position,n.x,n.y)),pt=(e,n)=>e.dungeon.layout.secrets.filter(o=>!o.found).filter(o=>o.type===se.TRAP_DOOR).find(o=>gn(o.position,n.x,n.y)),ht=(e,n,o)=>{const t=dt(e,n.position);return t?(t.hidden=!1,h(e,"logs.heroAction.foundDoor",{hero:m(n.name),result:`${o}`}),!0):!1},_t=(e,n,o)=>{const t=mt(e,n.position);return t?(h(e,"logs.heroAction.foundTrapInDoor",{hero:m(n.name),result:`${o}`}),t.trapped=!1,!0):!1},vt=(e,n,o)=>{const t=gt(e,n.position);if(t){switch(h(e,"logs.heroAction.foundSecret",{hero:m(n.name),result:`${o}`,secret:t.name}),t.found=!0,t.type){case se.EQUIPMENT:{const s=t.item??yt(e);s.amountInDeck>0&&(Io(e,s),h(e,"logs.heroAction.equipped",{hero:m(n.name),item:m(s.name)}),Ho(e,s,n));break}case se.MAGIC_ITEM:{const s=t.item??At(e);s.amountInDeck>0&&(Do(e,s),h(e,"logs.heroAction.found",{hero:m(n.name),item:m(s.name)}),n.inventory.push(s),s.pickup&&Pn[s.pickup](e,s,n));break}}return!0}return!1},yt=e=>{const n=e.itemDeck.length,o=Math.floor(Math.random()*n);return e.itemDeck[o]},At=e=>{const n=e.magicItemDeck.length,o=Math.floor(Math.random()*n);return e.magicItemDeck[o]},bt=(e,n,o)=>{const t=pt(e,n.position);return t?(h(e,"logs.heroAction.foundSecret",{hero:m(n.name),result:`${o}`,secret:m(t.name)}),t.found=!0,!0):!1},hn=(e,n)=>(vn[0].amountInDeck--,{name:e,actions:2,movement:3,maxMovement:3,defense:0,level:fe.APPRENTICE,health:7,maxHealth:7,colour:n,experience:0,position:{x:-1,y:-1},weapon:vn[0],incapacitated:!1,inventory:[],isInventoryOpen:!1}),Ye=(e,n)=>{ce(n);const o=n.currentActor;if(!o||o.actions===0)return;const t={x:o.position.x,y:o.position.y};switch(e){case"UL":t.x=o.position.x-1,t.y=o.position.y-1;break;case"U":t.y=o.position.y-1;break;case"UR":t.x=o.position.x+1,t.y=o.position.y-1;break;case"L":t.x=o.position.x-1;break;case"R":t.x=o.position.x+1;break;case"DL":t.x=o.position.x-1,t.y=o.position.y+1;break;case"D":t.y=o.position.y+1;break;case"DR":t.x=o.position.x+1,t.y=o.position.y+1;break}const s=fn(n,t.x,t.y),i=!En(n.dungeon.layout,t.x,t.y),r=un(n,t.x,t.y);if(!s&&!i){const l=mn(n.dungeon,t.x,t.y);l?l&&(r?Mo(o,n,t):No(o,n,t.x,t.y,1)):Dt(n,o,t.x,t.y)&&nn(o,n,t.x,t.y)}else h(n,"logs.heroAction.illegalMove",{hero:m(o.name)});Eo(n)||Nn(o)},Oo=e=>{ce(e);const n=e.currentActor;if(!n)return;if(n.blinded){h(e,"logs.heroAction.blinded",{hero:m(n.name)});return}if(!$e(n)){h(e,"logs.heroAction.noActions",{hero:m(n.name)});return}const o=e.dungeon.layout.doors.find(t=>t.x===n.position.x&&t.y===n.position.y);o&&o.locked&&(ze(n.level,1)>=1?(o.locked=!1,h(e,"logs.heroAction.pickedLock",{hero:m(n.name)})):h(e,"logs.heroAction.failedToPickLock",{hero:m(n.name)}),n.actions>1&&n.movement<3?n.actions-=2:n.actions--,n.movement=Ue(n),n.actions==0&&(n.movement=0))},Hn=e=>{ce(e),e.heroes.forEach((n,o)=>{n.position=e.dungeon.startingPositions[o],n.movement=Ue(n),n.actions=2,n.health=n.maxHealth})},q=e=>e.heroes.filter(n=>n.health>0).map(n=>n),kt=e=>{ce(e);const n=e.currentActor;n&&(n.actions--,n.movement=Ue(n),n.actions===0&&Ln(e))},$e=e=>e.movement<Ue(e)?e.actions>1:e.actions>0,nn=(e,n,o,t)=>{ce(n);const s=be(n.dungeon.layout.grid,o,t);s&&![cn,an,en].includes(s)&&n.dungeon.discoveredRooms.push(s),No(e,n,e.position.x,e.position.y,1),h(n,"logs.heroAction.openedDoor",{hero:m(e.name)})},Mo=(e,n,o)=>{if(ce(n),e.actions===1&&e.movement<e.maxMovement){h(n,"logs.heroAction.noActions",{hero:m(e.name)});return}if(!e.weapon.useHearHeroes&&Ct(n,e)){h(n,"logs.heroAction.notNearFriend",{hero:m(e.name),weapon:m(e.weapon.name)});return}const t=Rt(n,o);t&&(Xe(n,e,t,!1),t.health<=0&&Mt(n,t,e),e.actions>1&&e.movement<3?e.actions-=2:e.actions--)},Ro=e=>{ce(e);const n=e.currentActor;if(n){if(n.blinded){h(e,"logs.heroAction.blinded",{hero:m(n.name)});return}if(!$e(n)){h(e,"logs.heroAction.noActions",{hero:m(n.name)});return}ut(e),n.actions>1&&n.movement<Ue(n)?n.actions-=2:n.actions--,n.actions==0&&(n.movement=0)}},un=(e,n,o)=>e.dungeon.layout.monsters.some(t=>t.position.x===n&&t.position.y===o&&t.health>0),fn=(e,n,o)=>q(e).some(t=>t.position.x===n&&t.position.y===o),Nn=e=>{e.movement===0&&(e.actions--,e.actions!==0&&(e.movement=Ue(e))),e.actions==0&&(e.movement=0)},Et=e=>{ce(e),q(e).forEach(n=>{const o=n.level;n.experience>=28?n.level=fe.MASTER:n.experience>=18?n.level=fe.LORD:n.experience>=10?n.level=fe.HERO:n.experience>=4&&(n.level=fe.KNIGHT),o!==n.level&&h(e,"logs.heroAction.leveledUp",{hero:m(n.name),level:m(`content.level.${n.level}`)})})},It=e=>{q(e).forEach(n=>n.experience+=1)},Co=e=>{Tt(e).forEach(n=>{n.experience=0,n.health=n.maxHealth,n.movement=n.maxMovement,n.actions=2})},To=(e,n,o)=>!o.open&&!o.hidden&&(!o.locked||o.locked&&n)&&e.movement>0,Lo=(e,n)=>{const o=e.dungeon.layout.notes.find(t=>ke(t.position,n.position));o&&(e.dungeon.layout.doors.some(s=>s.hidden&&ke(o.position,{x:s.x,y:s.y}))||h(e,"logs.heroAction.reads",{hero:m(n.name),note:m(o.message)}))},wo=(e,n)=>{const o=e.dungeon.layout.monsters.some(t=>gn(n.position,t.position.x,t.position.y));return o&&h(e,"logs.heroAction.walkedByMonster",{hero:m(n.name)}),o},On=(e,n,o)=>{h(e,"logs.heroAction.drop",{hero:m(o.name),item:m(n.name)}),e.dungeon.layout.items.push({item:n,position:o.position}),n.drop&&Ko[n.drop](e,n,o)},Ho=(e,n,o)=>{switch(n.type){case X.ARMOUR:o.armour&&On(e,o.armour,o),o.armour=n;break;case X.SHIELD:o.shield&&On(e,o.shield,o),o.shield=n;break;case X.WEAPON:o.weapon&&On(e,o.weapon,o),o.weapon=n;break;default:o.inventory.push(n);break}if(n.pickup){const t=Pn[n.pickup];t(e,n,o)}},No=(e,n,o,t,s)=>{e.position.x=o,e.position.y=t,Lo(n,e),wo(n,e)?e.movement=0:e.movement-=s},Dt=(e,n,o,t)=>{const s=e.dungeon.layout.doors.find(r=>r.x===n.position.x&&r.y===n.position.y),i=n.inventory.some(r=>{var l;return(l=r.properties)==null?void 0:l[Po]});if(s&&To(n,i,s)){s.locked&&i&&h(e,"logs.heroAction.brokeLock",{hero:m(n.name)});const r=Ot(n.position.x,n.position.y,o,t);if(s.side===r)return s.open=!0,s.trapped&&Xe(e,$o(s),n,!1),!0}return s&&s.locked&&h(e,"logs.heroAction.locked"),!1},Ot=(e,n,o,t)=>{if(e===o){if(n>t)return I.UP;if(n<t)return I.DOWN}if(n===t){if(e>o)return I.LEFT;if(e<o)return I.RIGHT}},Mt=(e,n,o)=>{e.dungeon.layout.monsters=e.dungeon.layout.monsters.filter(t=>t!=n),e.dungeon.killCount++,o.experience+=n.experience},Rt=(e,n)=>e.dungeon.layout.monsters.find(o=>ke(o.position,n)),Ct=(e,n)=>et(e,n).filter(o=>o!==n).length>0,Tt=e=>e.heroes.filter(n=>n.health<=0).map(n=>n),Ge="USED",Fn="ATTACK_BONUS",Wn="SEARCH_BONUS",Po="BREAK_LOCK",Vn="RE_ROLL_ATTACK",Yn="DESCRIPTION",An="ACTIVE",bn="MOVEMENT_BONUS",qn="ACTIONS_BONUS",Bo="RESET_ON",Go="NEXT_TURN",Lt="TRADE",Uo="NEXT_SCENARIO",Pn={movementBonusOnPickup:(e,n,o)=>{var t,s;o.maxMovement+=(t=n.properties)==null?void 0:t[bn],o.actions>0&&(o.movement+=(s=n.properties)==null?void 0:s[bn])}},Ko={movementBonusOnDrop:(e,n,o)=>{var t,s;o.maxMovement-1>0&&(o.maxMovement-=(t=n.properties)==null?void 0:t[bn]),o.movement-1>=0&&(o.movement-=(s=n.properties)==null?void 0:s[bn])}},wt={magicHerbsOnUse:(e,n,o,t)=>{if(n.disabled){h(e,"logs.item.cannotUse",{item:m(n.name)});return}if(!t){h(e,"logs.item.noTarget");return}if(!$e(o)){h(e,"logs.heroAction.noActions",{hero:m(o.name)});return}if(n.properties){if(n.properties[Ge]){h(e,"logs.item.noUsesLeft",{item:m(n.name)});return}n.properties[Ge]=!0;const s=Math.min(ze(o.level,3),t.maxHealth-t.health);t.health+=s,h(e,"logs.item.magicHerbs",{user:m(o.name),item:m(n.name),target:m(t.name),addedHealth:`${s}`}),o.actions--,o.movement=o.maxMovement}},chaosSwordOnUse:(e,n,o,t)=>{if(n.disabled){h(e,"logs.item.cannotUse",{item:m(n.name)});return}},potionOfSpeedOnUse:(e,n,o)=>{var t,s,i;if(n.disabled){h(e,"logs.item.cannotUse",{item:m(n.name)});return}(t=n.properties)!=null&&t[Ge]?h(e,"logs.item.consumed",{item:m(n.name)}):(o.actions+=(s=n.properties)==null?void 0:s[qn],n.properties&&(n.properties[Ge]=!0),h(e,"logs.item.potionOfSpeed",{user:m(o.name),item:m(n.name),actions:(i=n.properties)==null?void 0:i[qn]}))},necklaceOfLightOnUse:(e,n,o,t)=>{var s;if(n.disabled){h(e,"logs.item.cannotUse",{item:m(n.name)});return}if(!t){h(e,"logs.item.noTarget");return}if(!$e(o)){h(e,"logs.heroAction.noActions",{hero:m(o.name)});return}n.properties&&!((s=n.properties)!=null&&s[Ge])&&(n.properties[Ge]=!0,t.ignoredByMonsters=!0,o.actions--)}},Fo={magicHerbsOnReset:(e,n)=>{n.properties&&(n.properties[Ge]=!1)},necklaceOfLightOnUse:(e,n)=>{n.properties&&(n.properties[Ge]=!1),e.heroes.forEach(o=>o.ignoredByMonsters=!1)}},Ht=(e,n)=>{if(n.effect&&e.currentActor){const o=wt[n.effect];o(e,n,e.currentActor,e.targetActor),e.targetActor=void 0}},Wo=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Pt(o)).forEach(o=>{if(o.reset){const t=Fo[o.reset];t(e,o)}})})},Vo=e=>{e.heroes.forEach(n=>{n.inventory.filter(o=>Nt(o)).forEach(o=>{if(o.reset){const t=Fo[o.reset];t(e,o)}})})},Nt=e=>e.properties?(e.properties[Bo]??[]).some(o=>o===Go):!1,Pt=e=>e.properties?(e.properties[Bo]??[]).some(o=>o===Uo):!1,Ae=[{name:"items.magicItems.healingHerbs.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,ACTIVE:!0,DESCRIPTION:"items.magicItems.healingHerbs.description",RESET_ON:[Lt,Uo]},effect:"magicHerbsOnUse",reset:"magicHerbsOnReset"},{name:"items.magicItems.boots.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.boots.description",MOVEMENT_BONUS:1},pickup:"movementBonusOnPickup",drop:"movementBonusOnDrop"},{name:"items.magicItems.giantsGlove.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.giantsGlove.description",BREAK_DOOR:!0,ATTACK_BONUS:1}},{name:"items.magicItems.ringOfPrecision.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.ringOfPrecision.description",RE_ROLL_ATTACK:!0}},{name:"items.magicItems.crownOfWisdom.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.crownOfWisdom.description",SEARCH_BONUS:1}},{name:"items.magicItems.swordOfChaos.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.swordOfChaos.description"},effect:"chaosSwordOnUse"},{name:"items.magicItems.potionOfSpeed.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{DESCRIPTION:"items.magicItems.potionOfSpeed.description",USED:!1,ACTIONS_BONUS:2,ACTIVE:!0},effect:"potionOfSpeedOnUse"},{name:"items.magicItems.necklaceOfLight.name",type:X.MAGIC,value:0,amountInDeck:1,properties:{USED:!1,RESET_ON:[Go],ACTIVE:!0,DESCRIPTION:"items.magicItems.necklaceOfLight.description"},effect:"necklaceOfLightOnUse",reset:"necklaceOfLightOnReset"}],Yo={name:"campaign.iceDragon.e1m3.name",beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1},{type:ie.OPEN_DOOR,targetCell:{x:18,y:4},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["       ########     ","     ###DDDEEE#     ","     #CCC##EEE#     ","######CCC##EEE######","#AAA##CCC####F#IIII#","#AAABBB#J####F#IIII#","#AAA####J##G#F#IIII#","##### ##J##GGF#IIII#","   ####KKK###F#IIII#","   #LLLKKK# #FMIIII#","   ####KKK####M#####","      #KKKMMMMM#    ","      ####MMMM##    ","         ######     "],corridors:["B","D","F","L"],pits:[{x:16,y:6},{x:17,y:6},{x:18,y:6},{x:15,y:8},{x:16,y:8},{x:17,y:8}],doors:[J(I.RIGHT,3,5),pn(I.DOWN,6,5,1),J(I.UP,6,5),J(I.DOWN,8,4),qe(I.UP,8,2),J(I.DOWN,8,7),J(I.LEFT,7,9),pn(I.LEFT,4,9,1),pn(I.RIGHT,9,11,1),qe(I.RIGHT,14,9),qe(I.UP,18,4),pn(I.LEFT,14,9,1),J(I.LEFT,13,7),yn(I.UP,11,6),J(I.UP,13,4),J(I.LEFT,11,1)],monsters:[te(K.ORCH,Y.Yellow,5,5),ct(K.TROLL,Y.Yellow,7,3,[Ae[3]]),te(K.ORCH,Y.Red,7,11),te(K.ORCH,Y.Blue,11,2),te(K.ORCH,Y.Blue,14,11),te(K.YELLOW_DARK_LORD,Y.Yellow,18,5)],secrets:[sn(se.MAGIC_ITEM,8,10,Ae[2]),Ee(se.TRAP_DOOR,"campaign.iceDragon.trapDoor",8,6),Ee(se.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,1),Ee(se.TRAP_DOOR,"campaign.iceDragon.trapDoor",11,7),Ee(se.TRAP_DOOR,"campaign.iceDragon.trapDoor",13,11)],notes:[{position:{x:6,y:5},message:"campaign.iceDragon.e1m3.notes.hint1"},{position:{x:8,y:3},message:"campaign.iceDragon.e1m3.notes.hint2"},{position:{x:8,y:8},message:"campaign.iceDragon.e1m3.notes.hint3"},{position:{x:14,y:10},message:"campaign.iceDragon.e1m3.notes.hint4"}],items:[]},killCount:0},qo={name:"campaign.iceDragon.e1m2.name",nextDungeon:Yo,beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1},{type:ie.OPEN_DOOR,targetCell:{x:17,y:14},fulfilled:!1}],startingPositions:[{x:2,y:14},{x:1,y:15},{x:2,y:15},{x:3,y:15}],discoveredRooms:["M"],layout:{grid:["############## #####","#AAA###CCCCCC###EEE#","#AAABBBC@CC@CDDDEEE#","#AAA###CCCCCC###EEE#","##### ##H##### #EEE#","       #H#     #EEE#","##### ##H##### #EEE#","#KKK###IIIIII# #EEE#","#KKKJJJIIIIII# ##F##","#KKK###IIIIII# ##F##","##L## #IIIIII# ##F##"," #L#  ######## #GGG#","##L##          #GGG#","#MMM#          #GGG#","#MMM#          #GGG#","#MMM#          #####","#####               "],corridors:["B","D","F","H","J","L"],doors:[J(I.UP,2,13),J(I.UP,2,10),J(I.RIGHT,3,8),yn(I.RIGHT,6,8),J(I.UP,8,7),J(I.UP,8,4),qe(I.LEFT,7,2),J(I.LEFT,4,2),yn(I.RIGHT,12,2),J(I.RIGHT,15,2),J(I.DOWN,17,7),J(I.DOWN,17,10),qe(I.DOWN,17,14)],monsters:[te(K.TROLL,Y.Red,3,7),te(K.ORCH,Y.Red,12,8),te(K.ORCH,Y.Green,11,1),te(K.TROLL,Y.Green,2,2),te(K.ORCH,Y.Yellow,18,7),te(K.TROLL,Y.Yellow,17,10)],secrets:[Ee(se.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,3),Ee(se.EQUIPMENT,"campaign.iceDragon.randomEquipment",3,3),Ee(se.EQUIPMENT,"campaign.iceDragon.randomEquipment",15,2),sn(se.MAGIC_ITEM,2,3,Ae[1]),sn(se.MAGIC_ITEM,16,11,Ae[6])],notes:[{message:"campaign.iceDragon.e1m2.notes.hint1",position:{x:2,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint2",position:{x:8,y:10}},{message:"campaign.iceDragon.e1m2.notes.hint3",position:{x:2,y:3}},{message:"campaign.iceDragon.e1m2.notes.hint4",position:{x:17,y:11}}],items:[]},killCount:0},xo={name:"campaign.iceDragon.e1m1.name",nextDungeon:qo,beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1},{type:ie.OPEN_DOOR,targetCell:{x:15,y:1},fulfilled:!1}],startingPositions:[{x:2,y:5},{x:1,y:4},{x:1,y:5},{x:1,y:6}],discoveredRooms:["A"],layout:{grid:["            ######","            #EEEE#","         ####EEEE#","##### ####DDDEEEE#","#AAA###CCCC#######","#AAABBBCCCC###GGG#","#AAA###CCCCFFFGGG#","##### #CCCC###GGG#","      #CCCC#######","      #CCCCHHHIII#","      ########III#","             #III#","             #####"],corridors:["B","D","F","H"],doors:[J(I.RIGHT,3,5),J(I.RIGHT,6,5),J(I.RIGHT,10,6),J(I.RIGHT,13,6),J(I.RIGHT,10,9),J(I.RIGHT,13,9),J(I.RIGHT,12,3),qe(I.UP,9,4),qe(I.RIGHT,15,2)],monsters:[te(K.ORCH,Y.Blue,10,8),te(K.ORCH,Y.Red,13,9),te(K.TROLL,Y.Red,16,2),te(K.TROLL,Y.Yellow,14,7)],secrets:[Ee(se.EQUIPMENT,"campaign.iceDragon.randomEquipment",10,5),Ee(se.EQUIPMENT,"campaign.iceDragon.randomEquipment",13,1),Ee(se.EQUIPMENT,"campaign.iceDragon.randomEquipment",16,10),sn(se.MAGIC_ITEM,16,6,Ae[0])],notes:[{message:"campaign.iceDragon.e1m1.notes.hint1",position:{x:2,y:4}},{message:"campaign.iceDragon.e1m1.notes.hint2",position:{x:9,y:8}},{message:"campaign.iceDragon.e1m1.notes.hint3",position:{x:9,y:5}},{message:"campaign.iceDragon.e1m1.notes.hint4",position:{x:9,y:3}}],items:[]},killCount:0},Xo={name:"campaign.iceDragon.e1mo.name",beaten:!1,winConditions:[{type:ie.KILL_ALL,fulfilled:!1}],nextDungeon:xo,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A"],layout:{grid:["     ######","     #CCCC#","     #CCCC#","     #CCCC#","     ##E###","      #E#  ","      #E## ","##### #BB# ","#AAA###BB# ","#AAADDDBB# ","#AAA###BB# ","##### #### "],doors:[J(I.RIGHT,3,9),J(I.RIGHT,6,9),J(I.UP,7,7),J(I.UP,7,4)],monsters:[te(K.ORCH,Y.Green,6,9),te(K.ORCH,Y.Yellow,8,10),te(K.ORCH,Y.Red,7,5),te(K.ORCH,Y.Red,9,3),te(K.TROLL,Y.Green,6,1)],secrets:[],notes:[],items:[],corridors:["D","E"]},killCount:0,events:[1,2,3,4,5,6]},Bt=[{name:"items.shields.largeShield",type:X.SHIELD,amountInDeck:2,dice:2,value:2},{name:"items.shields.smallShield",type:X.SHIELD,amountInDeck:2,dice:1,value:1}],Gt=()=>{const e=[];return Ae.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},Ut=()=>{const e=[];return vn.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),rt.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),Bt.forEach(n=>{for(let o=0;o<n.amountInDeck;o++)e.push(n)}),e},Se={name:"campaign.iceDragon.name",dungeons:[Xo,xo,qo,Yo],itemDeck:Ut(),magicItemDeck:Gt(),heroes:[hn("Fearik",Y.Yellow),hn("Helbran",Y.Red),hn("Siedel",Y.Green),hn("Wulf",Y.Blue)]},Bn=(e,n)=>{const o=Math.abs(n.x-e.x),t=Math.abs(n.y-e.y),s=Math.min(o,t),i=Math.max(o,t),r=s,l=i-s;let a=Math.sqrt(2);return l===0&&(a=1),Math.floor(a*r+l)},Kt=(e,n)=>{ce(e);const o=e.currentActor,t=e.dungeon.layout.items.find(i=>ke(i.position,o.position));if(t){const i=t.item;i.type===X.MAGIC?Do(e,i):Io(e,i);const r=e.dungeon.layout.items.indexOf(t);e.dungeon.layout.items.splice(r,1),h(e,"logs.heroAction.pickUp",{hero:m(o.name),item:m(i.name)}),Ho(e,i,o);return}const s=e.dungeon.layout.doors.find(i=>i.x===o.position.x&&i.y===o.position.y&&!i.open);if(s&&!s.hidden){const i=o.inventory.some(r=>{var l;return(l=r.properties)==null?void 0:l[Po]});if(To(o,i,s)){switch(s.locked&&i&&h(e,"logs.heroAction.brokeLock",{hero:m(o.name)}),s.open=!0,s.trapped&&Xe(e,$o(s),o,!1),s.side){case I.RIGHT:nn(o,e,n.x+1,n.y);break;case I.LEFT:nn(o,e,n.x-1,n.y);break;case I.DOWN:nn(o,e,n.x,n.y+1);break;case I.UP:nn(o,e,n.x,n.y-1);break}Nn(o)}else if(s.locked&&!s.hidden){if(!$e(o)){h(e,"logs.heroAction.noActions",{hero:m(o.name)});return}h(e,"logs.heroAction.locked"),Oo(e)}}else{if(!$e(o)){h(e,"logs.heroAction.noActions",{hero:m(o.name)});return}Ro(e)}},Ft=(e,n)=>{ce(e);const o=e.currentActor;if(o.actions===0){o.movement=0,h(e,"logs.heroAction.noActions",{hero:m(o.name)});return}if(En(e.dungeon.layout,n.x,n.y)){const s=fn(e,n.x,n.y),i=un(e,n.x,n.y),r=Bn(o.position,n),l=Gn(o.position,n,2,e,!0);if(!s&&!i&&r<=o.movement&&l){if(o.position=n,o.movement-=r,Lo(e,o),wo(e,o)&&(o.movement=0),Eo(e))return}else i&&(r<=o.weapon.range?Mo(o,e,n):h(e,"logs.heroAction.monsterOutOfRange"))}Nn(o)},Wt=(e,n,o)=>{const t=document.getElementById("gameBoard");if(!t)return;const s=t.getBoundingClientRect(),i=Math.min(Math.floor((e.clientX-s.left)/n),o.dungeon.layout.grid[0].length-1),r=Math.min(Math.floor((e.clientY-s.top)/n),o.dungeon.layout.grid.length-1),l=o.dungeon.layout.grid[r][i],a=o.currentActor;i===a.position.x&&r===a.position.y?Kt(o,{x:i,y:r}):xe(o.dungeon,l)&&Ft(o,{x:i,y:r})},Mn=e=>e.dungeon.layout.monsters.filter(n=>[K.ORCH,K.TROLL].includes(n.type)),Vt=e=>{const n=Jt(e);n.length===0&&h(e,"logs.monsterAction.noMonsterAct"),n.forEach(o=>{const t=o.actions;for(h(e,"logs.monsterAction.acted",{monster:m(o.name)});o.actions>0;){ce(e);const s=et(e,o).filter(u=>!u.ignoredByMonsters),i=Xt(e,o),r=jt([...i,...Mn(e)],o),l=$t([...i,...Mn(e)],o),a=zt([...q(e),...Mn(e)],o,e);switch(Yt(e,o,s,i,r,l,a)){case"MELEE_ATTACK":{const u=xt(s);xn(e,o,u,!1);break}case"RANGED_ATTACK":{const u=qt(i,o);xn(e,o,u,!0);break}case"MOVE":{Qt(e,o);break}case"DIAGONAL_FIRE_ATTACK":Rn(e,o,r);break;case"ORTHOGONAL_FIRE_ATTACK":Rn(e,o,l);break;case"SAME_ROOM_FIRE_ATTACK":Rn(e,o,a)}o.movement=Ue(o)}o.actions=t,o.movement=Ue(o)})},Yt=(e,n,o,t,s,i,r)=>o.length>0?"MELEE_ATTACK":!n.rangedWeapon&&s.length===0?"MOVE":t.length>0&&n.rangedWeapon?Math.random()<.1?(h(e,"logs.monsterAction.moveDespiteTarget",{monster:m(n.name)}),"MOVE"):"RANGED_ATTACK":r.length>0?Math.random()<.1?(h(e,"logs.monsterAction.moveDespiteTarget",{monster:m(n.name)}),"MOVE"):"SAME_ROOM_FIRE_ATTACK":t.length>0&&i.length>0?Math.random()<.1?(h(e,"logs.monsterAction.moveDespiteTarget",{monster:m(n.name)}),"MOVE"):"ORTHOGONAL_FIRE_ATTACK":t.length>0&&s.length>0?Math.random()<.1?(h(e,"logs.monsterAction.moveDespiteTarget",{monster:m(n.name)}),"MOVE"):"DIAGONAL_FIRE_ATTACK":"MOVE",qt=(e,n)=>e.filter(o=>!o.shield).sort(o=>on(n.position,o.position)).sort((o,t)=>t.health-o.health||on(n.position,o.position)-on(n.position,t.position))[0],xt=e=>e.sort((n,o)=>o.health-n.health)[0],Xt=(e,n)=>q(e).filter(o=>!o.ignoredByMonsters).filter(o=>Gn(n.position,o.position,48,e,!1)),Jt=e=>e.dungeon.layout.monsters.filter(n=>{const o=be(e.dungeon.layout.grid,n.position.x,n.position.y);return o&&xe(e.dungeon,o)&&n.health>0}),xn=(e,n,o,t)=>{Xe(e,n,o,t),(n==null?void 0:n.actions)>1&&(n==null?void 0:n.movement)<3?n.actions-=2:n.actions--},St=(e,n)=>q(e).map(o=>({hero:o,dist:on(o.position,n.position)})).sort((o,t)=>o.dist-t.dist)[0],Qt=(e,n)=>{const o=St(e,n);for(;n.movement>0;){if(o&&o.dist>1){const t=Zt(e,n.position);if(t.length>0){const s=t.map(i=>({pos:i,dist:on(i,o.hero.position)})).sort((i,r)=>i.dist-r.dist)[0].pos;n.position=s,h(e,"logs.monsterAction.movedTowards",{monster:m(n.name),hero:m(o.hero.name),x:`${s.x}`,y:`${s.y}`})}else h(e,"logs.monsterAction.couldNotMove",{monster:m(n.name)})}n.movement--}n.actions--},Zt=(e,n)=>{const o=n.x,t=n.y,s=[];for(let i=o-1;i<=o+1;i++)for(let r=t-1;r<=t+1;r++)i===o&&r===t||En(e.dungeon.layout,i,r)&&mn(e.dungeon,i,r)&&s.push({x:i,y:r});return s.filter(i=>!q(e).find(r=>r.position.x===i.x&&r.position.y===i.y)).filter(i=>!e.dungeon.layout.monsters.some(r=>r.position.x===i.x&&r.position.y===i.y))},jt=(e,n)=>e.filter(o=>[K.YELLOW_DARK_LORD,K.BLUE_DARK_LORD].includes(n.type)&&Math.abs(n.position.x-o.position.x)===Math.abs(n.position.y-o.position.y)&&Bn(n.position,o.position)>1),$t=(e,n)=>e.filter(o=>[K.RED_DARK_LORD,K.BLUE_DARK_LORD].includes(n.type)&&(n.position.x===o.position.x||n.position.y===o.position.y)&&Bn(n.position,o.position)>1),zt=(e,n,o)=>e.filter(t=>[K.GREEN_DARK_LORD,K.BLUE_DARK_LORD].includes(n.type)&&be(o.dungeon.layout.grid,n.position.x,n.position.y)===be(o.dungeon.layout.grid,t.position.x,t.position.y)),Rn=(e,n,o)=>{o.forEach(t=>{var s,i;(s=t.armour)!=null&&s.magicProtection?h(e,"logs.monsterAction.fireAttackDeflected",{monster:m(n.name),target:m(t.name),armour:m((i=t.armour)==null?void 0:i.name)}):Xe(e,n,t,!0)})},Xn=[{name:"events.hungryTroll.name",number:1,description:"events.hungryTroll.description",effect:"theHungryTroll",used:!1},{name:"events.sunStone.name",number:2,description:"events.sunStone.description",effect:"sunStone",used:!1},{name:"events.timePortal.name",number:3,description:"events.timePortal.description",effect:"timePortal",used:!1},{name:"events.fountainOfYouth.name",number:4,description:"events.fountainOfYouth.description",effect:"fountainOfYouth",used:!1},{name:"events.sleepingGas.name",number:5,description:"events.sleepingGas.description",effect:"sleepingGasCloud",used:!1},{name:"events.lostOrch.name",number:6,description:"events.lostOrch.description",effect:"theLostOrch",used:!1},{name:"events.dragonsBreath.name",number:7,description:"events.dragonsBreath.description",effect:"theDragonsBreath",used:!1},{name:"events.landslide.name",number:8,description:"events.landslide.description",effect:"landslide",used:!1},{name:"events.magicNode.name",number:9,description:"events.magicNode.description",effect:"fountainOfYouth",used:!1},{name:"events.foresight.name",number:10,description:"events.foresight.description",effect:"foresight",used:!1},{name:"events.earthquake.name",number:11,description:"events.earthquake.description",effect:"earthquake",used:!1},{name:"events.magicStorm.name",number:12,description:"events.magicStorm.description",effect:"theMagicStorm",used:!1},{name:"events.elementalWeapon.name",number:13,description:"events.elementalWeapon.description",effect:"theElementalWeapon",used:!1},{name:"events.orchDrums.name",number:14,description:"events.orchDrums.description",effect:"theOrchDrums",used:!1},{name:"events.weakness.name",number:15,description:"events.weakness.description",effect:"theSymbolOfWeakness",used:!1}],Jo=e=>e.events?Tn(Xn.filter(n=>{var o;return(o=e==null?void 0:e.events)==null?void 0:o.includes(n.number)})):Tn(Xn),So=e=>{const n=e.eventDeck.filter(o=>!o.used);return n.length>0?n[0]:(Tn(e.eventDeck),So(e))},es={sunStone:(e,n)=>{ve(e,n);const o=q(e).length-1,t=Math.floor(Math.random()*o),s=q(e)[t],i=be(e.dungeon.layout.grid,s.position.x,s.position.y);e.dungeon.layout.monsters.filter(r=>r.type===K.TROLL).filter(r=>be(e.dungeon.layout.grid,r.position.x,r.position.y)===i).forEach(r=>{h(e,"logs.events.sunStone",{monster:m(r.name)}),r.health=0}),n.used=!0},theHungryTroll:(e,n)=>{ve(e,n),Jn(e,K.TROLL),n.used=!0},timePortal:(e,n)=>{ve(e,n),e.heroes.forEach(o=>o.actions++),n.used=!0},fountainOfYouth:(e,n)=>{ve(e,n),q(e).forEach(o=>{if(o.health<o.maxHealth){const t=ze(o.level,3);o.health+=Math.min(t,o.maxHealth-o.health)}}),n.used=!0},sleepingGasCloud:(e,n)=>{ve(e,n),q(e).forEach(o=>{o.actions=Math.max(1,o.actions-1)}),n.used=!0},theLostOrch:(e,n)=>{ve(e,n),Jn(e,K.ORCH),n.used=!0},theDragonsBreath:(e,n)=>{ve(e,n),q(e).forEach(o=>o.blinded=!0),n.used=!0},landslide:(e,n)=>{ve(e,n);const o=e.dungeon.layout.corridors.filter(r=>!ls(e,r)).filter(r=>xe(e.dungeon,r)),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];e.dungeon.collapsedCorridor=i,e.dungeon.layout.grid=e.dungeon.layout.grid.map(r=>r.replaceAll(i,en)),n.used=!0},foreSight:(e,n)=>{if(ve(e,n),e.dungeon.layout.secrets.filter(t=>t.type===se.EQUIPMENT||t.type===se.MAGIC_ITEM).filter(t=>!t.found).filter(t=>t.item).filter(t=>{const s=be(e.dungeon.layout.grid,t.position.x,t.position.y)??"";return!xe(e.dungeon,s)}).length>0){const t=e.dungeon.layout.secrets.pop();t&&t.item&&(h(e,"logs.events.foreSight",{x:`${t.position.x+2}`,y:`${t.position.y-1}`}),e.dungeon.layout.items.push({item:t.item,position:t.position}))}n.used=!0},earthquake:(e,n)=>{ve(e,n);const o=Qo(e),t={name:"boulder",type:X.WEAPON,value:0,dice:3,useHearHeroes:!0,twoHanded:!1,range:1,amountInDeck:0,ignoresShield:!1,ignoresArmour:!1},s={name:"Earthquake",actions:0,health:0,maxMovement:0,position:{x:0,y:0},weapon:t,level:fe.APPRENTICE,maxHealth:0,movement:0,experience:0,colour:Y.Red,inventory:[],defense:0};e.dungeon.layout.monsters.filter(i=>i.type===K.TROLL).filter(i=>be(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>Xe(e,s,i,!1)),q(e).filter(i=>be(e.dungeon.layout.grid,i.position.x,i.position.y)===o).forEach(i=>Xe(e,s,i,!1)),n.used=!0},theMagicStorm:(e,n)=>{var t;ve(e,n);const o=q(e).filter(s=>s.inventory.filter(i=>!i.disabled).some(i=>i.type===X.MAGIC));if(o.length>0){const s=o.length-1,i=Math.floor(Math.random()*s),r=o[i],l=r.inventory.filter(a=>a.type===X.MAGIC);if(l.length>0){const a=l.length-1,c=Math.floor(Math.random()*a),u=l[c];u.disabled=!0,!((t=u.properties)!=null&&t[An])&&u.pickup&&u.drop&&Ko[u.drop](e,u,r)}}n.used=!0},theElementalWeapon:(e,n)=>{ve(e,n);const o=q(e),t=o.length-1,s=Math.floor(Math.random()*t),i=o[s];i.weapon.elemental=!0,n.used=!0},theOrchDrums:(e,n)=>{ve(e,n),e.dungeon.layout.monsters.filter(o=>o.type===K.ORCH).forEach(o=>o.actions=3),n.used=!0},theSymbolOfWeakness:(e,n)=>{ve(e,n),q(e).forEach(o=>o.weakened=!0),n.used=!0}},ns=e=>{q(e).some(n=>n.weapon.elemental)&&(h(e,"logs.events.magicStormRestored"),q(e).forEach(n=>{n.inventory.forEach(o=>{var t;!((t=o.properties)!=null&&t[An])&&o.pickup&&Pn[o.pickup](e,o,n),o.disabled=!1})}))},os=e=>{e.eventDeck.filter(o=>!o.used).length===0&&(is(e),ts(e),ns(e)),rs(e),ss(e)},ts=e=>{const n=e.dungeon.collapsedCorridor;n&&(h(e,"logs.events.landslideRestored"),e.dungeon.layout.grid=e.dungeon.layout.grid.map(o=>o.replaceAll(en,n)),e.dungeon.collapsedCorridor=void 0)},ss=e=>{q(e).some(n=>n.blinded)&&(h(e,"logs.events.blindedRestored"),q(e).forEach(n=>n.blinded=!1))},is=e=>{q(e).some(n=>n.weapon.elemental)&&(h(e,"logs.events.elementalWeaponRestored"),q(e).forEach(n=>n.weapon.elemental=!1))},rs=e=>{q(e).some(n=>n.weakened)&&(h(e,"logs.events.weakenedRestored"),q(e).forEach(n=>n.weakened=!1))},Qo=e=>{const n=e.dungeon.discoveredRooms.length-1,o=Math.floor(Math.random()*n);return e.dungeon.discoveredRooms[o]},Jn=(e,n)=>{const o=e.dungeon.layout.monsters.filter(l=>l.type===n);if(o.length===4)return;const s=Qo(e),i=[Y.Red,Y.Green,Y.Yellow,Y.Blue];o.forEach(l=>{const a=i.indexOf(l.colour);a!==-1&&i.splice(a,1)});let r=!1;for(let l=0;l<e.dungeon.layout.grid.length;l++){const a=dn(e.dungeon.layout.grid[l]);for(let c=0;c<a.length;c++)if(a[c]===s&&!fn(e,c,l)&&!un(e,c,l)){e.dungeon.layout.monsters.push(te(n,i[0],c,l)),r=!0;break}if(r)break}},ve=(e,n)=>{h(e,n.description),h(e,n.name)},Tn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e.forEach(t=>t.used=!1),e},ls=(e,n)=>{const o=[];return e.dungeon.layout.grid.forEach((t,s)=>{dn(t).forEach((i,r)=>{i===n&&o.push(fn(e,r,s)||un(e,r,s))})}),o.some(t=>t)},m=(e,n)=>Je.get(e,n)??e,as=e=>{ce(e),localStorage.setItem("state",JSON.stringify(e)),h(e,"logs.gameSaved")},ce=e=>{e.reRender=!0,localStorage.setItem("reloadGuard",JSON.stringify(e))},Zo=e=>(e.currentActor=e.heroes.find(n=>{var o;return n.name===((o=e.currentActor)==null?void 0:o.name)}),h(e,"logs.gameLoaded"),ce(e),e),jo=()=>{const e={heroes:Se.heroes,dungeon:Se.dungeons[0],currentActor:Se.heroes[0],actionLog:[{key:"logs.playingCampaign",properties:{name:m(Se.name)}},{key:"logs.gameInitialized"},{key:"logs.initLogActions"},{key:"logs.initLogMoves"},{key:"logs.initLogMoveFinished"},{key:"logs.initLogUnfair"}],itemDeck:Sn(Se.itemDeck),magicItemDeck:Sn(Se.magicItemDeck),settings:{cellSize:48,debug:!1},eventDeck:Jo(Se.dungeons[0]),reRender:!0};return Hn(e),localStorage.setItem("autosave",JSON.stringify(e)),e},Sn=e=>{let n=e.length,o;for(;n>0;)o=Math.floor(Math.random()*n),n--,[e[n],e[o]]=[e[o],e[n]];return e},dn=e=>{const n=[];for(let o=0;o<e.length;o++)n.push(e[o]);return n},ze=(e,n)=>{let o=[];for(let t=0;t<n;t++)o.push(Math.floor(Math.random()*6)+1);switch(e){case fe.APPRENTICE:o=o.filter(t=>t===5);break;case fe.KNIGHT:case fe.HERO:o=o.filter(t=>t>=4);break;case fe.LORD:case fe.MASTER:o=o.filter(t=>t>=3);break}return o.length},Ue=e=>{var n;return e.maxMovement-(((n=e.armour)==null?void 0:n.movementReduction)??0)},cs=e=>e.dungeon.winConditions.filter(n=>n.type!==ie.KILL_ALL).some(n=>!n.fulfilled),Ln=e=>{if(e.settings.debug&&console.log(e),ce(e),fs(e),e.currentActor===void 0)return e;{h(e,"logs.endedTurn",{name:m(e.currentActor.name)});let o=q(e).indexOf(e.currentActor)+1;if(o===q(e).length&&(Vt(e),o=0,Vo(e)),q(e).length===0)return us(e);if(q(e)[o].incapacitated&&(h(e,"logs.noLongerIncapacitated",{name:m(q(e)[o].name)}),q(e)[o].incapacitated=!1,o++),e.currentActor.actions=2,e.currentActor.movement=Ue(e.currentActor),e.currentActor=q(e)[o],o===0&&cs(e)){os(e);const t=So(e);es[t.effect](e,t)}h(e,"logs.startedTurn",{name:m(e.currentActor.name)})}return e},us=e=>{const n=localStorage.getItem("autosave");if(n){const o=JSON.parse(n);return ce(o),Co(o),Hn(o),Wo(o),Vo(o),zo({x:o.dungeon.startingPositions[0].x,y:o.dungeon.startingPositions[0].y},o.settings.cellSize),o.currentActor=o.heroes.find(t=>{var s;return t.name===((s=o.currentActor)==null?void 0:s.name)}),h(o,"logs.allHeroesDead"),o}return h(e,"logs.failedToReset"),e},fs=e=>{var n,o;e.dungeon.winConditions.forEach(t=>{var s;switch(t.type){case ie.KILL_ALL:{const i=e.dungeon.layout.monsters.map(r=>r.health).reduce((r,l)=>r+l,0);t.fulfilled=i<=0;break}case ie.REACH_CELL:{t.fulfilled=q(e).some(i=>{var r;return i.position.x===((r=t.targetCell)==null?void 0:r.x)&&i.position.y===t.targetCell.y});break}case ie.KILL_ALL_OF_TYPE:{t.fulfilled=e.dungeon.layout.monsters.filter(i=>i.type===t.targetMonsterType).some(i=>i.health>0);break}case ie.OPEN_DOOR:{t.fulfilled=((s=e.dungeon.layout.doors.find(i=>{var r,l;return i.x===((r=t.targetCell)==null?void 0:r.x)&&i.y===((l=t.targetCell)==null?void 0:l.y)}))==null?void 0:s.open)??!1;break}case ie.KILL_AT_LEAST:{t.fulfilled=(t.killMinCount?t.killMinCount:0)<=e.dungeon.killCount;break}}}),e.dungeon.beaten=e.dungeon.winConditions.map(t=>t.fulfilled).reduce((t,s)=>t&&s,!0),e.dungeon.beaten&&(h(e,"logs.allConditionsFulfilled"),h(e,"logs.clearedDungeon",{name:m(e.dungeon.name)}),(n=e.dungeon.nextDungeon)!=null&&n.name&&h(e,"logs.moveToNext",{name:m((o=e.dungeon.nextDungeon)==null?void 0:o.name)}))},$o=e=>({health:0,position:{x:e.x,y:e.y},defense:0,experience:0,actions:0,movement:0,maxMovement:0,colour:Y.Red,maxHealth:0,name:"Door",level:fe.APPRENTICE,incapacitated:!1,weapon:{name:"Trap",amountInDeck:0,dice:e.trapAttacks,useHearHeroes:!0,twoHanded:!1,range:1,type:X.WEAPON,value:0,ignoresShield:!0,ignoresArmour:!1},inventory:[]}),En=(e,n,o)=>{var s,i;let t=!0;if(n<0||n>=e.grid[0].length||o<0||o>=e.grid.length)t=!1;else{const r=(s=e.pits)==null?void 0:s.some(c=>ke(c,{x:n,y:o})),l=(i=e.pillars)==null?void 0:i.some(c=>ke(c,{x:n,y:o})),a=be(e.grid,n,o);(r||l||a===an||a===cn)&&(t=!1)}return t},mn=(e,n,o)=>{const t=be(e.layout.grid,n,o);return t?xe(e,t):!1},xe=(e,n)=>e.discoveredRooms.includes(n),be=(e,n,o)=>{let t="";return e.forEach((s,i)=>{dn(s).forEach((r,l)=>{i===o&&l===n&&(t=r)})}),t},gn=(e,n,o)=>e.x===n&&e.y===o||e.x===n-1&&e.y===o||e.x===n-1&&e.y===o-1||e.x===n&&e.y===o-1||e.x===n+1&&e.y===o-1||e.x===n+1&&e.y===o||e.x===n+1&&e.y===o+1||e.x===n&&e.y===o+1||e.x===n-1&&e.y===o+1,ds=(e,n,o,t)=>{var i;const s=((i=t.armour)==null?void 0:i.defense)??t.defense;return`${e} damage (${n}-(${s}+${o})=${e})`},ke=(e,n)=>e.x===n.x&&e.y===n.y,h=(e,n,o)=>{e.actionLog=[{key:n,properties:o},...e.actionLog],ce(e)},Xe=(e,n,o,t)=>{var k,D;let s=n.weapon;t&&n.rangedWeapon&&(s=n.rangedWeapon);let i=0,r=0;s.ignoresArmour?o.armour&&h(e,"logs.takeDamage.armourUseless",{actor:m(o.name),weapon:m(s.name)}):i=((k=o.armour)==null?void 0:k.defense)??o.defense,s.ignoresShield?o.shield&&h(e,"logs.takeDamage.shieldUseless",{actor:m(o.name),weapon:m(s.name)}):r=ze(o.level,((D=o.shield)==null?void 0:D.dice)??0);const l=n.inventory.filter(A=>{var _;return(_=A==null?void 0:A.properties)==null?void 0:_[Vn]}).some(A=>{var _;return h(e,"logs.takeDamage.usedEffect",{actor:m(n.name),item:m(A.name)}),(_=A.properties)==null?void 0:_[Vn]}),a=n.inventory.filter(A=>{var _;return(_=A==null?void 0:A.properties)==null?void 0:_[Fn]}).map(A=>{var _;return h(e,"logs.takeDamage.usedEffect",{actor:m(n.name),item:m(A.name)}),(_=A.properties)==null?void 0:_[Fn]}).reduce((A,_)=>A+_,0),c=n.blinded?1:0,u=n.weakened?1:0,d=n.weapon.elemental?1:0,b=a+d,p=c+u,E=ze(n.level,s.dice+b-p);let y=Math.max(E-(i+r),0);y===0&&l&&(h(e,"logs.takeDamage.reRoll",{actor:m(n.name)}),y=Math.max(E-(i+r),0)),o.health-=y,h(e,"logs.takeDamage.attackedWith",{actor:m(n.name),target:m(o.name),weapon:m(s.name),damage:ds(y,E,r,o)}),o.health<=0&&(h(e,"logs.takeDamage.killed",{actor:m(n.name),target:m(o.name)}),o.health=0,o.level=fe.APPRENTICE)},zo=(e,n)=>{const o=document.getElementById("gameBoardContainer"),t=document.getElementById("gameBoard");if(o&&t){const s=e.x*n,i=e.y*n,r=t.offsetWidth,l=t.offsetHeight;o.scrollLeft=Math.round(s/r),o.scrollTop=Math.round(i/l)}},ms=e=>{e.dungeon.beaten&&e.dungeon.nextDungeon&&(e.dungeon=e.dungeon.nextDungeon,e.actionLog=[{key:"logs.youHaveReached",properties:{name:m(e.dungeon.name)}}],e.eventDeck=Jo(e.dungeon),ce(e),It(e),Et(e),Co(e),Hn(e),Wo(e),zo({x:e.dungeon.startingPositions[0].x,y:e.dungeon.startingPositions[0].y},e.settings.cellSize),localStorage.setItem("autosave",JSON.stringify(e)))},on=(e,n)=>Math.sqrt(Math.pow(e.x-(n==null?void 0:n.x),2)+Math.pow(e.y-(n==null?void 0:n.y),2)),Gn=(e,n,o,t,s)=>{const i={x:e.x*o-Math.floor(o/2),y:e.y*o-Math.floor(o/2)},r={x:n.x*o-Math.floor(o/2),y:n.y*o-Math.floor(o/2)};return Un(i,e,r,n,o,t,s,[])},Un=(e,n,o,t,s,i,r,l)=>{var y,k;if(isNaN(e.x)||isNaN(e.y))return!1;const a=gs(e,o),c={x:Math.round((a.x+Math.floor(s/2))/s),y:Math.round((a.y+Math.floor(s/2))/s)};if(isNaN(c.x)||isNaN(c.y)||isNaN(a.x)||isNaN(a.y))return!1;const u=be(i.dungeon.layout.grid,c.x,c.y),d=(y=i.dungeon.layout.pits)==null?void 0:y.some(D=>ke(D,c)),b=(k=i.dungeon.layout.pillars)==null?void 0:k.some(D=>ke(D,c)),p=i.dungeon.layout.monsters.some(D=>ke(D.position,c)),E=q(i).filter(D=>!ke(D.position,n)).some(D=>ke(D.position,c));return c.x===t.x&&c.y===t.y?(l.push(c),!0):b||p||!r&&E||u===cn||u===en||r&&(d||u===an)?!1:(c.x===n.x&&c.y===n.y||l.some(D=>D.x===c.x&&D.y===c.y)||l.push(c),Un(a,n,o,t,s,i,r,l))},gs=(e,n)=>{const o=e.x,t=e.y,s=n.x-o,i=n.y-t,r=s/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),l=i/Math.pow(Math.pow(s,2)+Math.pow(i,2),1/2),a=Math.round(r+o),c=Math.round(l+t);return{x:a,y:c}},et=(e,n)=>q(e).filter(o=>gn(n.position,o.position.x,o.position.y)),ps=""+new URL("../assets/Dungeon_Tileset.e372bb4f.png",import.meta.url).href,hs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAAAgCAYAAADKbvy8AAAHzUlEQVRoge2af2gURxTHvydBhGKhObRwmJSq+0e9SDQhSU24BEEukBChEYwYgxRCTLg/KqEpEUJK00BCDKJ/HCZnaAm2NSk0lkoEzz9ET+PPREPUf+5qMSf5QzmFimhLYPvH5W1m92Z3Z3YvYsEHx+7OzuftzHv7Zt7OnAccUbw+1VgWTy14eHXNxI0OHivKu2HfBV5WTw4P/PFIDfLWrUXy2UvkrVsLANjVPq7KdMKpDsXrU3M35/HvAZa8G5b4/olJJO/dzbgX7ulacd6JHo8R5BmeZFf7uO2b5FQH+8Y1V/sBAKXr1wAAZj/9AoV/nUXL6WmtPqvDDcvqIKOFe7q4fbN7edzwTvXksGBFXRAj9xcBvFgqfYHvdn6Eby+90CkggxkbJKPDyLGRM/Hn37ojrg/jDAC2DkWUG9bYDvaN75+YRGd9rfGoPZPXf1He1BAO9GQMoSTNBTlYvf8EcLFLO792TjEqtmyQnQ6SeGrBowAqAFTUBTP4jy92IfnsJVbvP4HGrYrGuGV5krdtu9ktnZj1X5S3E1E9q3iFzQVpv/77y1daGXsuIrI6jIaw4o113bA86Z+Y5B5FxS0vo0eLwHhqwYNzURUAmgtqdHOXcR4DgNyz3XxDSugwihteluUNg+GeLoS6e8FeA0Couxfhni5dXV7/ZXizYVhWT0YERpqK8WXfeSSfvdSVs8lHc7VflxQ40WElbngRVvH6VNZAZMzczXm6xCHU3asZja1n7L8sb3y+Uz0ZMP0uHa5TLx2uUxWvT/3t8l2Vvcf+nOrg2N01L9P+4yd+0JWz12VlZWpZWVkGy9NDz5Xl2fps+2X0ELeKYMrScjfnofP6U7ScnkaouxfJe3fRPzGpZXHN1X5Emoq5BhTVYeYAp7wMG+ruRd627eisrzWN5ueJpOlzzfovyos8X0QPOVEbQus3faiDKYzpYc8TSTRX+zFy4YHpA0V1mEWRG16UDfd0ZRjvn5tn0Flfa8oC0I68/ovyZs93oodES2KoYWSI0vVr0JJI6h5AdczmPxkd2eZlWKPxqJxdBGDZ/h3r0ZJIgr4Bjf0X4XfevOkZuQDTxEWmHawNMj7E2TB9nkhqYfuc6QBFotmKhp0OXuOzwWebBSDcf1Hequ9O9KyyAiNNxToFitenRpqKpZzH0yHTeJaX7bhTlkS0/zJ8ttpB97gf8iS3nr4RKpPV4ZQXMUK2WCNvVSbDO5Fs6Xkv76BI7VG9TVmJfbm3wbrhnXAr4kDF6xPe+zLjUyp/2PB61tgmIyn1DYoqA9iQn48/fvoZuw804sn8PB7HbgslUYcOlkPxF2pl8QezGB6dEnaCE94px50DZecKIxsYiupWRmR5nvOKKgPCbFFlADNXYgCA3QcaAQAb8vNR0bjHNokyGhEAFH8hDh0sF0pCnPAinJk9uTvygaEo0Bq0/Gaxk7Er5xF+uKReUBfrvKLKAFLPFgAAhcWfY3b6Bj75bBPuXrttGuHEzlyJYfeBRsxO39DxIqL4CzEWmQMA3ElcxeBAG8Yic7iTmMoqb+yDHWdY3NZY0yw0MBQFRZJQw73Lq+ux1iDCD3MQ2rKI0JZFaV00/AHASOSUVj4SOQXF65N6qYy8iNxJXMWdxFXdtYzY8Yo3vetutIcVRysyedu2I9Tdq7FcQ2hRuCSx1qDt+B0YiiLWmt5QDQxFEdqyqKsTfphjqUfx+tSTO8qwd+qy5sAn8/MAoDu3mseoUxWNewBAmicdvOEMAL7+5qSjOdTIkwPZJTU7DoC2lMn+5SIjAim0yRkAhKKHjTQA2FdZo/vFWoOmemjo3Dt1Gb+WV+Fx7DaezM9jQ36+FonsuZmQMVjHifLs/DI8OoX4g1kAy8YzOs84H8nyvP1EO47+59NZX6vt2GcspfEiieYyswiiho9dOQ8g7byiUB8+2Lq8av9qbhoz4SMAzP9UZCwjnfsqa3TnIlEgwyve5f05duHYKMb9RNpcleF5S3EUfcOj/HmWuEhTMVpOT2vXgMkcyA6fADKGQ7OOAXznAcAHW4tRFOqz1dHR3oCqYAk62hvQ0d6A6d9HdedVwRLbTNKKtxJ6q9kto+97WwBAlw3SlpATHliOJF27/YU67tDB8gzu1tM32m5MPLXgiacWPBlZKA116SzSsr86iacWPPsqazTDvh7sAZCeiANDUbwe7MGMQDJw6/4jlBZs1K6PHhvH5eM7UHX4OjraGyxZcp4VXxUsAaK3M7LYjL/wLRmzpSuS1u0vBDBlup9nxw+PTmFwoA0A0MIMi4rXpw4OtGlDpsYtRSPLUR3T/4WSQopAY+SJDl9FoT5tuATSEc3OqXZJiIjIDMMiPDuM0bF/YhK5Z7u17TPW0LI8O+yxvFOOJGMINSYwJCLOI34mfARFoT5dUhMYiloOoWzjqoIluh9bxutEtnh2DhocaENnfa22kBxpKjZ1nghPwtvNF+HYTVxWuHMgOZHNImW+vciJr+bSb26sNaglMSJ6aAgsLdioOxcVJzzNKXRNzqLN053Hz3mMdWR4EqNjRDnevAlYfMiTYqtGWwk5kTJXEecpXp/a0d6AW/cfce+XFmy0TGKywQ8OtOnWH2n+EREr3movVeS5ZltKlvuBboV1vqzzKGKOHhvXHVeK19q89B1mdu2Gt9rXc/vc9/I/lf8AumRDnk2NWWYAAAAASUVORK5CYII=",_s=(e,n,o,t,s)=>{q(t).forEach(r=>{vs(e,r,n,o,s)}),ks(e,t,o),Es(e,t,o)},vs=(e,n,o,t,s)=>{const i=n.position.x,r=n.position.y;if(e.drawImage(o,4*16,0,16,16,i*t,r*t,t,t),ys(e,n,i,r,t),bs(e,n,i,r,t),As(e,n,i,r,t),s){const l=`(${i},${r})`;e.fillStyle="black",e.font="8px Arial",e.fillText(l,i*t+3,r*t+10)}},ys=(e,n,o,t,s)=>{const i=e.fillStyle,r=e.strokeStyle;e.strokeStyle="#080808",e.fillStyle="darkred";for(let l=0;l<n.actions;l++)e.fillRect(o*s+4+6*l,t*s+s-12,5,5),e.rect(o*s+4+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle="blue";for(let l=0;l<n.movement;l++)e.fillRect(o*s+s-22+6*l,t*s+s-12,5,5),e.rect(o*s+s-22+6*l,t*s+s-12,5,5),e.stroke();e.fillStyle=i,e.strokeStyle=r},As=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(o*s+4,t*s,s-8,4),e.fillStyle="green",e.fillRect(o*s+4,t*s,(s-8)*(n.health/n.maxHealth),4),e.rect(o*s+4,t*s,s-8,4),e.stroke()},bs=(e,n,o,t,s)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(o*s+4,t*s+(s-6),s-8,4),e.stroke()},ks=(e,n,o)=>{const t=n.currentActor;if(t){for(let s=t.position.x-t.movement;s<=t.position.x+t.movement;s++)for(let i=t.position.y-t.movement;i<=t.position.y+t.movement;i++)if(mn(n.dungeon,s,i)&&!(s===(t==null?void 0:t.position.x)&&i===(t==null?void 0:t.position.y))){const l=un(n,s,i),a=fn(n,s,i),c=En(n.dungeon.layout,s,i),u=Gn(t.position,{x:s,y:i},2,n,!0);!a&&!l&&c&&u&&(e.fillStyle="rgba(50, 50, 255, 0.08)",e.fillRect(s*o,i*o,o,o),e.stroke())}}},Es=(e,n,o)=>{const t=n.currentActor;t&&(e.beginPath(),e.strokeStyle="lightblue",e.lineWidth=2,e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o+o/3,t.position.y*o),e.moveTo(t.position.x*o,t.position.y*o),e.lineTo(t.position.x*o,t.position.y*o+o/3),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o),e.moveTo(t.position.x*o+o,t.position.y*o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3,t.position.y*o+o),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o,t.position.y*o+o/3*2),e.moveTo(t.position.x*o+o,t.position.y*o+o),e.lineTo(t.position.x*o+o/3*2,t.position.y*o+o),e.stroke(),e.lineWidth=1)},Is=(e,n,o,t,s)=>{t.dungeon.layout.monsters.forEach(i=>{Ds(e,n,t,i,o,s)})},Ds=(e,n,o,t,s,i)=>{const r=o.dungeon.layout.grid[t.position.y][t.position.x];if(t&&t.health>0&&xe(o.dungeon,r)){switch(t.type){case K.ORCH:Os(e,n,s,t);break;case K.TROLL:Ms(e,n,s,t);break;default:Rs(e,n,s,t);break}Cs(e,t,s),Ts(e,t,s),Ls(e,t,o.heroes,o,s,i)}},Os=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},Ms=(e,n,o,t)=>{e.drawImage(n,o,16,16,16,t.position.x*o,t.position.y*o,o,o)},Rs=(e,n,o,t)=>{e.drawImage(n,16,16,16,16,t.position.x*o,t.position.y*o,o,o)},Cs=(e,n,o)=>{e.beginPath(),e.strokeStyle=n.colour,e.fillStyle=n.colour,e.fillRect(n.position.x*o+4,n.position.y*o+(o-6),o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Ts=(e,n,o)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="red",e.fillRect(n.position.x*o+4,n.position.y*o,o-8,4),e.fillStyle="green",e.fillRect(n.position.x*o+4,n.position.y*o,(o-8)*(n.health/n.maxHealth),4),e.rect(n.position.x*o+4,n.position.y*o,o-8,4),e.stroke(),e.strokeStyle="black",e.fillStyle="black"},Ls=(e,n,o,t,s,i)=>{i&&o.forEach(r=>{const l=[],a={x:n.position.x*48-24,y:n.position.y*48-24},c={x:r.position.x*48-24,y:r.position.y*48-24};if(Un(a,n.position,c,r.position,48,t,!1,l)){const d=n.position.x,b=n.position.y,p=r.position.x,E=r.position.y;e.beginPath(),e.strokeStyle=n.colour,e.lineWidth=2,e.moveTo(d*s+s/2,b*s+s/2),e.lineTo(p*s+s/2,E*s+s/2),e.stroke(),e.lineWidth=1}})},ws=(e,n,o,t,s)=>{t.dungeon.layout.doors.forEach(i=>{Vs(e,n,o,t,i,s)})},Hs=(e,n,o,t,s)=>{t.dungeon.layout.grid.forEach((i,r)=>{dn(i).forEach((l,a)=>{Gs(e,n,t,l,a,r,o),Ws(e,l,t,a,r,o,s)})}),Ps(e,n,o,t,s),Bs(e,n,o,t,s)},Ns=(e,n,o,t,s)=>{t.dungeon.layout.secrets.filter(i=>i.found).forEach(i=>{switch(i.type){case se.TRAP_DOOR:Ks(e,n,o,i);break;default:Fs(e,n,o,i);break}}),t.dungeon.layout.secrets.filter(i=>!i.found).forEach(i=>{if(e.globalAlpha=.6,Qe(e,n,8,0,o,i.position.x,i.position.y,t),e.globalAlpha=1,s){const r=`${i.type}`;e.fillStyle="rgba(255, 50, 50, 0.28)",e.fillRect(i.position.x*o,i.position.y*o,o,o),e.fillStyle="black",e.font="12px Arial",e.fillText(r,i.position.x*o,i.position.y*o+10)}})},Qe=(e,n,o,t,s,i,r,l)=>{l.dungeon.discoveredRooms.some(a=>Qn(i,r,a,l))||Qn(i,r,en,l)?e.drawImage(n,o*48,t,48,48,i*s,r*s,s,s):nt(e,i,r,s)},Ps=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pits)==null?void 0:i.filter(l=>mn(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{Qe(e,n,7,0,o,l.x,l.y,t)})},Bs=(e,n,o,t,s)=>{var i,r;(r=(i=t.dungeon.layout.pillars)==null?void 0:i.filter(l=>mn(t.dungeon,l.x,l.y)||s))==null||r.forEach(l=>{Qe(e,n,6,0,o,l.x,l.y,t)})},Gs=(e,n,o,t,s,i,r)=>{Us(t,o)?t===en?(Qe(e,n,0,0,r,s,i,o),Qe(e,n,5,0,r,s,i,o)):Qe(e,n,1,0,r,s,i,o):kn(t,o)?nt(e,s,i,r):Qe(e,n,0,0,r,s,i,o)},Us=(e,n)=>Ys(e)||!xe(n.dungeon,e)&&e!==an,nt=(e,n,o,t)=>{e.beginPath(),e.strokeStyle="black",e.fillStyle="black",e.fillRect(n*t,o*t,t,t),e.stroke()},Ks=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,3*48,0,48,48,s*o,i*o,o,o)},Fs=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,4*48,0,48,48,s*o,i*o,o,o)},Ws=(e,n,o,t,s,i,r)=>{!r&&(kn(n,o)||n===cn)||(e.beginPath(),e.strokeStyle="black",e.rect(t*i,s*i,i,i),r&&(e.font="7px Arial",e.fillText(`${t},${s}`,t*i+3,s*i+(i-3))),e.stroke())},Vs=(e,n,o,t,s,i)=>{const r=t.dungeon.layout.grid[s.y][s.x];if(s&&!s.hidden&&!s.open&&!kn(r,t))switch(e.fillStyle="brown",s.side){case I.RIGHT:{e.fillRect(s.x*o+(o-2),s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o-4),s.y*o+(o/2-4),8,8));break}case I.LEFT:{e.fillRect(s.x*o-2,s.y*o,4,o),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o-4,s.y*o+(o/2-4),8,8));break}case I.UP:{e.fillRect(s.x*o,s.y*o-2,o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o-4,8,8));break}case I.DOWN:{e.fillRect(s.x*o,s.y*o+(o-2),o,4),s.locked&&i&&(e.fillStyle="grey",e.fillRect(s.x*o+(o/2-4),s.y*o+(o-4),8,8));break}}i&&!kn(r,t)&&(e.fillStyle="black",e.font="12px Arial",e.fillText(`[${s.hidden?"H":"-"}/${s.trapped?`T${s.trapAttacks}`:"-"}/${s.locked?"L":"-"}]`,s.x*o,s.y*o+10),e.fillStyle="rgba(50, 255, 255, 0.28)",e.fillRect(s.x*o,s.y*o,o,o))},Ys=e=>e===cn,kn=(e,n)=>e===an||!xe(n.dungeon,e),Qn=(e,n,o,t)=>{if(!t)return;const s=Math.max(e-1,0),i=Math.max(n-1,0),r=Math.min(n+1,t.dungeon.layout.grid.length-1),l=Math.min(e+1,t.dungeon.layout.grid[0].length-1);for(let a=s;a<=l;a++)for(let c=i;c<=r;c++){const u=t.dungeon.layout.grid[c];if(dn(u)[a]===o)return!0}return!1},qs=(e,n,o,t)=>{t.dungeon.layout.items.forEach(s=>{switch(s.item.type){case X.MAGIC:Zn(e,n,o,s);break;case X.WEAPON:Zn(e,n,o,s)}})},Zn=(e,n,o,t)=>{const s=t.position.x,i=t.position.y;e.drawImage(n,0,48,48,48,s*o,i*o,o,o)};function jn(e){let n,o,t=e[2](e[0])+"",s,i;return{c(){n=L("p"),o=M(" "),s=M(t),this.h()},l(r){n=w(r,"P",{class:!0});var l=H(n);o=R(l," "),s=R(l,t),l.forEach(f),this.h()},h(){C(n,"class",i=_n(e[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")},m(r,l){O(r,n,l),g(n,o),g(n,s)},p(r,l){l&1&&t!==(t=r[2](r[0])+"")&&S(s,t),l&1&&i!==(i=_n(r[0].fulfilled?"fulfilled":"notFulfilled")+" svelte-1yg4fsj")&&C(n,"class",i)},d(r){r&&f(n)}}}function xs(e){let n=e[1],o,t=jn(e);return{c(){t.c(),o=de()},l(s){t.l(s),o=de()},m(s,i){t.m(s,i),O(s,o,i)},p(s,[i]){i&2&&_e(n,n=s[1])?(t.d(1),t=jn(s),t.c(),t.m(o.parentNode,o)):t.p(s,i)},i:Le,o:Le,d(s){s&&f(o),t.d(s)}}}function Xs(e,n,o){let t;Ze(e,Je,c=>o(4,t=c));let{condition:s}=n,{state:i}=n,r=!1;const l=c=>{switch(c.type){case ie.KILL_ALL:return t("content.winConditions.killAll");case ie.KILL_ALL_OF_TYPE:return t("content.winConditions.killAll",{type:c.targetMonsterType});case ie.KILL_AT_LEAST:return t("content.winConditions.killAtLeast",{minKills:c.killMinCount})+` (${i.dungeon.killCount}/${c.killMinCount})`;case ie.OPEN_DOOR:return t("content.winConditions.openDoor");case ie.REACH_CELL:return t("content.winConditions.reachCell")}};rn(()=>{a(),setInterval(a,100)});const a=()=>{i.reRender&&o(1,r=!r)};return e.$$set=c=>{"condition"in c&&o(0,s=c.condition),"state"in c&&o(3,i=c.state)},[s,r,l,i]}class Js extends He{constructor(n){super(),Ne(this,n,Xs,xs,_e,{condition:0,state:3})}}function $n(e,n,o){const t=e.slice();return t[15]=n[o],t[16]=n,t[17]=o,t}function Ss(e){let n=e[2]("content.winConditions.buttonOpen")+"",o;return{c(){o=M(n)},l(t){o=R(t,n)},m(t,s){O(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonOpen")+"")&&S(o,n)},d(t){t&&f(o)}}}function Qs(e){let n=e[2]("content.winConditions.buttonClose")+"",o;return{c(){o=M(n)},l(t){o=R(t,n)},m(t,s){O(t,o,s)},p(t,s){s&4&&n!==(n=t[2]("content.winConditions.buttonClose")+"")&&S(o,n)},d(t){t&&f(o)}}}function zn(e){let n,o,t=we(e[0].dungeon.winConditions.sort(oo)),s=[];for(let r=0;r<t.length;r+=1)s[r]=eo($n(e,t,r));const i=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){n=L("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){n=w(r,"DIV",{class:!0});var l=H(n);for(let a=0;a<s.length;a+=1)s[a].l(l);l.forEach(f),this.h()},h(){C(n,"class","conditionsDiv svelte-qsh3al")},m(r,l){O(r,n,l);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,null);o=!0},p(r,l){if(l&1){t=we(r[0].dungeon.winConditions.sort(oo));let a;for(a=0;a<t.length;a+=1){const c=$n(r,t,a);s[a]?(s[a].p(c,l),Q(s[a],1)):(s[a]=eo(c),s[a].c(),Q(s[a],1),s[a].m(n,null))}for(Ke(),a=t.length;a<s.length;a+=1)i(a);Fe()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)Q(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)z(s[l]);o=!1},d(r){r&&f(n),ln(s,r)}}}function eo(e){let n,o,t,s;function i(a){e[8](a,e[15],e[16],e[17])}function r(a){e[9](a)}let l={};return e[15]!==void 0&&(l.condition=e[15]),e[0]!==void 0&&(l.state=e[0]),n=new Js({props:l}),ge.push(()=>he(n,"condition",i)),ge.push(()=>he(n,"state",r)),{c(){Me(n.$$.fragment)},l(a){Re(n.$$.fragment,a)},m(a,c){Ce(n,a,c),s=!0},p(a,c){e=a;const u={};!o&&c&1&&(o=!0,u.condition=e[15],pe(()=>o=!1)),!t&&c&1&&(t=!0,u.state=e[0],pe(()=>t=!1)),n.$set(u)},i(a){s||(Q(n.$$.fragment,a),s=!0)},o(a){z(n.$$.fragment,a),s=!1},d(a){Te(n,a)}}}function Zs(e){let n,o,t,s,i,r,l,a,c,u,d;function b(k,D){return k[1]?Qs:Ss}let p=b(e),E=p(e),y=e[1]&&zn(e);return{c(){n=L("div"),o=L("canvas"),t=ee(),s=L("div"),i=L("div"),r=L("button"),E.c(),l=ee(),y&&y.c(),this.h()},l(k){n=w(k,"DIV",{style:!0,class:!0,id:!0});var D=H(n);o=w(D,"CANVAS",{width:!0,height:!0,id:!0}),H(o).forEach(f),t=ne(D),s=w(D,"DIV",{class:!0});var A=H(s);i=w(A,"DIV",{class:!0});var _=H(i);r=w(_,"BUTTON",{class:!0});var N=H(r);E.l(N),N.forEach(f),_.forEach(f),l=ne(A),y&&y.l(A),A.forEach(f),D.forEach(f),this.h()},h(){C(o,"width",e[3]*40),C(o,"height",e[3]*30),C(o,"id","gameBoard"),C(r,"class","hideConditionsButton svelte-qsh3al"),C(i,"class","buttonDiv svelte-qsh3al"),C(s,"class",a="winConditions "+(e[1]?"":"conditionsHidden")+" svelte-qsh3al"),C(n,"style",e[5]()),C(n,"class","dungeon svelte-qsh3al"),C(n,"id","gameBoardContainer")},m(k,D){O(k,n,D),g(n,o),g(n,t),g(n,s),g(s,i),g(i,r),E.m(r,null),g(s,l),y&&y.m(s,null),c=!0,u||(d=[Oe(o,"click",e[4]),Oe(r,"click",e[7])],u=!0)},p(k,[D]){p===(p=b(k))&&E?E.p(k,D):(E.d(1),E=p(k),E&&(E.c(),E.m(r,null))),k[1]?y?(y.p(k,D),D&2&&Q(y,1)):(y=zn(k),y.c(),Q(y,1),y.m(s,null)):y&&(Ke(),z(y,1,1,()=>{y=null}),Fe()),(!c||D&2&&a!==(a="winConditions "+(k[1]?"":"conditionsHidden")+" svelte-qsh3al"))&&C(s,"class",a)},i(k){c||(Q(y),c=!0)},o(k){z(y),c=!1},d(k){k&&f(n),E.d(),y&&y.d(),u=!1,wn(d)}}}const no=10,oo=(e,n)=>e.fulfilled===n.fulfilled?0:e.fulfilled?1:-1;function js(e,n,o){var A;let t;Ze(e,Je,_=>o(2,t=_));let{state:s}=n,{debugMode:i}=n,r=!0,l,a;const c=(s==null?void 0:s.settings.cellSize)??48;let u=0,d=0;a=window.innerHeight,l=((A=document.getElementById("footer"))==null?void 0:A.offsetHeight)??0,rn(()=>{const _=new Image;_.src=ps;const N=new Image;N.src=hs,setInterval(()=>b(_,N),10)});const b=(_,N)=>{if(!s||!document)return;const V=document.getElementById("gameBoard"),P=V.getContext("2d");s.reRender&&(d++,u++,P.clearRect(0,0,V.width,V.height),P.fillStyle="black",P.fillRect(0,0,V.width,V.height),Hs(P,_,c,s,i),Ns(P,_,c,s,i),qs(P,_,c,s),ws(P,_,c,s,i),Is(P,N,c,s,i),_s(P,N,c,s,i),i&&(P.fillStyle="white",P.font="8px Arial",P.fillText(`Re-renders: ${u}`,2,10),P.fillText(`FPS: ${d/(no/1e3)}`,2,20)),setTimeout(()=>{o(0,s.reRender=!1,s),d=0},no))},p=_=>{Wt(_,c,s)},E=()=>`max-height: ${a-l-20}px; max-width: ${c*40}`,y=()=>o(1,r=!r);function k(_,N,V,P){V[P]=_,o(0,s)}function D(_){s=_,o(0,s)}return e.$$set=_=>{"state"in _&&o(0,s=_.state),"debugMode"in _&&o(6,i=_.debugMode)},[s,r,t,c,p,E,i,y,k,D]}class $s extends He{constructor(n){super(),Ne(this,n,js,Zs,_e,{state:0,debugMode:6})}}function zs(e){let n,o=e[2]("content.inventory.uses")+"",t;return{c(){n=L("button"),t=M(o),this.h()},l(s){n=w(s,"BUTTON",{class:!0});var i=H(n);t=R(i,o),i.forEach(f),this.h()},h(){n.disabled=!0,C(n,"class","svelte-gca2x5")},m(s,i){O(s,n,i),g(n,t)},p(s,i){i&4&&o!==(o=s[2]("content.inventory.uses")+"")&&S(t,o)},d(s){s&&f(n)}}}function ei(e){let n,o=e[2]("content.inventory.use")+"",t,s,i;return{c(){n=L("button"),t=M(o),this.h()},l(r){n=w(r,"BUTTON",{class:!0});var l=H(n);t=R(l,o),l.forEach(f),this.h()},h(){C(n,"class","svelte-gca2x5")},m(r,l){O(r,n,l),g(n,t),s||(i=Oe(n,"click",e[3]),s=!0)},p(r,l){l&4&&o!==(o=r[2]("content.inventory.use")+"")&&S(t,o)},d(r){r&&f(n),s=!1,i()}}}function ni(e){var D;let n,o="",t,s,i,r=e[2](e[0].name)+"",l,a,c,u=e[2]((D=e[0].properties)==null?void 0:D[Yn])+"",d,b,p;function E(A,_){var N,V,P;if((N=A[0].properties)!=null&&N[An]&&!((V=A[0].properties)!=null&&V[Ge]))return ei;if((P=A[0].properties)!=null&&P[An])return zs}let y=E(e),k=y&&y(e);return{c(){n=L("div"),n.innerHTML=o,t=ee(),s=L("div"),i=L("b"),l=M(r),a=ee(),c=L("span"),d=M(u),b=ee(),p=L("div"),k&&k.c(),this.h()},l(A){n=w(A,"DIV",{class:!0,"data-svelte-h":!0}),ko(n)!=="svelte-pn8o3r"&&(n.innerHTML=o),t=ne(A),s=w(A,"DIV",{class:!0});var _=H(s);i=w(_,"B",{class:!0});var N=H(i);l=R(N,r),N.forEach(f),a=ne(_),c=w(_,"SPAN",{class:!0});var V=H(c);d=R(V,u),V.forEach(f),_.forEach(f),b=ne(A),p=w(A,"DIV",{class:!0});var P=H(p);k&&k.l(P),P.forEach(f),this.h()},h(){C(n,"class","item item-icon svelte-gca2x5"),C(i,"class","svelte-gca2x5"),C(c,"class","svelte-gca2x5"),C(s,"class","item item-description bottom-border svelte-gca2x5"),C(p,"class","item item-action svelte-gca2x5")},m(A,_){O(A,n,_),O(A,t,_),O(A,s,_),g(s,i),g(i,l),g(s,a),g(s,c),g(c,d),O(A,b,_),O(A,p,_),k&&k.m(p,null)},p(A,[_]){var N;_&5&&r!==(r=A[2](A[0].name)+"")&&S(l,r),_&5&&u!==(u=A[2]((N=A[0].properties)==null?void 0:N[Yn])+"")&&S(d,u),y===(y=E(A))&&k?k.p(A,_):(k&&k.d(1),k=y&&y(A),k&&(k.c(),k.m(p,null)))},i:Le,o:Le,d(A){A&&(f(n),f(t),f(s),f(b),f(p)),k&&k.d()}}}function oi(e,n,o){let t;Ze(e,Je,l=>o(2,t=l));let{item:s}=n,{state:i}=n;const r=()=>Ht(i,s);return e.$$set=l=>{"item"in l&&o(0,s=l.item),"state"in l&&o(1,i=l.state)},[s,i,t,r]}class ti extends He{constructor(n){super(),Ne(this,n,oi,ni,_e,{item:0,state:1})}}function to(e,n,o){const t=e.slice();return t[6]=n[o],t[7]=n,t[8]=o,t}function so(e){let n,o,t;function s(r){e[4](r,e[6],e[7],e[8])}let i={state:e[1]};return e[6]!==void 0&&(i.item=e[6]),n=new ti({props:i}),ge.push(()=>he(n,"item",s)),{c(){Me(n.$$.fragment)},l(r){Re(n.$$.fragment,r)},m(r,l){Ce(n,r,l),t=!0},p(r,l){e=r;const a={};l&2&&(a.state=e[1]),!o&&l&1&&(o=!0,a.item=e[6],pe(()=>o=!1)),n.$set(a)},i(r){t||(Q(n.$$.fragment,r),t=!0)},o(r){z(n.$$.fragment,r),t=!1},d(r){Te(n,r)}}}function io(e){let n,o,t=we(e[0]),s=[];for(let r=0;r<t.length;r+=1)s[r]=so(to(e,t,r));const i=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);n=de()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);O(r,n,l),o=!0},p(r,l){if(l&3){t=we(r[0]);let a;for(a=0;a<t.length;a+=1){const c=to(r,t,a);s[a]?(s[a].p(c,l),Q(s[a],1)):(s[a]=so(c),s[a].c(),Q(s[a],1),s[a].m(n.parentNode,n))}for(Ke(),a=t.length;a<s.length;a+=1)i(a);Fe()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)Q(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)z(s[l]);o=!1},d(r){r&&f(n),ln(s,r)}}}function si(e){var c;let n,o=e[3]("content.inventory.label",{hero:e[3]((c=e[1].currentActor)==null?void 0:c.name)})+"",t,s,i,r=e[2],l,a=io(e);return{c(){n=L("h4"),t=M(o),s=ee(),i=L("div"),a.c(),this.h()},l(u){n=w(u,"H4",{class:!0});var d=H(n);t=R(d,o),d.forEach(f),s=ne(u),i=w(u,"DIV",{class:!0});var b=H(i);a.l(b),b.forEach(f),this.h()},h(){C(n,"class","svelte-1sdwrze"),C(i,"class","inventory svelte-1sdwrze")},m(u,d){O(u,n,d),g(n,t),O(u,s,d),O(u,i,d),a.m(i,null),l=!0},p(u,[d]){var b;(!l||d&10)&&o!==(o=u[3]("content.inventory.label",{hero:u[3]((b=u[1].currentActor)==null?void 0:b.name)})+"")&&S(t,o),d&4&&_e(r,r=u[2])?(Ke(),z(a,1,1,Le),Fe(),a=io(u),a.c(),Q(a,1),a.m(i,null)):a.p(u,d)},i(u){l||(Q(a),l=!0)},o(u){z(a),l=!1},d(u){u&&(f(n),f(s),f(i)),a.d(u)}}}function ii(e,n,o){let t;Ze(e,Je,c=>o(3,t=c));let{inventory:s}=n,{state:i}=n,r=!1;rn(()=>{l(),setInterval(l,100)});const l=()=>{o(2,r=!r)};function a(c,u,d,b){d[b]=c,o(0,s)}return e.$$set=c=>{"inventory"in c&&o(0,s=c.inventory),"state"in c&&o(1,i=c.state)},[s,i,r,t,a]}class ri extends He{constructor(n){super(),Ne(this,n,ii,si,_e,{inventory:0,state:1})}}function ro(e){let n;return{c(){n=M("*")},l(o){n=R(o,"*")},m(o,t){O(o,n,t)},d(o){o&&f(n)}}}function li(e){let n;return{c(){n=M("")},l(o){n=R(o,"")},m(o,t){O(o,n,t)},d(o){o&&f(n)}}}function ai(e){let n;return{c(){n=M("")},l(o){n=R(o,"")},m(o,t){O(o,n,t)},d(o){o&&f(n)}}}function lo(e){let n,o,t,s,i;function r(a){e[8](a)}let l={state:e[1]};return e[0].inventory!==void 0&&(l.inventory=e[0].inventory),o=new ri({props:l}),ge.push(()=>he(o,"inventory",r)),{c(){n=L("div"),Me(o.$$.fragment),this.h()},l(a){n=w(a,"DIV",{class:!0,id:!0,style:!0});var c=H(n);Re(o.$$.fragment,c),c.forEach(f),this.h()},h(){C(n,"class","hero-inventory svelte-11gs3s7"),C(n,"id",s=e[0].name+"s-inventory"),tn(n,"display",e[2])},m(a,c){O(a,n,c),Ce(o,n,null),i=!0},p(a,c){const u={};c&2&&(u.state=a[1]),!t&&c&1&&(t=!0,u.inventory=a[0].inventory,pe(()=>t=!1)),o.$set(u),(!i||c&1&&s!==(s=a[0].name+"s-inventory"))&&C(n,"id",s),(!i||c&4)&&tn(n,"display",a[2])},i(a){i||(Q(o.$$.fragment,a),i=!0)},o(a){z(o.$$.fragment,a),i=!1},d(a){a&&f(n),Te(o)}}}function ao(e){let n,o=e[3]("content.hero.actions")+"",t,s,i=e[0].actions+"",r,l,a,c=e[3]("content.hero.moves")+"",u,d,b=e[0].movement+"",p,E,y,k=e[3]("content.hero.equipment")+"",D,A,_,N,V,P,re=e[3](e[0].weapon.name)+"",ue,T,Z=e[0].weapon.dice+"",le,ae,me,oe,F,Ie,$,We;function ye(W,x){return W[0].armour?ui:ci}let j=ye(e),v=j(e);function B(W,x){return W[0].shield?di:fi}let G=B(e),U=G(e);return{c(){n=L("span"),t=M(o),s=M(": "),r=M(i),l=ee(),a=L("span"),u=M(c),d=M(": "),p=M(b),E=ee(),y=L("span"),D=M(k),A=M(":"),_=ee(),N=L("div"),V=L("span"),P=M(" "),ue=M(re),T=M(" ("),le=M(Z),ae=M(")"),me=ee(),oe=L("span"),F=M(`
        `),v.c(),Ie=ee(),$=L("span"),We=M(`
        `),U.c(),this.h()},l(W){n=w(W,"SPAN",{class:!0});var x=H(n);t=R(x,o),s=R(x,": "),r=R(x,i),x.forEach(f),l=ne(W),a=w(W,"SPAN",{class:!0});var Pe=H(a);u=R(Pe,c),d=R(Pe,": "),p=R(Pe,b),Pe.forEach(f),E=ne(W),y=w(W,"SPAN",{class:!0});var je=H(y);D=R(je,k),A=R(je,":"),je.forEach(f),_=ne(W),N=w(W,"DIV",{class:!0});var Be=H(N);V=w(Be,"SPAN",{class:!0});var De=H(V);P=R(De," "),ue=R(De,re),T=R(De," ("),le=R(De,Z),ae=R(De,")"),De.forEach(f),me=ne(Be),oe=w(Be,"SPAN",{class:!0});var Ve=H(oe);F=R(Ve,`
        `),v.l(Ve),Ve.forEach(f),Ie=ne(Be),$=w(Be,"SPAN",{class:!0});var In=H($);We=R(In,`
        `),U.l(In),In.forEach(f),Be.forEach(f),this.h()},h(){C(n,"class","svelte-11gs3s7"),C(a,"class","svelte-11gs3s7"),C(y,"class","svelte-11gs3s7"),C(V,"class","svelte-11gs3s7"),C(oe,"class","svelte-11gs3s7"),C($,"class","svelte-11gs3s7"),C(N,"class","equipment svelte-11gs3s7")},m(W,x){O(W,n,x),g(n,t),g(n,s),g(n,r),O(W,l,x),O(W,a,x),g(a,u),g(a,d),g(a,p),O(W,E,x),O(W,y,x),g(y,D),g(y,A),O(W,_,x),O(W,N,x),g(N,V),g(V,P),g(V,ue),g(V,T),g(V,le),g(V,ae),g(N,me),g(N,oe),g(oe,F),v.m(oe,null),g(N,Ie),g(N,$),g($,We),U.m($,null)},p(W,x){x&8&&o!==(o=W[3]("content.hero.actions")+"")&&S(t,o),x&1&&i!==(i=W[0].actions+"")&&S(r,i),x&8&&c!==(c=W[3]("content.hero.moves")+"")&&S(u,c),x&1&&b!==(b=W[0].movement+"")&&S(p,b),x&8&&k!==(k=W[3]("content.hero.equipment")+"")&&S(D,k),x&9&&re!==(re=W[3](W[0].weapon.name)+"")&&S(ue,re),x&1&&Z!==(Z=W[0].weapon.dice+"")&&S(le,Z),j===(j=ye(W))&&v?v.p(W,x):(v.d(1),v=j(W),v&&(v.c(),v.m(oe,null))),G===(G=B(W))&&U?U.p(W,x):(U.d(1),U=G(W),U&&(U.c(),U.m($,null)))},d(W){W&&(f(n),f(l),f(a),f(E),f(y),f(_),f(N)),v.d(),U.d()}}}function ci(e){let n=e[3]("content.hero.none")+"",o,t;return{c(){o=M(n),t=M(" (0)")},l(s){o=R(s,n),t=R(s," (0)")},m(s,i){O(s,o,i),O(s,t,i)},p(s,i){i&8&&n!==(n=s[3]("content.hero.none")+"")&&S(o,n)},d(s){s&&(f(o),f(t))}}}function ui(e){let n=e[3](e[0].armour.name)+"",o,t,s=e[0].armour.defense+"",i,r;return{c(){o=M(n),t=M(" ("),i=M(s),r=M(")")},l(l){o=R(l,n),t=R(l," ("),i=R(l,s),r=R(l,")")},m(l,a){O(l,o,a),O(l,t,a),O(l,i,a),O(l,r,a)},p(l,a){a&9&&n!==(n=l[3](l[0].armour.name)+"")&&S(o,n),a&1&&s!==(s=l[0].armour.defense+"")&&S(i,s)},d(l){l&&(f(o),f(t),f(i),f(r))}}}function fi(e){let n=e[3]("content.hero.none")+"",o,t;return{c(){o=M(n),t=M(" (0)")},l(s){o=R(s,n),t=R(s," (0)")},m(s,i){O(s,o,i),O(s,t,i)},p(s,i){i&8&&n!==(n=s[3]("content.hero.none")+"")&&S(o,n)},d(s){s&&(f(o),f(t))}}}function di(e){let n=e[3](e[0].shield.name)+"",o,t,s=e[0].shield.dice+"",i,r;return{c(){o=M(n),t=M(" ("),i=M(s),r=M(")")},l(l){o=R(l,n),t=R(l," ("),i=R(l,s),r=R(l,")")},m(l,a){O(l,o,a),O(l,t,a),O(l,i,a),O(l,r,a)},p(l,a){a&9&&n!==(n=l[3](l[0].shield.name)+"")&&S(o,n),a&1&&s!==(s=l[0].shield.dice+"")&&S(i,s)},d(l){l&&(f(o),f(t),f(i),f(r))}}}function co(e){let n,o,t,s=e[3](e[0].name)+"",i,r,l=e[3]("content.level."+e[0].level)+"",a,c,u=e[0].experience+"",d,b,p,E,y,k,D,A="",_,N,V,P,re,ue=e[3]("content.hero.hp")+"",T,Z,le=e[0].health+"",ae,me,oe,F,Ie,$=e[1].targetActor===e[0]&&ro();function We(G,U){return G[1].targetActor!==G[0]?ai:li}let ye=We(e),j=ye(e),v=e[1].currentActor===e[0]&&lo(e),B=e[1].currentActor===e[0]&&ao(e);return{c(){n=L("div"),o=L("div"),t=L("b"),$&&$.c(),i=M(s),r=M(` -
    `),a=M(l),c=M(" ("),d=M(u),b=M(")"),p=ee(),E=L("div"),y=L("button"),j.c(),k=ee(),D=L("button"),D.textContent=A,_=ee(),N=L("div"),v&&v.c(),V=ee(),P=L("div"),re=L("span"),T=M(ue),Z=M(": "),ae=M(le),me=ee(),B&&B.c(),this.h()},l(G){n=w(G,"DIV",{class:!0,style:!0});var U=H(n);o=w(U,"DIV",{class:!0});var W=H(o);t=w(W,"B",{class:!0});var x=H(t);$&&$.l(x),i=R(x,s),r=R(x,` -
    `),a=R(x,l),c=R(x," ("),d=R(x,u),b=R(x,")"),x.forEach(f),W.forEach(f),p=ne(U),E=w(U,"DIV",{});var Pe=H(E);y=w(Pe,"BUTTON",{title:!0});var je=H(y);j.l(je),je.forEach(f),k=ne(Pe),D=w(Pe,"BUTTON",{title:!0,"data-svelte-h":!0}),ko(D)!=="svelte-qrm7uk"&&(D.textContent=A),Pe.forEach(f),_=ne(U),N=w(U,"DIV",{class:!0});var Be=H(N);v&&v.l(Be),Be.forEach(f),V=ne(U),P=w(U,"DIV",{});var De=H(P);re=w(De,"SPAN",{class:!0});var Ve=H(re);T=R(Ve,ue),Z=R(Ve,": "),ae=R(Ve,le),Ve.forEach(f),me=ne(De),B&&B.l(De),De.forEach(f),U.forEach(f),this.h()},h(){C(t,"class","svelte-11gs3s7"),C(o,"class","hero-title svelte-11gs3s7"),C(y,"title","select target hero"),C(D,"title","Open inventory"),C(N,"class","hero-information svelte-11gs3s7"),C(re,"class","svelte-11gs3s7"),C(n,"class","hero-card svelte-11gs3s7"),tn(n,"background-color",e[0].colour)},m(G,U){O(G,n,U),g(n,o),g(o,t),$&&$.m(t,null),g(t,i),g(t,r),g(t,a),g(t,c),g(t,d),g(t,b),g(n,p),g(n,E),g(E,y),j.m(y,null),g(E,k),g(E,D),g(n,_),g(n,N),v&&v.m(N,null),g(n,V),g(n,P),g(P,re),g(re,T),g(re,Z),g(re,ae),g(P,me),B&&B.m(P,null),oe=!0,F||(Ie=[Oe(y,"click",e[6]),Oe(D,"click",e[7])],F=!0)},p(G,U){G[1].targetActor===G[0]?$||($=ro(),$.c(),$.m(t,i)):$&&($.d(1),$=null),(!oe||U&9)&&s!==(s=G[3](G[0].name)+"")&&S(i,s),(!oe||U&9)&&l!==(l=G[3]("content.level."+G[0].level)+"")&&S(a,l),(!oe||U&1)&&u!==(u=G[0].experience+"")&&S(d,u),ye!==(ye=We(G))&&(j.d(1),j=ye(G),j&&(j.c(),j.m(y,null))),G[1].currentActor===G[0]?v?(v.p(G,U),U&3&&Q(v,1)):(v=lo(G),v.c(),Q(v,1),v.m(N,null)):v&&(Ke(),z(v,1,1,()=>{v=null}),Fe()),(!oe||U&8)&&ue!==(ue=G[3]("content.hero.hp")+"")&&S(T,ue),(!oe||U&1)&&le!==(le=G[0].health+"")&&S(ae,le),G[1].currentActor===G[0]?B?B.p(G,U):(B=ao(G),B.c(),B.m(P,null)):B&&(B.d(1),B=null),(!oe||U&1)&&tn(n,"background-color",G[0].colour)},i(G){oe||(Q(v),oe=!0)},o(G){z(v),oe=!1},d(G){G&&f(n),$&&$.d(),j.d(),v&&v.d(),B&&B.d(),F=!1,wn(Ie)}}}function mi(e){let n=e[1].targetActor,o,t,s=co(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),O(i,o,r),t=!0},p(i,[r]){r&2&&_e(n,n=i[1].targetActor)?(Ke(),z(s,1,1,Le),Fe(),s=co(i),s.c(),Q(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(Q(s),t=!0)},o(i){z(s),t=!1},d(i){i&&f(o),s.d(i)}}}function gi(e,n,o){let t;Ze(e,Je,p=>o(3,t=p));let{hero:s}=n,{state:i}=n,r="none";const l=p=>{i.targetActor&&p===i.targetActor?o(1,i.targetActor=void 0,i):o(1,i.targetActor=p,i)},a=p=>{const E=document.getElementById(p.name+"s-inventory");E&&(p.isInventoryOpen=!p.isInventoryOpen,c(),E.style.display=r)},c=()=>{s.isInventoryOpen?o(2,r="inline-block"):o(2,r="none")};c();const u=()=>l(s),d=()=>a(s);function b(p){e.$$.not_equal(s.inventory,p)&&(s.inventory=p,o(0,s))}return e.$$set=p=>{"hero"in p&&o(0,s=p.hero),"state"in p&&o(1,i=p.state)},[s,i,r,t,l,a,u,d,b]}class ot extends He{constructor(n){super(),Ne(this,n,gi,mi,_e,{hero:0,state:1})}}function uo(e,n,o){const t=e.slice();return t[3]=n[o],t[5]=o,t}function pi(e){let n,o,t,s;return o=new ot({props:{hero:e[3],state:e[0]}}),{c(){n=L("div"),Me(o.$$.fragment),t=ee(),this.h()},l(i){n=w(i,"DIV",{class:!0});var r=H(n);Re(o.$$.fragment,r),t=ne(r),r.forEach(f),this.h()},h(){C(n,"class","not-current-actor svelte-gyascg")},m(i,r){O(i,n,r),Ce(o,n,null),g(n,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),o.$set(l)},i(i){s||(Q(o.$$.fragment,i),s=!0)},o(i){z(o.$$.fragment,i),s=!1},d(i){i&&f(n),Te(o)}}}function hi(e){let n,o,t,s;return o=new ot({props:{hero:e[3],state:e[0]}}),{c(){n=L("div"),Me(o.$$.fragment),t=ee(),this.h()},l(i){n=w(i,"DIV",{class:!0});var r=H(n);Re(o.$$.fragment,r),t=ne(r),r.forEach(f),this.h()},h(){C(n,"class","is-current-actor svelte-gyascg")},m(i,r){O(i,n,r),Ce(o,n,null),g(n,t),s=!0},p(i,r){const l={};r&1&&(l.hero=i[3]),r&1&&(l.state=i[0]),o.$set(l)},i(i){s||(Q(o.$$.fragment,i),s=!0)},o(i){z(o.$$.fragment,i),s=!1},d(i){i&&f(n),Te(o)}}}function fo(e){let n,o,t,s;const i=[hi,pi],r=[];function l(a,c){return a[3]===a[0].currentActor?0:1}return n=l(e),o=r[n]=i[n](e),{c(){o.c(),t=de()},l(a){o.l(a),t=de()},m(a,c){r[n].m(a,c),O(a,t,c),s=!0},p(a,c){let u=n;n=l(a),n===u?r[n].p(a,c):(Ke(),z(r[u],1,1,()=>{r[u]=null}),Fe(),o=r[n],o?o.p(a,c):(o=r[n]=i[n](a),o.c()),Q(o,1),o.m(t.parentNode,t))},i(a){s||(Q(o),s=!0)},o(a){z(o),s=!1},d(a){a&&f(t),r[n].d(a)}}}function mo(e){let n=e[1],o,t,s=fo(e);return{c(){s.c(),o=de()},l(i){s.l(i),o=de()},m(i,r){s.m(i,r),O(i,o,r),t=!0},p(i,r){r&2&&_e(n,n=i[1])?(Ke(),z(s,1,1,Le),Fe(),s=fo(i),s.c(),Q(s,1),s.m(o.parentNode,o)):s.p(i,r)},i(i){t||(Q(s),t=!0)},o(i){z(s),t=!1},d(i){i&&f(o),s.d(i)}}}function _i(e){let n,o,t=we(q(e[0])),s=[];for(let r=0;r<t.length;r+=1)s[r]=mo(uo(e,t,r));const i=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();n=de()},l(r){for(let l=0;l<s.length;l+=1)s[l].l(r);n=de()},m(r,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,l);O(r,n,l),o=!0},p(r,[l]){if(l&3){t=we(q(r[0]));let a;for(a=0;a<t.length;a+=1){const c=uo(r,t,a);s[a]?(s[a].p(c,l),Q(s[a],1)):(s[a]=mo(c),s[a].c(),Q(s[a],1),s[a].m(n.parentNode,n))}for(Ke(),a=t.length;a<s.length;a+=1)i(a);Fe()}},i(r){if(!o){for(let l=0;l<t.length;l+=1)Q(s[l]);o=!0}},o(r){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)z(s[l]);o=!1},d(r){r&&f(n),ln(s,r)}}}function vi(e,n,o){let{state:t}=n,s=!1;rn(()=>{i(),setInterval(i,100)});const i=()=>{t.reRender&&o(1,s=!s)};return e.$$set=r=>{"state"in r&&o(0,t=r.state)},[t,s]}class yi extends He{constructor(n){super(),Ne(this,n,vi,_i,_e,{state:0})}}function go(e,n,o){const t=e.slice();return t[5]=n[o],t[7]=o,t}function Ai(e){let n,o,t=e[2](e[5])+"",s;return{c(){n=L("p"),o=M(">"),s=M(t),this.h()},l(i){n=w(i,"P",{class:!0});var r=H(n);o=R(r,">"),s=R(r,t),r.forEach(f),this.h()},h(){C(n,"class","svelte-grgnnk")},m(i,r){O(i,n,r),g(n,o),g(n,s)},p(i,r){r&1&&t!==(t=i[2](i[5])+"")&&S(s,t)},d(i){i&&f(n)}}}function po(e){let n,o=e[7]<25&&Ai(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),O(t,n,s)},p(t,s){t[7]<25&&o.p(t,s)},d(t){t&&f(n),o&&o.d(t)}}}function ho(e){let n,o=we(e[0].actionLog),t=[];for(let s=0;s<o.length;s+=1)t[s]=po(go(e,o,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();n=de()},l(s){for(let i=0;i<t.length;i+=1)t[i].l(s);n=de()},m(s,i){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(s,i);O(s,n,i)},p(s,i){if(i&5){o=we(s[0].actionLog);let r;for(r=0;r<o.length;r+=1){const l=go(s,o,r);t[r]?t[r].p(l,i):(t[r]=po(l),t[r].c(),t[r].m(n.parentNode,n))}for(;r<t.length;r+=1)t[r].d(1);t.length=o.length}},d(s){s&&f(n),ln(t,s)}}}function bi(e){let n,o=e[1],t=ho(e);return{c(){n=L("div"),t.c(),this.h()},l(s){n=w(s,"DIV",{class:!0});var i=H(n);t.l(i),i.forEach(f),this.h()},h(){C(n,"class","log svelte-grgnnk")},m(s,i){O(s,n,i),t.m(n,null)},p(s,[i]){i&2&&_e(o,o=s[1])?(t.d(1),t=ho(s),t.c(),t.m(n,null)):t.p(s,i)},i:Le,o:Le,d(s){s&&f(n),t.d(s)}}}function ki(e,n,o){let t;Ze(e,Je,a=>o(3,t=a));let{state:s}=n,i=!1;rn(()=>{r(),setInterval(r,500)});const r=()=>{s.reRender&&o(1,i=!i)},l=a=>t(a.key,a.properties);return e.$$set=a=>{"state"in a&&o(0,s=a.state)},[s,i,l]}class Ei extends He{constructor(n){super(),Ne(this,n,ki,bi,_e,{state:0})}}const Ii={name:"campaign.iceDragon.testingGrounds.name",beaten:!0,winConditions:[{type:ie.KILL_ALL,fulfilled:!0},{type:ie.OPEN_DOOR,targetCell:{x:2,y:10},fulfilled:!1},{type:ie.KILL_ALL_OF_TYPE,targetMonsterType:K.ORCH,fulfilled:!1},{type:ie.REACH_CELL,targetCell:{x:2,y:10},fulfilled:!1},{type:ie.KILL_AT_LEAST,killMinCount:5,fulfilled:!1}],nextDungeon:Xo,startingPositions:[{x:2,y:9},{x:1,y:8},{x:1,y:9},{x:1,y:10}],discoveredRooms:["A","D"],layout:{grid:["###########","#CCCCCCCCC#","#CCCCCCCCC#","#CCCCCCCCC#","#######E###","  #####E#  ","  #FFFFE## ","###F###AA# ","#AAAAAAAA#D","#AAAAAAAA#D","#AAAAAAAA#D","##G####### "," #G#       "," #G#       "," ###       "],pillars:[{x:8,y:3},{x:7,y:9}],pits:[{x:6,y:3},{x:6,y:2}],corridors:["G","E","F"],doors:[at(I.UP,3,8,1),yn(I.LEFT,7,6),lt(I.UP,7,7,1),J(I.UP,7,4),qe(I.DOWN,2,10)],monsters:[te(K.ORCH,Y.Green,1,1),te(K.ORCH,Y.Red,4,9),te(K.TROLL,Y.Green,5,1)],secrets:[Ee(se.TRAP_DOOR,"campaign.iceDragon.testingGrounds.secrets.trapDoor",3,9),Ee(se.EQUIPMENT,"campaign.iceDragon.randomEquipment",1,10),sn(se.EQUIPMENT,5,10,vn[2])],notes:[],items:[{item:Ae[0],position:{x:3,y:10}},{item:Ae[1],position:{x:4,y:10}},{item:Ae[6],position:{x:5,y:10}},{item:Ae[2],position:{x:6,y:10}},{item:Ae[3],position:{x:7,y:10}},{item:Ae[4],position:{x:8,y:10}}]},killCount:0};function _o(e,n,o){const t=e.slice();return t[5]=n[o],t}function vo(e){let n,o=e[5].label+"",t,s,i;return{c(){n=L("button"),t=M(o),this.h()},l(r){n=w(r,"BUTTON",{class:!0});var l=H(n);t=R(l,o),l.forEach(f),this.h()},h(){C(n,"class","menuButton svelte-12a9xod")},m(r,l){O(r,n,l),g(n,t),s||(i=Oe(n,"click",function(){tt(e[5].onClick)&&e[5].onClick.apply(this,arguments)}),s=!0)},p(r,l){e=r,l&4&&o!==(o=e[5].label+"")&&S(t,o)},d(r){r&&f(n),s=!1,i()}}}function yo(e){let n,o=(e[5].debugModeOnly&&e[1]||!e[5].debugModeOnly)&&vo(e);return{c(){o&&o.c(),n=de()},l(t){o&&o.l(t),n=de()},m(t,s){o&&o.m(t,s),O(t,n,s)},p(t,s){t[5].debugModeOnly&&t[1]||!t[5].debugModeOnly?o?o.p(t,s):(o=vo(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(t){t&&f(n),o&&o.d(t)}}}function Di(e){let n,o,t,s,i,r,l,a,c=we(e[2]),u=[];for(let d=0;d<c.length;d+=1)u[d]=yo(_o(e,c,d));return{c(){n=L("div"),o=L("span"),t=M(e[0]),s=ee();for(let d=0;d<u.length;d+=1)u[d].c();i=ee(),r=L("span"),l=M(e[3]),this.h()},l(d){n=w(d,"DIV",{class:!0});var b=H(n);o=w(b,"SPAN",{class:!0});var p=H(o);t=R(p,e[0]),p.forEach(f),s=ne(b);for(let y=0;y<u.length;y+=1)u[y].l(b);i=ne(b),r=w(b,"SPAN",{class:!0});var E=H(r);l=R(E,e[3]),E.forEach(f),b.forEach(f),this.h()},h(){C(o,"class","header svelte-12a9xod"),C(r,"class","footer svelte-12a9xod"),C(n,"class",a=_n(e[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")},m(d,b){O(d,n,b),g(n,o),g(o,t),g(n,s);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(n,null);g(n,i),g(n,r),g(r,l)},p(d,[b]){if(b&1&&S(t,d[0]),b&6){c=we(d[2]);let p;for(p=0;p<c.length;p+=1){const E=_o(d,c,p);u[p]?u[p].p(E,b):(u[p]=yo(E),u[p].c(),u[p].m(n,i))}for(;p<u.length;p+=1)u[p].d(1);u.length=c.length}b&8&&S(l,d[3]),b&16&&a!==(a=_n(d[4]?"menuOpen":"menuClosed")+" svelte-12a9xod")&&C(n,"class",a)},i:Le,o:Le,d(d){d&&f(n),ln(u,d)}}}function Oi(e,n,o){let{header:t}=n,{debugMode:s}=n,{buttons:i}=n,{footer:r}=n,{showMenu:l}=n;return e.$$set=a=>{"header"in a&&o(0,t=a.header),"debugMode"in a&&o(1,s=a.debugMode),"buttons"in a&&o(2,i=a.buttons),"footer"in a&&o(3,r=a.footer),"showMenu"in a&&o(4,l=a.showMenu)},[t,s,i,r,l]}class Ao extends He{constructor(n){super(),Ne(this,n,Oi,Di,_e,{header:0,debugMode:1,buttons:2,footer:3,showMenu:4})}}function bo(e){let n,o=e[7]("content.actions.nextLevel")+"",t,s,i;return{c(){n=L("button"),t=M(o),this.h()},l(r){n=w(r,"BUTTON",{class:!0});var l=H(n);t=R(l,o),l.forEach(f),this.h()},h(){C(n,"class","menuButton svelte-1v33x5s")},m(r,l){O(r,n,l),g(n,t),s||(i=Oe(n,"click",e[18]),s=!0)},p(r,l){l&128&&o!==(o=r[7]("content.actions.nextLevel")+"")&&S(t,o)},d(r){r&&f(n),s=!1,i()}}}function Mi(e){let n,o,t,s,i,r,l,a,c,u,d,b,p=e[7]("content.menu.menuButton")+"",E,y,k,D,A=e[7]("content.actions.next")+"",_,N,V,P=e[7]("content.actions.action")+"",re,ue,T,Z,le;function ae(v){e[10](v)}function me(v){e[11](v)}function oe(v){e[12](v)}let F={header:e[7]("content.menu.mainMenu.header"),footer:`${e[2].date} - ${e[2].hash}`};e[1]!==void 0&&(F.debugMode=e[1]),e[3]!==void 0&&(F.showMenu=e[3]),e[6]!==void 0&&(F.buttons=e[6]),o=new Ao({props:F}),ge.push(()=>he(o,"debugMode",ae)),ge.push(()=>he(o,"showMenu",me)),ge.push(()=>he(o,"buttons",oe));function Ie(v){e[13](v)}function $(v){e[14](v)}function We(v){e[15](v)}let ye={header:e[7]("content.menu.loadGame.header"),footer:""};e[1]!==void 0&&(ye.debugMode=e[1]),e[4]!==void 0&&(ye.showMenu=e[4]),e[5]!==void 0&&(ye.buttons=e[5]),l=new Ao({props:ye}),ge.push(()=>he(l,"debugMode",Ie)),ge.push(()=>he(l,"showMenu",$)),ge.push(()=>he(l,"buttons",We));let j=e[0].dungeon.beaten&&bo(e);return{c(){n=L("div"),Me(o.$$.fragment),r=ee(),Me(l.$$.fragment),d=ee(),b=L("button"),E=M(p),y=ee(),k=L("div"),D=L("button"),_=M(A),N=ee(),V=L("button"),re=M(P),ue=ee(),j&&j.c(),this.h()},l(v){n=w(v,"DIV",{class:!0});var B=H(n);Re(o.$$.fragment,B),r=ne(B),Re(l.$$.fragment,B),d=ne(B),b=w(B,"BUTTON",{class:!0});var G=H(b);E=R(G,p),G.forEach(f),y=ne(B),k=w(B,"DIV",{});var U=H(k);D=w(U,"BUTTON",{class:!0});var W=H(D);_=R(W,A),W.forEach(f),N=ne(U),V=w(U,"BUTTON",{class:!0,style:!0});var x=H(V);re=R(x,P),x.forEach(f),U.forEach(f),ue=ne(B),j&&j.l(B),B.forEach(f),this.h()},h(){C(b,"class","menuButton svelte-1v33x5s"),C(D,"class","menuButton twoColButton svelte-1v33x5s"),C(V,"class","menuButton twoColButton svelte-1v33x5s"),tn(V,"float","right"),C(n,"class","commands svelte-1v33x5s")},m(v,B){O(v,n,B),Ce(o,n,null),g(n,r),Ce(l,n,null),g(n,d),g(n,b),g(b,E),g(n,y),g(n,k),g(k,D),g(D,_),g(k,N),g(k,V),g(V,re),g(n,ue),j&&j.m(n,null),T=!0,Z||(le=[Oe(window,"keydown",st(e[8])),Oe(b,"click",e[9]),Oe(D,"click",e[16]),Oe(V,"click",e[17])],Z=!0)},p(v,[B]){const G={};B&128&&(G.header=v[7]("content.menu.mainMenu.header")),B&4&&(G.footer=`${v[2].date} - ${v[2].hash}`),!t&&B&2&&(t=!0,G.debugMode=v[1],pe(()=>t=!1)),!s&&B&8&&(s=!0,G.showMenu=v[3],pe(()=>s=!1)),!i&&B&64&&(i=!0,G.buttons=v[6],pe(()=>i=!1)),o.$set(G);const U={};B&128&&(U.header=v[7]("content.menu.loadGame.header")),!a&&B&2&&(a=!0,U.debugMode=v[1],pe(()=>a=!1)),!c&&B&16&&(c=!0,U.showMenu=v[4],pe(()=>c=!1)),!u&&B&32&&(u=!0,U.buttons=v[5],pe(()=>u=!1)),l.$set(U),(!T||B&128)&&p!==(p=v[7]("content.menu.menuButton")+"")&&S(E,p),(!T||B&128)&&A!==(A=v[7]("content.actions.next")+"")&&S(_,A),(!T||B&128)&&P!==(P=v[7]("content.actions.action")+"")&&S(re,P),v[0].dungeon.beaten?j?j.p(v,B):(j=bo(v),j.c(),j.m(n,null)):j&&(j.d(1),j=null)},i(v){T||(Q(o.$$.fragment,v),Q(l.$$.fragment,v),T=!0)},o(v){z(o.$$.fragment,v),z(l.$$.fragment,v),T=!1},d(v){v&&f(n),Te(o),Te(l),j&&j.d(),Z=!1,wn(le)}}}function Ri(e,n,o){let t;Ze(e,Je,F=>o(7,t=F));let{state:s}=n,{debugMode:i}=n,{buildInfo:r}=n,l=!1,a=!1,c=[],u=[];const d=()=>{o(1,i=!i),o(0,s.settings.debug=i,s),ce(s)},b=F=>{switch(F.key){case"6":case"d":Ye("R",s);break;case"9":case"e":Ye("UR",s);break;case"8":case"w":Ye("U",s);break;case"7":case"q":Ye("UL",s);break;case"4":case"a":Ye("L",s);break;case"1":case"z":Ye("DL",s);break;case"2":case"x":Ye("D",s);break;case"3":case"c":Ye("DR",s);break;case"0":case" ":o(0,s=Ln(s));break;case"-":case"r":Oo(s);break;case"+":case"f":Ro(s);break}},p=()=>{o(0,s=jo()),ce(s),o(3,l=!1)},E=()=>{as(s),o(3,l=!1)},y=()=>{o(0,s.dungeon=Ii,s),ce(s),o(3,l=!1)},k=()=>{o(3,l=!1),o(4,a=!0),o(5,c=D())},D=()=>{const F=[],Ie=localStorage.getItem("autosave");Ie&&F.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.autoSave"),onClick:()=>_(Ie)});const $=localStorage.getItem("state");return $&&F.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.manualSave"),onClick:()=>_($)}),F.push({debugModeOnly:!1,label:t("content.menu.loadGame.buttons.back"),onClick:()=>{o(3,l=!0),o(4,a=!1)}}),F},A=()=>[{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.newGame"),onClick:p},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.saveGame"),onClick:E},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.loadGame"),onClick:k},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.debug"),onClick:d},{debugModeOnly:!0,label:t("content.menu.mainMenu.buttons.testingGrounds"),onClick:y},{debugModeOnly:!1,label:t("content.menu.mainMenu.buttons.language"),onClick:V}],_=F=>{o(0,s=Zo(JSON.parse(F))),o(3,l=!1),o(4,a=!1)},N=()=>{o(6,u=A()),a?o(3,l=!1):o(3,l=!l),o(4,a=!1)},V=()=>{it.get()==="en"?(Cn("sv"),o(0,s.settings.locale="sv",s)):(Cn("en"),o(0,s.settings.locale="en",s)),o(6,u=A()),ce(s)};u=A();function P(F){i=F,o(1,i)}function re(F){l=F,o(3,l)}function ue(F){u=F,o(6,u)}function T(F){i=F,o(1,i)}function Z(F){a=F,o(4,a)}function le(F){c=F,o(5,c)}const ae=()=>o(0,s=Ln(s)),me=()=>kt(s),oe=()=>ms(s);return e.$$set=F=>{"state"in F&&o(0,s=F.state),"debugMode"in F&&o(1,i=F.debugMode),"buildInfo"in F&&o(2,r=F.buildInfo)},[s,i,r,l,a,c,u,t,b,N,P,re,ue,T,Z,le,ae,me,oe]}class Ci extends He{constructor(n){super(),Ne(this,n,Ri,Mi,_e,{state:0,debugMode:1,buildInfo:2})}}const Ti="2023-10-02",Li="55b693c",wi={date:Ti,hash:Li};function Hi(e){let n,o,t,s,i,r,l,a,c,u,d,b,p,E,y,k;t=new yi({props:{state:e[0]}});function D(T){e[2](T)}function A(T){e[3](T)}let _={};e[0]!==void 0&&(_.state=e[0]),e[1]!==void 0&&(_.debugMode=e[1]),i=new $s({props:_}),ge.push(()=>he(i,"state",D)),ge.push(()=>he(i,"debugMode",A));function N(T){e[4](T)}function V(T){e[5](T)}let P={buildInfo:wi};e[0]!==void 0&&(P.state=e[0]),e[1]!==void 0&&(P.debugMode=e[1]),u=new Ci({props:P}),ge.push(()=>he(u,"state",N)),ge.push(()=>he(u,"debugMode",V));function re(T){e[6](T)}let ue={};return e[0]!==void 0&&(ue.state=e[0]),E=new Ei({props:ue}),ge.push(()=>he(E,"state",re)),{c(){n=L("div"),o=L("div"),Me(t.$$.fragment),s=ee(),Me(i.$$.fragment),a=ee(),c=L("div"),Me(u.$$.fragment),p=ee(),Me(E.$$.fragment),this.h()},l(T){n=w(T,"DIV",{class:!0});var Z=H(n);o=w(Z,"DIV",{class:!0});var le=H(o);Re(t.$$.fragment,le),le.forEach(f),s=ne(Z),Re(i.$$.fragment,Z),Z.forEach(f),a=ne(T),c=w(T,"DIV",{class:!0,id:!0});var ae=H(c);Re(u.$$.fragment,ae),p=ne(ae),Re(E.$$.fragment,ae),ae.forEach(f),this.h()},h(){C(o,"class","characterSide svelte-3spdd7"),C(n,"class","container svelte-3spdd7"),C(c,"class","container svelte-3spdd7"),C(c,"id","footer")},m(T,Z){O(T,n,Z),g(n,o),Ce(t,o,null),g(n,s),Ce(i,n,null),O(T,a,Z),O(T,c,Z),Ce(u,c,null),g(c,p),Ce(E,c,null),k=!0},p(T,[Z]){const le={};Z&1&&(le.state=T[0]),t.$set(le);const ae={};!r&&Z&1&&(r=!0,ae.state=T[0],pe(()=>r=!1)),!l&&Z&2&&(l=!0,ae.debugMode=T[1],pe(()=>l=!1)),i.$set(ae);const me={};!d&&Z&1&&(d=!0,me.state=T[0],pe(()=>d=!1)),!b&&Z&2&&(b=!0,me.debugMode=T[1],pe(()=>b=!1)),u.$set(me);const oe={};!y&&Z&1&&(y=!0,oe.state=T[0],pe(()=>y=!1)),E.$set(oe)},i(T){k||(Q(t.$$.fragment,T),Q(i.$$.fragment,T),Q(u.$$.fragment,T),Q(E.$$.fragment,T),k=!0)},o(T){z(t.$$.fragment,T),z(i.$$.fragment,T),z(u.$$.fragment,T),z(E.$$.fragment,T),k=!1},d(T){T&&(f(n),f(a),f(c)),Te(t),Te(i),Te(u),Te(E)}}}function Ni(e,n,o){let t,s=null;s=localStorage.getItem("reloadGuard"),s?t=Zo(JSON.parse(s)):t=jo(),Cn(t.settings.locale);let i=t.settings.debug;function r(d){t=d,o(0,t)}function l(d){i=d,o(1,i)}function a(d){t=d,o(0,t)}function c(d){i=d,o(1,i)}function u(d){t=d,o(0,t)}return[t,i,r,l,a,c,u]}class Ui extends He{constructor(n){super(),Ne(this,n,Ni,Hi,_e,{})}}export{Ui as component};
